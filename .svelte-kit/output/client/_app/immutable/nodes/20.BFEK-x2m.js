import"../chunks/disclose-version.Bg9kRutz.js";import{f as Ae,p as Se,c as s,r as a,s as i,t as z,a as Ee,g as e,n as Be,d as u,b as n,an as it,e as Re,m as Xe}from"../chunks/utils.CRNn4dtP.js";import{s as P}from"../chunks/render.xPn1qZIb.js";import{i as ce}from"../chunks/if.CRsBAEFG.js";import{c as $e,a as M,d as Te,t as I}from"../chunks/store.B1kL-7Ni.js";import{i as ht}from"../chunks/lifecycle.DSkr6FdQ.js";import{o as ot}from"../chunks/index-client.BdGz_wQc.js";import{s as k}from"../chunks/supabaseClient.BTuNJN2N.js";import{e as be,i as Ne}from"../chunks/each.v0RK4Yef.js";import{l as bt,s as yt,p as wt,a as _}from"../chunks/preload-helper.Dwm_PvIR.js";import{c as Ze,r as qe,s as kt}from"../chunks/attributes.BcfEV1VJ.js";import{s as nt}from"../chunks/class.CstC7PuZ.js";import{b as me}from"../chunks/input.o7SqHMM4.js";import{b as je}from"../chunks/select.CgyWjfO5.js";import{I as Rt,s as At}from"../chunks/Icon.CEA2x5sb.js";import{T as lt}from"../chunks/trash-2.B2J2poVW.js";import{L as Nt}from"../chunks/loader-circle.D00fYFri.js";import{C as St,a as Et}from"../chunks/circle-x.DAt5zSv4.js";import{P as Pt}from"../chunks/plus.BBSv_QI7.js";import{S as Mt}from"../chunks/save.D1ZZhgaf.js";import{E as Ct,a as Ft}from"../chunks/jspdf.plugin.autotable.hR4uI5lc.js";import{A as st}from"../chunks/arrow-up-down.Ck2frNgV.js";import{S as Dt}from"../chunks/search.B4Eo5Hu8.js";import{D as zt}from"../chunks/download.CIM__xX3.js";function It(R,r){const l=bt(r,["children","$$slots","$$events","$$legacy"]);Rt(R,yt({name:"arrow-up-right"},()=>l,{iconNode:[["path",{d:"M7 7h10v10"}],["path",{d:"M7 17 17 7"}]],children:(b,x)=>{var g=$e(),p=Ae(g);At(p,r,"default",{}),M(b,g)},$$slots:{default:!0}}))}var Lt=(R,r)=>r.removeRow(r.index),qt=I("<option> </option>"),jt=I('<div class="bg-white rounded-xl shadow-lg p-6"><div class="flex justify-between items-start mb-6"><div><h3 class="text-lg font-semibold text-gray-800"> </h3></div> <div class="flex items-center gap-4"><a><span class="text-sm">Risk Assessment</span> <!></a> <button class="text-red-500 hover:text-red-600"><!></button></div></div> <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Risk Statement</label> <textarea placeholder="Enter risk statement..." class="w-full h-24 px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-blue-500"></textarea></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Actions</label> <textarea placeholder="Enter actions..." class="w-full h-24 px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-blue-500"></textarea></div></div> <div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Classification</label> <select class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-blue-500"><option>Select classification</option><!></select></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Key Persons</label> <textarea placeholder="Enter key persons..." class="w-full h-24 px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-blue-500"></textarea></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Budget</label> <input type="number" placeholder="Enter budget..." class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-blue-500"></div></div></div></div>');function Bt(R,r){Se(r,!0);let l=wt(r,"risk",7);var f=jt(),b=s(f),x=s(b),g=s(x),p=s(g,!0);a(g),a(x);var N=i(x,2),c=s(N),C=i(s(c),2);It(C,{class:"w-4 h-4"}),a(c);var L=i(c,2);L.__click=[Lt,r];var Q=s(L);lt(Q,{class:"w-5 h-5"}),a(L),a(N),a(b);var q=i(b,2),J=s(q),D=s(J),te=i(s(D),2);Ze(te),a(D);var W=i(D,2),X=i(s(W),2);Ze(X),a(W),a(J);var G=i(J,2),S=s(G),j=i(s(S),2),H=s(j);H.value=(H.__value=null)==null?"":null;var B=i(H);be(B,17,()=>r.classification,Ne,(F,U)=>{var $=qt(),v={},y=s($,!0);a($),z(()=>{v!==(v=e(U).id)&&($.value=($.__value=e(U).id)==null?"":e(U).id),P(y,e(U).name)}),M(F,$)}),a(j),a(S);var T=i(S,2),Y=i(s(T),2);Ze(Y),a(T);var Z=i(T,2),re=i(s(Z),2);qe(re),a(Z),a(G),a(q),a(f),z(()=>{P(p,l().rrn),kt(c,"href",`/risks/riskAssessment?riskId=${l().id}`),nt(c,`${(l().id?"":"pointer-events-none opacity-50")??""} inline-flex items-center text-blue-600 hover:text-blue-700 gap-1`)}),me(te,()=>l().risk_statement,F=>l().risk_statement=F),me(X,()=>l().actions,F=>l().actions=F),je(j,()=>l().classification,F=>l().classification=F),me(Y,()=>l().key_persons,F=>l().key_persons=F),me(re,()=>l().budget,F=>l().budget=F),M(R,f),Ee()}Te(["click"]);var Tt=I('<div class="flex items-center justify-center p-8"><div class="flex flex-col items-center gap-2"><!> <p class="text-gray-600">Loading risks...</p></div></div>');function Ut(R){var r=Tt(),l=s(r),f=s(l);Nt(f,{class:"w-8 h-8 animate-spin text-blue-600"}),Be(2),a(l),a(r),M(R,r)}var Vt=I('<div class="flex items-center gap-2 p-4 mb-4 text-sm rounded-lg bg-green-50 text-green-600"><!> <span> </span></div>'),Ht=I('<div class="flex items-center gap-2 p-4 mb-4 text-sm rounded-lg bg-red-50 text-red-600"><!> <span> </span></div>'),Kt=I("<!> <!>",1);function Yt(R,r){var l=Kt(),f=Ae(l);ce(f,()=>r.successMessage,x=>{var g=Vt(),p=s(g);St(p,{class:"w-5 h-5"});var N=i(p,2),c=s(N,!0);a(N),a(g),z(()=>P(c,r.successMessage)),M(x,g)});var b=i(f,2);ce(b,()=>r.errorMessage,x=>{var g=Ht(),p=s(g);Et(p,{class:"w-5 h-5"});var N=i(p,2),c=s(N,!0);a(N),a(g),z(()=>P(c,r.errorMessage)),M(x,g)}),M(R,l)}const Ot=(R,r,l,f,b)=>{var g,p;const x=`RRN-${e(r)}-${String(e(l)).padStart(3,"0")}`;it(l),n(f,_([...e(f),{rrn:x,risk_statement:"",classification:null,actions:"",key_persons:"",budget:0,profile_id:((g=e(b))==null?void 0:g.id)||"",department_id:((p=e(b))==null?void 0:p.department_id)||""}]))},Qt=async(R,r,l,f,b,x)=>{var g;n(r,!0);try{const p=e(l).map(({id:C,...L})=>L),{error:N}=await k.from("risks").upsert(p,{onConflict:"rrn"});if(N)throw N;const c=await k.from("risks").select("*").eq("profile_id",(g=e(f))==null?void 0:g.id);if(c.error)throw c.error;n(l,_(c.data||[])),n(b,"Risks saved successfully!"),setTimeout(()=>{n(b,null)},3e3)}catch(p){console.error("Error saving risks:",p),n(x,"Failed to save risks."),setTimeout(()=>{n(x,null)},3e3)}finally{n(r,!1)}};var Wt=I('<div class="grid grid-cols-1 gap-6 mb-8"></div>'),Gt=I('<div class="min-h-screen bg-gray-50/50"><div class="container mx-auto px-4 py-8"><div class="bg-white rounded-xl shadow-lg p-6 mb-8"><div class="flex justify-between items-center mb-6"><h1 class="text-2xl font-bold text-gray-800"> </h1> <div class="flex gap-4"><button class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"><!> Add Risk</button> <button class="inline-flex items-center px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors disabled:opacity-50"><!> </button></div></div> <!></div> <!></div></div>');function Jt(R,r){Se(r,!0);let l=u(_([])),f=u(_([])),b=u(null),x=u(""),g=u(!0),p=u(!1),N=u(null),c=u(null),C=u(1);const L=async()=>{try{await Q(),await J(),await D(),await q()}catch(v){console.error("Error fetching data:",v),n(c,"Failed to fetch data. Please try again.")}},Q=async()=>{var v,y;try{const{data:m,error:K}=await k.auth.getSession();if(K)throw K;const O=(y=(v=m==null?void 0:m.session)==null?void 0:v.user)==null?void 0:y.id;if(!O)throw new Error("No logged-in user found.");const{data:ve,error:_e}=await k.from("profiles").select("id, department_id").eq("id",O).single();if(_e)throw _e;n(b,_(ve));const{data:fe,error:Pe}=await k.from("departments").select("name").eq("id",e(b).department_id).single();if(Pe)throw Pe;n(x,_(fe.name))}catch(m){console.error("Error fetching user profile:",m),n(c,"Failed to fetch profile details.")}},q=async()=>{try{const{data:v,error:y}=await k.from("classification").select("id, name");if(y)throw y;n(f,_(v||[]))}catch(v){console.error("Error fetching classifications:",v),n(c,"Failed to fetch classifications.")}},J=async()=>{var v;try{const{data:y,error:m}=await k.from("risks").select("*").eq("profile_id",(v=e(b))==null?void 0:v.id).order("rrn",{ascending:!0});if(m)throw m;n(l,_(y||[]))}catch(y){console.error("Error fetching risks:",y),n(c,"Failed to fetch risks.")}},D=async()=>{var v;try{const{data:y,error:m}=await k.from("risks").select("rrn").eq("profile_id",(v=e(b))==null?void 0:v.id).order("rrn",{ascending:!1}).limit(1);if(m)throw m;if(y.length>0){const O=y[0].rrn.match(/(\d+)$/);n(C,_(O?parseInt(O[0],10)+1:1))}else n(C,1)}catch(y){console.error("Error fetching next RRN number:",y),n(c,"Failed to determine the next RRN number.")}},te=v=>{e(l).length>0&&v===e(l).length-1&&it(C,-1),n(l,_(e(l).filter((y,m)=>m!==v)))};ot(async()=>{n(g,!0),await L(),n(g,!1)});var W=Gt(),X=s(W),G=s(X),S=s(G),j=s(S),H=s(j);a(j);var B=i(j,2),T=s(B);T.__click=[Ot,x,C,l,b];var Y=s(T);Pt(Y,{class:"w-4 h-4 mr-2"}),Be(),a(T);var Z=i(T,2);Z.__click=[Qt,p,l,b,N,c];var re=s(Z);Mt(re,{class:"w-4 h-4 mr-2"});var F=i(re);a(Z),a(B),a(S);var U=i(S,2);ce(U,()=>e(N)||e(c),v=>{Yt(v,{get successMessage(){return e(N)},get errorMessage(){return e(c)}})}),a(G);var $=i(G,2);ce($,()=>e(g),v=>{Ut(v)},v=>{var y=Wt();be(y,21,()=>e(l),Ne,(m,K,O)=>{Bt(m,{get risk(){return e(K)},get classification(){return e(f)},index:O,removeRow:te})}),a(y),M(v,y)}),a(X),a(W),z(()=>{P(H,`${e(x)??""} Risk Register`),Z.disabled=e(p),P(F,` ${(e(p)?"Saving...":"Save All")??""}`)}),M(R,W),Ee()}Te(["click"]);var Xt=I('<div class="space-y-1"><div><span class="font-medium">Likelihood:</span> </div> <div><span class="font-medium">Severity:</span> </div> <div><span class="font-medium">Control Rating:</span> </div> <div><span class="font-medium">Monitoring Rating:</span> </div></div>'),Zt=(R,r)=>r.onApprove(r.risk.id),$t=(R,r)=>r.onDelete(r.risk.id),er=I('<tr class="hover:bg-muted/50"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"></td><td class="px-4 py-3"><div class="flex items-center gap-2"><button class="px-2 py-1 rounded bg-green-500 text-white hover:bg-green-600 disabled:opacity-50 text-sm"> </button> <button class="p-1 rounded hover:bg-muted text-red-500 hover:text-red-600 disabled:opacity-50"><!></button></div></td></tr>');function tr(R,r){Se(r,!0);var l=er(),f=s(l),b=s(f,!0);a(f);var x=i(f),g=s(x,!0);a(x);var p=i(x),N=s(p,!0);z(()=>{var H;return P(N,((H=r.classification.find(B=>B.id===r.risk.classification))==null?void 0:H.name)||"N/A")}),a(p);var c=i(p),C=s(c,!0);a(c);var L=i(c),Q=s(L,!0);a(L);var q=i(L),J=s(q);z(()=>P(J,`P${r.risk.budget.toFixed(2)??""}`)),a(q);var D=i(q);be(D,21,()=>r.riskAssessments.filter(H=>H.risk_id===r.risk.id),Ne,(H,B)=>{var T=Xt(),Y=s(T),Z=i(s(Y));z(()=>{var m;return P(Z,` ${(((m=r.likelihoodRatings.find(K=>K.id===e(B).lr))==null?void 0:m.name)||"N/A")??""}`)}),a(Y);var re=i(Y,2),F=i(s(re));z(()=>{var m;return P(F,` ${(((m=r.severities.find(K=>K.id===e(B).s))==null?void 0:m.value)||"N/A")??""}`)}),a(re);var U=i(re,2),$=i(s(U));z(()=>{var m;return P($,` ${(((m=r.riskControlRatings.find(K=>K.id===e(B).rcr))==null?void 0:m.name)||"N/A")??""}`)}),a(U);var v=i(U,2),y=i(s(v));z(()=>{var m;return P(y,` ${(((m=r.riskMonitoringRatings.find(K=>K.id===e(B).rmr))==null?void 0:m.status)||"N/A")??""}`)}),a(v),a(T),M(H,T)}),a(D);var te=i(D),W=s(te),X=s(W);X.__click=[Zt,r];var G=s(X,!0);a(X);var S=i(X,2);S.__click=[$t,r];var j=s(S);lt(j,{size:16}),a(S),a(W),a(te),a(l),z(()=>{P(b,r.risk.rrn),P(g,r.risk.risk_statement),P(C,r.risk.actions),P(Q,r.risk.key_persons),X.disabled=r.approvingId===r.risk.id||r.userRole==="admin"&&r.risk.is_approved||r.userRole==="vice_president"&&(!r.risk.is_approved||r.risk.is_approved_vp)||r.userRole==="president"&&(!r.risk.is_approved_vp||r.risk.is_approved_president),P(G,r.approvingId===r.risk.id?"Processing...":r.userRole==="admin"?r.risk.is_approved?"Admin Approved":"Approve":r.userRole==="vice_president"?r.risk.is_approved_vp?"VP Approved":"Approve":r.userRole==="president"&&r.risk.is_approved_president?"President Approved":"Approve"),S.disabled=r.deletingId===r.risk.id}),M(R,l),Ee()}Te(["click"]);var rr=(R,r)=>n(r,!e(r)),ar=I("<option> </option>"),sr=I("<option> </option>"),ir=I('<div class="flex justify-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),or=(R,r)=>r("rrn"),nr=(R,r)=>n(r,e(r)-1),lr=(R,r)=>n(r,e(r)+1),dr=I('<div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">RRN <!></button></th><th class="px-4 py-3 text-left">Risk Statement</th><th class="px-4 py-3 text-left">Classification</th><th class="px-4 py-3 text-left">Actions</th><th class="px-4 py-3 text-left">Key Persons</th><th class="px-4 py-3 text-left">Budget</th><th class="px-4 py-3 text-left">Risk Assessments</th><th class="px-4 py-3 text-left w-[150px]">Actions</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary rounded-lg px-2 py-1 w-full sm:w-auto"><option>5 per page</option><option>10 per page</option><option>25 per page</option><option>50 per page</option></select> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Next</button></div></div></div>',1),cr=I('<div class="flex flex-col gap-4 container mx-auto p-6"><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><h2 class="text-2xl font-bold">Risk Management</h2></div> <button class="md:hidden w-full px-4 py-2 bg-secondary rounded-lg text-left flex justify-between items-center">Filters <!></button> <div><div class="flex flex-col md:flex-row gap-4 w-full md:w-auto flex-1"><div class="relative flex-2 md:w-[300px]"><!> <input type="text" placeholder="Search risks..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full"></div> <select class="bg-secondary rounded-lg px-3 py-2 w-full md:w-[200px]"><option>All Departments</option><!></select> <select class="bg-secondary rounded-lg px-3 py-2 w-full md:w-[200px]"><option>All Classifications</option><!></select></div> <div class="flex flex-col md:flex-row gap-4 w-full md:w-auto"><div class="flex items-center gap-2"><input type="number" placeholder="Min Budget" class="bg-secondary rounded-lg px-3 py-2 w-[150px]"> <span class="text-muted-foreground">to</span> <input type="number" placeholder="Max Budget" class="bg-secondary rounded-lg px-3 py-2 w-[150px]"></div> <button class="flex items-center gap-2 bg-secondary px-4 py-2 rounded-lg hover:bg-secondary/80"><!> Export PDF</button></div></div> <!></div>');function vr(R,r){Se(r,!0);let l=[];const f=async()=>{const{data:{session:t}}=await k.auth.getSession();if(!t||!t.user)return;const{data:o,error:d}=await k.from("profiles").select("role, first_name, last_name").eq("id",t.user.id).single();if(d){console.error("Error fetching user role:",d);return}n(O,_(o.role)),e(O)==="admin"&&n(ve,`${o.first_name} ${o.last_name}`)},b=async()=>{try{const{data:t,error:o}=await k.from("profiles").select("first_name, last_name").eq("role","admin");o||!t?(console.error("Error fetching admin names:",o||"No data found"),n(ve,"N/A")):n(ve,_(t.map(d=>`${d.first_name} ${d.last_name}`).join(", ")))}catch(t){console.error("Error fetching admin details:",t),n(ve,"N/A")}},x=async()=>{try{const{data:t,error:o}=await k.from("profiles").select("first_name, last_name, role").in("role",["vice_president","president"]);if(o||!t){console.error("Error fetching VP and President names:",o||"No data found"),n(_e,"N/A"),n(fe,"N/A");return}const d=t.find(h=>h.role==="vice_president"),w=t.find(h=>h.role==="president");n(_e,_(d?`${d.first_name} ${d.last_name}`:"N/A")),n(fe,_(w?`${w.first_name} ${w.last_name}`:"N/A"))}catch(t){console.error("Error fetching VP and President details:",t),n(_e,"N/A"),n(fe,"N/A")}},g=async()=>{const{data:t,error:o}=await k.from("departments").select("id, name");if(o){console.error("Error fetching departments:",o);return}n(re,_(t||[]))},p=async()=>{const{data:t,error:o}=await k.from("risks").select("*, profiles (first_name, last_name, departments (name))");if(o){console.error("Error fetching risks:",o);return}n(Z,_(t.map(d=>{var w,h,ie,E;return{...d,user_name:`${((w=d.profiles)==null?void 0:w.first_name)||""} ${((h=d.profiles)==null?void 0:h.last_name)||""}`,department_name:((E=(ie=d.profiles)==null?void 0:ie.departments)==null?void 0:E.name)||"N/A"}}))),te()},N=async()=>{const{data:t,error:o}=await k.from("risk_assessment").select("*");if(o){console.error("Error fetching risk assessments:",o);return}n(F,_(t||[]))},c=async()=>{const{data:t,error:o}=await k.from("classification").select("*");o||n(U,_(t||[]))},C=async()=>{const{data:t,error:o}=await k.from("likelihood_rating").select("*");o||n($,_(t||[]))},L=async()=>{const{data:t,error:o}=await k.from("severity").select("*");o||n(v,_(t||[]))},Q=async()=>{const{data:t,error:o}=await k.from("risk_control_rating").select("*");o||n(y,_(t||[]))},q=async()=>{const{data:t,error:o}=await k.from("risk_monitoring_rating").select("*");o||n(m,_(t||[]))},J=async t=>{let o={};e(O)==="admin"?o={is_approved:!0}:e(O)==="vice_president"?o={is_approved_vp:!0}:e(O)==="president"&&(o={is_approved_president:!0});try{const{data:d,error:w}=await k.from("risks").update(o).eq("id",t).select();if(w){console.error("Error approving risk:",w);return}if(e(O)==="president"&&d&&d.length>0){const h=d[0],{data:ie,error:E}=await k.from("risk_assessment").select("*").eq("risk_id",h.id);if(E){console.error("Error fetching risk assessments:",E);return}const oe=ie.map(ee=>({risk_id:h.id,likelihood_rating_id:ee.lr,severity_id:ee.s,control_rating_id:ee.rcr,monitoring_rating_id:ee.rmr,department_id:h.department_id})),{error:V}=await k.from("risk_monitoring").insert(oe);V&&console.error("Error inserting into risk_monitoring:",V),console.log("Risk Monitoring Entries:",oe)}await p()}catch(d){console.error("Unexpected error while approving risk:",d)}finally{}},D=async t=>{const{error:o}=await k.from("risks").delete().eq("id",t);o?console.error("Error deleting risk:",o):await p()},te=()=>{l=e(Z)},W=()=>{var pe;const t=new Ct("landscape"),o="Risk Report",d=["Risk Statement","Classification","Budget","Likelihood","Severity","Control Rating","Monitoring Rating","Approval Status","Department"],w=e(ge).flatMap(A=>{var xe;const ne=e(F).filter(se=>se.risk_id===A.id);return ne.length===0?[[A.risk_statement,((xe=e(U).find(se=>se.id===A.classification))==null?void 0:xe.name)||"N/A",A.budget||"N/A","N/A","N/A","N/A","N/A",A.is_approved?"Admin Approved":A.is_approved_vp?"VP Approved":A.is_approved_president?"President Approved":"Pending",A.department_name||"N/A"]]:ne.map(se=>{var we,he,ke,de,Le;return[A.risk_statement,((we=e(U).find(le=>le.id===A.classification))==null?void 0:we.name)||"N/A",A.budget||"N/A",((he=e($).find(le=>le.id===se.lr))==null?void 0:he.name)||"N/A",((ke=e(v).find(le=>le.id===se.s))==null?void 0:ke.value)||"N/A",((de=e(y).find(le=>le.id===se.rcr))==null?void 0:de.name)||"N/A",((Le=e(m).find(le=>le.id===se.rmr))==null?void 0:Le.status)||"N/A",A.is_approved?"Admin Approved":A.is_approved_vp?"VP Approved":A.is_approved_president?"President Approved":"Pending",A.department_name||"N/A"]})});t.setFontSize(14),t.text(o,14,15),t.setFontSize(10);let h=[];if(e(G)&&h.push(`Search: "${e(G)}"`),e(Y)!=="all"&&h.push(`Department: ${e(Y)}`),e(ue)!=="all"){const A=(pe=e(U).find(ne=>ne.id===e(ue)))==null?void 0:pe.name;h.push(`Classification: ${A}`)}ae.min&&h.push(`Min Budget: ${ae.min}`),ae.max&&h.push(`Max Budget: ${ae.max}`),h.length>0&&t.text(`Filters applied: ${h.join(" | ")}`,14,22),t.setFontSize(14),t.text(o,14,15),Ft(t,{head:[d],body:w,startY:25,theme:"grid",styles:{fontSize:10},headStyles:{fillColor:[41,128,185]}});const E=t.internal.pageSize.height-40,oe=t.internal.pageSize.width/4,V=[14,oe,oe*2,oe*3];t.setFontSize(10);const ee=l[0],De=(ee==null?void 0:ee.user_name)||"Unknown",ze=(ee==null?void 0:ee.department_name)||"Unknown";t.text(`${De||"Unknown"} (sgnd)`,V[0],E-5),t.text("_________________________",V[0],E),t.text(`${ze||"Unknown"} Department Head`,V[0],E+5),t.text(`${e(ve)||"N/A"} (sgnd)`,V[1],E-5),t.text("_________________________",V[1],E),t.text("Corporate Planning Officer",V[1],E+5),t.text(`${e(_e)||"N/A"} (sgnd)`,V[2],E-5),t.text("_________________________",V[2],E),t.text("Vice President",V[2],E+5),t.text(`${e(fe)||"N/A"} (sgnd)`,V[3],E-5),t.text("_________________________",V[3],E),t.text("President",V[3],E+5);const ye=new Date().toLocaleString(),Je=w.length,Ie=e(ge).reduce((A,ne)=>A+(ne.budget||0),0);t.setFontSize(8),t.text(`Exported on: ${ye} | Total Records: ${Je} | Total Budget: P${Ie}`,14,t.internal.pageSize.height-10),t.save("Risk_Report.pdf"),t.save("Risk_Report.pdf")},X=async()=>{await f(),await b(),await g(),await p(),await N(),await c(),await C(),await L(),await Q(),await q(),await x(),n(K,!1)};let G=u(""),S=u(1),j=u(5),H=u(!1),B=u("rrn"),T=u("asc"),Y=u("all"),Z=u(_([])),re=u(_([])),F=u(_([])),U=u(_([])),$=u(_([])),v=u(_([])),y=u(_([])),m=u(_([])),K=u(!0),O=u(null),ve=u(null),_e=u(null),fe=u(null),Pe=null,dt=null,ue=u("all"),ae=_({min:null,max:null});const ct=t=>{e(B)===t?n(T,_(e(T)==="asc"?"desc":"asc")):(n(B,_(t)),n(T,"asc"))},ge=Re(()=>e(Z).filter(t=>{const d=`${t.rrn} ${t.risk_statement} ${t.department_name}`.toLowerCase().includes(e(G).toLowerCase()),w=e(Y)==="all"||t.department_name===e(Y),h=e(ue)==="all"||t.classification===e(ue),ie=(!ae.min||t.budget>=ae.min)&&(!ae.max||t.budget<=ae.max);return d&&w&&h&&ie}).sort((t,o)=>{const d=String(t[e(B)]),w=String(o[e(B)]);return e(T)==="asc"?d.localeCompare(w):w.localeCompare(d)})),vt=Re(()=>e(ge).slice((e(S)-1)*e(j),e(S)*e(j))),_t=Re(()=>Math.ceil(e(ge).length/e(j)));X();var Ue=cr(),Me=i(s(Ue),2);Me.__click=[rr,H];var pt=i(s(Me)),mt=Re(()=>e(H)?"rotate-180":"");st(pt,{size:16,get class(){return e(mt)}}),a(Me);var Ce=i(Me,2),Ve=s(Ce),He=s(Ve),et=s(He);Dt(et,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var tt=i(et,2);qe(tt),a(He);var Fe=i(He,2),Ke=s(Fe);Ke.value=(Ke.__value="all")==null?"":"all";var ft=i(Ke);be(ft,17,()=>e(re),Ne,(t,o)=>{var d=ar(),w={},h=s(d,!0);a(d),z(()=>{w!==(w=e(o).name)&&(d.value=(d.__value=e(o).name)==null?"":e(o).name),P(h,e(o).name)}),M(t,d)}),a(Fe);var Ye=i(Fe,2),Oe=s(Ye);Oe.value=(Oe.__value="all")==null?"":"all";var ut=i(Oe);be(ut,17,()=>e(U),Ne,(t,o)=>{var d=sr(),w={},h=s(d,!0);a(d),z(()=>{w!==(w=e(o).id)&&(d.value=(d.__value=e(o).id)==null?"":e(o).id),P(h,e(o).name)}),M(t,d)}),a(Ye),a(Ve);var rt=i(Ve,2),Qe=s(rt),We=s(Qe);qe(We);var at=i(We,4);qe(at),a(Qe);var Ge=i(Qe,2);Ge.__click=W;var gt=s(Ge);zt(gt,{size:20}),Be(),a(Ge),a(rt),a(Ce);var xt=i(Ce,2);ce(xt,()=>e(K),t=>{var o=ir();M(t,o)},t=>{var o=dr(),d=Ae(o),w=s(d),h=s(w),ie=s(h),E=s(ie),oe=s(E);oe.__click=[or,ct];var V=i(s(oe)),ee=Re(()=>e(B)==="rrn"?"text-primary":"");st(V,{size:16,get class(){return e(ee)}}),a(oe),a(E),Be(7),a(ie),a(h);var De=i(h);be(De,21,()=>e(vt),de=>de.id,(de,Le)=>{tr(de,{get risk(){return e(Le)},get userRole(){return e(O)},get classification(){return e(U)},get likelihoodRatings(){return e($)},get severities(){return e(v)},get riskControlRatings(){return e(y)},get riskMonitoringRatings(){return e(m)},get riskAssessments(){return e(F)},onDelete:D,onApprove:J,get approvingId(){return Pe},get deletingId(){return dt}})}),a(De),a(w),a(d);var ze=i(d,2),ye=s(ze),Je=s(ye);z(()=>P(Je,`Showing ${(e(S)-1)*e(j)+1} to ${Math.min(e(S)*e(j),e(ge).length)??""} of ${e(ge).length??""} results`)),a(ye);var Ie=i(ye,2),pe=s(Ie),A=s(pe);A.value=(A.__value=5)==null?"":5;var ne=i(A);ne.value=(ne.__value=10)==null?"":10;var xe=i(ne);xe.value=(xe.__value=25)==null?"":25;var se=i(xe);se.value=(se.__value=50)==null?"":50,a(pe);var we=i(pe,2),he=s(we);he.__click=[nr,S];var ke=i(he,2);ke.__click=[lr,S],a(we),a(Ie),a(ze),z(()=>{he.disabled=e(S)===1,ke.disabled=e(S)===e(_t)}),je(pe,()=>e(j),de=>n(j,de)),M(t,o)}),a(Ue),z(()=>nt(Ce,`flex flex-col gap-4 ${e(H)?"block":"hidden"} md:flex md:flex-row md:flex-wrap md:justify-between`)),me(tt,()=>e(G),t=>n(G,t)),je(Fe,()=>e(Y),t=>n(Y,t)),je(Ye,()=>e(ue),t=>n(ue,t)),me(We,()=>ae.min,t=>ae.min=t),me(at,()=>ae.max,t=>ae.max=t),M(R,Ue),Ee()}Te(["click"]);var _r=I("<p>Loading...</p>"),pr=I('<p class="text-red-500"> </p>'),mr=I("<div><!></div>");function Br(R,r){Se(r,!1);let l=null,f=Xe(null),b=Xe(!0),x=Xe(null);const g=async()=>{try{const{data:c,error:C}=await k.auth.getSession();if(C)throw C;if(l=c.session,l){const{data:L,error:Q}=await k.from("profiles").select("*").eq("id",l.user.id).single();if(Q)throw Q;n(f,L),console.log("Profile Id: ",e(f).id),console.log("Profile Role: ",e(f).role)}else n(x,"User is not logged in.")}catch(c){console.error(c.message),n(x,"Failed to fetch profile data.")}finally{n(b,!1)}};ot(()=>{g()}),ht();var p=mr(),N=s(p);ce(N,()=>e(b),c=>{var C=_r();M(c,C)},c=>{var C=$e(),L=Ae(C);ce(L,()=>e(x),Q=>{var q=pr(),J=s(q,!0);a(q),z(()=>P(J,e(x))),M(Q,q)},Q=>{var q=$e(),J=Ae(q);ce(J,()=>{var D,te,W;return((D=e(f))==null?void 0:D.role)==="admin"||((te=e(f))==null?void 0:te.role)==="vice_president"||((W=e(f))==null?void 0:W.role)==="president"},D=>{vr(D,{})},D=>{Jt(D,{})}),M(Q,q)},!0),M(c,C)}),a(p),M(R,p),Ee()}export{Br as component};

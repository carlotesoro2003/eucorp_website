import{s as E}from"../chunks/supabaseClient.CaMOPPuz.js";import"../chunks/disclose-version.Bg9kRutz.js";import{j as Qe,l as ye,o as we,k as Je,w as $e,ap as Ze,aC as We,aB as Xe,a5 as et,al as tt,ak as rt,f as p,p as O,a as F,t as Pe,s as b,aN as C,aO as Ie,g as k,m as ee,ax as A,b as te,c as W,n as D,r as X}from"../chunks/runtime.CLSstnwU.js";import{k as Se,o as at,c as T,a as m,t as y,b as ke}from"../chunks/utils.kA-YjkFf.js";import{i as V}from"../chunks/if.b2Q-jNLG.js";import{I as ie,s as H}from"../chunks/Icon.BPJo08Fo.js";import{i as Y}from"../chunks/lifecycle.V0dJQ05z.js";import{s as Le,a as re}from"../chunks/store.D2tkwa9F.js";/* empty css                         */import{g as B}from"../chunks/entry.SSTTWxxn.js";import{o as Ae}from"../chunks/index-client.DT-fMr9Z.js";import{p as st}from"../chunks/stores.DWte6y18.js";import{u as K,S as ot,A as nt,a as it,b as lt,c as dt,B as ct,d as mt,e as Ne,f as ut,g as ft,h as ht,i as Me}from"../chunks/breadcrumb-page.u5MrjT7m.js";import{L as gt}from"../chunks/Login.COpvZdt1.js";import{g as le,d as Ve,w as N}from"../chunks/index.Czza9BHq.js";import{l as de,s as ce,p as _}from"../chunks/props.BD0jg91j.js";import{s as Be}from"../chunks/attributes.DiUoHvyc.js";import{a as vt}from"../chunks/render.D17u6ZCY.js";function _t(r,e,o,a,i){var l=r,t="",n;Qe(()=>{if(t===(t=e()??"")){ye&&we();return}n!==void 0&&(rt(n),n=void 0),t!==""&&(n=Je(()=>{if(ye){$e.data;for(var s=we(),c=s;s!==null&&(s.nodeType!==8||s.data!=="");)c=s,s=Ze(s);if(s===null)throw We(),Xe;Se($e,c),l=et(s);return}var u=t+"",d=at(u);Se(tt(d),d.lastChild),l.before(d)}))})}const pt=async()=>{const{data:{session:r}}=await E.auth.getSession(),{data:{user:e}}=await E.auth.getUser();return{supabase:E,user:e,session:r}},mr=Object.freeze(Object.defineProperty({__proto__:null,load:pt},Symbol.toStringTag,{value:"Module"}));function bt(r,e){const o=de(e,["children","$$slots","$$events","$$legacy"]);ie(r,ce({name:"bell"},()=>o,{iconNode:[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326"}]],children:(i,l)=>{var t=T(),n=p(t);H(n,e,"default",{}),m(i,t)},$$slots:{default:!0}}))}let Ce,Ee;function Ke(r){if(typeof document>"u")return;clearTimeout(Ce),clearTimeout(Ee);const e=document.createElement("style"),o=document.createTextNode(`* {
     -webkit-transition: none !important;
     -moz-transition: none !important;
     -o-transition: none !important;
     -ms-transition: none !important;
     transition: none !important;
  }`);e.appendChild(o);const a=()=>document.head.appendChild(e),i=()=>document.head.removeChild(e);if(typeof window.getComputedStyle<"u"){a(),r(),window.getComputedStyle(e).opacity,i();return}if(typeof window.requestAnimationFrame<"u"){a(),r(),window.requestAnimationFrame(i);return}a(),Ce=window.setTimeout(()=>{r(),Ee=window.setTimeout(i,120)},120)}function Te(r){return r.filter(e=>e.length>0)}const Re={getItem:r=>null,setItem:(r,e)=>{}},P=typeof document<"u",yt=["dark","light","system"],ae=N("mode-watcher-mode"),se=N("mode-watcher-theme"),me=$t(),oe=kt(),xe=N(void 0),ze=St(),ue=N(!0),Ue=N([]),je=N([]),qe=Nt(),wt=Mt();function $t(){const r="system",e=P?localStorage:Re,o=e.getItem(i());let a=ne(o)?o:r;function i(){return le(ae)}const{subscribe:l,set:t}=N(a,()=>{if(!P)return;const s=c=>{if(c.key!==i())return;const u=c.newValue;ne(u)?t(a=u):t(a=r)};return addEventListener("storage",s),()=>removeEventListener("storage",s)});function n(s){t(a=s),e.setItem(i(),a)}return{subscribe:l,set:n}}function St(){const r=P?localStorage:Re,e=r.getItem(a());let o=e??"";function a(){return le(se)}const{subscribe:i,set:l}=N(o,()=>{if(!P)return;const n=s=>{if(s.key!==a())return;const c=s.newValue;l(c===null?o="":o=c)};return addEventListener("storage",n),()=>removeEventListener("storage",n)});function t(n){l(o=n),r.setItem(a(),o)}return{subscribe:i,set:t}}function kt(){let e=!0;const{subscribe:o,set:a}=N(void 0,()=>{if(!P)return;const t=s=>{e&&a(s.matches?"light":"dark")},n=window.matchMedia("(prefers-color-scheme: light)");return n.addEventListener("change",t),()=>n.removeEventListener("change",t)});function i(){if(!P)return;const t=window.matchMedia("(prefers-color-scheme: light)");a(t.matches?"light":"dark")}function l(t){e=t}return{subscribe:o,query:i,tracking:l}}function Nt(){const{subscribe:r}=Ve([me,oe,xe,ue,Ue,je],([e,o,a,i,l,t])=>{if(!P)return;const n=e==="system"?o:e,s=Te(l),c=Te(t);function u(){const d=document.documentElement,g=document.querySelector('meta[name="theme-color"]');n==="light"?(s.length&&d.classList.remove(...s),c.length&&d.classList.add(...c),d.style.colorScheme="light",g&&a&&g.setAttribute("content",a.light)):(c.length&&d.classList.remove(...c),s.length&&d.classList.add(...s),d.style.colorScheme="dark",g&&a&&g.setAttribute("content",a.dark))}return i?Ke(u):u(),n});return{subscribe:r}}function Mt(){const{subscribe:r}=Ve([ze,ue],([e,o])=>{if(!P)return;function a(){document.documentElement.setAttribute("data-theme",e)}return o?Ke(a):a(),e});return{subscribe:r}}function ne(r){return typeof r!="string"?!1:yt.includes(r)}function Ct(){me.set(le(qe)==="dark"?"light":"dark")}function Et(r){me.set(r)}function Tt(r){ze.set(r)}function Pt({defaultMode:r="system",themeColors:e,darkClassNames:o=["dark"],lightClassNames:a=[],defaultTheme:i="",modeStorageKey:l="mode-watcher-mode",themeStorageKey:t="mode-watcher-theme"}){const n=document.documentElement,s=localStorage.getItem(l)||r,c=localStorage.getItem(t)||i,u=s==="light"||s==="system"&&window.matchMedia("(prefers-color-scheme: light)").matches;if(u?(o.length&&n.classList.remove(...o),a.length&&n.classList.add(...a)):(a.length&&n.classList.remove(...a),o.length&&n.classList.add(...o)),n.style.colorScheme=u?"light":"dark",e){const d=document.querySelector('meta[name="theme-color"]');d&&d.setAttribute("content",s==="light"?e.light:e.dark)}c&&(n.setAttribute("data-theme",c),localStorage.setItem(t,c)),localStorage.setItem(l,s)}var It=y('<meta name="theme-color">');function Lt(r,e){O(e,!1);let o=_(e,"themeColors",24,()=>{});Y();var a=T(),i=p(a);V(i,o,l=>{var t=It();Pe(()=>Be(t,"content",o().dark)),m(l,t)}),m(r,a),F()}var At=y('<meta name="theme-color">'),Vt=y("<!> <!>",1);function Bt(r,e){O(e,!1);let o=_(e,"trueNonce",8,""),a=_(e,"initConfig",8),i=_(e,"themeColors",24,()=>{});Y(),vt(l=>{var t=Vt(),n=p(t);V(n,i,c=>{var u=At();Pe(()=>Be(u,"content",i().dark)),m(c,u)});var s=b(n,2);_t(s,()=>`<script${o()?` nonce=${o()}`:""}>(`+Pt.toString()+")("+JSON.stringify(a())+");<\/script>",!1,!1),m(l,t)}),F()}function Kt(r,e){O(e,!1);const o=Le(),a=()=>re(ae,"$modeStorageKeyStore",o),i=()=>re(se,"$themeStorageKeyStore",o),l=ee();let t=_(e,"track",8,!0),n=_(e,"defaultMode",8,"system"),s=_(e,"themeColors",24,()=>{}),c=_(e,"disableTransitions",8,!0),u=_(e,"darkClassNames",24,()=>["dark"]),d=_(e,"lightClassNames",24,()=>[]),g=_(e,"defaultTheme",8,""),w=_(e,"nonce",8,""),h=_(e,"themeStorageKey",8,"mode-watcher-theme"),f=_(e,"modeStorageKey",8,"mode-watcher-mode"),M=_(e,"disableHeadScriptInjection",8,!1);Ae(()=>{const S=qe.subscribe(()=>{}),j=wt.subscribe(()=>{});oe.tracking(t()),oe.query();const R=localStorage.getItem(a());Et(ne(R)?R:n());const x=localStorage.getItem(i());return Tt(x||g()),()=>{S(),j()}});const v={defaultMode:n(),themeColors:s(),darkClassNames:u(),lightClassNames:d(),defaultTheme:g(),modeStorageKey:f(),themeStorageKey:h()};C(()=>A(c()),()=>{ue.set(c())}),C(()=>A(s()),()=>{xe.set(s())}),C(()=>A(u()),()=>{Ue.set(u())}),C(()=>A(d()),()=>{je.set(d())}),C(()=>A(f()),()=>{ae.set(f())}),C(()=>A(h()),()=>{se.set(h())}),C(()=>A(w()),()=>{te(l,typeof window>"u"?w():"")}),Ie(),Y();var $=T(),I=p($);V(I,M,S=>{Lt(S,{get themeColors(){return s()}})},S=>{Bt(S,{get trueNonce(){return k(l)},initConfig:v,get themeColors(){return s()}})}),m(r,$),F()}function Rt(r,e){const o=de(e,["children","$$slots","$$events","$$legacy"]);ie(r,ce({name:"sun"},()=>o,{iconNode:[["circle",{cx:"12",cy:"12",r:"4"}],["path",{d:"M12 2v2"}],["path",{d:"M12 20v2"}],["path",{d:"m4.93 4.93 1.41 1.41"}],["path",{d:"m17.66 17.66 1.41 1.41"}],["path",{d:"M2 12h2"}],["path",{d:"M20 12h2"}],["path",{d:"m6.34 17.66-1.41 1.41"}],["path",{d:"m19.07 4.93-1.41 1.41"}]],children:(i,l)=>{var t=T(),n=p(t);H(n,e,"default",{}),m(i,t)},$$slots:{default:!0}}))}function xt(r,e){const o=de(e,["children","$$slots","$$events","$$legacy"]);ie(r,ce({name:"moon"},()=>o,{iconNode:[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"}]],children:(i,l)=>{var t=T(),n=p(t);H(n,e,"default",{}),m(i,t)},$$slots:{default:!0}}))}var zt=y('<div class="flex items-center justify-center min-h-screen "><span class="loading loading-spinner loading-lg"></span></div>'),Ut=y("<!> <!> <!>",1),jt=y('<!> <!> <span class="sr-only">Toggle theme</span>',1),qt=y('<!> <span class="sr-only">Notifications</span>',1),Dt=y('<header class="flex h-16 shrink-0 items-center justify-between gap-2 transition-[width,height] ease-linear group-has-[[data-collapsible=icon]]/sidebar-wrapper:h-12 sticky top-0  z-10"><div class="flex items-center gap-2 px-4"><!> <!> <!></div> <div class="flex items-center gap-3 pr-4"><!> <!></div></header> <!>',1),Ot=y("<!> <!>",1),Ft=y('<div class="flex items-center justify-center min-h-screen "><div class="text-center"><h1 class="text-4xl font-bold  mb-4">Pending for System Access</h1> <p>Your account is under review. Please wait for verification.</p></div></div>'),Ht=y("<!> <!>",1);function ur(r,e){O(e,!1);const o=Le();let i=re(st,"$page",o).url.pathname,l=ee(!0),t=ee({session:null,isVerified:!1,userRole:null,profilePic:null,email:null,departmentName:""});const n=async()=>{var d,g,w;try{if(!k(t).session){const{data:v,error:$}=await E.auth.getSession();if($||!(v!=null&&v.session)){console.log("No active session found. Redirecting to /login."),B("/login");return}K.update(I=>({...I,session:v.session}))}const{session:h}=k(t),{data:f,error:M}=await E.from("profiles").select("id, role, is_verified, profile_pic, department_id, email, first_name, last_name").eq("id",h.user.id).single();if(M)if(M.code==="PGRST116"){console.log("User not found. Adding new user profile.");const{error:v}=await E.from("profiles").insert({id:h.user.id,email:h.user.email,first_name:((d=h.user.user_metadata)==null?void 0:d.first_name)||"New",last_name:((g=h.user.user_metadata)==null?void 0:g.last_name)||"User",role:"user",is_verified:!1});if(v){console.error("Error adding user profile:",v.message),B("/login");return}}else{console.error("Error fetching profile:",M.message),B("/login");return}f&&(K.set({session:h,isVerified:f.is_verified??!1,userRole:f.role??null,profilePic:f.profile_pic,email:f.email,departmentName:f.department_id?((w=(await E.from("departments").select("name").eq("id",f.department_id).single()).data)==null?void 0:w.name)??"No Department":"",firstName:f.first_name||"New",lastName:f.last_name||"User"}),f.is_verified&&i==="/"&&(console.log("Redirecting to /dashboard."),B("/dashboard")))}catch(h){console.error("Error during session check:",h),B("/login")}finally{te(l,!1)}};Ae(()=>{n();const{data:d}=E.auth.onAuthStateChange((g,w)=>{g==="SIGNED_OUT"?(console.log("User signed out, redirecting to /login."),K.set({session:null,isVerified:!1,userRole:null,profilePic:null,email:null,departmentName:"",firstName:"New",lastName:"User"}),B("/login")):w&&(console.log("User signed in or session updated."),K.update(h=>({...h,session:w})),n())});return()=>{d.subscription.unsubscribe()}}),C(()=>K,()=>{K.subscribe(d=>{te(t,d)})}),Ie(),Y();var s=Ht(),c=p(s);Kt(c,{});var u=b(c,2);V(u,()=>k(l),d=>{var g=zt();m(d,g)},d=>{var g=T(),w=p(g);V(w,()=>k(t).session&&k(t).isVerified,h=>{ot(h,{children:(f,M)=>{var v=Ot(),$=p(v);nt($,{get userRole(){return k(t).userRole}});var I=b($,2);it(I,{children:(S,j)=>{var R=Dt(),x=p(R),G=W(x),fe=W(G);lt(fe,{class:"-ml-1"});var he=b(fe,2);dt(he,{orientation:"vertical",class:"mr-2 h-4"});var De=b(he,2);ct(De,{children:(z,_e)=>{mt(z,{children:(L,U)=>{var q=Ut(),pe=p(q);Ne(pe,{class:"hidden md:block",children:(Q,Ye)=>{ut(Q,{href:"#",children:(J,Ge)=>{D();var Z=ke("Building Your Application");m(J,Z)},$$slots:{default:!0}})},$$slots:{default:!0}});var be=b(pe,2);ft(be,{class:"hidden md:block"});var He=b(be,2);Ne(He,{children:(Q,Ye)=>{ht(Q,{children:(J,Ge)=>{D();var Z=ke("Data Fetching");m(J,Z)},$$slots:{default:!0}})},$$slots:{default:!0}}),m(L,q)},$$slots:{default:!0}})},$$slots:{default:!0}}),X(G);var ge=b(G,2),ve=W(ge);Me(ve,{onclick:Ct,variant:"outline",size:"icon",children:(z,_e)=>{var L=jt(),U=p(L);Rt(U,{class:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"});var q=b(U,2);xt(q,{class:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),D(2),m(z,L)},$$slots:{default:!0}});var Oe=b(ve,2);Me(Oe,{variant:"outline",size:"icon",onclick:()=>alert("Notifications clicked!"),children:(z,_e)=>{var L=qt(),U=p(L);bt(U,{class:"h-[1.2rem] w-[1.2rem]"}),D(2),m(z,L)},$$slots:{default:!0}}),X(ge),X(x);var Fe=b(x,2);H(Fe,e,"default",{}),m(S,R)},$$slots:{default:!0}}),m(f,v)},$$slots:{default:!0}})},h=>{var f=T(),M=p(f);V(M,()=>!k(t).session,v=>{gt(v,{})},v=>{var $=T(),I=p($);V(I,()=>!k(t).isVerified,S=>{var j=Ft();m(S,j)},null,!0),m(v,$)},!0),m(h,f)},!0),m(d,g)}),m(r,s),F()}export{ur as component,mr as universal};

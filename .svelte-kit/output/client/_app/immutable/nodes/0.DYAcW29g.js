import{s as T,I as He,a as Me}from"../chunks/Icon.Nl6wOSVO.js";import"../chunks/disclose-version.Bg9kRutz.js";import{j as Qe,o as ve,q as _e,k as Ye,v as pe,aw as Ge,aQ as Je,aP as We,N as Xe,as as Ze,B as et,f as b,p as H,a as Q,t as Ee,s as w,l as E,d as Te,g as N,m as O,R as A,b as F,c as Z,n as j,r as ee}from"../chunks/utils.Cx6K9qTo.js";import{p as be,q as tt,e as x,a as f,t as S,r as rt,s as Ce,c as te,f as ye}from"../chunks/store.BALTJZ26.js";import{i as R}from"../chunks/if.Bgpzl8Wa.js";import{i as Y}from"../chunks/lifecycle.D0tpf3vC.js";/* empty css                         */import{g as L}from"../chunks/entry.CMKkUr-m.js";import{o as Pe}from"../chunks/index-client.lWLCSZVk.js";import{p as st}from"../chunks/stores.iWLj25CT.js";import{u as V,S as ot,A as at,a as nt,b as it,c as lt,B as dt,d as ct,e as we,f as ut,g as mt,h as ft,i as Se}from"../chunks/breadcrumb-page.CvO4NE9k.js";import{S as ht,M as gt,L as vt}from"../chunks/Login.D7hwEKVR.js";import{g as ne,d as Ie,w as C}from"../chunks/index.Cf17R-GU.js";import{l as _t,s as pt,p as _}from"../chunks/preload-helper.Tg4Km7Zr.js";import{s as Ae}from"../chunks/attributes.rzeD2olC.js";function bt(s,e,a,r,i){var d=s,t="",n;Qe(()=>{if(t===(t=e()??"")){ve&&_e();return}n!==void 0&&(et(n),n=void 0),t!==""&&(n=Ye(()=>{if(ve){pe.data;for(var o=_e(),c=o;o!==null&&(o.nodeType!==8||o.data!=="");)c=o,o=Ge(o);if(o===null)throw Je(),We;be(pe,c),d=Xe(o);return}var u=t+"",l=tt(u);be(Ze(l),l.lastChild),d.before(l)}))})}const yt=async()=>{const{data:{session:s}}=await T.auth.getSession(),{data:{user:e}}=await T.auth.getUser();return{supabase:T,user:e,session:s}},lr=Object.freeze(Object.defineProperty({__proto__:null,load:yt},Symbol.toStringTag,{value:"Module"}));function wt(s,e){const a=_t(e,["children","$$slots","$$events","$$legacy"]);He(s,pt({name:"bell"},()=>a,{iconNode:[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326"}]],children:(i,d)=>{var t=x(),n=b(t);Me(n,e,"default",{}),f(i,t)},$$slots:{default:!0}}))}let ke,$e;function Le(s){if(typeof document>"u")return;clearTimeout(ke),clearTimeout($e);const e=document.createElement("style"),a=document.createTextNode(`* {
     -webkit-transition: none !important;
     -moz-transition: none !important;
     -o-transition: none !important;
     -ms-transition: none !important;
     transition: none !important;
  }`);e.appendChild(a);const r=()=>document.head.appendChild(e),i=()=>document.head.removeChild(e);if(typeof window.getComputedStyle<"u"){r(),s(),window.getComputedStyle(e).opacity,i();return}if(typeof window.requestAnimationFrame<"u"){r(),s(),window.requestAnimationFrame(i);return}r(),ke=window.setTimeout(()=>{s(),$e=window.setTimeout(i,120)},120)}function Ne(s){return s.filter(e=>e.length>0)}const Ve={getItem:s=>null,setItem:(s,e)=>{}},P=typeof document<"u",St=["dark","light","system"],re=C("mode-watcher-mode"),se=C("mode-watcher-theme"),ie=$t(),oe=Mt(),Re=C(void 0),xe=Nt(),le=C(!0),Be=C([]),Ke=C([]),Ue=Et(),kt=Tt();function $t(){const s="system",e=P?localStorage:Ve,a=e.getItem(i());let r=ae(a)?a:s;function i(){return ne(re)}const{subscribe:d,set:t}=C(r,()=>{if(!P)return;const o=c=>{if(c.key!==i())return;const u=c.newValue;ae(u)?t(r=u):t(r=s)};return addEventListener("storage",o),()=>removeEventListener("storage",o)});function n(o){t(r=o),e.setItem(i(),r)}return{subscribe:d,set:n}}function Nt(){const s=P?localStorage:Ve,e=s.getItem(r());let a=e??"";function r(){return ne(se)}const{subscribe:i,set:d}=C(a,()=>{if(!P)return;const n=o=>{if(o.key!==r())return;const c=o.newValue;d(c===null?a="":a=c)};return addEventListener("storage",n),()=>removeEventListener("storage",n)});function t(n){d(a=n),s.setItem(r(),a)}return{subscribe:i,set:t}}function Mt(){let e=!0;const{subscribe:a,set:r}=C(void 0,()=>{if(!P)return;const t=o=>{e&&r(o.matches?"light":"dark")},n=window.matchMedia("(prefers-color-scheme: light)");return n.addEventListener("change",t),()=>n.removeEventListener("change",t)});function i(){if(!P)return;const t=window.matchMedia("(prefers-color-scheme: light)");r(t.matches?"light":"dark")}function d(t){e=t}return{subscribe:a,query:i,tracking:d}}function Et(){const{subscribe:s}=Ie([ie,oe,Re,le,Be,Ke],([e,a,r,i,d,t])=>{if(!P)return;const n=e==="system"?a:e,o=Ne(d),c=Ne(t);function u(){const l=document.documentElement,g=document.querySelector('meta[name="theme-color"]');n==="light"?(o.length&&l.classList.remove(...o),c.length&&l.classList.add(...c),l.style.colorScheme="light",g&&r&&g.setAttribute("content",r.light)):(c.length&&l.classList.remove(...c),o.length&&l.classList.add(...o),l.style.colorScheme="dark",g&&r&&g.setAttribute("content",r.dark))}return i?Le(u):u(),n});return{subscribe:s}}function Tt(){const{subscribe:s}=Ie([xe,le],([e,a])=>{if(!P)return;function r(){document.documentElement.setAttribute("data-theme",e)}return a?Le(r):r(),e});return{subscribe:s}}function ae(s){return typeof s!="string"?!1:St.includes(s)}function Ct(){ie.set(ne(Ue)==="dark"?"light":"dark")}function Pt(s){ie.set(s)}function It(s){xe.set(s)}function At({defaultMode:s="system",themeColors:e,darkClassNames:a=["dark"],lightClassNames:r=[],defaultTheme:i="",modeStorageKey:d="mode-watcher-mode",themeStorageKey:t="mode-watcher-theme"}){const n=document.documentElement,o=localStorage.getItem(d)||s,c=localStorage.getItem(t)||i,u=o==="light"||o==="system"&&window.matchMedia("(prefers-color-scheme: light)").matches;if(u?(a.length&&n.classList.remove(...a),r.length&&n.classList.add(...r)):(r.length&&n.classList.remove(...r),a.length&&n.classList.add(...a)),n.style.colorScheme=u?"light":"dark",e){const l=document.querySelector('meta[name="theme-color"]');l&&l.setAttribute("content",o==="light"?e.light:e.dark)}c&&(n.setAttribute("data-theme",c),localStorage.setItem(t,c)),localStorage.setItem(d,o)}var Lt=S('<meta name="theme-color">');function Vt(s,e){H(e,!1);let a=_(e,"themeColors",24,()=>{});Y();var r=x(),i=b(r);R(i,a,d=>{var t=Lt();Ee(()=>Ae(t,"content",a().dark)),f(d,t)}),f(s,r),Q()}var Rt=S('<meta name="theme-color">'),xt=S("<!> <!>",1);function Bt(s,e){H(e,!1);let a=_(e,"trueNonce",8,""),r=_(e,"initConfig",8),i=_(e,"themeColors",24,()=>{});Y(),rt(d=>{var t=xt(),n=b(t);R(n,i,c=>{var u=Rt();Ee(()=>Ae(u,"content",i().dark)),f(c,u)});var o=w(n,2);bt(o,()=>`<script${a()?` nonce=${a()}`:""}>(`+At.toString()+")("+JSON.stringify(r())+");<\/script>",!1,!1),f(d,t)}),Q()}function Kt(s,e){H(e,!1);const a=Ce(),r=()=>te(re,"$modeStorageKeyStore",a),i=()=>te(se,"$themeStorageKeyStore",a),d=O();let t=_(e,"track",8,!0),n=_(e,"defaultMode",8,"system"),o=_(e,"themeColors",24,()=>{}),c=_(e,"disableTransitions",8,!0),u=_(e,"darkClassNames",24,()=>["dark"]),l=_(e,"lightClassNames",24,()=>[]),g=_(e,"defaultTheme",8,""),k=_(e,"nonce",8,""),m=_(e,"themeStorageKey",8,"mode-watcher-theme"),M=_(e,"modeStorageKey",8,"mode-watcher-mode"),v=_(e,"disableHeadScriptInjection",8,!1);Pe(()=>{const p=Ue.subscribe(()=>{}),z=kt.subscribe(()=>{});oe.tracking(t()),oe.query();const B=localStorage.getItem(r());Pt(ae(B)?B:n());const K=localStorage.getItem(i());return It(K||g()),()=>{p(),z()}});const y={defaultMode:n(),themeColors:o(),darkClassNames:u(),lightClassNames:l(),defaultTheme:g(),modeStorageKey:M(),themeStorageKey:m()};E(()=>A(c()),()=>{le.set(c())}),E(()=>A(o()),()=>{Re.set(o())}),E(()=>A(u()),()=>{Be.set(u())}),E(()=>A(l()),()=>{Ke.set(l())}),E(()=>A(M()),()=>{re.set(M())}),E(()=>A(m()),()=>{se.set(m())}),E(()=>A(k()),()=>{F(d,typeof window>"u"?k():"")}),Te(),Y();var h=x(),$=b(h);R($,v,p=>{Vt(p,{get themeColors(){return o()}})},p=>{Bt(p,{get trueNonce(){return N(d)},initConfig:y,get themeColors(){return o()}})}),f(s,h),Q()}var Ut=S('<div class="flex items-center justify-center min-h-screen "><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),qt=S("<!> <!> <!>",1),zt=S('<!> <!> <span class="sr-only">Toggle theme</span>',1),Dt=S('<!> <span class="sr-only">Notifications</span>',1),jt=S('<header class="flex h-16 shrink-0 items-center justify-between gap-2 transition-[width,height] ease-linear group-has-[[data-collapsible=icon]]/sidebar-wrapper:h-12 sticky top-0  z-10"><div class="flex items-center gap-2 px-4"><!> <!> <!></div> <div class="flex items-center gap-3 pr-4"><!> <!></div></header> <!>',1),Ot=S("<!> <!>",1),Ft=S('<div class="flex items-center justify-center min-h-screen "><div class="text-center"><h1 class="text-4xl font-bold  mb-4">Pending for System Access</h1> <p>Your account is under review. Please wait for verification.</p></div></div>'),Ht=S("<!> <!>",1);function dr(s,e){H(e,!1);const a=Ce(),r=()=>te(st,"$page",a),i=O();let d=O(!0),t=O({session:null,isVerified:!1,userRole:null,profilePic:null,email:null,departmentName:""});const n=async()=>{var l,g,k;try{if(!N(t).session){const{data:h,error:$}=await T.auth.getSession();if($||!(h!=null&&h.session)){console.log("No active session found. Redirecting to /login."),L("/login");return}V.update(p=>({...p,session:h.session}))}const{session:m}=N(t);if(m.expires_at-Math.floor(Date.now()/1e3)<300){console.log("Token is expiring soon. Refreshing session...");const{data:h,error:$}=await T.auth.refreshSession();if($){console.error("Error refreshing session:",$.message),L("/login");return}else console.log("Session refreshed successfully."),V.update(p=>({...p,session:h.session}))}const{data:v,error:y}=await T.from("profiles").select("id, role, is_verified, profile_pic, department_id, email, first_name, last_name").eq("id",m.user.id).single();if(y)if(y.code==="PGRST116"){console.log("User not found. Adding new user profile.");const{error:h}=await T.from("profiles").insert({id:m.user.id,email:m.user.email,first_name:((l=m.user.user_metadata)==null?void 0:l.first_name)||"New",last_name:((g=m.user.user_metadata)==null?void 0:g.last_name)||"User",role:"user",is_verified:!1});if(h){console.error("Error adding user profile:",h.message),L("/login");return}}else{console.error("Error fetching profile:",y.message),L("/login");return}v&&(V.set({session:m,isVerified:v.is_verified??!1,userRole:v.role??null,profilePic:v.profile_pic,email:v.email,departmentName:v.department_id?((k=(await T.from("departments").select("name").eq("id",v.department_id).single()).data)==null?void 0:k.name)??"No Department":"",firstName:v.first_name||"New",lastName:v.last_name||"User"}),v.is_verified&&N(i)==="/"&&(console.log("Redirecting to /dashboard."),L("/dashboard")))}catch(m){console.error("Error during session refresh and check:",m),L("/login")}finally{F(d,!1)}};Pe(()=>{n();const{data:l}=T.auth.onAuthStateChange((g,k)=>{g==="SIGNED_OUT"?(console.log("User signed out, redirecting to /login."),V.set({session:null,isVerified:!1,userRole:null,profilePic:null,email:null,departmentName:"",firstName:"New",lastName:"User"}),L("/login")):k&&(console.log("User signed in or session updated."),V.update(m=>({...m,session:k})),n())});return()=>{l.subscription.unsubscribe()}}),E(()=>r(),()=>{F(i,r().url.pathname)}),E(()=>V,()=>{V.subscribe(l=>{F(t,l)})}),Te(),Y();var o=Ht(),c=b(o);Kt(c,{});var u=w(c,2);R(u,()=>N(d),l=>{var g=Ut();f(l,g)},l=>{var g=x(),k=b(g);R(k,()=>N(t).session&&N(t).isVerified,m=>{ot(m,{children:(M,v)=>{var y=Ot(),h=b(y);at(h,{get userRole(){return N(t).userRole}});var $=w(h,2);nt($,{children:(p,z)=>{var B=jt(),K=b(B),G=Z(K),de=Z(G);it(de,{class:"-ml-1"});var ce=w(de,2);lt(ce,{orientation:"vertical",class:"mr-2 h-4"});var qe=w(ce,2);dt(qe,{children:(U,fe)=>{ct(U,{children:(I,q)=>{var D=qt(),he=b(D);we(he,{class:"hidden md:block",children:(J,Oe)=>{ut(J,{href:"#",children:(W,Fe)=>{j();var X=ye("Building Your Application");f(W,X)},$$slots:{default:!0}})},$$slots:{default:!0}});var ge=w(he,2);mt(ge,{class:"hidden md:block"});var je=w(ge,2);we(je,{children:(J,Oe)=>{ft(J,{children:(W,Fe)=>{j();var X=ye("Data Fetching");f(W,X)},$$slots:{default:!0}})},$$slots:{default:!0}}),f(I,D)},$$slots:{default:!0}})},$$slots:{default:!0}}),ee(G);var ue=w(G,2),me=Z(ue);Se(me,{onclick:Ct,variant:"outline",size:"icon",children:(U,fe)=>{var I=zt(),q=b(I);ht(q,{class:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"});var D=w(q,2);gt(D,{class:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),j(2),f(U,I)},$$slots:{default:!0}});var ze=w(me,2);Se(ze,{variant:"outline",size:"icon",onclick:()=>alert("Notifications clicked!"),children:(U,fe)=>{var I=Dt(),q=b(I);wt(q,{class:"h-[1.2rem] w-[1.2rem]"}),j(2),f(U,I)},$$slots:{default:!0}}),ee(ue),ee(K);var De=w(K,2);Me(De,e,"default",{}),f(p,B)},$$slots:{default:!0}}),f(M,y)},$$slots:{default:!0}})},m=>{var M=x(),v=b(M);R(v,()=>!N(t).session,y=>{vt(y,{})},y=>{var h=x(),$=b(h);R($,()=>!N(t).isVerified,p=>{var z=Ft();f(p,z)},null,!0),f(y,h)},!0),f(m,M)},!0),f(l,g)}),f(s,o),Q()}export{dr as component,lr as universal};

import"../chunks/disclose-version.Bg9kRutz.js";import{p as ct,t as K,a as dt,d as X,g as e,b as p,m as v,s as c,c as l,f as pt,r as i,i as $}from"../chunks/runtime.CLSstnwU.js";import{s as M}from"../chunks/render.D17u6ZCY.js";import{i as H}from"../chunks/if.b2Q-jNLG.js";import{e as _t,i as ut}from"../chunks/each.sV1uapQk.js";import{e as b,a as g,t as x,b as bt}from"../chunks/utils.kA-YjkFf.js";import{r as P}from"../chunks/misc.C2nsS1Cr.js";import{s as vt}from"../chunks/class.9GukHOdr.js";import{b as S}from"../chunks/input.CQDk-SFX.js";import{i as gt}from"../chunks/lifecycle.V0dJQ05z.js";import{s as mt,a as ft}from"../chunks/store.D2tkwa9F.js";import{s as h}from"../chunks/supabaseClient.CaMOPPuz.js";import{o as ht}from"../chunks/index-client.DT-fMr9Z.js";import{p as xt}from"../chunks/stores.DWte6y18.js";var wt=x('<h5 class="text-md font-semibold"><strong>Strategic Goal:</strong> </h5> <h5 class="text-md font-semibold mt-2"><strong>Strategic Objective:</strong> </h5>',1),yt=x("<div><span> </span></div>"),kt=x('<tr><td><textarea class="input input-bordered w-full resize-none svelte-vxi0bz"></textarea></td><td><textarea class="input input-bordered w-full resize-none svelte-vxi0bz"></textarea></td><td><textarea class="input input-bordered w-full resize-none svelte-vxi0bz"></textarea></td><td><textarea class="input input-bordered w-full resize-none svelte-vxi0bz"></textarea></td><td><button class="btn btn-error btn-sm text-white">Delete</button></td></tr>'),jt=x('<span class="loading loading-spinner">Submitting...</span>'),At=x('<div class="min-h-screen bg-base-300 p-8"><h1 class="text-2xl font-bold mb-4">Action Plans</h1> <!> <!> <div class="overflow-x-auto"><table class="table table-zebra w-full shadow-lg rounded-lg"><thead><tr><th>Actions Taken</th><th>KPI</th><th>Target Output</th><th>Key Person Responsible</th><th>Actions</th></tr></thead><tbody></tbody></table></div> <div class="mt-4 flex gap-4"><button class="btn btn-primary">Add Row</button> <button class="btn btn-secondary"><!></button></div></div>');function Kt(Y,Z){ct(Z,!1);const tt=mt(),et=()=>ft(xt,"$page",tt);let o=v([{actions_taken:"",kpi:"",target_output:"",key_person_responsible:"",objective_id:0,profile_id:"",department_id:""}]),u={actions_taken:"",kpi:"",target_output:"",key_person_responsible:"",objective_id:0,profile_id:"",department_id:""},T=v(null),w=v(null),y=v(""),B=v("info"),m=null,k=v(!1),j="";ht(()=>{const{params:r}=et();m=parseInt(r.id),m?(u.objective_id=m,X(o,e(o)[0].objective_id=m),at(m),rt()):_("Objective ID is missing.","error")});const rt=async()=>{const{data:{user:r}}=await h.auth.getUser();if(r){const{data:t,error:a}=await h.from("profiles").select("id, department_id").eq("id",r.id).single();if(a||!t){console.error("Error fetching profile details:",a),_("Failed to fetch user profile details.","error");return}j=t.id,u.profile_id=j,X(o,e(o)[0].profile_id=j),e(o).forEach(n=>n.department_id=t.department_id),u.department_id=t.department_id}else _("User not logged in.","error")},at=async r=>{try{const{data:t,error:a}=await h.from("strategic_objectives").select("name, strategic_goal_id").eq("id",r).single();if(a||!t){console.error("Error fetching strategic objective:",a),_("Failed to fetch strategic objective.","error");return}p(T,t);const{data:n,error:d}=await h.from("strategic_goals").select("name, goal_no").eq("id",t.strategic_goal_id).single();if(d||!n){console.error("Error fetching strategic goal:",d),_("Failed to fetch strategic goal.","error");return}p(w,n)}catch(t){console.error("Error fetching strategic objective or goal:",t),_("An error occurred while fetching strategic data.","error")}},ot=()=>{p(o,[...e(o),{...u}])},st=r=>{p(o,e(o).filter((t,a)=>a!==r))},A=(r,t,a)=>{p(o,e(o).map((n,d)=>d===r?{...n,[t]:a}:n))},it=async()=>{if(e(o).length===0){_("Please add at least one action plan.","warning");return}const r=e(o).map(t=>({...t,profile_id:j||u.profile_id,department_id:t.department_id||u.department_id,objective_id:t.objective_id||u.objective_id}));try{p(k,!0);const{data:t,error:a}=await h.from("action_plans").insert(r);a?(console.error("Error submitting action plans:",a.message),_("Failed to submit action plans.","error")):(console.log("Action plans submitted successfully:",t),_("Action plans submitted successfully.","success"),p(o,[]))}catch(t){console.error("Error submitting action plans:",t),_("An error occurred while submitting action plans.","error")}finally{p(k,!1)}},_=(r,t)=>{p(y,r),p(B,t),setTimeout(()=>{p(y,"")},5e3)},z=r=>{const t=r.target;t.style.height="auto",t.style.height=`${t.scrollHeight}px`};gt();var D=At(),C=c(l(D),2);H(C,()=>e(w)&&e(T),r=>{var t=wt(),a=pt(t),n=c(l(a));i(a);var d=c(a,2),f=c(l(d));i(d),K(()=>{M(n,` ${e(w).goal_no??""} - ${e(w).name??""}`),M(f,` ${e(T).name??""}`)}),g(r,t)});var J=c(C,2);H(J,()=>e(y),r=>{var t=yt(),a=l(t),n=l(a,!0);i(a),i(t),K(()=>{vt(t,`alert alert-${e(B)??""} shadow-lg mb-4 svelte-vxi0bz`),M(n,e(y))}),g(r,t)});var F=c(J,2),L=l(F),N=c(l(L));_t(N,5,()=>e(o),ut,(r,t,a)=>{var n=kt(),d=l(n),f=l(d);P(f),i(d);var O=c(d),I=l(O);P(I),i(O);var R=c(O),q=l(R);P(q),i(R);var G=c(R),U=l(G);P(U),i(G);var W=c(G),lt=l(W);i(W),i(n),S(f,()=>e(t).actions_taken,s=>(e(t).actions_taken=s,$(()=>e(o)))),b("input",f,s=>{z(s),A(a,"actions_taken",s.target.value)}),S(I,()=>e(t).kpi,s=>(e(t).kpi=s,$(()=>e(o)))),b("input",I,s=>{z(s),A(a,"kpi",s.target.value)}),S(q,()=>e(t).target_output,s=>(e(t).target_output=s,$(()=>e(o)))),b("input",q,s=>{z(s),A(a,"target_output",s.target.value)}),S(U,()=>e(t).key_person_responsible,s=>(e(t).key_person_responsible=s,$(()=>e(o)))),b("input",U,s=>{z(s),A(a,"key_person_responsible",s.target.value)}),b("click",lt,()=>st(a)),g(r,n)}),i(N),i(L),i(F);var Q=c(F,2),V=l(Q),E=c(V,2),nt=l(E);H(nt,()=>e(k),r=>{var t=jt();g(r,t)},r=>{var t=bt("Submit");g(r,t)}),i(E),i(Q),i(D),K(()=>E.disabled=e(k)),b("click",V,ot),b("click",E,it),g(Y,D),dt()}export{Kt as component};

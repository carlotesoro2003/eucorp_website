import"./disclose-version.Bg9kRutz.js";import{f as xt,p as se,J as we,a as le,c as a,r as e,e as y,g as t,t as Y,b as i,T as ke,h as Dt,s as r,n as bt,l as qe,d as la,m as Gt}from"./utils.Cx6K9qTo.js";import{e as Et,a as v,t as m,d as pe,b as h}from"./store.BALTJZ26.js";import{I as Qt,a as Bt,s as ft}from"./Icon.Nl6wOSVO.js";import{l as Wt,s as Zt,a as N,p as Ke}from"./preload-helper.Tg4Km7Zr.js";import{i as et}from"./if.Bgpzl8Wa.js";import{e as Ct,r as $e,i as zt,b as He,c as Ye}from"./attributes.rzeD2olC.js";import{s as Ut}from"./class.DKwifj_X.js";import{t as na,f as da}from"./index.3UqCw1jp.js";import{b as Se}from"./input.BVFrb_g3.js";import{b as Jt}from"./select.BtlRD387.js";import{b as ca}from"./this.DKiYVa2M.js";import{o as Ae}from"./index-client.lWLCSZVk.js";import{C as va,a as be}from"./auto.w1CHRZhd.js";import{E as Fe,a as Je}from"./jspdf.plugin.autotable.BCh_1lSd.js";import{S as Te}from"./search.BpYLThKw.js";import{D as Qe}from"./download.K4Jw1XP8.js";import{L as _e}from"./loader-circle.DGJ4eXRr.js";import{T as ua}from"./triangle-alert.3_7etEXw.js";import{A as ue}from"./arrow-up-down.CZ0J7o1e.js";import{L as _a}from"./lightbulb.BtKHez7a.js";import{i as pa}from"./lifecycle.D0tpf3vC.js";/* empty css                 */import{E as Be}from"./eye.CaP1-WUo.js";import{c as ga}from"./riskCalculator.D3oLOKg6.js";import{X as Oe}from"./x.D9PBK57y.js";import{C as ma,a as fa}from"./circle-check.DrQe913-.js";function ha(p,o){const l=Wt(o,["children","$$slots","$$events","$$legacy"]);Qt(p,Zt({name:"building-2"},()=>l,{iconNode:[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"}],["path",{d:"M10 6h4"}],["path",{d:"M10 10h4"}],["path",{d:"M10 14h4"}],["path",{d:"M10 18h4"}]],children:(s,$)=>{var c=Et(),g=xt(c);Bt(g,o,"default",{}),v(s,c)},$$slots:{default:!0}}))}function xa(p,o){const l=Wt(o,["children","$$slots","$$events","$$legacy"]);Qt(p,Zt({name:"circle-check-big"},()=>l,{iconNode:[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335"}],["path",{d:"m9 11 3 3L22 4"}]],children:(s,$)=>{var c=Et(),g=xt(c);Bt(g,o,"default",{}),v(s,c)},$$slots:{default:!0}}))}function ba(p,o){const l=Wt(o,["children","$$slots","$$events","$$legacy"]);Qt(p,Zt({name:"circle-x"},()=>l,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"m15 9-6 6"}],["path",{d:"m9 9 6 6"}]],children:(s,$)=>{var c=Et(),g=xt(c);Bt(g,o,"default",{}),v(s,c)},$$slots:{default:!0}}))}function Yo(p,o){const l=Wt(o,["children","$$slots","$$events","$$legacy"]);Qt(p,Zt({name:"clipboard-list"},()=>l,{iconNode:[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}],["path",{d:"M12 11h4"}],["path",{d:"M12 16h4"}],["path",{d:"M8 11h.01"}],["path",{d:"M8 16h.01"}]],children:(s,$)=>{var c=Et(),g=xt(c);Bt(g,o,"default",{}),v(s,c)},$$slots:{default:!0}}))}function ya(p,o){const l=Wt(o,["children","$$slots","$$events","$$legacy"]);Qt(p,Zt({name:"clock"},()=>l,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["polyline",{points:"12 6 12 12 16 14"}]],children:(s,$)=>{var c=Et(),g=xt(c);Bt(g,o,"default",{}),v(s,c)},$$slots:{default:!0}}))}function We(p,o){const l=Wt(o,["children","$$slots","$$events","$$legacy"]);Qt(p,Zt({name:"file-text"},()=>l,{iconNode:[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}],["path",{d:"M10 9H8"}],["path",{d:"M16 13H8"}],["path",{d:"M16 17H8"}]],children:(s,$)=>{var c=Et(),g=xt(c);Bt(g,o,"default",{}),v(s,c)},$$slots:{default:!0}}))}function Jo(p,o){const l=Wt(o,["children","$$slots","$$events","$$legacy"]);Qt(p,Zt({name:"monitor"},()=>l,{iconNode:[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21"}]],children:(s,$)=>{var c=Et(),g=xt(c);Bt(g,o,"default",{}),v(s,c)},$$slots:{default:!0}}))}function wa(p,o){const l=Wt(o,["children","$$slots","$$events","$$legacy"]);Qt(p,Zt({name:"notepad-text"},()=>l,{iconNode:[["path",{d:"M8 2v4"}],["path",{d:"M12 2v4"}],["path",{d:"M16 2v4"}],["rect",{width:"16",height:"18",x:"4",y:"4",rx:"2"}],["path",{d:"M8 10h6"}],["path",{d:"M8 14h8"}],["path",{d:"M8 18h5"}]],children:(s,$)=>{var c=Et(),g=xt(c);Bt(g,o,"default",{}),v(s,c)},$$slots:{default:!0}}))}function ka(p,o){const l=Wt(o,["children","$$slots","$$events","$$legacy"]);Qt(p,Zt({name:"refresh-cw"},()=>l,{iconNode:[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}],["path",{d:"M8 16H3v5"}]],children:(s,$)=>{var c=Et(),g=xt(c);Bt(g,o,"default",{}),v(s,c)},$$slots:{default:!0}}))}var $a=m('<div class="h-[200px]"><canvas></canvas></div>');function Sa(p,o){se(o,!0);let l=null,d;const s=()=>{const g=d.getContext("2d");g&&(l=new va(g,{type:"doughnut",data:{labels:["Achieved","Not Achieved"],datasets:[{data:[o.chartData.achieved,o.chartData.notAchieved],backgroundColor:["rgb(34, 197, 94)","rgb(239, 68, 68)"],borderWidth:1,borderColor:"#fff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:document.documentElement.classList.contains("dark")?"#fff":"#000"}}}}}))};we(()=>{l&&(l.data.datasets[0].data=[o.chartData.achieved,o.chartData.notAchieved],l.update())}),Ae(()=>(s(),()=>{l&&l.destroy()}));var $=$a(),c=a($);ca(c,g=>d=g,()=>d),e($),v(p,$),le()}const Aa=(p,o,l,d)=>{const s=new Fe("landscape");try{s.setFontSize(16),s.text("MANUEL S. ENVERGA UNIVERSITY FOUNDATION",s.internal.pageSize.width/2,15,{align:"center"}),s.setFontSize(12),s.text("Plan Monitoring Report",s.internal.pageSize.width/2,22,{align:"center"}),s.text("SY 2024-2025",s.internal.pageSize.width/2,28,{align:"center"}),s.setFontSize(11);const $=t(o).length,c=t(l).achieved,g=t(l).notAchieved,W=(c/$*100).toFixed(1);s.text([`Total Plans: ${$}`,`Achieved: ${c}`,`Not Achieved: ${g}`,`Achievement Rate: ${W}%`],14,40);const Z=["Department","Actions Taken","KPI","Evaluation","Statement","Status","Time Completed"],J=t(o).map(b=>[b.department,b.actions_taken,b.kpi,b.evaluation||"Pending",b.statement||"Pending",b.is_accomplished?"Achieved":"Not Achieved",b.time_completed?new Date(b.time_completed).toLocaleString():"N/A"]);Je(s,{head:[Z],body:J,startY:60,theme:"grid",styles:{fontSize:8},headStyles:{fillColor:[41,128,185]}}),s.save("PlanMonitoring.pdf"),d("PDF exported successfully","success")}catch{d("Error exporting PDF","error")}},Na=async(p,o,l,d)=>{i(o,!0);try{const s=await fetch("/api/summary-report-plan-monitoring",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plans:t(l)})}),$=await s.json();if(!s.ok||$.error)throw new Error($.error||"Failed to generate summary.");const c=new Fe;c.setFont("times","normal"),c.setFontSize(12),c.text("MANUEL S. ENVERGA UNIVERSITY FOUNDATION",14,10),c.setFontSize(10),c.text("SY 2024-2025",14,20),c.setFontSize(14),c.text("Summary Report",14,15);const g=c.splitTextToSize($.summaryReport,180);c.setFontSize(12),c.text(g,14,35),c.save("PlanMonitoringSummary.pdf"),d("Summary report generated successfully","success")}catch{d("Error generating summary report","error")}finally{i(o,!1)}};var Ma=m("<div><span> </span></div>"),Ra=(p,o)=>i(o,!t(o)),Pa=(p,o,l,d,s)=>{i(o,N(t(l).value)),i(d,!1),s()},Ca=m("<button> </button>"),Ea=m('<div class="absolute top-full left-0 mt-1 w-48 rounded-lg bg-popover shadow-lg border border-border z-10"></div>'),La=(p,o)=>i(o,!t(o)),ja=(p,o,l,d,s)=>{i(o,N(t(l)==="All Departments"?"all":t(l))),i(d,!1),s()},Da=m("<button> </button>"),za=m('<div class="absolute top-full left-0 mt-1 w-56 rounded-lg bg-popover shadow-lg border border-border z-10"></div>'),Oa=(p,o)=>i(o,!t(o)),Fa=(p,o,l,d)=>{i(o,N(t(l).name)),i(d,!1)},Ta=m("<button> </button>"),Ia=m('<div class="absolute top-full left-0 mt-1 w-56 rounded-lg bg-white dark:bg-gray-800 shadow-lg border border-gray-200 dark:border-gray-700 z-10"></div>'),Ga=(p,o)=>i(o,!t(o)),Va=(p,o,l,d,s)=>{i(o,N(t(l)==="All Objectives"?"all":t(l))),i(d,!1),s()},qa=m("<button> </button>"),Ka=m('<div class="absolute top-full left-0 mt-1 w-56 rounded-lg bg-white dark:bg-gray-800 shadow-lg border border-gray-200 dark:border-gray-700 z-10"></div>'),Ua=m('<div class="flex items-center justify-center p-8"><!> <span class="ml-2 text-muted-foreground">Loading plans...</span></div>'),Ha=m('<tr class="hover:bg-muted/50"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><span> </span></td><td class="px-4 py-3 text-muted-foreground"> </td></tr>'),Ya=(p,o)=>ke(o,-1),Ja=(p,o)=>ke(o),Qa=m('<table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left">Department</th><th class="px-4 py-3 text-left">Action Plans</th><th class="px-4 py-3 text-left">KPI</th><th class="px-4 py-3 text-left">Actions Taken</th><th class="px-4 py-3 text-left">Statement</th><th class="px-4 py-3 text-left">Status</th><th class="px-4 py-3 text-left">Completed</th></tr></thead><tbody class="divide-y divide-border"></tbody></table> <div class="flex flex-col sm:flex-row justify-between items-center gap-4 p-4 bg-muted/50 border-t border-border"><div class="text-sm text-muted-foreground"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-ring"><option>5 per page</option><option>10 per page</option><option>25 per page</option></select> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50 transition-colors">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50 transition-colors">Next</button></div></div></div>',1),Ba=m('<div class="text-center p-8 text-muted-foreground">No plans found matching your criteria.</div>'),Wa=m('<div class="flex flex-col gap-4 p-4 container mx-auto"><!> <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div class="flex items-center gap-2"><!> <h1 class="text-2xl font-bold">Plans Monitoring</h1></div></div> <div class="grid grid-cols-1 md:grid-cols-4 gap-4"><div class="bg-card rounded-lg shadow border border-border p-4"><h3 class="text-sm font-medium text-muted-foreground">Total Plans</h3> <p class="text-2xl font-semibold mt-2"> </p></div> <div class="bg-card rounded-lg shadow border border-border p-4"><h3 class="text-sm font-medium text-muted-foreground">Achieved</h3> <p class="text-2xl font-semibold text-green-600 mt-2"> </p></div> <div class="bg-card rounded-lg shadow border border-border p-4"><h3 class="text-sm font-medium text-muted-foreground">Not Achieved</h3> <p class="text-2xl font-semibold text-red-600 mt-2"> </p></div> <div class="bg-card rounded-lg shadow border border-border p-4"><!></div></div> <div class="flex flex-col md:flex-row gap-4 mb-2 items-center justify-between"><div class="flex flex-col md:flex-row gap-4 flex-1"><div class="relative flex-1 w-full md:max-w-[300px]"><!> <input type="text" placeholder="Search plans..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <div class="relative"><button class="px-4 py-2 bg-secondary rounded-lg text-sm font-medium hover:bg-secondary/80 transition-colors flex items-center gap-2"> <!></button> <!></div> <div class="relative"><button class="px-4 py-2 bg-secondary rounded-lg text-sm font-medium hover:bg-secondary/80 transition-colors flex items-center gap-2"><!> <!></button> <!></div> <div class="relative"><button class="px-4 py-2 rounded-lg text-sm font-medium bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2"> <!></button> <!></div> <div class="relative"><button class="px-4 py-2 rounded-lg text-sm font-medium bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2"> <!></button> <!></div></div> <div class="flex gap-2"><button class="flex items-center gap-2 bg-secondary text-foreground px-4 py-2 rounded-lg hover:bg-secondary/80 justify-center flex-1 md:flex-initial whitespace-nowrap"><!> Export PDF</button> <button class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"><!> Generate Report</button></div></div> <div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><!></div></div>');function Qo(p,o){se(o,!0);let l=y(N([])),d=y(N([])),s=y("all"),$=y("all"),c=y(!0),g=y(!1),W=y(""),Z=y(!1),J=y(!1),b=y(!1),G=y(""),at=y("success"),ct=y(1),gt=y(5),Lt=Dt(()=>Math.ceil(t(d).length/t(gt))),Rt=Dt(()=>t(d).slice((t(ct)-1)*t(gt),t(ct)*t(gt)));const At=Dt(()=>({achieved:t(d).filter(x=>x.is_accomplished).length,notAchieved:t(d).filter(x=>!x.is_accomplished).length}));let jt=y(N([])),C=y("all"),V=y(!1),f=y(N([])),n=y("all"),u=y(!1),w=y(N([]));const k=[{value:"all",label:"All Status"},{value:"achieved",label:"Achieved"},{value:"not_achieved",label:"Not Achieved"}],S=x=>{var P;return((P=k.find(F=>F.value===x))==null?void 0:P.label)||"All Status"},L=(x,P)=>{i(G,N(x)),i(at,N(P)),i(b,!0),setTimeout(()=>{i(b,!1)},3e3)},rt=async()=>{i(c,!0);try{const{data:x,error:P}=await ft.from("plan_monitoring").select(`
				id,
				action_plan_id,
				evaluation,
				statement,
				is_accomplished,
				time_completed,
				department_id,
				action_plans (
					actions_taken,
					kpi,
					objective_id,
					strategic_objectives (
						name,
						strategic_goal_id,
						strategic_goals (name, goal_no)
					)
				)
			`);if(P)throw P;const{data:F,error:H}=await ft.from("departments").select("id, name");if(H)throw H;const q=Object.fromEntries(F.map(it=>[it.id,it.name]));i(l,N(x.map(it=>{var Kt,ee,de,ye,fe,ie,ce,ve,he,xe;return{id:it.id,action_plan_id:it.action_plan_id,evaluation:it.evaluation,statement:it.statement,is_accomplished:it.is_accomplished,time_completed:it.time_completed,department:q[it.department_id]||"Unassigned",actions_taken:((Kt=it.action_plans)==null?void 0:Kt.actions_taken)||"No Actions Taken",kpi:((ee=it.action_plans)==null?void 0:ee.kpi)||"No KPI",objective:((ye=(de=it.action_plans)==null?void 0:de.strategic_objectives)==null?void 0:ye.name)||"No Objective",goal:((ce=(ie=(fe=it.action_plans)==null?void 0:fe.strategic_objectives)==null?void 0:ie.strategic_goals)==null?void 0:ce.name)||"No Goal",goal_no:((xe=(he=(ve=it.action_plans)==null?void 0:ve.strategic_objectives)==null?void 0:he.strategic_goals)==null?void 0:xe.goal_no)||0}}))),T()}catch(x){console.error("Error fetching data:",x)}finally{i(c,!1)}},K=async()=>{try{const{data:x,error:P}=await ft.from("departments").select("name");if(P)throw P;i(jt,N(["All Departments",...x.map(F=>F.name)]))}catch{L("Error fetching departments","error")}},j=async()=>{try{const{data:x,error:P}=await ft.from("strategic_goals").select("name, goal_no");if(P)throw P;i(f,N([{name:"All Goals",goal_no:null},...x.map(F=>({name:`${F.goal_no} - ${F.name}`,goal_no:F.goal_no}))]))}catch(x){console.error("Error fetching strategic goals:",x)}},z=async()=>{try{const x=t(f).find(q=>q.name===t(C));let P=ft.from("strategic_objectives").select("name, strategic_goal_id");t(C)!=="all"&&(x!=null&&x.goal_no)&&(P=P.eq("strategic_goal_id",x.goal_no));const{data:F,error:H}=await P;if(H)throw H;i(w,N(["All Objectives",...F.map(q=>q.name)])),console.log("Strategic Objectives:",t(w))}catch(x){console.error("Error fetching strategic objectives:",x),i(w,N(["All Objectives"]))}};we(()=>{t(C)!=="all"?z():i(w,N(["All Objectives"]))});const T=()=>{var P;let x=t(l);if(t(s)==="achieved"?x=x.filter(F=>F.is_accomplished):t(s)==="not_achieved"&&(x=x.filter(F=>!F.is_accomplished)),t($)!=="all"&&(x=x.filter(F=>F.department===t($))),t(C)!=="all"){const F=(P=t(f).find(H=>H.name===t(C)))==null?void 0:P.goal_no;F&&(x=x.filter(H=>H.goal_no===F))}if(t(n)!=="all"&&(x=x.filter(F=>F.objective===t(n))),t(W)){const F=t(W).toLowerCase();x=x.filter(H=>{var q,it,Kt,ee;return((q=H.statement)==null?void 0:q.toLowerCase().includes(F))||((it=H.actions_taken)==null?void 0:it.toLowerCase().includes(F))||((Kt=H.kpi)==null?void 0:Kt.toLowerCase().includes(F))||((ee=H.department)==null?void 0:ee.toLowerCase().includes(F))})}i(d,N(x)),i(ct,1)};rt(),K(),j(),z(),we(()=>{T()});var _=Wa(),R=a(_);et(R,()=>t(b),x=>{var P=Ma(),F=a(P),H=a(F,!0);e(F),e(P),Y(()=>{Ut(P,`flex items-center p-4 rounded-lg ${(t(at)==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800")??""}`),h(H,t(G))}),na(3,P,()=>da),v(x,P)});var O=r(R,2),D=a(O),Q=a(D);wa(Q,{class:"w-8 h-8 text-primary"}),bt(2),e(D),e(O);var ot=r(O,2),ut=a(ot),st=r(a(ut),2),M=a(st,!0);e(st),e(ut);var E=r(ut,2),A=r(a(E),2),lt=a(A,!0);e(A),e(E);var _t=r(E,2),U=r(a(_t),2),B=a(U,!0);e(U),e(_t);var I=r(_t,2),tt=a(I);Sa(tt,{get chartData(){return t(At)}}),e(I),e(ot);var nt=r(ot,2),ht=a(nt),Ot=a(ht),Pt=a(Ot);Te(Pt,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var Mt=r(Pt,2);$e(Mt),e(Ot);var Tt=r(Ot,2),pt=a(Tt);pt.__click=[Ra,Z];var X=a(pt);Y(()=>h(X,`${S(t(s))??""} `));var $t=r(X);be($t,{class:"w-4 h-4"}),e(pt);var Ft=r(pt,2);et(Ft,()=>t(Z),x=>{var P=Ea();Ct(P,21,()=>k,zt,(F,H)=>{var q=Ca();q.__click=[Pa,s,H,Z,T];var it=a(q,!0);e(q),Y(()=>{Ut(q,`w-full px-4 py-2 text-left text-sm hover:bg-muted/50 first:rounded-t-lg last:rounded-b-lg ${(t(s)===t(H).value?"bg-muted/50":"")??""}`),h(it,t(H).label)}),v(F,q)}),e(P),v(x,P)}),e(Tt);var mt=r(Tt,2),dt=a(mt);dt.__click=[La,J];var St=a(dt);ha(St,{class:"w-4 h-4"});var vt=r(St),Nt=r(vt);be(Nt,{class:"w-4 h-4"}),e(dt);var yt=r(dt,2);et(yt,()=>t(J),x=>{var P=za();Ct(P,21,()=>t(jt),zt,(F,H)=>{var q=Da();const it=Dt(()=>`w-full px-4 py-2 text-left text-sm hover:bg-muted/50 first:rounded-t-lg last:rounded-b-lg ${(t($)===t(H).toLowerCase()?"bg-muted/50":"")??""}`);q.__click=[ja,$,H,J,T];var Kt=a(q,!0);e(q),Y(()=>{Ut(q,t(it)),h(Kt,t(H))}),v(F,q)}),e(P),v(x,P)}),e(mt);var wt=r(mt,2),kt=a(wt);kt.__click=[Oa,V];var Xt=a(kt),It=r(Xt);be(It,{class:"w-4 h-4"}),e(kt);var ge=r(kt,2);et(ge,()=>t(V),x=>{var P=Ia();Ct(P,21,()=>t(f),zt,(F,H)=>{var q=Ta();q.__click=[Fa,C,H,V];var it=a(q,!0);e(q),Y(()=>{Ut(q,`w-full px-4 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-gray-700 first:rounded-t-lg last:rounded-b-lg ${(t(C)===t(H).name?"bg-gray-50 dark:bg-gray-700":"")??""}`),h(it,t(H).name)}),v(F,q)}),e(P),v(x,P)}),e(wt);var Vt=r(wt,2),qt=a(Vt);qt.__click=[Ga,u];var te=a(qt),ae=r(te);be(ae,{class:"w-4 h-4"}),e(qt);var re=r(qt,2);et(re,()=>t(u),x=>{var P=Ka();Ct(P,21,()=>t(w),zt,(F,H)=>{var q=qa();q.__click=[Va,n,H,u,T];var it=a(q,!0);e(q),Y(()=>{Ut(q,`w-full px-4 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-gray-700 first:rounded-t-lg last:rounded-b-lg ${(t(n)===t(H)?"bg-gray-50 dark:bg-gray-700":"")??""}`),h(it,t(H))}),v(F,q)}),e(P),v(x,P)}),e(Vt),e(ht);var oe=r(ht,2),Ht=a(oe);Ht.__click=[Aa,d,At,L];var me=a(Ht);Qe(me,{class:"w-4 h-4"}),bt(),e(Ht);var ne=r(Ht,2);ne.__click=[Na,g,d,L];var Ze=a(ne);et(Ze,()=>t(g),x=>{_e(x,{class:"w-4 h-4 animate-spin"})},x=>{We(x,{class:"w-4 h-4"})}),bt(),e(ne),e(oe),e(nt);var Ie=r(nt,2),Xe=a(Ie);et(Xe,()=>t(c),x=>{var P=Ua(),F=a(P);_e(F,{class:"w-6 h-6 animate-spin text-primary"}),bt(2),e(P),v(x,P)},x=>{var P=Et(),F=xt(P);et(F,()=>t(d).length>0,H=>{var q=Qa(),it=xt(q),Kt=r(a(it));Ct(Kt,21,()=>t(Rt),zt,(Me,Yt)=>{var Re=Ha(),Pe=a(Re),ta=a(Pe,!0);e(Pe);var Ce=r(Pe),ea=a(Ce,!0);e(Ce);var Ee=r(Ce),aa=a(Ee,!0);e(Ee);var Le=r(Ee),ra=a(Le,!0);e(Le);var je=r(Le),oa=a(je,!0);e(je);var De=r(je),ze=a(De),ia=a(ze,!0);e(ze),e(De);var Ve=r(De),sa=a(Ve,!0);Y(()=>h(sa,t(Yt).time_completed?new Date(t(Yt).time_completed).toLocaleString():"N/A")),e(Ve),e(Re),Y(()=>{h(ta,t(Yt).department),h(ea,t(Yt).actions_taken),h(aa,t(Yt).kpi),h(ra,t(Yt).evaluation||"Pending"),h(oa,t(Yt).statement||"Pending"),Ut(ze,`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${(t(Yt).is_accomplished?"bg-green-100 text-green-800":"bg-red-100 text-red-800")??""}`),h(ia,t(Yt).is_accomplished?"Achieved":"Not Achieved")}),v(Me,Re)}),e(Kt),e(it);var ee=r(it,2),de=a(ee),ye=a(de);Y(()=>h(ye,`Showing ${(t(ct)-1)*t(gt)+1} to ${Math.min(t(ct)*t(gt),t(d).length)??""} of ${t(d).length??""} results`)),e(de);var fe=r(de,2),ie=a(fe),ce=a(ie);ce.value=(ce.__value=5)==null?"":5;var ve=r(ce);ve.value=(ve.__value=10)==null?"":10;var he=r(ve);he.value=(he.__value=25)==null?"":25,e(ie);var xe=r(ie,2),Ne=a(xe);Ne.__click=[Ya,ct];var Ge=r(Ne,2);Ge.__click=[Ja,ct],e(xe),e(fe),e(ee),Y(()=>{Ne.disabled=t(ct)===1,Ge.disabled=t(ct)===t(Lt)}),Jt(ie,()=>t(gt),Me=>i(gt,Me)),v(H,q)},H=>{var q=Ba();v(H,q)},!0),v(x,P)}),e(Ie),e(_),Y(()=>{h(M,t(d).length),h(lt,t(At).achieved),h(B,t(At).notAchieved),h(vt,` ${(t($)==="all"?"All Departments":t($))??""} `),h(Xt,`${(t(C)==="all"?"All Goals":t(C))??""} `),h(te,`${(t(n)==="all"?"All Objectives":t(n))??""} `),ne.disabled=t(g)}),Se(Mt,()=>t(W),x=>i(W,x)),v(p,_),le()}pe(["click"]);var Za=m('<div class="flex justify-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),Xa=(p,o)=>o("rrn"),tr=(p,o)=>o("risk_statement"),er=(p,o)=>o("likelihood_rating"),ar=(p,o)=>o("severity"),rr=m('<tr class="hover:bg-muted/50"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3 hidden lg:table-cell"> </td><td class="px-4 py-3 hidden lg:table-cell"> </td><td class="px-4 py-3 hidden md:table-cell"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><span> </span></td></tr>'),or=m('<table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">RRN <!></button></th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">Risk Statement <!></button></th><th class="px-4 py-3 text-left hidden lg:table-cell"><button class="flex items-center gap-1">Likelihood Rating <!></button></th><th class="px-4 py-3 text-left hidden lg:table-cell"><button class="flex items-center gap-1">Severity <!></button></th><th class="px-4 py-3 text-left hidden md:table-cell">Control Rating</th><th class="px-4 py-3 text-left">Monitoring Rating</th><th class="px-4 py-3 text-left">Status</th></tr></thead><tbody class="divide-y divide-border"></tbody></table>'),ir=(p,o)=>ke(o,-1),sr=(p,o)=>ke(o),lr=m('<div class="flex flex-col gap-4 p-4 container mx-auto"><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div class="flex items-center gap-2"><!> <h1 class="text-2xl font-bold">Risk Monitoring</h1></div></div> <div class="flex flex-col md:flex-row gap-4 mb-2 items-center justify-between"><div class="flex flex-col md:flex-row gap-4 flex-1"><div class="relative flex-1 w-full md:max-w-[300px]"><!> <input type="text" placeholder="Search risks..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring w-full md:w-[200px]"><option>All Status</option><option>Achieved</option><option>Still mitigating</option></select></div></div> <div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><!></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-ring"><option>5 per page</option><option>10 per page</option><option>25 per page</option></select> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50 transition-colors">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50 transition-colors">Next</button></div></div></div></div>');function Bo(p,o){se(o,!0);let l=y(N([])),d=y(!0),s=y(null),$=y(""),c=y(1),g=y(5),W=y("rrn"),Z=y("asc"),J=y("all");const b=async()=>{try{const{data:M,error:E}=await ft.from("risk_monitoring").select(`
                id,
                risks (
                    rrn,
                    risk_statement
                ),
                likelihood_rating:likelihood_rating_id(name),
                severity:severity_id(name),
                control_rating:control_rating_id(name),
                monitoring_rating:monitoring_rating_id(status),
                is_achieved
            `);if(E)throw E;i(l,N(M.map(A=>{var lt,_t,U,B;return{id:A.id,rrn:A.risks.rrn,risk_statement:A.risks.risk_statement,likelihood_rating:((lt=A.likelihood_rating)==null?void 0:lt.name)||"Not Available",severity:((_t=A.severity)==null?void 0:_t.name)||"Not Available",control_rating:((U=A.control_rating)==null?void 0:U.name)||"Not Available",monitoring_rating:((B=A.monitoring_rating)==null?void 0:B.status)||"Not Available",is_achieved:A.is_achieved}})))}catch(M){console.error("Error fetching risk monitoring data:",M),i(s,"Failed to fetch risk monitoring data.")}finally{i(d,!1)}},G=M=>{t(W)===M?i(Z,N(t(Z)==="asc"?"desc":"asc")):(i(W,N(M)),i(Z,"asc"))},at=Dt(()=>t(l).filter(M=>{const A=`${M.rrn} ${M.risk_statement} ${M.likelihood_rating} ${M.severity} ${M.control_rating} ${M.monitoring_rating}`.toLowerCase().includes(t($).toLowerCase()),lt=t(J)==="all"||M.is_achieved===t(J);return A&&lt}).sort((M,E)=>{const A=String(M[t(W)]),lt=String(E[t(W)]);return t(Z)==="asc"?A.localeCompare(lt):lt.localeCompare(A)})),ct=Dt(()=>t(at).slice((t(c)-1)*t(g),t(c)*t(g))),gt=Dt(()=>Math.ceil(t(at).length/t(g)));b();var Lt=lr(),Rt=a(Lt),At=a(Rt),jt=a(At);ua(jt,{class:"w-8 h-8 text-primary"}),bt(2),e(At),e(Rt);var C=r(Rt,2),V=a(C),f=a(V),n=a(f);Te(n,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var u=r(n,2);$e(u),e(f);var w=r(f,2),k=a(w);k.value=(k.__value="all")==null?"":"all";var S=r(k);S.value=(S.__value=!0)==null?"":!0;var L=r(S);L.value=(L.__value=!1)==null?"":!1,e(w),e(V),e(C);var rt=r(C,2),K=a(rt);et(K,()=>t(d),M=>{var E=Za();v(M,E)},M=>{var E=or(),A=a(E),lt=a(A),_t=a(lt),U=a(_t);U.__click=[Xa,G];var B=r(a(U)),I=Dt(()=>t(W)==="rrn"?"text-primary":"");ue(B,{size:16,get class(){return t(I)}}),e(U),e(_t);var tt=r(_t),nt=a(tt);nt.__click=[tr,G];var ht=r(a(nt)),Ot=Dt(()=>t(W)==="risk_statement"?"text-primary":"");ue(ht,{size:16,get class(){return t(Ot)}}),e(nt),e(tt);var Pt=r(tt),Mt=a(Pt);Mt.__click=[er,G];var Tt=r(a(Mt)),pt=Dt(()=>t(W)==="likelihood_rating"?"text-primary":"");ue(Tt,{size:16,get class(){return t(pt)}}),e(Mt),e(Pt);var X=r(Pt),$t=a(X);$t.__click=[ar,G];var Ft=r(a($t)),mt=Dt(()=>t(W)==="severity"?"text-primary":"");ue(Ft,{size:16,get class(){return t(mt)}}),e($t),e(X),bt(3),e(lt),e(A);var dt=r(A);Ct(dt,21,()=>t(ct),St=>St.id,(St,vt)=>{var Nt=rr(),yt=a(Nt),wt=a(yt,!0);e(yt);var kt=r(yt),Xt=a(kt,!0);e(kt);var It=r(kt),ge=a(It,!0);e(It);var Vt=r(It),qt=a(Vt,!0);e(Vt);var te=r(Vt),ae=a(te,!0);e(te);var re=r(te),oe=a(re,!0);e(re);var Ht=r(re),me=a(Ht),ne=a(me,!0);e(me),e(Ht),e(Nt),Y(()=>{h(wt,t(vt).rrn),h(Xt,t(vt).risk_statement),h(ge,t(vt).likelihood_rating),h(qt,t(vt).severity),h(ae,t(vt).control_rating),h(oe,t(vt).monitoring_rating),Ut(me,`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${(t(vt).is_achieved?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800")??""}`),h(ne,t(vt).is_achieved?"Achieved":"Still mitigating")}),v(St,Nt)}),e(dt),e(E),v(M,E)}),e(rt);var j=r(rt,2),z=a(j),T=a(z);Y(()=>h(T,`Showing ${(t(c)-1)*t(g)+1} to ${Math.min(t(c)*t(g),t(at).length)??""} of ${t(at).length??""} results`)),e(z);var _=r(z,2),R=a(_),O=a(R);O.value=(O.__value=5)==null?"":5;var D=r(O);D.value=(D.__value=10)==null?"":10;var Q=r(D);Q.value=(Q.__value=25)==null?"":25,e(R);var ot=r(R,2),ut=a(ot);ut.__click=[ir,c];var st=r(ut,2);st.__click=[sr,c],e(ot),e(_),e(j),e(Lt),Y(()=>{ut.disabled=t(c)===1,st.disabled=t(c)===t(gt)}),Se(u,()=>t($),M=>i($,M)),Jt(w,()=>t(J),M=>i(J,M)),Jt(R,()=>t(g),M=>i(g,M)),v(p,Lt),le()}pe(["click"]);const nr=(p,o)=>{const l=new Fe;l.text("Opportunities Monitoring Report",14,20);const d=t(o).map(s=>[s.opt_statement,s.kpi,s.planned_actions,s.evaluation||"Pending",s.achieved?"Achieved":"Not Achieved",s.time_completed?new Date(s.time_completed).toLocaleString():"N/A"]);Je(l,{head:[["Statement","KPI","Actions","Evaluation","Status","Completed"]],body:d,startY:30}),l.save("opportunities.pdf")},dr=async(p,o)=>{i(o,!0);try{doc.save("OpportunitiesSummary.pdf")}catch(l){console.error("Error generating summary:",l)}finally{i(o,!1)}};var cr=m('<div class="flex justify-center items-center min-h-[200px]"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),vr=(p,o)=>i(o,!t(o)),ur=(p,o,l,d,s)=>{i(o,N(t(l).value)),i(d,!1),s()},_r=m('<button class="w-full text-left px-4 py-2 hover:bg-secondary/80"> </button>'),pr=m('<div class="absolute right-0 mt-2 w-48 bg-card rounded-lg shadow-lg border border-border z-10"></div>'),gr=(p,o)=>o("opt_statement"),mr=m('<tr class="hover:bg-muted/50"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><span> </span></td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td></tr>'),fr=(p,o)=>i(o,t(o)-1),hr=(p,o)=>i(o,t(o)+1),xr=m('<div class="flex flex-col gap-6"><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div class="flex items-center gap-2"><!> <h1 class="text-2xl font-bold">Opportunities Monitoring</h1></div></div> <div class="flex flex-col md:flex-row justify-between items-center gap-4"><div class="relative flex-3 w-full md:max-w-[300px]"><!> <input type="text" placeholder="Search opportunities..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <div class="flex gap-2"><div class="relative"><button class="flex items-center gap-2 bg-secondary text-foreground px-4 py-2 rounded-lg hover:bg-secondary/80"> <!></button> <!></div> <button class="flex items-center gap-2 bg-secondary text-foreground px-4 py-2 rounded-lg hover:bg-secondary/80"><!> Export</button> <button class="flex items-center gap-2 bg-primary text-primary-foreground px-4 py-2 rounded-lg hover:bg-primary/90"><!> Generate Report</button></div></div> <div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Statement <!></button></th><th class="px-4 py-3 text-left">KPI</th><th class="px-4 py-3 text-left">Actions</th><th class="px-4 py-3 text-left">Evaluation</th><th class="px-4 py-3 text-left">Status</th><th class="px-4 py-3 text-left">Remarks</th><th class="px-4 py-3 text-left">Completed</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex gap-2 items-center"><select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring"><option>5 per page</option><option>10 per page</option><option>25 per page</option><option>50 per page</option></select> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Next</button></div></div></div>'),br=m('<div class="container mx-auto p-4"><!></div>');function Wo(p,o){se(o,!0);let l=y(N([])),d=y(N([])),s=y("all"),$=y(!0),c=y(!1),g=y(""),W=y(!1),Z=y("opt_statement"),J=y("asc"),b=y(1),G=y(5),at=Dt(()=>Math.ceil(t(d).length/t(G))),ct=Dt(()=>t(d).slice((t(b)-1)*t(G),t(b)*t(G)));const gt=[{value:"all",label:"All Status"},{value:"achieved",label:"Achieved"},{value:"not_achieved",label:"Not Achieved"}],Lt=f=>{var n;return((n=gt.find(u=>u.value===f))==null?void 0:n.label)||"All Status"},Rt=f=>{t(Z)===f?i(J,N(t(J)==="asc"?"desc":"asc")):(i(Z,N(f)),i(J,"asc")),jt()},At=async()=>{i($,!0);try{const{data:f,error:n}=await ft.from("opt_monitoring").select(`
                opt_id,
                opportunities (
                    opt_statement,
                    kpi,
                    planned_actions
                ),
				statement,
                evaluation,
                is_accomplished,
                time_completed
            `);if(n){console.error("Error fetching opportunities:",n);return}f&&(i(l,N(f.map(u=>{var w,k,S;return{id:u.opt_id,opt_statement:((w=u.opportunities)==null?void 0:w.opt_statement)||"No Statement Available",kpi:((k=u.opportunities)==null?void 0:k.kpi)||"No KPI Available",planned_actions:((S=u.opportunities)==null?void 0:S.planned_actions)||"No Actions Available",evaluation:u.evaluation||"Pending Evaluation",statement:u.statement||"No Statement Available",achieved:u.is_accomplished||!1,time_completed:u.time_completed||null}}))),jt())}catch(f){console.error("Unexpected error during data fetch:",f)}finally{i($,!1)}},jt=()=>{let f=t(l);if(t(s)==="achieved"?f=f.filter(n=>n.achieved):t(s)==="not_achieved"&&(f=f.filter(n=>!n.achieved)),t(g)){const n=t(g).toLowerCase();f=f.filter(u=>u.opt_statement.toLowerCase().includes(n)||u.kpi.toLowerCase().includes(n)||u.planned_actions.toLowerCase().includes(n))}f.sort((n,u)=>{const w=String(n[t(Z)]),k=String(u[t(Z)]);return t(J)==="asc"?w.localeCompare(k):k.localeCompare(w)}),i(d,N(f)),i(b,1)};we(()=>{jt()}),At();var C=br(),V=a(C);et(V,()=>t($),f=>{var n=cr();v(f,n)},f=>{var n=xr(),u=a(n),w=a(u),k=a(w);_a(k,{class:"w-8 h-8 text-primary"}),bt(2),e(w),e(u);var S=r(u,2),L=a(S),rt=a(L);Te(rt,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var K=r(rt,2);$e(K),e(L);var j=r(L,2),z=a(j),T=a(z);T.__click=[vr,W];var _=a(T);Y(()=>h(_,`${Lt(t(s))??""} `));var R=r(_);be(R,{size:20}),e(T);var O=r(T,2);et(O,()=>t(W),mt=>{var dt=pr();Ct(dt,21,()=>gt,zt,(St,vt)=>{var Nt=_r();Nt.__click=[ur,s,vt,W,jt];var yt=a(Nt,!0);e(Nt),Y(()=>h(yt,t(vt).label)),v(St,Nt)}),e(dt),v(mt,dt)}),e(z);var D=r(z,2);D.__click=[nr,d];var Q=a(D);Qe(Q,{size:20}),bt(),e(D);var ot=r(D,2);ot.__click=[dr,c];var ut=a(ot);et(ut,()=>t(c),mt=>{_e(mt,{class:"animate-spin",size:20})},mt=>{We(mt,{size:20})}),bt(),e(ot),e(j),e(S);var st=r(S,2),M=a(st),E=a(M),A=a(E),lt=a(A),_t=a(lt);_t.__click=[gr,Rt];var U=r(a(_t)),B=Dt(()=>t(Z)==="opt_statement"?"text-primary":"");ue(U,{size:16,get class(){return t(B)}}),e(_t),e(lt),bt(6),e(A),e(E);var I=r(E);Ct(I,21,()=>t(ct),zt,(mt,dt)=>{var St=mr(),vt=a(St),Nt=a(vt,!0);e(vt);var yt=r(vt),wt=a(yt,!0);e(yt);var kt=r(yt),Xt=a(kt,!0);e(kt);var It=r(kt),ge=a(It,!0);e(It);var Vt=r(It),qt=a(Vt),te=a(qt,!0);e(qt),e(Vt);var ae=r(Vt),re=a(ae,!0);e(ae);var oe=r(ae),Ht=a(oe,!0);Y(()=>h(Ht,t(dt).time_completed?new Date(t(dt).time_completed).toLocaleString():"N/A")),e(oe),e(St),Y(()=>{h(Nt,t(dt).opt_statement),h(wt,t(dt).kpi),h(Xt,t(dt).planned_actions),h(ge,t(dt).evaluation||"Pending"),Ut(qt,`inline-flex px-2 py-1 rounded-full text-xs font-medium ${(t(dt).achieved?"bg-green-100 text-green-800":"bg-red-100 text-red-800")??""}`),h(te,t(dt).achieved?"Achieved":"Not Achieved"),h(re,t(dt).statement)}),v(mt,St)}),e(I),e(M),e(st);var tt=r(st,2),nt=a(tt),ht=a(nt);Y(()=>h(ht,`Showing ${(t(b)-1)*t(G)+1} to ${Math.min(t(b)*t(G),t(d).length)??""} of ${t(d).length??""} results`)),e(nt);var Ot=r(nt,2),Pt=a(Ot),Mt=a(Pt);Mt.value=(Mt.__value=5)==null?"":5;var Tt=r(Mt);Tt.value=(Tt.__value=10)==null?"":10;var pt=r(Tt);pt.value=(pt.__value=25)==null?"":25;var X=r(pt);X.value=(X.__value=50)==null?"":50,e(Pt);var $t=r(Pt,2);$t.__click=[fr,b];var Ft=r($t,2);Ft.__click=[hr,b],e(Ot),e(tt),e(n),Y(()=>{ot.disabled=t(c),$t.disabled=t(b)===1,Ft.disabled=t(b)===t(at)}),Se(K,()=>t(g),mt=>i(g,mt)),Jt(Pt,()=>t(G),mt=>i(G,mt)),v(f,n)}),e(C),v(p,C),le()}pe(["click"]);var yr=m("<option> </option>"),wr=m("<option> </option>"),kr=m('<div class="mt-4 p-4 bg-gray-50 rounded-lg"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="flex flex-col"><label for="status" class="text-sm font-medium text-gray-700 mb-1">Status</label> <select id="status" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"></select></div> <div class="flex flex-col"><label for="goal" class="text-sm font-medium text-gray-700 mb-1">Strategic Goal</label> <select id="goal" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"></select></div></div></div>');function $r(p,o){let l=Ke(o,"selectedStatus",15,"all"),d=Ke(o,"selectedGoal",15,"all");const s=[{value:"all",label:"All Status"},{value:"achieved",label:"Achieved"},{value:"pending",label:"Pending"}];var $=kr(),c=a($),g=a(c),W=r(a(g),2);Ct(W,21,()=>s,zt,(b,G)=>{var at=yr(),ct={},gt=a(at,!0);e(at),Y(()=>{ct!==(ct=t(G).value)&&(at.value=(at.__value=t(G).value)==null?"":t(G).value),h(gt,t(G).label)}),v(b,at)}),e(W),e(g);var Z=r(g,2),J=r(a(Z),2);Ct(J,21,()=>o.uniqueGoals,zt,(b,G)=>{var at=wr(),ct={},gt=a(at,!0);e(at),Y(()=>{ct!==(ct=t(G))&&(at.value=(at.__value=t(G))==null?"":t(G)),h(gt,t(G)==="all"?"All Goals":t(G))}),v(b,at)}),e(J),e(Z),e(c),e($),Jt(W,l),Jt(J,d),v(p,$)}var Sr=m('<div class="flex justify-center items-center h-64"><!></div>'),Ar=(p,o)=>o("strategic_goal_name"),Nr=(p,o,l,d)=>{i(o,t(o).map(s=>s.id===t(l).id?{...s,evaluation:p.target.value}:s)),d(p)},Mr=m("<!> Achieved",1),Rr=m("<!> Pending",1),Pr=(p,o,l)=>o(t(l).statement||""),Cr=m('<button class="inline-flex items-center px-3 py-1 text-sm text-indigo-600 bg-indigo-100 hover:bg-indigo-200 rounded-md"><!> View</button>'),Er=(p,o,l)=>o(t(l).id,t(l).kpi,t(l).evaluation||""),Lr=m('<button class="inline-flex items-center px-4 py-2 text-sm text-white bg-indigo-600 hover:bg-indigo-700 rounded-md disabled:opacity-50">Evaluate</button>'),jr=m('<tr class="hover:bg-gray-50"><td class="px-4 py-4 text-sm text-gray-800 break-words"> </td><td class="px-4 py-4 text-sm text-gray-800 break-words"> </td><td class="px-4 py-4 text-sm text-gray-600 break-words"> </td><td class="px-4 py-4 text-sm text-gray-600 break-words"> </td><td class="px-4 py-4"><textarea class="w-full text-sm border rounded-md px-3 py-2 focus:outline-none focus:ring-1 focus:ring-indigo-500" placeholder="Enter evaluation..." style="resize: vertical; min-height: 60px;" rows="2"></textarea></td><td class="px-4 py-4"><span><!></span></td><td class="px-4 py-4 text-center"><div class="flex items-center justify-center gap-2"><!> <!></div></td></tr>'),Dr=m('<div class="bg-white rounded-lg shadow"><table class="w-full"><thead class="bg-gray-50"><tr><th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider cursor-pointer"><div class="flex items-center gap-2">Strategic Goal <!></div></th><th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Objective</th><th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Action Plans</th><th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">KPI</th><th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Actions Taken</th><th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Status</th><th class="px-4 py-3 text-center text-xs font-medium text-gray-600 uppercase tracking-wider">Actions</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"></tbody></table></div>'),zr=m('<div class="text-center py-12 bg-white rounded-lg shadow"><p class="text-gray-500">No action plans found.</p></div>'),Or=(p,o)=>i(o,!1),Fr=m('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"><div class="bg-white rounded-lg shadow-xl w-full max-w-lg mx-4 p-6"><h2 class="text-lg font-semibold text-gray-900 mb-4">Evaluation Statement</h2> <div class="bg-gray-50 rounded-lg p-4 text-gray-700 mb-6 max-h-[60vh] overflow-y-auto break-words"> </div> <button class="w-full inline-flex justify-center px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-md">Close</button></div></div>'),Tr=m('<div class="min-h-screen flex flex-col bg-gray-100"><header class="sticky top-0 z-40 bg-white border-b shadow-sm"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"><div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"><h1 class="text-2xl font-medium text-gray-800">Plans Monitoring</h1> <div class="flex items-center gap-2"><div class="relative flex-1 sm:flex-none"><input type="search" placeholder="Search plans..." class="w-full sm:w-64 pl-3 pr-8 py-2 border rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-indigo-500"> <span class="absolute right-2 top-2.5 text-gray-400">🔍</span></div></div></div> <div class="mt-4"><!></div></div></header> <main class="flex-1"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"><!></div></main> <!></div>');function Zo(p,o){se(o,!1);const l=Gt(),d=Gt();let s=Gt([]),$=null,c=Gt(!1),g=Gt(""),W=Gt(!0),Z=Gt(""),J=Gt("strategic_goal_name"),b=Gt(!0),G=Gt("all"),at=Gt("all");function ct(_){t(J)===_?i(b,!t(b)):(i(J,_),i(b,!0))}function gt(_){i(g,_),i(c,!0)}const Lt=_=>{const R=_.target;R.style.height="auto",R.style.height=`${R.scrollHeight}px`},Rt=async()=>{try{const{data:{session:_},error:R}=await ft.auth.getSession();if(R||!_)throw R;$=_.user.id}catch(_){console.error("Error fetching session:",_)}},At=async _=>{try{const{data:R,error:O}=await ft.from("plan_monitoring").select("action_plan_id, is_accomplished, evaluation, statement, time_completed").in("action_plan_id",_);if(O)throw O;return R}catch(R){return console.error("Error fetching monitoring data:",R),[]}},jt=async()=>{try{const{data:_,error:R}=await ft.from("profiles").select("department_id").eq("id",$).single();if(R||!(_!=null&&_.department_id))throw R;const{data:O,error:D}=await ft.from("profiles").select("id").eq("department_id",_.department_id);if(D)throw D;const Q=O.map(E=>E.id),{data:ot,error:ut}=await ft.from("action_plans").select(`
					id,
					actions_taken,
					kpi,
					objective_id,
					strategic_objectives (
						name,
						strategic_goals (name)
					),
					is_approved
				`).in("profile_id",Q).eq("is_approved",!0);if(ut)throw ut;const st=ot.map(E=>{var A,lt,_t;return{id:E.id,actions_taken:E.actions_taken,kpi:E.kpi,objective_id:E.objective_id,strategic_goal_name:((lt=(A=E.strategic_objectives)==null?void 0:A.strategic_goals)==null?void 0:lt.name)||"No Goal Assigned",objective_name:((_t=E.strategic_objectives)==null?void 0:_t.name)||"No Objective Assigned",is_accomplished:!1,evaluation:null,statement:null,time_completed:null,isLoading:!1}}),M=await At(st.map(E=>E.id));i(s,st.map(E=>{const A=M.find(lt=>lt.action_plan_id===E.id);return{...E,is_accomplished:(A==null?void 0:A.is_accomplished)||!1,evaluation:(A==null?void 0:A.evaluation)||null,statement:(A==null?void 0:A.statement)||null,time_completed:(A==null?void 0:A.time_completed)||null}}))}catch(_){console.error("Error fetching action plans:",_)}finally{i(W,!1)}},C=async(_,R,O)=>{i(s,t(s).map(D=>D.id===_?{...D,isLoading:!0}:D));try{const D=await fetch("/api/evaluate-goal",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({target:R,evaluation:O})}),Q=await D.json();if(!D.ok||Q.error)throw new Error(Q.error||"Failed to evaluate action plan.");const ot=Q.aiEvaluation;if(typeof ot!="string")throw new TypeError("AI evaluation response is not valid.");const st=!["not achieved","unsuccessful","failed","incomplete","fell short","below target","did not meet","not"].some(A=>ot.toLowerCase().includes(A)),M=st?new Date().toISOString():null,{error:E}=await ft.from("plan_monitoring").update({evaluation:O,statement:ot,is_accomplished:st,time_completed:M}).eq("action_plan_id",_);if(E)throw E;i(s,t(s).map(A=>A.id===_?{...A,is_accomplished:st,evaluation:O,statement:ot,time_completed:M,isLoading:!1}:A))}catch(D){console.error("Error evaluating action plan:",D),i(s,t(s).map(Q=>Q.id===_?{...Q,isLoading:!1}:Q))}};Ae(async()=>{await Rt(),await jt()}),qe(()=>t(s),()=>{i(l,["all",...new Set(t(s).map(_=>_.strategic_goal_name))])}),qe(()=>(t(s),t(Z),t(G),t(at),t(b),t(J)),()=>{i(d,t(s).filter(_=>{const R=_.strategic_goal_name.toLowerCase().includes(t(Z).toLowerCase())||_.objective_name.toLowerCase().includes(t(Z).toLowerCase())||_.actions_taken.toLowerCase().includes(t(Z).toLowerCase()),O=t(G)==="all"?!0:t(G)==="achieved"?_.is_accomplished:!_.is_accomplished,D=t(at)==="all"||_.strategic_goal_name===t(at);return R&&O&&D}).sort((_,R)=>{const O=t(b)?1:-1;return _[t(J)]>R[t(J)]?O:-O}))}),la(),pa();var V=Tr(),f=a(V),n=a(f),u=a(n),w=r(a(u),2),k=a(w),S=a(k);$e(S),bt(2),e(k),e(w),e(u);var L=r(u,2),rt=a(L);$r(rt,{get uniqueGoals(){return t(l)},get selectedStatus(){return t(G)},set selectedStatus(_){i(G,_)},get selectedGoal(){return t(at)},set selectedGoal(_){i(at,_)},$$legacy:!0}),e(L),e(n),e(f);var K=r(f,2),j=a(K),z=a(j);et(z,()=>t(W),_=>{var R=Sr(),O=a(R);_e(O,{class:"animate-spin h-10 w-10 text-indigo-500"}),e(R),v(_,R)},_=>{var R=Et(),O=xt(R);et(O,()=>t(d).length>0,D=>{var Q=Dr(),ot=a(Q),ut=a(ot),st=a(ut),M=a(st);M.__click=[Ar,ct];var E=a(M),A=r(a(E));ue(A,{class:"h-4 w-4"}),e(E),e(M),bt(6),e(st),e(ut);var lt=r(ut);Ct(lt,5,()=>t(d),zt,(_t,U)=>{var B=jr(),I=a(B),tt=a(I,!0);e(I);var nt=r(I),ht=a(nt,!0);e(nt);var Ot=r(nt),Pt=a(Ot,!0);e(Ot);var Mt=r(Ot),Tt=a(Mt,!0);e(Mt);var pt=r(Mt),X=a(pt);He(X),X.__input=[Nr,s,U,Lt],e(pt);var $t=r(pt),Ft=a($t),mt=a(Ft);et(mt,()=>t(U).is_accomplished,yt=>{var wt=Mr(),kt=xt(wt);xa(kt,{class:"w-4 h-4 mr-1"}),bt(),v(yt,wt)},yt=>{var wt=Rr(),kt=xt(wt);ba(kt,{class:"w-4 h-4 mr-1"}),bt(),v(yt,wt)}),e(Ft),e($t);var dt=r($t),St=a(dt),vt=a(St);et(vt,()=>t(U).statement,yt=>{var wt=Cr();wt.__click=[Pr,gt,U];var kt=a(wt);Be(kt,{class:"w-4 h-4 mr-1"}),bt(),e(wt),v(yt,wt)});var Nt=r(vt,2);et(Nt,()=>t(U).isLoading,yt=>{_e(yt,{class:"animate-spin h-5 w-5 text-indigo-500"})},yt=>{var wt=Et(),kt=xt(wt);et(kt,()=>!t(U).is_accomplished,Xt=>{var It=Lr();It.__click=[Er,C,U],Y(()=>It.disabled=!t(U).evaluation||t(U).isLoading),v(Xt,It)},null,!0),v(yt,wt)}),e(St),e(dt),e(B),Y(()=>{h(tt,t(U).strategic_goal_name),h(ht,t(U).objective_name),h(Pt,t(U).actions_taken),h(Tt,t(U).kpi),Ye(X,t(U).evaluation),X.disabled=t(U).is_accomplished,Ut(Ft,`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${t(U).is_accomplished?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`)}),v(_t,B)}),e(lt),e(ot),e(Q),v(D,Q)},D=>{var Q=zr();v(D,Q)},!0),v(_,R)}),e(j),e(K);var T=r(K,2);et(T,()=>t(c),_=>{var R=Fr(),O=a(R),D=r(a(O),2),Q=a(D,!0);e(D);var ot=r(D,2);ot.__click=[Or,c],e(O),e(R),Y(()=>h(Q,t(g))),v(_,R)}),e(V),Se(S,()=>t(Z),_=>i(Z,_)),v(p,V),le()}pe(["click","input"]);const Ue=(p,o)=>{o()},Ir=async(p,o,l,d,s)=>{var $;try{const{error:c}=await ft.from("risk_monitoring").update({likelihood_rating_id:t(o).likelihoodRating,severity_id:t(o).severity,control_rating_id:t(o).riskControlRating,monitoring_rating_id:t(o).riskMonitoringRating}).eq("id",($=t(l))==null?void 0:$.id);if(c)throw c;i(d,!1),i(l,null),await s()}catch(c){console.error("Failed to save risk assessment:",c)}};var Gr=m('<div class="flex items-center justify-center p-8"><!> <span class="ml-2 text-gray-600 dark:text-gray-400">Loading risks...</span></div>'),Vr=m('<div class="p-4 bg-red-50 dark:bg-red-900 text-red-700 dark:text-red-200 rounded-lg"> </div>'),qr=(p,o,l)=>o(t(l)),Kr=m('<tr><td class="px-6 py-4"> </td><td class="px-6 py-4"> </td><td class="px-6 py-4"> </td><td class="px-6 py-4"> </td><td class="px-6 py-4"> </td><td class="px-6 py-4"> </td><td class="px-6 py-4"><button class="text-blue-600 text-sm">Add Re-Assessment</button></td></tr>'),Ur=m('<div class="overflow-x-auto"><table class="w-full border-collapse"><thead><tr class="bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600"><th class="px-6 py-4">RRN</th><th class="px-6 py-4">Risk Statement</th><th class="px-6 py-4">Likelihood Rating</th><th class="px-6 py-4">Severity</th><th class="px-6 py-4">Control Rating</th><th class="px-6 py-4">Monitoring Rating</th><th class="px-6 py-4">Actions</th></tr></thead><tbody></tbody></table></div>'),Hr=m("<option> </option>"),Yr=m("<option> </option>"),Jr=m('<p class="text-sm text-gray-800 dark:text-gray-200"> </p>'),Qr=m('<p class="text-sm text-gray-500 dark:text-gray-400">Select Likelihood and Severity first</p>'),Br=m("<option> </option>"),Wr=m('<div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"><div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-md w-full"><div class="flex justify-between items-center p-4 border-b border-gray-300 dark:border-gray-700"><h3 class="text-lg font-semibold text-gray-900 dark:text-white">Edit Risk Assessment</h3> <button class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300"><!></button></div> <div class="p-6 space-y-4"><div><h4 class="text-sm font-medium text-gray-600 dark:text-gray-300">Risk Statement</h4> <p class="text-sm text-gray-800 dark:text-gray-100"> </p></div> <div><label class="block text-sm font-medium text-gray-600 dark:text-gray-300">Likelihood Rating</label> <select class="block w-full mt-1 rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 dark:text-gray-200"><option>Select Likelihood</option><!></select></div> <div><label class="block text-sm font-medium text-gray-600 dark:text-gray-300">Severity</label> <select class="block w-full mt-1 rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 dark:text-gray-200"><option>Select Severity</option><!></select></div> <div><label class="block text-sm font-medium text-gray-600 dark:text-gray-300">Control Rating</label> <div class="mt-1 p-2 bg-gray-50 dark:bg-gray-700 rounded-lg"><!></div></div> <div><label class="block text-sm font-medium text-gray-600 dark:text-gray-300">Monitoring Rating</label> <select class="block w-full mt-1 rounded-lg"><option>Select Monitoring Rating</option><!></select></div></div> <div class="p-4 flex justify-end space-x-2 border-t border-gray-300 dark:border-gray-700"><button class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">Cancel</button> <button class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 disabled:opacity-50 disabled:cursor-not-allowed">Save Changes</button></div></div></div>'),Zr=m('<div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"><!> <!></div>');function Xo(p,o){se(o,!0);let l=y(N([])),d=y(!0),s=y(null),$=y(!1),c=y(null),g=y(N([])),W=y(N([])),Z=y(N([])),J=y(N([])),b=y(N({likelihoodRating:null,severity:null,riskControlRating:null,riskMonitoringRating:null}));const G=async()=>{try{const{data:C,error:V}=await ft.from("risk_monitoring").select(`
                id,
                risks (
                    rrn,
                    risk_statement
                ),
                likelihood_rating:likelihood_rating_id(name),
                severity:severity_id(name),
                control_rating:control_rating_id(name),
                monitoring_rating:monitoring_rating_id(status),
                is_achieved
            `);if(V)throw V;i(l,N(C.map(f=>{var n,u,w,k;return{id:f.id,rrn:f.risks.rrn,risk_statement:f.risks.risk_statement,likelihood_rating:((n=f.likelihood_rating)==null?void 0:n.name)||"Not Available",severity:((u=f.severity)==null?void 0:u.name)||"Not Available",control_rating:((w=f.control_rating)==null?void 0:w.name)||"Not Available",monitoring_rating:((k=f.monitoring_rating)==null?void 0:k.status)||"Not Available",is_achieved:f.is_achieved}})))}catch(C){console.error("Error fetching risk monitoring data:",C),i(s,"Failed to fetch risk monitoring data.")}finally{i(d,!1)}},at=async()=>{try{const[C,V,f,n]=await Promise.all([ft.from("likelihood_rating").select("*"),ft.from("severity").select("*"),ft.from("risk_control_rating").select("*"),ft.from("risk_monitoring_rating").select("*")]);if(C.error||V.error||f.error||n.error)throw new Error("Failed to fetch dropdown options");i(g,N(C.data)),i(W,N(V.data)),i(Z,N(f.data)),i(J,N(n.data))}catch(C){console.error("Error fetching dropdown options:",C)}},ct=C=>{var V,f,n,u;i(c,N(C)),i(b,N({likelihoodRating:((V=t(g).find(w=>w.name===C.likelihood_rating))==null?void 0:V.id)||null,severity:((f=t(W).find(w=>w.name===C.severity))==null?void 0:f.id)||null,riskControlRating:((n=t(Z).find(w=>w.name===C.control_rating))==null?void 0:n.id)||null,riskMonitoringRating:((u=t(J).find(w=>w.status===C.monitoring_rating))==null?void 0:u.id)||null})),t(b).riskControlRating,i($,!0)},gt=()=>{var f,n,u,w,k;if(!t(b).likelihoodRating||!t(b).severity)return;const C=(f=t(g).find(S=>S.id===t(b).likelihoodRating))==null?void 0:f.symbol,V=(n=t(W).find(S=>S.id===t(b).severity))==null?void 0:n.value;if(C&&V){const{controlRating:S}=ga(C,V),L=t(Z).find(K=>K.symbol===S),rt=(L==null?void 0:L.id)||null;if(rt&&t(b).riskControlRating!==rt&&(t(b).riskControlRating=rt),rt){const K=(L==null?void 0:L.value)||0,j=t(J).find(z=>z.id===t(b).riskMonitoringRating);if(j){const z=j.value;let T=null;K>z?T=(u=t(J).find(_=>_.status==="Grading Increased"))==null?void 0:u.id:K<z?T=(w=t(J).find(_=>_.status==="Grading Decreased"))==null?void 0:w.id:T=(k=t(J).find(_=>_.status==="No Change to Grade"))==null?void 0:k.id,T&&t(b).riskMonitoringRating!==T&&(t(b).riskMonitoringRating=T)}}}},Lt=()=>{i($,!1),i(c,null)};Ae(()=>{G(),at()});var Rt=Zr(),At=a(Rt);et(At,()=>t(d),C=>{var V=Gr(),f=a(V);_e(f,{class:"w-6 h-6 animate-spin text-blue-600 dark:text-blue-400"}),bt(2),e(V),v(C,V)},C=>{var V=Et(),f=xt(V);et(f,()=>t(s),n=>{var u=Vr(),w=a(u,!0);e(u),Y(()=>h(w,t(s))),v(n,u)},n=>{var u=Ur(),w=a(u),k=r(a(w));Ct(k,21,()=>t(l),zt,(S,L)=>{var rt=Kr(),K=a(rt),j=a(K,!0);e(K);var z=r(K),T=a(z,!0);e(z);var _=r(z),R=a(_,!0);e(_);var O=r(_),D=a(O,!0);e(O);var Q=r(O),ot=a(Q,!0);e(Q);var ut=r(Q),st=a(ut,!0);e(ut);var M=r(ut),E=a(M);E.__click=[qr,ct,L],e(M),e(rt),Y(()=>{h(j,t(L).rrn),h(T,t(L).risk_statement),h(R,t(L).likelihood_rating),h(D,t(L).severity),h(ot,t(L).control_rating),h(st,t(L).monitoring_rating)}),v(S,rt)}),e(k),e(w),e(u),v(n,u)},!0),v(C,V)});var jt=r(At,2);et(jt,()=>t($),C=>{var V=Wr(),f=a(V),n=a(f),u=r(a(n),2);u.__click=Lt;var w=a(u);Oe(w,{class:"w-5 h-5"}),e(u),e(n);var k=r(n,2),S=a(k),L=r(a(S),2),rt=a(L,!0);e(L),e(S);var K=r(S,2),j=r(a(K),2);j.__change=[Ue,gt];var z=a(j);z.value=(z.__value=null)==null?"":null;var T=r(z);Ct(T,17,()=>t(g),zt,(B,I)=>{var tt=Hr(),nt={},ht=a(tt,!0);e(tt),Y(()=>{nt!==(nt=t(I).id)&&(tt.value=(tt.__value=t(I).id)==null?"":t(I).id),h(ht,t(I).name)}),v(B,tt)}),e(j),e(K);var _=r(K,2),R=r(a(_),2);R.__change=[Ue,gt];var O=a(R);O.value=(O.__value=null)==null?"":null;var D=r(O);Ct(D,17,()=>t(W),zt,(B,I)=>{var tt=Yr(),nt={},ht=a(tt,!0);e(tt),Y(()=>{nt!==(nt=t(I).id)&&(tt.value=(tt.__value=t(I).id)==null?"":t(I).id),h(ht,t(I).name)}),v(B,tt)}),e(R),e(_);var Q=r(_,2),ot=r(a(Q),2),ut=a(ot);et(ut,()=>t(b).riskControlRating,B=>{var I=Jr();const tt=Dt(()=>t(Z).find(ht=>ht.id===t(b).riskControlRating));var nt=a(I,!0);e(I),Y(()=>{var ht;return h(nt,((ht=t(tt))==null?void 0:ht.name)||"Not Available")}),v(B,I)},B=>{var I=Qr();v(B,I)}),e(ot),e(Q);var st=r(Q,2),M=r(a(st),2),E=a(M);E.value=(E.__value=null)==null?"":null;var A=r(E);Ct(A,17,()=>t(J),zt,(B,I)=>{var tt=Br(),nt={},ht=a(tt);e(tt),Y(()=>{nt!==(nt=t(I).id)&&(tt.value=(tt.__value=t(I).id)==null?"":t(I).id),h(ht,`${t(I).value??""} - ${t(I).status??""}`)}),v(B,tt)}),e(M),e(st),e(k);var lt=r(k,2),_t=a(lt);_t.__click=Lt;var U=r(_t,2);U.__click=[Ir,b,c,$,G],e(lt),e(f),e(V),Y(()=>{var B;return h(rt,(B=t(c))==null?void 0:B.risk_statement)}),Jt(j,()=>t(b).likelihoodRating,B=>t(b).likelihoodRating=B),Jt(R,()=>t(b).severity,B=>t(b).severity=B),Jt(M,()=>t(b).riskMonitoringRating,B=>t(b).riskMonitoringRating=B),v(C,V)}),e(Rt),v(p,Rt),le()}pe(["click","change"]);async function Xr(p,o){const l=t(o).map(d=>({opt_statement:d.statement,kpi:d.goal,achieved:d.achieved==="Achieved",evaluation:d.evaluation}));try{const d=await fetch("/api/generate-summary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({monitoringData:l})}),s=await d.json();if(!d.ok||s.error)throw new Error(s.error||"Failed to generate summary.")}catch(d){console.error("Error generating summary:",d)}}var to=m('<div class="flex items-center justify-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div> <span class="ml-3 text-gray-600">Loading opportunities...</span></div>'),eo=m('<div class="text-center py-12 bg-white rounded-lg shadow"><!> <h3 class="mt-2 text-lg font-medium text-gray-900">No opportunities found</h3> <p class="mt-1 text-sm text-gray-500">No opportunities have been added to your monitoring list yet.</p></div>'),ao=(p,o,l)=>o(l(),"evaluation",p.target.value),ro=m('<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-current"></div>'),oo=m("<!> Achieved",1),io=m("<!> Not Achieved",1),so=m("<!> Pending",1),lo=m('<div class="text-xs text-gray-500 mt-1"> </div>'),no=(p,o,l)=>o(l()),co=m('<button class="inline-flex items-center px-3 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors"><!> View</button>'),vo=m('<span class="text-gray-500">-</span>'),uo=(p,o,l,d,s)=>o(l(),d(),s()),_o=m('<button class="inline-flex items-center px-3 py-1 bg-green-600 text-white text-xs font-medium rounded hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">Evaluate</button>'),po=m('<tr><td class="px-6 py-4 whitespace-normal text-sm text-gray-900"> </td><td class="px-6 py-4 whitespace-normal text-sm text-gray-500"> </td><td class="px-6 py-4"><textarea class="w-full min-h-[80px] px-3 py-2 text-sm border rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 disabled:bg-gray-100" placeholder="Enter your evaluation..."></textarea></td><td class="px-6 py-4 whitespace-nowrap"><span><!></span> <!></td><td class="px-6 py-4 whitespace-nowrap text-sm"><!></td><td class="px-6 py-4 whitespace-nowrap text-sm"><div class="flex space-x-2"><!></div></td></tr>'),go=m('<div class="bg-white shadow-lg rounded-lg overflow-hidden"><div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statement</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Target (KPI)</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions Taken</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Remarks</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"></tbody></table></div></div>'),mo=(p,o)=>i(o,!1),fo=(p,o)=>i(o,!1),ho=m('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"><div class="bg-white rounded-lg shadow-xl max-w-lg w-full p-6"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-medium text-gray-900">AI Evaluation Statement</h3> <button class="text-gray-400 hover:text-gray-500 focus:outline-none"><!></button></div> <div class="mt-2"><p class="text-sm text-gray-500 whitespace-pre-wrap"> </p></div> <div class="mt-6"><button class="w-full inline-flex justify-center px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Close</button></div></div></div>'),xo=m('<div class="min-h-screen bg-gray-50"><header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"><div class="flex justify-between items-center"><h1 class="text-2xl font-semibold text-gray-900">Mid-Year Opportunity Monitoring</h1> <button class="inline-flex items-center px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors"><!> Evaluate All</button></div></div></header> <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><!></main> <!></div>');function ti(p,o){se(o,!0);let l=y(N([])),d=y(null),s=y(!1),$=y(!1),c=y(""),g=y(N([]));function W(n){i(c,N(n)),i($,!0)}const Z=async()=>{const{data:{session:n},error:u}=await ft.auth.getSession();if(u||!n){console.error("Error fetching session:",u);return}const{user:w}=n,{data:k,error:S}=await ft.from("profiles").select("id").eq("id",w.id).single();if(S||!k){console.error("Error fetching profile:",S);return}i(d,N(k.id))},J=async()=>{i(s,!0);try{const{data:n,error:u}=await ft.from("profiles").select("department_id").eq("id",t(d)).single();if(u||!(n!=null&&n.department_id)){console.error("Error fetching user profile or department:",u);return}const w=n.department_id,{data:k,error:S}=await ft.from("profiles").select("id").eq("department_id",w);if(S){console.error("Error fetching profile IDs:",S);return}const L=k.map(j=>j.id),{data:rt,error:K}=await ft.from("opt_monitoring").select(`
                    opt_id,
                    time_completed,
                    evaluation,
                    statement,
                    opportunities (opt_statement, kpi, planned_actions)
                `).in("profile_id",L);if(K){console.error("Error fetching opportunities:",K);return}i(l,N(rt.map(j=>{var z,T,_;return{opt_id:j.opt_id,opt_statement:((z=j.opportunities)==null?void 0:z.opt_statement)||"No Statement",kpi:((T=j.opportunities)==null?void 0:T.kpi)||"No KPI",planned_actions:((_=j.opportunities)==null?void 0:_.planned_actions)||"No Actions Taken",time_completed:j.time_completed,evaluation:j.evaluation||"",statement:j.statement||null}}))),i(g,N(t(l).map(j=>({id:j.opt_id,statement:j.opt_statement,goal:j.kpi,evaluation:j.evaluation||"",achieved:j.time_completed?"Achieved":null,isLoading:!1,timeCompleted:j.time_completed,aiStatement:j.statement||null}))))}catch(n){console.error("Error fetching opportunities:",n)}finally{i(s,!1)}};async function b(n,u,w){i(g,N(t(g).map(k=>k.id===n?{...k,isLoading:!0}:k)));try{const k=await fetch("/api/evaluate-goal",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({target:u,evaluation:w})}),S=await k.json();if(!k.ok||S.error)throw new Error(S.error||"Failed to evaluate goal.");const L=S.aiEvaluation;if(typeof L!="string")throw new TypeError("AI evaluation response is not a valid string.");const K=!["not achieved","unsuccessful","failed","incomplete","fell short","below target","did not meet","not","not been achieved"].some(T=>L.toLowerCase().includes(T)),j=K?new Date().toISOString():null,{error:z}=await ft.from("opt_monitoring").update({time_completed:j,evaluation:w,statement:L,is_accomplished:K}).eq("opt_id",n);z?console.error("[ERROR] Error updating opt_monitoring:",z):i(g,N(t(g).map(T=>T.id===n?{...T,achieved:K?"Achieved":"Not Achieved",isLoading:!1,timeCompleted:j,aiStatement:L}:T)))}catch(k){console.error("[ERROR] Error evaluating goal:",k),i(g,N(t(g).map(S=>S.id===n?{...S,isLoading:!1}:S)))}}function G(n,u,w){i(g,N(t(g).map(k=>k.id===n?{...k,[u]:w}:k)))}function at(n){const u=n.target;u.style.height="auto",u.style.width="auto",u.style.height=`${u.scrollHeight}px`,u.style.width=`${u.scrollWidth+20}px`}Ae(async()=>{await Z(),await J()});var ct=xo(),gt=a(ct),Lt=a(gt),Rt=a(Lt),At=r(a(Rt),2);At.__click=[Xr,g];var jt=a(At);ka(jt,{class:"w-4 h-4 mr-2"}),bt(),e(At),e(Rt),e(Lt),e(gt);var C=r(gt,2),V=a(C);et(V,()=>t(s),n=>{var u=to();v(n,u)},n=>{var u=Et(),w=xt(u);et(w,()=>t(g).length===0,k=>{var S=eo(),L=a(S);ma(L,{class:"mx-auto h-12 w-12 text-gray-400"}),bt(4),e(S),v(k,S)},k=>{var S=go(),L=a(S),rt=a(L),K=r(a(rt));Ct(K,21,()=>t(g),zt,(j,z)=>{let T=()=>t(z).id,_=()=>t(z).statement,R=()=>t(z).goal,O=()=>t(z).evaluation,D=()=>t(z).achieved,Q=()=>t(z).isLoading,ot=()=>t(z).timeCompleted,ut=()=>t(z).aiStatement;var st=po(),M=a(st),E=a(M,!0);e(M);var A=r(M),lt=a(A,!0);e(A);var _t=r(A),U=a(_t);He(U),U.__change=[ao,G,T],U.__input=at,e(_t);var B=r(_t),I=a(B),tt=a(I);et(tt,Q,pt=>{var X=ro();v(pt,X)},pt=>{var X=Et(),$t=xt(X);et($t,()=>D()==="Achieved",Ft=>{var mt=oo(),dt=xt(mt);fa(dt,{class:"w-4 h-4 mr-1"}),bt(),v(Ft,mt)},Ft=>{var mt=Et(),dt=xt(mt);et(dt,()=>D()==="Not Achieved",St=>{var vt=io(),Nt=xt(vt);Oe(Nt,{class:"w-4 h-4 mr-1"}),bt(),v(St,vt)},St=>{var vt=so(),Nt=xt(vt);ya(Nt,{class:"w-4 h-4 mr-1"}),bt(),v(St,vt)},!0),v(Ft,mt)},!0),v(pt,X)}),e(I);var nt=r(I,2);et(nt,ot,pt=>{var X=lo(),$t=a(X,!0);Y(()=>h($t,new Date(ot()).toLocaleDateString())),e(X),v(pt,X)}),e(B);var ht=r(B),Ot=a(ht);et(Ot,ut,pt=>{var X=co();X.__click=[no,W,ut];var $t=a(X);Be($t,{class:"w-4 h-4 mr-1"}),bt(),e(X),v(pt,X)},pt=>{var X=vo();v(pt,X)}),e(ht);var Pt=r(ht),Mt=a(Pt),Tt=a(Mt);et(Tt,()=>D()!=="Achieved",pt=>{var X=_o();X.__click=[uo,b,T,R,O],Y(()=>X.disabled=!O()||Q()),v(pt,X)}),e(Mt),e(Pt),e(st),Y(()=>{h(E,_()),h(lt,R()),Ye(U,O()),U.disabled=D()==="Achieved",Ut(I,`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                            ${D()==="Achieved"?"bg-green-100 text-green-800":D()==="Not Achieved"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`)}),v(j,st)}),e(K),e(rt),e(L),e(S),v(k,S)},!0),v(n,u)}),e(C);var f=r(C,2);et(f,()=>t($),n=>{var u=ho(),w=a(u),k=a(w),S=r(a(k),2);S.__click=[mo,$];var L=a(S);Oe(L,{class:"w-5 h-5"}),e(S),e(k);var rt=r(k,2),K=a(rt),j=a(K,!0);e(K),e(rt);var z=r(rt,2),T=a(z);T.__click=[fo,$],e(z),e(w),e(u),Y(()=>h(j,t(c))),v(n,u)}),e(ct),v(p,ct),le()}pe(["click","change","input"]);export{Qo as A,Yo as C,Zo as D,Jo as M,Bo as a,Wo as b,Xo as c,ti as d};

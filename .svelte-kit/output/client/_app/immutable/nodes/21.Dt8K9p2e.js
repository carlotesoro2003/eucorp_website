import"../chunks/disclose-version.Bg9kRutz.js";import{p as ce,b as d,g as a,a as ve,e as h,c as r,s as n,r as t,t as j,n as oe,h as de,J as fe,f as ie}from"../chunks/utils.Cx6K9qTo.js";import{d as ue,a as y,t as b,b as R,e as me}from"../chunks/store.BALTJZ26.js";import{i as B}from"../chunks/if.Bgpzl8Wa.js";import{p as ye,a as u}from"../chunks/preload-helper.Tg4Km7Zr.js";import{o as be}from"../chunks/index-client.lWLCSZVk.js";import{s as A}from"../chunks/Icon.Nl6wOSVO.js";import{e as se,r as xe,i as le}from"../chunks/attributes.rzeD2olC.js";import{b as _e}from"../chunks/input.BVFrb_g3.js";import{S as pe}from"../chunks/search.BpYLThKw.js";import{b as ne}from"../chunks/select.BtlRD387.js";import{c as he}from"../chunks/riskCalculator.D3oLOKg6.js";import{X as ke}from"../chunks/x.D9PBK57y.js";import{C as we}from"../chunks/chevron-left.BQoiznrZ.js";var Re=b('<button disabled class="flex items-center gap-2 bg-success text-success-foreground px-3 py-1 rounded-lg opacity-50 cursor-not-allowed">Assessed</button>'),Ce=(D,o,v)=>o.onAssess(a(v)),Se=b('<div class="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"></div>'),Me=b('<button class="flex items-center gap-2 bg-primary text-primary-foreground px-3 py-1 rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"><!> Assess</button>'),Ae=b('<tr class="hover:bg-muted/50"><td class="px-4 py-3 font-medium"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><div class="flex justify-center"><!></div></td></tr>'),De=b('<div class="flex flex-col gap-4 p-4 container mx-auto"><div class="flex flex-col md:flex-row gap-4 mb-2 items-center justify-between"><div class="flex flex-col md:flex-row gap-4 flex-1"><div class="relative flex-1 w-full md:max-w-[300px]"><!> <input type="text" placeholder="Search risks..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div></div></div> <div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left">RRN</th><th class="px-4 py-3 text-left">Risk Statement</th><th class="px-4 py-3 text-left">Classification</th><th class="px-4 py-3 text-left">Actions</th><th class="px-4 py-3 text-left">Key Persons</th><th class="px-4 py-3 text-left">Budget</th><th class="px-4 py-3 text-center">Assessment</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div></div>');function Fe(D,o){ce(o,!0);let v=h(""),l=de(()=>o.savedRisks.filter(_=>_.rrn.toLowerCase().includes(a(v).toLowerCase())||_.risk_statement.toLowerCase().includes(a(v).toLowerCase()))),p=_=>new Set(o.riskAssessments.map(F=>F.risk_id)).has(_);var x=De(),m=r(x),k=r(m),w=r(k),P=r(w);pe(P,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var E=n(P,2);xe(E),t(w),t(k),t(m);var T=n(m,2),U=r(T),L=n(r(U));se(L,21,()=>a(l),_=>_.id,(_,g)=>{var F=Ae(),N=r(F),Q=r(N,!0);t(N);var q=n(N),W=r(q,!0);t(q);var Y=n(q),te=r(Y,!0);j(()=>{var M;return R(te,((M=o.classification.find(C=>C.id===a(g).classification))==null?void 0:M.name)||"N/A")}),t(Y);var z=n(Y),V=r(z,!0);t(z);var Z=n(z),$=r(Z,!0);t(Z);var H=n(Z),ae=r(H);t(H);var ee=n(H),J=r(ee),K=r(J);B(K,()=>a(g).id&&p(a(g).id),M=>{var C=Re();y(M,C)},M=>{var C=Me();C.__click=[Ce,o,g];var O=r(C);B(O,()=>o.isSaving,I=>{var re=Se();y(I,re)}),oe(),t(C),j(()=>C.disabled=o.isSaving),y(M,C)}),t(J),t(ee),t(F),j(()=>{R(Q,a(g).rrn),R(W,a(g).risk_statement),R(V,a(g).actions),R($,a(g).key_persons),R(ae,`$${a(g).budget??""}`)}),y(_,F)}),t(L),t(U),t(T),t(x),_e(E,()=>a(v),_=>d(v,_)),y(D,x),ve()}ue(["click"]);const Ne=async(D,o,v,l,p)=>{if(!(!a(o)||!v.selectedRisk)){l(!0);try{const{data:x,error:m}=await A.from("risk_assessment").insert({risk_id:v.selectedRisk.id,lr:p.likelihoodRating,s:p.severity,rcr:p.riskControlRating,rmr:p.riskMonitoringRating}).select();if(m)throw m;const{data:k,error:w}=await A.from("risk_assessment").select("*");if(w)throw w;v.onSuccess("Assessment saved successfully"),v.onClose()}catch{v.onError("Failed to save assessment")}finally{l(!1)}}};var je=b("<option> </option>"),Le=b("<option> </option>"),Pe=b('<div class="flex items-center gap-2"><span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 font-semibold"> </span> <span class="text-gray-900 dark:text-gray-100"> </span></div>'),Ee=b('<p class="text-gray-500 dark:text-gray-400">Select likelihood and severity first</p>'),Te=b("<option> </option>"),qe=b('<div class="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"></div>'),ze=b('<div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50"><div class="bg-white dark:bg-gray-800 rounded-xl max-w-xl w-full shadow-xl"><div class="flex items-center justify-between p-6 border-b dark:border-gray-700"><div><h2 class="text-xl font-semibold text-gray-900 dark:text-white">Risk Assessment</h2> <p class="mt-1 text-sm text-gray-500 dark:text-gray-400"> </p></div> <button class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 transition-colors"><!></button></div> <div class="p-6 space-y-6"><div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg"><h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Risk Statement</h3> <p class="mt-1 text-sm text-gray-900 dark:text-gray-100"> </p></div> <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="space-y-2"><label class="block text-sm font-medium text-gray-700 dark:text-gray-200">Likelihood Rating</label> <select class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 dark:text-white"><option>Select likelihood</option><!></select></div> <div class="space-y-2"><label class="block text-sm font-medium text-gray-700 dark:text-gray-200">Severity</label> <select class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 dark:text-white"><option>Select severity</option><!></select></div></div> <div class="space-y-2"><label class="block text-sm font-medium text-gray-700 dark:text-gray-200">Risk Control Rating</label> <div class="p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg"><!></div></div> <div class="space-y-2"><label class="block text-sm font-medium text-gray-700 dark:text-gray-200">Monitoring Rating</label> <select class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 dark:text-white"><option>Select monitoring rating</option><!></select></div></div> <div class="flex items-center justify-end gap-3 p-6 border-t dark:border-gray-700"><button class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">Cancel</button> <button class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"><!> Save Assessment</button></div></div></div>');function Ie(D,o){ce(o,!0);let v=ye(o,"isSaving",15,!1),l=u({likelihoodRating:null,severity:null,riskControlRating:null,riskMonitoringRating:null});const p=de(()=>l.likelihoodRating!==null&&l.severity!==null&&l.riskControlRating!==null&&l.riskMonitoringRating!==null);fe(()=>{var c,i;if(l.likelihoodRating&&l.severity){const e=(c=o.likelihoodRating.find(f=>f.id===l.likelihoodRating))==null?void 0:c.symbol,s=(i=o.severity.find(f=>f.id===l.severity))==null?void 0:i.value;if(e&&s){const f=he(e,s),S=o.riskControlRating.find(X=>X.symbol===f.controlRating);l.riskControlRating=(S==null?void 0:S.id)||null}}});var x=ze(),m=r(x),k=r(m),w=r(k),P=n(r(w),2),E=r(P);t(P),t(w);var T=n(w,2);T.__click=function(...c){var i;(i=o.onClose)==null||i.apply(this,c)};var U=r(T);ke(U,{class:"h-5 w-5"}),t(T),t(k);var L=n(k,2),_=r(L),g=n(r(_),2),F=r(g,!0);t(g),t(_);var N=n(_,2),Q=r(N),q=n(r(Q),2),W=r(q);W.value=(W.__value=null)==null?"":null;var Y=n(W);se(Y,17,()=>o.likelihoodRating,le,(c,i)=>{var e=je(),s={},f=r(e);t(e),j(()=>{s!==(s=a(i).id)&&(e.value=(e.__value=a(i).id)==null?"":a(i).id),R(f,`${a(i).symbol??""} - ${a(i).name??""}`)}),y(c,e)}),t(q),t(Q);var te=n(Q,2),z=n(r(te),2),V=r(z);V.value=(V.__value=null)==null?"":null;var Z=n(V);se(Z,17,()=>o.severity,le,(c,i)=>{var e=Le(),s={},f=r(e);t(e),j(()=>{s!==(s=a(i).id)&&(e.value=(e.__value=a(i).id)==null?"":a(i).id),R(f,`${a(i).value??""} - ${a(i).name??""}`)}),y(c,e)}),t(z),t(te),t(N);var $=n(N,2),H=n(r($),2),ae=r(H);B(ae,()=>l.riskControlRating,c=>{var i=Pe();const e=de(()=>o.riskControlRating.find(G=>G.id===l.riskControlRating));var s=r(i),f=r(s,!0);t(s);var S=n(s,2),X=r(S,!0);t(S),t(i),j(()=>{var G,ge;R(f,(G=a(e))==null?void 0:G.symbol),R(X,(ge=a(e))==null?void 0:ge.name)}),y(c,i)},c=>{var i=Ee();y(c,i)}),t(H),t($);var ee=n($,2),J=n(r(ee),2),K=r(J);K.value=(K.__value=null)==null?"":null;var M=n(K);se(M,17,()=>o.riskMonitoringRating,le,(c,i)=>{var e=me(),s=ie(e);B(s,()=>a(i).status==="New Risk",f=>{var S=Te(),X={},G=r(S,!0);t(S),j(()=>{X!==(X=a(i).id)&&(S.value=(S.__value=a(i).id)==null?"":a(i).id),R(G,a(i).status)}),y(f,S)}),y(c,e)}),t(J),t(ee),t(L);var C=n(L,2),O=r(C);O.__click=function(...c){var i;(i=o.onClose)==null||i.apply(this,c)};var I=n(O,2);I.__click=[Ne,p,o,v,l];var re=r(I);B(re,v,c=>{var i=qe();y(c,i)}),oe(),t(I),t(C),t(m),t(x),j(()=>{var c,i;R(E,`RRN: ${((c=o.selectedRisk)==null?void 0:c.rrn)??""}`),R(F,(i=o.selectedRisk)==null?void 0:i.risk_statement),O.disabled=v(),I.disabled=!a(p)||v()}),ne(q,()=>l.likelihoodRating,c=>l.likelihoodRating=c),ne(z,()=>l.severity,c=>l.severity=c),ne(J,()=>l.riskMonitoringRating,c=>l.riskMonitoringRating=c),y(D,x),ve()}ue(["click"]);var Be=b('<div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-4 rounded"><p> </p></div>'),Ue=b('<div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded"><p> </p></div>'),Ve=b("<!> <!>",1);function He(D,o){var v=Ve(),l=ie(v);B(l,()=>o.successMessage,x=>{var m=Be(),k=r(m),w=r(k,!0);t(k),t(m),j(()=>R(w,o.successMessage)),y(x,m)});var p=n(l,2);B(p,()=>o.errorMessage,x=>{var m=Ue(),k=r(m),w=r(k,!0);t(k),t(m),j(()=>R(w,o.errorMessage)),y(x,m)}),y(D,v)}var Je=b('<header class="bg-white dark:bg-gray-800 shadow-sm"><div class="container mx-auto px-4 py-6"><h1 class="text-3xl font-bold text-gray-900 dark:text-white"> </h1> <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">Manage and assess department risks</p></div></header>');function Ke(D,o){var v=Je(),l=r(v),p=r(l),x=r(p);t(p),oe(2),t(l),t(v),j(()=>R(x,`${o.departmentName??""} Risk Register`)),y(D,v)}var Oe=b('<div class="flex justify-center items-center min-h-[400px]"><div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div></div>'),Xe=b("<!> <!>",1),Ge=b('<a href="/risks" class="flex items-center gap-2 text-muted-foreground mb-2 hover:text-foreground"><!> Back</a> <div class="min-h-screen bg-gray-50 dark:bg-gray-900"><!> <main class="container mx-auto px-4 py-8"><!> <!></main></div>',1);function dt(D,o){ce(o,!0),u([]);let v=h(u([])),l=h(u([])),p=h(u([])),x=h(u([])),m=h(u([])),k=h(u([])),w=h(u([])),P=h(null),E=h(null),T=h(""),U=h(!0),L=h(!1),_=h(null),g=h(null),F=h(!1),N=h(null);const Q=async()=>{try{await Promise.all([V(),Z(),q(),W(),Y(),te(),z()])}catch{d(g,"Failed to fetch data. Please refresh the page.")}},q=async()=>{const{data:e,error:s}=await A.from("classification").select("*");if(s)throw s;d(p,u(e))},W=async()=>{try{const{data:e,error:s}=await A.from("likelihood_rating").select("*");if(s)throw s;d(x,u(e))}catch{d(g,"Failed to fetch likelihood rating.")}},Y=async()=>{try{const{data:e,error:s}=await A.from("severity").select("*");if(s)throw s;d(m,u(e))}catch{d(g,"Failed to fetch severity.")}},te=async()=>{try{const{data:e,error:s}=await A.from("risk_control_rating").select("*");if(s)throw s;d(k,u(e))}catch{d(g,"Failed to fetch risk control rating.")}},z=async()=>{try{const{data:e,error:s}=await A.from("risk_monitoring_rating").select("*");if(s)throw s;d(w,u(e))}catch{d(g,"Failed to fetch risk monitoring rating.")}},V=async()=>{var e;try{if(!((e=a(E))!=null&&e.department_id)){d(g,"Department ID not found. Please try reloading.");return}const{data:s,error:f}=await A.from("risks").select("*").eq("department_id",a(E).department_id).order("rrn",{ascending:!0});if(f)throw f;d(v,u(s))}catch{d(g,"Failed to fetch saved risks.")}},Z=async()=>{try{const{data:e,error:s}=await A.from("risk_assessment").select("*");if(s)throw s;d(l,u(e))}catch{d(g,"Failed to fetch risk assessments.")}},$=async()=>{d(U,!0);try{const{data:e}=await A.auth.getSession();if(d(P,u(e.session)),a(P)){const{data:s}=await A.from("profiles").select("id, department_id").eq("id",a(P).user.id).single();d(E,u(s));const{data:f}=await A.from("departments").select("name").eq("id",a(E).department_id).single();d(T,u(f?f.name:"Unknown Department")),await V(),await Q()}}catch{d(g,"Failed to load profile. Please try again.")}finally{d(U,!1)}},H=e=>{d(N,u(e)),d(F,!0)},ae=()=>{d(F,!1),d(N,null)},ee=e=>{d(_,u(e)),setTimeout(()=>d(_,null),3e3)},J=e=>{d(g,u(e)),setTimeout(()=>d(g,null),3e3)};be(()=>{$()});var K=Ge(),M=ie(K),C=r(M);we(C,{size:20}),oe(),t(M);var O=n(M,2),I=r(O);Ke(I,{get departmentName(){return a(T)}});var re=n(I,2),c=r(re);He(c,{get successMessage(){return a(_)},get errorMessage(){return a(g)}});var i=n(c,2);B(i,()=>a(U),e=>{var s=Oe();y(e,s)},e=>{var s=Xe(),f=ie(s);Fe(f,{get savedRisks(){return a(v)},get classification(){return a(p)},get riskAssessments(){return a(l)},get isSaving(){return a(L)},onAssess:H});var S=n(f,2);B(S,()=>a(F),X=>{Ie(X,{get isSaving(){return a(L)},set isSaving(G){d(L,u(G))},get selectedRisk(){return a(N)},get likelihoodRating(){return a(x)},get severity(){return a(m)},get riskControlRating(){return a(k)},get riskMonitoringRating(){return a(w)},onClose:ae,onSuccess:ee,onError:J})}),y(e,s)}),t(re),t(O),y(D,K),ve()}export{dt as component};

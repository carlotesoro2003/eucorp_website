import"../chunks/disclose-version.Bg9kRutz.js";import{p as Ft,t as f,a as St,g as t,m as g,b as o,c as a,r as s,s as l,f as $t,d as H,i as I}from"../chunks/runtime.CLSstnwU.js";import{s as u}from"../chunks/render.D17u6ZCY.js";import{i as J}from"../chunks/if.b2Q-jNLG.js";import{e as U,i as z}from"../chunks/each.sV1uapQk.js";import{a as b,t as R,e as O,c as Dt}from"../chunks/utils.kA-YjkFf.js";import{b as Q}from"../chunks/select.BAP3DC-4.js";import{i as Nt}from"../chunks/lifecycle.V0dJQ05z.js";import{o as qt}from"../chunks/index-client.DT-fMr9Z.js";import{s as p}from"../chunks/supabaseClient.CaMOPPuz.js";var Pt=R('<p class="text-green-400 my-2"> </p>'),Lt=R('<p class="text-red-400 my-2"> </p>'),Ut=R('<tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td><button class="btn btn-sm btn-primary">Add Assessment</button></td><td><button class="btn btn-sm btn-error">Delete</button></td></tr>'),zt=R("<option> </option>"),Bt=R("<option> </option>"),Kt=R("<option> </option>"),jt=R("<option> </option>"),Gt=R('<div class="modal modal-open"><div class="modal-box "><h3 class="font-bold text-lg"> </h3> <label class="label" for="likelihoodRating">Likelihood Rating</label> <select id="likelihoodRating" class="select select-bordered w-full max-w-xs"><option disabled>Select likelihood</option><!></select> <label class="label mt-2" for="severity">Severity</label> <select id="severity" class="select select-bordered w-full max-w-xs"><option disabled>Select severity</option><!></select> <label class="label mt-2" for="riskControlRating">Risk Control Rating</label> <select id="riskControlRating" class="select select-bordered w-full max-w-xs"><option disabled>Select control rating</option><!></select> <label class="label mt-2" for="riskMonitoringRating">Risk Monitoring Rating</label> <select id="riskMonitoringRating" class="select select-bordered w-full max-w-xs"><option disabled>Select monitoring rating</option><!></select> <div class="modal-action"><button class="btn btn-primary">Save</button> <button class="btn">Cancel</button></div></div></div>'),Ht=R('<div><h1 class="text-3xl font-bold"> </h1> <!> <!> <h2 class="text-2xl font-bold mt-8">All Saved Risks</h2> <table class="table table-zebra w-full mt-4"><thead><tr><th>RRN</th><th>Risk Statement</th><th>Classification</th><th>Actions</th><th>Key Persons</th><th>Budget</th><th></th></tr></thead><tbody></tbody></table> <!></div>');function te(_t,ut){Ft(ut,!1);let B=g([]),st=g([]),at=g([]),T=g([]),V=g([]),W=g([]),X=g([]),Y=null,it=null,lt=g(""),K=g(null),m=g(null),Z=g(!1),$=g(null),n=g({risk_id:"",likelihoodRating:null,severity:null,riskControlRating:null,riskMonitoringRating:null});const ht=async()=>{try{const{data:r,error:e}=await p.from("classification").select("*");if(e)throw e;o(at,r)}catch(r){console.error("Error fetching classification:",r),o(m,"Failed to fetch classification.")}},gt=async()=>{try{const{data:r,error:e}=await p.from("likelihood_rating").select("*");if(e)throw e;o(T,r)}catch(r){console.error("Error fetching likelihood rating:",r),o(m,"Failed to fetch likelihood rating.")}},pt=async()=>{try{const{data:r,error:e}=await p.from("severity").select("*");if(e)throw e;o(V,r)}catch(r){console.error("Error fetching severity:",r),o(m,"Failed to fetch severity.")}},kt=async()=>{try{const{data:r,error:e}=await p.from("risk_control_rating").select("*");if(e)throw e;o(W,r)}catch(r){console.error("Error fetching risk control rating:",r),o(m,"Failed to fetch risk control rating.")}},bt=async()=>{try{const{data:r,error:e}=await p.from("risk_monitoring_rating").select("*");if(e)throw e;o(X,r)}catch(r){console.error("Error fetching risk monitoring rating:",r),o(m,"Failed to fetch risk monitoring rating.")}},Rt=async()=>{try{const{data:r,error:e}=await p.from("risks").select("*").order("rrn",{ascending:!0});if(e)throw e;o(B,r.sort((v,_)=>{const y=h=>{const w=h.match(/(\d+)$/);return w?parseInt(w[0],10):0};return y(v.rrn)-y(_.rrn)}))}catch(r){console.error("Error fetching risks:",r),o(m,"Failed to fetch saved risks.")}},nt=async()=>{try{const{data:r,error:e}=await p.from("risk_assessment").select("*");if(e)throw e;o(st,r)}catch(r){console.error("Error fetching risk assessments:",r),o(m,"Failed to fetch risk assessments.")}},yt=async()=>{try{const{data:r,error:e}=await p.auth.getSession();if(e)throw e;if(Y=r.session,Y){const{data:v,error:_}=await p.from("profiles").select("id, department_id").eq("id",Y.user.id).single();if(_)throw _;it=v;const{data:y,error:h}=await p.from("departments").select("name").eq("id",it.department_id).single();if(h)throw h;o(lt,y.name),await Rt(),await nt(),await ht(),await gt(),await pt(),await kt(),await bt()}else o(m,"User is not logged in.")}catch(r){console.error("Error fetching user profile or department:",r),o(m,"Failed to fetch profile or department details.")}finally{}},wt=r=>{o($,r),o(Z,!0)},ct=()=>{o(Z,!1),o($,null),o(n,{risk_id:"",likelihoodRating:null,severity:null,riskControlRating:null,riskMonitoringRating:null})},xt=async()=>{try{if(!t($)){o(m,"No risk selected for assessment.");return}const{data:r,error:e}=await p.from("risk_assessment").insert({risk_id:t($).id,lr:t(n).likelihoodRating,s:t(n).severity,rcr:t(n).riskControlRating,rmr:t(n).riskMonitoringRating});if(e)throw e;o(K,"Risk assessment saved successfully!"),await nt(),ct()}catch(r){console.error("Error saving risk assessment:",r),o(m,"Failed to save risk assessment.")}},Ct=async r=>{try{const{data:e,error:v}=await p.from("risks").delete().eq("id",r);if(v)throw v;o(K,"Risk deleted successfully!"),o(B,t(B).filter(_=>_.id!==r))}catch(e){console.log("Error deleting risk: ",e),o(m,"Failed to delete risk.")}};qt(()=>{yt()}),Nt();var tt=Ht(),et=a(tt),Mt=a(et);s(et);var dt=l(et,2);J(dt,()=>t(K),r=>{var e=Pt(),v=a(e,!0);s(e),f(()=>u(v,t(K))),b(r,e)});var vt=l(dt,2);J(vt,()=>t(m),r=>{var e=Lt(),v=a(e,!0);s(e),f(()=>u(v,t(m))),b(r,e)});var rt=l(vt,4),ft=l(a(rt));U(ft,5,()=>t(B),z,(r,e)=>{var v=Ut(),_=a(v),y=a(_,!0);s(_);var h=l(_),w=a(h,!0);s(h);var D=l(h),E=a(D,!0);f(()=>{var S;return u(E,((S=t(at).find(c=>c.id===t(e).classification))==null?void 0:S.name)||"N/A")}),s(D);var C=l(D),ot=a(C,!0);s(C);var x=l(C),N=a(x,!0);s(x);var q=l(x),F=a(q,!0);s(q);var M=l(q),j=a(M);f(()=>j.disabled=t(st).some(S=>S.risk_id===t(e).id)),s(M);var P=l(M),G=a(P);s(P),s(v),f(()=>{u(y,t(e).rrn),u(w,t(e).risk_statement),u(ot,t(e).actions),u(N,t(e).key_persons),u(F,t(e).budget)}),O("click",j,()=>wt(t(e))),O("click",G,()=>Ct(t(e).id)),b(r,v)}),s(ft),s(rt);var At=l(rt,2);J(At,()=>t(Z),r=>{var e=Gt(),v=a(e),_=a(v),y=a(_);s(_);var h=l(_,4);f(()=>{t(n).likelihoodRating,I(()=>{t(T)})});var w=a(h);w.value=((w.__value="")==null,"");var D=l(w);U(D,1,()=>t(T),z,(c,i)=>{var d=zt(),k={},A=a(d);s(d),f(()=>{k!==(k=t(i).id)&&(d.value=(d.__value=t(i).id)==null?"":t(i).id),u(A,`${t(i).symbol??""} - ${t(i).name??""}`)}),b(c,d)}),s(h);var E=l(h,4);f(()=>{t(n).severity,I(()=>{t(V)})});var C=a(E);C.value=((C.__value="")==null,"");var ot=l(C);U(ot,1,()=>t(V),z,(c,i)=>{var d=Bt(),k={},A=a(d);s(d),f(()=>{k!==(k=t(i).id)&&(d.value=(d.__value=t(i).id)==null?"":t(i).id),u(A,`${t(i).value??""} - ${t(i).name??""}`)}),b(c,d)}),s(E);var x=l(E,4);f(()=>{t(n).riskControlRating,I(()=>{t(W)})});var N=a(x);N.value=((N.__value="")==null,"");var q=l(N);U(q,1,()=>t(W),z,(c,i)=>{var d=Kt(),k={},A=a(d);s(d),f(()=>{k!==(k=t(i).id)&&(d.value=(d.__value=t(i).id)==null?"":t(i).id),u(A,`${t(i).symbol??""} - ${t(i).name??""}`)}),b(c,d)}),s(x);var F=l(x,4);f(()=>{t(n).riskMonitoringRating,I(()=>{t(X)})});var M=a(F);M.value=((M.__value="")==null,"");var j=l(M);U(j,1,()=>t(X),z,(c,i)=>{var d=Dt(),k=$t(d);J(k,()=>t(i).status==="New Risk",A=>{var L=jt(),mt={},Et=a(L,!0);s(L),f(()=>{mt!==(mt=t(i).id)&&(L.value=(L.__value=t(i).id)==null?"":t(i).id),u(Et,t(i).status)}),b(A,L)}),b(c,d)}),s(F);var P=l(F,2),G=a(P),S=l(G,2);s(P),s(v),s(e),f(()=>{var c;return u(y,`Add Risk Assessment for ${((c=t($))==null?void 0:c.rrn)??""}`)}),Q(h,()=>t(n).likelihoodRating,c=>H(n,t(n).likelihoodRating=c)),Q(E,()=>t(n).severity,c=>H(n,t(n).severity=c)),Q(x,()=>t(n).riskControlRating,c=>H(n,t(n).riskControlRating=c)),Q(F,()=>t(n).riskMonitoringRating,c=>H(n,t(n).riskMonitoringRating=c)),O("click",G,xt),O("click",S,ct),b(r,e)}),s(tt),f(()=>u(Mt,`${t(lt)??""} Risks Register`)),b(_t,tt),St()}export{te as component};

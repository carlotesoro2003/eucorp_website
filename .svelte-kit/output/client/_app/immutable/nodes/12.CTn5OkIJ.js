import"../chunks/disclose-version.Bg9kRutz.js";import{p as Ze,e as u,c as o,r as a,s,t as k,b as i,g as e,a as $e,f as yt,T as et,n as Ie,h as J}from"../chunks/utils.Cx6K9qTo.js";import{d as tt,a as P,g as wt,t as A,b as f}from"../chunks/store.BALTJZ26.js";import{i as Le}from"../chunks/if.Bgpzl8Wa.js";import{b as Fe,e as le,i as Te,r as kt}from"../chunks/attributes.rzeD2olC.js";import{s as St}from"../chunks/class.DKwifj_X.js";import{t as Et,f as Gt}from"../chunks/index.3UqCw1jp.js";import{b as se}from"../chunks/input.BVFrb_g3.js";import{b as ne}from"../chunks/select.BtlRD387.js";import{a as _}from"../chunks/preload-helper.Tg4Km7Zr.js";import{o as Ct}from"../chunks/index-client.lWLCSZVk.js";import{s as N}from"../chunks/Icon.Nl6wOSVO.js";import{g as Nt}from"../chunks/entry.CMKkUr-m.js";import{X as Pt}from"../chunks/x.D9PBK57y.js";import{T as At}from"../chunks/target.DTwNHqoR.js";import{S as Yt}from"../chunks/search.BpYLThKw.js";import{P as zt}from"../chunks/plus.Dop3u5ke.js";import{A as We}from"../chunks/arrow-up-down.CZ0J7o1e.js";import{E as It}from"../chunks/eye.CaP1-WUo.js";import{P as Lt}from"../chunks/pencil.Brzv4RaD.js";import{T as Ft}from"../chunks/trash-2.d9YwO6MY.js";var Tt=A("<option> </option>"),jt=A('<div class="fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center p-4 z-50"><div class="bg-card p-6 rounded-lg shadow-lg w-full max-w-md relative border border-border"><button class="absolute right-4 top-4 p-1 hover:bg-muted rounded-lg" title="Close"><!></button> <h2 class="text-xl font-semibold mb-4"> </h2> <form class="space-y-4"><div class="space-y-2"><label for="name" class="text-sm font-medium">Name</label> <textarea id="name" placeholder="Enter goal name" class="w-full px-3 py-2 bg-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-ring" required></textarea></div> <div class="space-y-2"><label for="description" class="text-sm font-medium">Description</label> <textarea id="description" placeholder="Enter description" class="w-full px-3 py-2 bg-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-ring" required></textarea></div> <div class="space-y-2"><label for="kpi" class="text-sm font-medium">KPI</label> <textarea id="kpi" placeholder="Enter KPI" class="w-full px-3 py-2 bg-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-ring" required></textarea></div> <div class="space-y-2"><label for="lead_id" class="text-sm font-medium">Lead</label> <select id="lead_id" class="w-full px-3 py-2 bg-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-ring"><option>Select a lead</option><!></select></div> <div class="flex gap-2 pt-4"><button type="submit" class="flex-1 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90"> </button> <button type="button" class="flex-1 px-4 py-2 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/80">Cancel</button></div></form></div></div>');function Dt(b,n){var Z,$,q,X;Ze(n,!0);let x=u(_(((Z=n.goal)==null?void 0:Z.name)||"")),g=u(_((($=n.goal)==null?void 0:$.description)||"")),h=u(_(((q=n.goal)==null?void 0:q.kpi)||"")),Y=u(_(((X=n.goal)==null?void 0:X.lead_id)||null));const z=d=>{d.preventDefault(),n.onSave({name:e(x),description:e(g),kpi:e(h),lead_id:e(Y)})};var y=jt(),F=o(y),w=o(F);w.__click=function(...d){var m;(m=n.onClose)==null||m.apply(this,d)};var I=o(w);Pt(I,{size:20}),a(w);var S=s(w,2),B=o(S);a(S);var j=s(S,2),D=o(j),E=s(o(D),2);Fe(E),a(D);var L=s(D,2),M=s(o(L),2);Fe(M),a(L);var G=s(L,2),R=s(o(G),2);Fe(R),a(G);var O=s(G,2),Q=s(o(O),2),U=o(Q);U.value=(U.__value=null)==null?"":null;var V=s(U);le(V,17,()=>n.leads,Te,(d,m)=>{var T=Tt(),K={},ee=o(T,!0);a(T),k(()=>{K!==(K=e(m).id)&&(T.value=(T.__value=e(m).id)==null?"":e(m).id),f(ee,e(m).name)}),P(d,T)}),a(Q),a(O);var W=s(O,2),p=o(W),ie=o(p);a(p);var ce=s(p,2);ce.__click=function(...d){var m;(m=n.onClose)==null||m.apply(this,d)},a(W),a(j),a(F),a(y),k(()=>{f(B,`${(n.goal?"Edit":"Create")??""} Strategic Goal`),f(ie,`${(n.goal?"Update":"Create")??""} Goal`)}),wt("submit",j,z),se(E,()=>e(x),d=>i(x,d)),se(M,()=>e(g),d=>i(g,d)),se(R,()=>e(h),d=>i(h,d)),ne(Q,()=>e(Y),d=>i(Y,d)),P(b,y),$e()}tt(["click"]);var Mt=A("<div><span> </span></div>"),Vt=A("<option> </option>"),qt=A("<option> </option>"),Kt=(b,n)=>i(n,!0),Bt=A('<div class="flex justify-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),Ot=(b,n)=>n("goal_no"),Qt=(b,n)=>n("name"),Ut=(b,n)=>Nt(`/plans/${e(n).id}`),Xt=(b,n,x,g)=>{i(n,_(e(x))),i(g,!0)},Ht=(b,n,x)=>n(e(x).id),Jt=A('<tr class="hover:bg-muted/50"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3 hidden md:table-cell"> </td><td class="px-4 py-3 hidden lg:table-cell"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><div class="flex justify-center gap-2"><button class="p-1.5 hover:bg-primary/10 rounded-md transition-colors text-blue-500" title="View objectives"><!></button> <button class="hover:bg-muted rounded-lg text-muted-foreground hover:text-foreground" title="Edit goal"><!></button> <button class="p-1.5 hover:bg-red-100 rounded-md transition-colors text-red-600" title="Delete goal"><!></button></div></td></tr>'),Rt=(b,n)=>et(n,-1),Wt=(b,n)=>et(n),Zt=A('<div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">Goal No <!></button></th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">Name <!></button></th><th class="px-4 py-3 text-left hidden md:table-cell">Description</th><th class="px-4 py-3 text-left hidden lg:table-cell">KPI</th><th class="px-4 py-3 text-left">Lead</th><th class="px-4 py-3 text-left">School Year</th><th class="px-4 py-3 text-center">Actions</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-ring"><option>5 per page</option><option>10 per page</option><option>25 per page</option></select> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50 transition-colors">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50 transition-colors">Next</button></div></div></div>',1),$t=A('<div class="flex flex-col gap-4 p-4 container mx-auto"><!> <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div class="flex items-center gap-2"><!> <h1 class="text-2xl font-bold">Strategic Goals</h1></div></div> <div class="flex flex-col md:flex-row gap-4 mb-2 items-center justify-between"><div class="flex flex-col md:flex-row gap-4 flex-1"><div class="relative flex-1 w-full md:max-w-[300px]"><!> <input type="text" placeholder="Search goals..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring w-full md:w-[200px]"><option>All Leads</option><!></select> <select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring w-full md:w-[200px]"><option>All School Years</option><!></select></div> <button class="flex items-center gap-2 bg-primary text-primary-foreground px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors"><!> Add Goal</button></div> <!> <!></div>');function ya(b,n){Ze(n,!0);let x=u(""),g=u(1),h=u(5),Y=u(!1),z=u("goal_no"),y=u("asc"),F=u("all"),w=u("all"),I=u(!0),S=u(null),B=u(!1),j=u(""),D=u("success"),E=u(_([])),L=u(_([])),M=u(_([])),G=null;Ct(()=>{R()});const R=async()=>{await O(),await U(),await Q(),await V(),i(I,!1)},O=async()=>{const t=new Date().toISOString().split("T")[0],{data:r,error:l}=await N.from("school_years").select("id").lte("start_date",t).gte("end_date",t).maybeSingle();l?(console.error("Error fetching current school year:",l),G=null):(G=(r==null?void 0:r.id)||null,i(w,_(G||"all")))},Q=async()=>{const{data:t,error:r}=await N.from("school_years").select("*").order("start_date",{ascending:!1});r?p("Error fetching school years","error"):i(M,_(t))},U=async()=>{const{data:t,error:r}=await N.from("leads").select("id, name");r?p("Error fetching leads","error"):i(L,_(t))},V=async()=>{const{data:t,error:r}=await N.from("strategic_goals").select("*").order("goal_no",{ascending:e(y)==="asc"});r?p("Error fetching strategic goals","error"):i(E,_(t))},W=()=>e(E).length>0?Math.max(...e(E).map(t=>t.goal_no))+1:1,p=(t,r)=>{i(j,_(t)),i(D,_(r)),i(B,!0),setTimeout(()=>{i(B,!1)},3e3)},ie=t=>{const r=e(L).find(l=>l.id===t);return r?r.name:"No Lead Assigned"},ce=t=>{const r=e(M).find(l=>l.id===t);return r?r.school_year:"No School Year"},Z=async t=>{if(!G){p("No current school year found. Cannot save goal.","error");return}const r={...t,school_year:G};if(e(S)){const{error:l}=await N.from("strategic_goals").update(r).match({id:e(S).id});l?p("Error updating goal","error"):(p("Goal updated successfully","success"),await V(),q())}else{const l={...r,goal_no:W()},{error:c}=await N.from("strategic_goals").insert([l]);c?p("Error creating goal","error"):(p("Goal created successfully","success"),await V(),q())}},$=async t=>{if(confirm("Are you sure you want to delete this goal?")){i(I,!0);const{error:r}=await N.from("strategic_goals").delete().match({id:t});if(r){p("Error deleting goal","error"),i(I,!1);return}const{data:l,error:c}=await N.from("strategic_goals").select("*").order("goal_no",{ascending:!0});if(c){p("Error reordering goals","error"),i(I,!1);return}for(let v=0;v<l.length;(v+=1)-1)await N.from("strategic_goals").update({goal_no:v+1}).match({id:l[v].id});p("Goal deleted and reordered successfully","success"),await V(),i(I,!1)}},q=()=>{i(Y,!1),i(S,null)},X=t=>{e(z)===t?i(y,_(e(y)==="asc"?"desc":"asc")):(i(z,_(t)),i(y,"asc")),t==="goal_no"?e(E).sort((r,l)=>e(y)==="asc"?Number(r.goal_no)-Number(l.goal_no):Number(l.goal_no)-Number(r.goal_no)):e(E).sort((r,l)=>{const c=String(r[t]),v=String(l[t]);return e(y)==="asc"?c.localeCompare(v):v.localeCompare(c)})},d=J(()=>e(E).filter(t=>{const l=`${t.name} ${t.description} ${t.kpi}`.toLowerCase().includes(e(x).toLowerCase()),c=e(F)==="all"||t.lead_id===e(F),v=e(w)==="all"||t.school_year===e(w);return l&&c&&v}).sort((t,r)=>{const l=String(t[e(z)]),c=String(r[e(z)]);return e(y)==="asc"?l.localeCompare(c):c.localeCompare(l)})),m=J(()=>e(d).slice((e(g)-1)*e(h),e(g)*e(h))),T=J(()=>Math.ceil(e(d).length/e(h)));var K=$t(),ee=o(K);Le(ee,()=>e(B),t=>{var r=Mt(),l=o(r),c=o(l,!0);a(l),a(r),k(()=>{St(r,`flex items-center p-4 rounded-lg ${(e(D)==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800")??""}`),f(c,e(j))}),Et(3,r,()=>Gt),P(t,r)});var de=s(ee,2),je=o(de),at=o(je);At(at,{class:"w-8 h-8 text-primary"}),Ie(2),a(je),a(de);var ue=s(de,2),ve=o(ue),_e=o(ve),De=o(_e);Yt(De,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var Me=s(De,2);kt(Me),a(_e);var te=s(_e,2),pe=o(te);pe.value=(pe.__value="all")==null?"":"all";var rt=s(pe);le(rt,17,()=>e(L),Te,(t,r)=>{var l=Vt(),c={},v=o(l,!0);a(l),k(()=>{c!==(c=e(r).id)&&(l.value=(l.__value=e(r).id)==null?"":e(r).id),f(v,e(r).name)}),P(t,l)}),a(te);var ge=s(te,2),fe=o(ge);fe.value=(fe.__value="all")==null?"":"all";var ot=s(fe);le(ot,17,()=>e(M),Te,(t,r)=>{var l=qt(),c={},v=o(l,!0);a(l),k(()=>{c!==(c=e(r).id)&&(l.value=(l.__value=e(r).id)==null?"":e(r).id),f(v,e(r).school_year)}),P(t,l)}),a(ge),a(ve);var me=s(ve,2);me.__click=[Kt,Y];var lt=o(me);zt(lt,{size:20}),Ie(),a(me),a(ue);var Ve=s(ue,2);Le(Ve,()=>e(I),t=>{var r=Bt();P(t,r)},t=>{var r=Zt(),l=yt(r),c=o(l),v=o(c),qe=o(v),be=o(qe),xe=o(be);xe.__click=[Ot,X];var nt=s(o(xe)),it=J(()=>e(z)==="goal_no"?"text-primary":"");We(nt,{size:16,get class(){return e(it)}}),a(xe),a(be);var Ke=s(be),he=o(Ke);he.__click=[Qt,X];var ct=s(o(he)),dt=J(()=>e(z)==="name"?"text-primary":"");We(ct,{size:16,get class(){return e(dt)}}),a(he),a(Ke),Ie(5),a(qe),a(v);var Be=s(v);le(Be,21,()=>e(m),H=>H.id,(H,C)=>{var Ee=Jt(),Ge=o(Ee),vt=o(Ge,!0);a(Ge);var Ce=s(Ge),_t=o(Ce,!0);a(Ce);var Ne=s(Ce),pt=o(Ne,!0);a(Ne);var Pe=s(Ne),gt=o(Pe,!0);a(Pe);var Ae=s(Pe),ft=o(Ae,!0);k(()=>f(ft,ie(e(C).lead_id))),a(Ae);var Ye=s(Ae),mt=o(Ye,!0);k(()=>f(mt,ce(e(C).school_year))),a(Ye);var Je=s(Ye),Re=o(Je),re=o(Re);re.__click=[Ut,C];var bt=o(re);It(bt,{size:18}),a(re);var oe=s(re,2);oe.__click=[Xt,S,C,Y];var xt=o(oe);Lt(xt,{size:18}),a(oe);var ze=s(oe,2);ze.__click=[Ht,$,C];var ht=o(ze);Ft(ht,{size:18}),a(ze),a(Re),a(Je),a(Ee),k(()=>{f(vt,e(C).goal_no),f(_t,e(C).name),f(pt,e(C).description),f(gt,e(C).kpi)}),P(H,Ee)}),a(Be),a(c),a(l);var Oe=s(l,2),ye=o(Oe),ut=o(ye);k(()=>f(ut,`Showing ${(e(g)-1)*e(h)+1} to ${Math.min(e(g)*e(h),e(d).length)??""} of ${e(d).length??""} results`)),a(ye);var Qe=s(ye,2),ae=o(Qe),we=o(ae);we.value=(we.__value=5)==null?"":5;var ke=s(we);ke.value=(ke.__value=10)==null?"":10;var Ue=s(ke);Ue.value=(Ue.__value=25)==null?"":25,a(ae);var Xe=s(ae,2),Se=o(Xe);Se.__click=[Rt,g];var He=s(Se,2);He.__click=[Wt,g],a(Xe),a(Qe),a(Oe),k(()=>{Se.disabled=e(g)===1,He.disabled=e(g)===e(T)}),ne(ae,()=>e(h),H=>i(h,H)),P(t,r)});var st=s(Ve,2);Le(st,()=>e(Y),t=>{Dt(t,{get goal(){return e(S)},get leads(){return e(L)},onSave:Z,onClose:q})}),a(K),se(Me,()=>e(x),t=>i(x,t)),ne(te,()=>e(F),t=>i(F,t)),ne(ge,()=>e(w),t=>i(w,t)),P(b,K),$e()}tt(["click"]);export{ya as component};

import"../chunks/disclose-version.Bg9kRutz.js";import{f as Ae,p as Ee,c as s,r as a,s as o,t as z,a as Pe,g as e,e as u,b as n,T as lt,n as Re,h as ke,m as Xe}from"../chunks/utils.Cx6K9qTo.js";import{e as $e,a as S,d as Be,t as T,b as M}from"../chunks/store.BALTJZ26.js";import{i as ve}from"../chunks/if.Bgpzl8Wa.js";import{i as At}from"../chunks/lifecycle.D0tpf3vC.js";import{o as dt}from"../chunks/index-client.lWLCSZVk.js";import{I as Nt,a as Et,s as h}from"../chunks/Icon.Nl6wOSVO.js";import{b as Ze,e as he,i as Ne,r as je,s as Pt}from"../chunks/attributes.rzeD2olC.js";import{t as it,f as ot}from"../chunks/index.3UqCw1jp.js";import{l as St,s as Ct,p as Ft,a as p}from"../chunks/preload-helper.Tg4Km7Zr.js";import{s as ct}from"../chunks/class.DKwifj_X.js";import{b as pe}from"../chunks/input.BVFrb_g3.js";import{b as qe}from"../chunks/select.BtlRD387.js";import{T as vt}from"../chunks/trash-2.d9YwO6MY.js";import{T as _t}from"../chunks/triangle-alert.3_7etEXw.js";import{P as Mt}from"../chunks/plus.Dop3u5ke.js";import{C as Dt}from"../chunks/circle-plus.C_eqP8H1.js";import{E as zt,a as It}from"../chunks/jspdf.plugin.autotable.BCh_1lSd.js";import{A as nt}from"../chunks/arrow-up-down.CZ0J7o1e.js";import{S as Tt}from"../chunks/search.BpYLThKw.js";import{D as jt}from"../chunks/download.K4Jw1XP8.js";function qt(C,r){const c=St(r,["children","$$slots","$$events","$$legacy"]);Nt(C,Ct({name:"arrow-up-right"},()=>c,{iconNode:[["path",{d:"M7 7h10v10"}],["path",{d:"M7 17 17 7"}]],children:(y,w)=>{var N=$e(),g=Ae(N);Et(g,r,"default",{}),S(y,N)},$$slots:{default:!0}}))}var Bt=(C,r)=>r.removeRow(r.index),Ut=T("<option> </option>"),Vt=T('<div class="bg-white rounded-xl shadow-lg p-6"><div class="flex justify-between items-start mb-6"><div><h3 class="text-lg font-semibold text-gray-800"> </h3></div> <div class="flex items-center gap-4"><a><span class="text-sm">Risk Assessment</span> <!></a> <button class="text-red-500 hover:text-red-600"><!></button></div></div> <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Risk Statement</label> <textarea placeholder="Enter risk statement..." class="w-full h-24 px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-blue-500"></textarea></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Actions</label> <textarea placeholder="Enter actions..." class="w-full h-24 px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-blue-500"></textarea></div></div> <div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Classification</label> <select class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-blue-500"><option>Select classification</option><!></select></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Key Persons</label> <textarea placeholder="Enter key persons..." class="w-full h-24 px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-blue-500"></textarea></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Budget</label> <input type="number" placeholder="Enter budget..." class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-blue-500"></div></div></div></div>');function Lt(C,r){Ee(r,!0);let c=Ft(r,"risk",7);var b=Vt(),y=s(b),w=s(y),N=s(w),g=s(N,!0);a(N),a(w);var Y=o(w,2),f=s(Y),D=o(s(f),2);qt(D,{class:"w-4 h-4"}),a(f);var j=o(f,2);j.__click=[Bt,r];var O=s(j);vt(O,{class:"w-5 h-5"}),a(j),a(Y),a(y);var q=o(y,2),J=s(q),I=s(J),ee=o(s(I),2);Ze(ee),a(I);var Q=o(I,2),X=o(s(Q),2);Ze(X),a(Q),a(J);var Z=o(J,2),E=s(Z),L=o(s(E),2),B=s(L);B.value=(B.__value=null)==null?"":null;var U=o(B);he(U,17,()=>r.classification,Ne,(l,v)=>{var A=Ut(),F={},re=s(A,!0);a(A),z(()=>{F!==(F=e(v).id)&&(A.value=(A.__value=e(v).id)==null?"":e(v).id),M(re,e(v).name)}),S(l,A)}),a(L),a(E);var W=o(E,2),H=o(s(W),2);Ze(H),a(W);var se=o(W,2),_=o(s(se),2);je(_),a(se),a(Z),a(q),a(b),z(()=>{M(g,c().rrn),Pt(f,"href",`/risks/riskAssessment?riskId=${c().id}`),ct(f,`${(c().id?"":"pointer-events-none opacity-50")??""} inline-flex items-center text-blue-600 hover:text-blue-700 gap-1`)}),pe(ee,()=>c().risk_statement,l=>c().risk_statement=l),pe(X,()=>c().actions,l=>c().actions=l),qe(L,()=>c().classification,l=>c().classification=l),pe(H,()=>c().key_persons,l=>c().key_persons=l),pe(_,()=>c().budget,l=>c().budget=l),S(C,b),Pe()}Be(["click"]);const Ht=(C,r,c,b,y)=>{var N,g;const w=`RRN-${e(r)}-${String(e(c)).padStart(3,"0")}`;lt(c),n(b,p([...e(b),{rrn:w,risk_statement:"",classification:null,actions:"",key_persons:"",budget:0,profile_id:((N=e(y))==null?void 0:N.id)||"",department_id:((g=e(y))==null?void 0:g.department_id)||""}]))},Kt=async(C,r,c,b,y,w)=>{var N;n(r,!0);try{const g=e(c).map(({id:D,...j})=>j),{error:Y}=await h.from("risks").upsert(g,{onConflict:"rrn"});if(Y)throw Y;const f=await h.from("risks").select("*").eq("profile_id",(N=e(b))==null?void 0:N.id);if(f.error)throw f.error;n(c,p(f.data||[])),n(y,"Risks saved successfully!"),setTimeout(()=>{n(y,null)},3e3)}catch(g){console.error("Error saving risks:",g),n(w,"Failed to save risks."),setTimeout(()=>{n(w,null)},3e3)}finally{n(r,!1)}};var Yt=T('<div class="flex items-center p-4 rounded-lg bg-green-100 text-green-800"><span> </span></div>'),Ot=T('<div class="flex items-center p-4 rounded-lg bg-red-100 text-red-800"><span> </span></div>'),Qt=T('<div class="flex justify-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),Wt=T('<div class="animate-spin inline-block w-4 h-4 border-2 border-current border-t-transparent rounded-full mr-2"></div>'),Gt=T('<div class="grid grid-cols-1 gap-4 mb-6"></div> <div class="flex flex-wrap gap-4"><button class="inline-flex items-center px-4 py-2 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/90 transition-colors"><!> Add Risk</button> <button class="inline-flex items-center px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50"><!> Submit Risks</button></div>',1),Jt=T('<div class="flex flex-col gap-4 p-4 container mx-auto"><!> <!> <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div class="flex items-center gap-2"><!> <h1 class="text-2xl font-bold"> </h1></div></div> <div class="bg-card rounded-lg shadow border border-border p-6"><div class="flex justify-between items-center mb-6"><h2 class="text-xl font-semibold">Department Risks</h2></div> <!></div></div>');function Xt(C,r){Ee(r,!0);let c=u(p([])),b=u(p([])),y=u(null),w=u(""),N=u(!0),g=u(!1),Y=u(null),f=u(null),D=u(1);const j=async()=>{try{await O(),await J(),await I(),await q()}catch(_){console.error("Error fetching data:",_),n(f,"Failed to fetch data. Please try again.")}},O=async()=>{var _,l;try{const{data:v,error:A}=await h.auth.getSession();if(A)throw A;const F=(l=(_=v==null?void 0:v.session)==null?void 0:_.user)==null?void 0:l.id;if(!F)throw new Error("No logged-in user found.");const{data:re,error:k}=await h.from("profiles").select("id, department_id").eq("id",F).single();if(k)throw k;n(y,p(re));const{data:G,error:K}=await h.from("departments").select("name").eq("id",e(y).department_id).single();if(K)throw K;n(w,p(G.name))}catch(v){console.error("Error fetching user profile:",v),n(f,"Failed to fetch profile details.")}},q=async()=>{try{const{data:_,error:l}=await h.from("classification").select("id, name");if(l)throw l;n(b,p(_||[]))}catch(_){console.error("Error fetching classifications:",_),n(f,"Failed to fetch classifications.")}},J=async()=>{var _;try{const{data:l,error:v}=await h.from("risks").select("*").eq("department_id",(_=e(y))==null?void 0:_.department_id).order("rrn",{ascending:!0});if(v)throw v;n(c,p(l||[]))}catch(l){console.error("Error fetching risks:",l),n(f,"Failed to fetch risks.")}},I=async()=>{var _;try{const{data:l,error:v}=await h.from("risks").select("rrn").eq("profile_id",(_=e(y))==null?void 0:_.id).order("rrn",{ascending:!1}).limit(1);if(v)throw v;if(l.length>0){const F=l[0].rrn.match(/(\d+)$/);n(D,p(F?parseInt(F[0],10)+1:1))}else n(D,1)}catch(l){console.error("Error fetching next RRN number:",l),n(f,"Failed to determine the next RRN number.")}},ee=_=>{e(c).length>0&&_===e(c).length-1&&lt(D,-1),n(c,p(e(c).filter((l,v)=>v!==_)))};dt(async()=>{n(N,!0),await j(),n(N,!1)});var Q=Jt(),X=s(Q);ve(X,()=>e(Y),_=>{var l=Yt(),v=s(l),A=s(v,!0);a(v),a(l),z(()=>M(A,e(Y))),it(3,l,()=>ot),S(_,l)});var Z=o(X,2);ve(Z,()=>e(f),_=>{var l=Ot(),v=s(l),A=s(v,!0);a(v),a(l),z(()=>M(A,e(f))),it(3,l,()=>ot),S(_,l)});var E=o(Z,2),L=s(E),B=s(L);_t(B,{class:"w-8 h-8 text-primary"});var U=o(B,2),W=s(U);a(U),a(L),a(E);var H=o(E,2),se=o(s(H),2);ve(se,()=>e(N),_=>{var l=Qt();S(_,l)},_=>{var l=Gt(),v=Ae(l);he(v,21,()=>e(c),Ne,(K,le,fe)=>{Lt(K,{get risk(){return e(le)},get classification(){return e(b)},index:fe,removeRow:ee})}),a(v);var A=o(v,2),F=s(A);F.__click=[Ht,w,D,c,y];var re=s(F);Mt(re,{class:"w-4 h-4 mr-2"}),Re(),a(F);var k=o(F,2);k.__click=[Kt,g,c,y,Y,f];var G=s(k);ve(G,()=>e(g),K=>{var le=Wt();S(K,le)},K=>{Dt(K,{class:"w-4 h-4 mr-2"})}),Re(),a(k),a(A),z(()=>k.disabled=e(g)),S(_,l)}),a(H),a(Q),z(()=>M(W,`${e(w)??""} Risk Register`)),S(C,Q),Pe()}Be(["click"]);var Zt=T('<div class="space-y-1"><div><span class="font-medium">Likelihood:</span> </div> <div><span class="font-medium">Severity:</span> </div> <div><span class="font-medium">Control Rating:</span> </div> <div><span class="font-medium">Monitoring Rating:</span> </div></div>'),$t=(C,r)=>r.onApprove(r.risk.id),er=(C,r)=>r.onDelete(r.risk.id),tr=T('<tr class="hover:bg-muted/50"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"></td><td class="px-4 py-3"><div class="flex items-center gap-2"><button class="px-2 py-1 rounded bg-green-500 text-white hover:bg-green-600 disabled:opacity-50 text-sm"> </button> <button class="p-1 rounded hover:bg-muted text-red-500 hover:text-red-600 disabled:opacity-50"><!></button></div></td></tr>');function rr(C,r){Ee(r,!0);var c=tr(),b=s(c),y=s(b,!0);a(b);var w=o(b),N=s(w,!0);a(w);var g=o(w),Y=s(g,!0);z(()=>{var B;return M(Y,((B=r.classification.find(U=>U.id===r.risk.classification))==null?void 0:B.name)||"N/A")}),a(g);var f=o(g),D=s(f,!0);a(f);var j=o(f),O=s(j,!0);a(j);var q=o(j),J=s(q);z(()=>M(J,`P${r.risk.budget.toFixed(2)??""}`)),a(q);var I=o(q);he(I,21,()=>r.riskAssessments.filter(B=>B.risk_id===r.risk.id),Ne,(B,U)=>{var W=Zt(),H=s(W),se=o(s(H));z(()=>{var k;return M(se,` ${(((k=r.likelihoodRatings.find(G=>G.id===e(U).lr))==null?void 0:k.name)||"N/A")??""}`)}),a(H);var _=o(H,2),l=o(s(_));z(()=>{var k;return M(l,` ${(((k=r.severities.find(G=>G.id===e(U).s))==null?void 0:k.value)||"N/A")??""}`)}),a(_);var v=o(_,2),A=o(s(v));z(()=>{var k;return M(A,` ${(((k=r.riskControlRatings.find(G=>G.id===e(U).rcr))==null?void 0:k.name)||"N/A")??""}`)}),a(v);var F=o(v,2),re=o(s(F));z(()=>{var k;return M(re,` ${(((k=r.riskMonitoringRatings.find(G=>G.id===e(U).rmr))==null?void 0:k.status)||"N/A")??""}`)}),a(F),a(W),S(B,W)}),a(I);var ee=o(I),Q=s(ee),X=s(Q);X.__click=[$t,r];var Z=s(X,!0);a(X);var E=o(X,2);E.__click=[er,r];var L=s(E);vt(L,{size:16}),a(E),a(Q),a(ee),a(c),z(()=>{M(y,r.risk.rrn),M(N,r.risk.risk_statement),M(D,r.risk.actions),M(O,r.risk.key_persons),X.disabled=r.approvingId===r.risk.id||r.userRole==="admin"&&r.risk.is_approved||r.userRole==="vice_president"&&(!r.risk.is_approved||r.risk.is_approved_vp)||r.userRole==="president"&&(!r.risk.is_approved_vp||r.risk.is_approved_president),M(Z,r.approvingId===r.risk.id?"Processing...":r.userRole==="admin"?r.risk.is_approved?"Admin Approved":"Approve":r.userRole==="vice_president"?r.risk.is_approved_vp?"VP Approved":"Approve":r.userRole==="president"&&r.risk.is_approved_president?"President Approved":"Approve"),E.disabled=r.deletingId===r.risk.id}),S(C,c),Pe()}Be(["click"]);var ar=(C,r)=>n(r,!e(r)),sr=T("<option> </option>"),ir=T("<option> </option>"),or=T('<div class="flex justify-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),nr=(C,r)=>r("rrn"),lr=(C,r)=>n(r,e(r)-1),dr=(C,r)=>n(r,e(r)+1),cr=T('<div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">RRN <!></button></th><th class="px-4 py-3 text-left">Risk Statement</th><th class="px-4 py-3 text-left">Classification</th><th class="px-4 py-3 text-left">Actions</th><th class="px-4 py-3 text-left">Key Persons</th><th class="px-4 py-3 text-left">Budget</th><th class="px-4 py-3 text-left">Risk Assessments</th><th class="px-4 py-3 text-left w-[150px]">Actions</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary rounded-lg px-2 py-1 w-full sm:w-auto"><option>5 per page</option><option>10 per page</option><option>25 per page</option><option>50 per page</option></select> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Next</button></div></div></div>',1),vr=T('<div class="flex flex-col gap-4 container mx-auto p-6"><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div class="flex items-center gap-2"><!> <h1 class="text-2xl font-bold">Risk Management</h1></div></div> <button class="md:hidden w-full px-4 py-2 bg-secondary rounded-lg text-left flex justify-between items-center">Filters <!></button> <div><div class="flex flex-col md:flex-row gap-4 w-full md:w-auto flex-1"><div class="relative flex-2 md:w-[300px]"><!> <input type="text" placeholder="Search risks..." class="pl-10 pr-4 py-2 bg-secondary border-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <select class="bg-secondary rounded-lg px-3 py-2 w-full md:w-[200px]"><option>All Departments</option><!></select> <select class="bg-secondary rounded-lg px-3 py-2 w-full md:w-[200px]"><option>All Classifications</option><!></select></div> <div class="flex flex-col md:flex-row gap-4 w-full md:w-auto"><div class="flex items-center gap-2"><input type="number" placeholder="Min Budget" class=" px-3 py-2 bg-secondary border-secondary rounded-lg  focus:outline-none focus:ring-2 focus:ring-ring w-[150px]"> <span class="text-muted-foreground">to</span> <input type="number" placeholder="Max Budget" class=" px-3 py-2 bg-secondary border-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-ring w-[150px]"></div> <button class="flex items-center gap-2 bg-secondary px-4 py-2 rounded-lg hover:bg-secondary/80"><!> Export</button></div></div> <!></div>');function _r(C,r){Ee(r,!0);let c=[];const b=async()=>{const{data:{session:t}}=await h.auth.getSession();if(!t||!t.user)return;const{data:i,error:d}=await h.from("profiles").select("role, first_name, last_name").eq("id",t.user.id).single();if(d){console.error("Error fetching user role:",d);return}n(K,p(i.role)),e(K)==="admin"&&n(le,`${i.first_name} ${i.last_name}`)},y=async()=>{try{const{data:t,error:i}=await h.from("profiles").select("first_name, last_name").eq("role","admin");i||!t?(console.error("Error fetching admin names:",i||"No data found"),n(le,"N/A")):n(le,p(t.map(d=>`${d.first_name} ${d.last_name}`).join(", ")))}catch(t){console.error("Error fetching admin details:",t),n(le,"N/A")}},w=async()=>{try{const{data:t,error:i}=await h.from("profiles").select("first_name, last_name, role").in("role",["vice_president","president"]);if(i||!t){console.error("Error fetching VP and President names:",i||"No data found"),n(fe,"N/A"),n(Se,"N/A");return}const d=t.find(m=>m.role==="vice_president"),x=t.find(m=>m.role==="president");n(fe,p(d?`${d.first_name} ${d.last_name}`:"N/A")),n(Se,p(x?`${x.first_name} ${x.last_name}`:"N/A"))}catch(t){console.error("Error fetching VP and President details:",t),n(fe,"N/A"),n(Se,"N/A")}},N=async()=>{const{data:t,error:i}=await h.from("departments").select("id, name");if(i){console.error("Error fetching departments:",i);return}n(_,p(t||[]))},g=async()=>{const{data:t,error:i}=await h.from("risks").select("*, profiles (first_name, last_name, departments (name))");if(i){console.error("Error fetching risks:",i);return}n(se,p(t.map(d=>{var x,m,ie,P;return{...d,user_name:`${((x=d.profiles)==null?void 0:x.first_name)||""} ${((m=d.profiles)==null?void 0:m.last_name)||""}`,department_name:((P=(ie=d.profiles)==null?void 0:ie.departments)==null?void 0:P.name)||"N/A"}}))),ee()},Y=async()=>{const{data:t,error:i}=await h.from("risk_assessment").select("*");if(i){console.error("Error fetching risk assessments:",i);return}n(l,p(t||[]))},f=async()=>{const{data:t,error:i}=await h.from("classification").select("*");i||n(v,p(t||[]))},D=async()=>{const{data:t,error:i}=await h.from("likelihood_rating").select("*");i||n(A,p(t||[]))},j=async()=>{const{data:t,error:i}=await h.from("severity").select("*");i||n(F,p(t||[]))},O=async()=>{const{data:t,error:i}=await h.from("risk_control_rating").select("*");i||n(re,p(t||[]))},q=async()=>{const{data:t,error:i}=await h.from("risk_monitoring_rating").select("*");i||n(k,p(t||[]))},J=async t=>{let i={};e(K)==="admin"?i={is_approved:!0}:e(K)==="vice_president"?i={is_approved_vp:!0}:e(K)==="president"&&(i={is_approved_president:!0});try{const{data:d,error:x}=await h.from("risks").update(i).eq("id",t).select();if(x){console.error("Error approving risk:",x);return}if(e(K)==="president"&&d&&d.length>0){const m=d[0],{data:ie,error:P}=await h.from("risk_assessment").select("*").eq("risk_id",m.id);if(P){console.error("Error fetching risk assessments:",P);return}const oe=ie.map($=>({risk_id:m.id,likelihood_rating_id:$.lr,severity_id:$.s,control_rating_id:$.rcr,monitoring_rating_id:$.rmr,department_id:m.department_id})),{error:V}=await h.from("risk_monitoring").insert(oe);V&&console.error("Error inserting into risk_monitoring:",V),console.log("Risk Monitoring Entries:",oe)}await g()}catch(d){console.error("Unexpected error while approving risk:",d)}finally{}},I=async t=>{const{error:i}=await h.from("risks").delete().eq("id",t);i?console.error("Error deleting risk:",i):await g()},ee=()=>{c=e(se)},Q=()=>{var _e;const t=new zt("landscape"),i="Risk Report",d=["Risk Statement","Classification","Budget","Likelihood","Severity","Control Rating","Monitoring Rating","Approval Status","Department"],x=e(me).flatMap(R=>{var ge;const ne=e(l).filter(ae=>ae.risk_id===R.id);return ne.length===0?[[R.risk_statement,((ge=e(v).find(ae=>ae.id===R.classification))==null?void 0:ge.name)||"N/A",R.budget||"N/A","N/A","N/A","N/A","N/A",R.is_approved?"Admin Approved":R.is_approved_vp?"VP Approved":R.is_approved_president?"President Approved":"Pending",R.department_name||"N/A"]]:ne.map(ae=>{var ye,xe,we,ce,Te;return[R.risk_statement,((ye=e(v).find(de=>de.id===R.classification))==null?void 0:ye.name)||"N/A",R.budget||"N/A",((xe=e(A).find(de=>de.id===ae.lr))==null?void 0:xe.name)||"N/A",((we=e(F).find(de=>de.id===ae.s))==null?void 0:we.value)||"N/A",((ce=e(re).find(de=>de.id===ae.rcr))==null?void 0:ce.name)||"N/A",((Te=e(k).find(de=>de.id===ae.rmr))==null?void 0:Te.status)||"N/A",R.is_approved?"Admin Approved":R.is_approved_vp?"VP Approved":R.is_approved_president?"President Approved":"Pending",R.department_name||"N/A"]})});t.setFontSize(14),t.text(i,14,15),t.setFontSize(10);let m=[];if(e(Z)&&m.push(`Search: "${e(Z)}"`),e(H)!=="all"&&m.push(`Department: ${e(H)}`),e(ue)!=="all"){const R=(_e=e(v).find(ne=>ne.id===e(ue)))==null?void 0:_e.name;m.push(`Classification: ${R}`)}te.min&&m.push(`Min Budget: ${te.min}`),te.max&&m.push(`Max Budget: ${te.max}`),m.length>0&&t.text(`Filters applied: ${m.join(" | ")}`,14,22),t.setFontSize(14),t.text(i,14,15),It(t,{head:[d],body:x,startY:25,theme:"grid",styles:{fontSize:10},headStyles:{fillColor:[41,128,185]}});const P=t.internal.pageSize.height-40,oe=t.internal.pageSize.width/4,V=[14,oe,oe*2,oe*3];t.setFontSize(10);const $=c[0],De=($==null?void 0:$.user_name)||"Unknown",ze=($==null?void 0:$.department_name)||"Unknown";t.text(`${De||"Unknown"} (sgnd)`,V[0],P-5),t.text("_________________________",V[0],P),t.text(`${ze||"Unknown"} Department Head`,V[0],P+5),t.text(`${e(le)||"N/A"} (sgnd)`,V[1],P-5),t.text("_________________________",V[1],P),t.text("Corporate Planning Officer",V[1],P+5),t.text(`${e(fe)||"N/A"} (sgnd)`,V[2],P-5),t.text("_________________________",V[2],P),t.text("Vice President",V[2],P+5),t.text(`${e(Se)||"N/A"} (sgnd)`,V[3],P-5),t.text("_________________________",V[3],P),t.text("President",V[3],P+5);const be=new Date().toLocaleString(),Je=x.length,Ie=e(me).reduce((R,ne)=>R+(ne.budget||0),0);t.setFontSize(8),t.text(`Exported on: ${be} | Total Records: ${Je} | Total Budget: P${Ie}`,14,t.internal.pageSize.height-10),t.save("Risk_Report.pdf"),t.save("Risk_Report.pdf")},X=async()=>{await b(),await y(),await N(),await g(),await Y(),await f(),await D(),await j(),await O(),await q(),await w(),n(G,!1)};let Z=u(""),E=u(1),L=u(5),B=u(!1),U=u("rrn"),W=u("asc"),H=u("all"),se=u(p([])),_=u(p([])),l=u(p([])),v=u(p([])),A=u(p([])),F=u(p([])),re=u(p([])),k=u(p([])),G=u(!0),K=u(null),le=u(null),fe=u(null),Se=u(null),pt=null,ft=null,ue=u("all"),te=p({min:null,max:null});const ut=t=>{e(U)===t?n(W,p(e(W)==="asc"?"desc":"asc")):(n(U,p(t)),n(W,"asc"))},me=ke(()=>e(se).filter(t=>{const d=`${t.rrn} ${t.risk_statement} ${t.department_name}`.toLowerCase().includes(e(Z).toLowerCase()),x=e(H)==="all"||t.department_name===e(H),m=e(ue)==="all"||t.classification===e(ue),ie=(!te.min||t.budget>=te.min)&&(!te.max||t.budget<=te.max);return d&&x&&m&&ie}).sort((t,i)=>{const d=String(t[e(U)]),x=String(i[e(U)]);return e(W)==="asc"?d.localeCompare(x):x.localeCompare(d)})),mt=ke(()=>e(me).slice((e(E)-1)*e(L),e(E)*e(L))),gt=ke(()=>Math.ceil(e(me).length/e(L)));X();var Ue=vr(),Ve=s(Ue),et=s(Ve),xt=s(et);_t(xt,{class:"w-8 h-8 text-primary"}),Re(2),a(et),a(Ve);var Ce=o(Ve,2);Ce.__click=[ar,B];var ht=o(s(Ce)),bt=ke(()=>e(B)?"rotate-180":"");nt(ht,{size:16,get class(){return e(bt)}}),a(Ce);var Fe=o(Ce,2),Le=s(Fe),He=s(Le),tt=s(He);Tt(tt,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var rt=o(tt,2);je(rt),a(He);var Me=o(He,2),Ke=s(Me);Ke.value=(Ke.__value="all")==null?"":"all";var yt=o(Ke);he(yt,17,()=>e(_),Ne,(t,i)=>{var d=sr(),x={},m=s(d,!0);a(d),z(()=>{x!==(x=e(i).name)&&(d.value=(d.__value=e(i).name)==null?"":e(i).name),M(m,e(i).name)}),S(t,d)}),a(Me);var Ye=o(Me,2),Oe=s(Ye);Oe.value=(Oe.__value="all")==null?"":"all";var wt=o(Oe);he(wt,17,()=>e(v),Ne,(t,i)=>{var d=ir(),x={},m=s(d,!0);a(d),z(()=>{x!==(x=e(i).id)&&(d.value=(d.__value=e(i).id)==null?"":e(i).id),M(m,e(i).name)}),S(t,d)}),a(Ye),a(Le);var at=o(Le,2),Qe=s(at),We=s(Qe);je(We);var st=o(We,4);je(st),a(Qe);var Ge=o(Qe,2);Ge.__click=Q;var kt=s(Ge);jt(kt,{size:20}),Re(),a(Ge),a(at),a(Fe);var Rt=o(Fe,2);ve(Rt,()=>e(G),t=>{var i=or();S(t,i)},t=>{var i=cr(),d=Ae(i),x=s(d),m=s(x),ie=s(m),P=s(ie),oe=s(P);oe.__click=[nr,ut];var V=o(s(oe)),$=ke(()=>e(U)==="rrn"?"text-primary":"");nt(V,{size:16,get class(){return e($)}}),a(oe),a(P),Re(7),a(ie),a(m);var De=o(m);he(De,21,()=>e(mt),ce=>ce.id,(ce,Te)=>{rr(ce,{get risk(){return e(Te)},get userRole(){return e(K)},get classification(){return e(v)},get likelihoodRatings(){return e(A)},get severities(){return e(F)},get riskControlRatings(){return e(re)},get riskMonitoringRatings(){return e(k)},get riskAssessments(){return e(l)},onDelete:I,onApprove:J,get approvingId(){return pt},get deletingId(){return ft}})}),a(De),a(x),a(d);var ze=o(d,2),be=s(ze),Je=s(be);z(()=>M(Je,`Showing ${(e(E)-1)*e(L)+1} to ${Math.min(e(E)*e(L),e(me).length)??""} of ${e(me).length??""} results`)),a(be);var Ie=o(be,2),_e=s(Ie),R=s(_e);R.value=(R.__value=5)==null?"":5;var ne=o(R);ne.value=(ne.__value=10)==null?"":10;var ge=o(ne);ge.value=(ge.__value=25)==null?"":25;var ae=o(ge);ae.value=(ae.__value=50)==null?"":50,a(_e);var ye=o(_e,2),xe=s(ye);xe.__click=[lr,E];var we=o(xe,2);we.__click=[dr,E],a(ye),a(Ie),a(ze),z(()=>{xe.disabled=e(E)===1,we.disabled=e(E)===e(gt)}),qe(_e,()=>e(L),ce=>n(L,ce)),S(t,i)}),a(Ue),z(()=>ct(Fe,`flex flex-col gap-4 ${e(B)?"block":"hidden"} md:flex md:flex-row md:flex-wrap md:justify-between`)),pe(rt,()=>e(Z),t=>n(Z,t)),qe(Me,()=>e(H),t=>n(H,t)),qe(Ye,()=>e(ue),t=>n(ue,t)),pe(We,()=>te.min,t=>te.min=t),pe(st,()=>te.max,t=>te.max=t),S(C,Ue),Pe()}Be(["click"]);var pr=T('<div class="flex items-center justify-center min-h-screen "><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),fr=T('<p class="text-red-500"> </p>'),ur=T("<div><!></div>");function jr(C,r){Ee(r,!1);let c=null,b=Xe(null),y=Xe(!0),w=Xe(null);const N=async()=>{try{const{data:f,error:D}=await h.auth.getSession();if(D)throw D;if(c=f.session,c){const{data:j,error:O}=await h.from("profiles").select("*").eq("id",c.user.id).single();if(O)throw O;n(b,j),console.log("Profile Id: ",e(b).id),console.log("Profile Role: ",e(b).role)}else n(w,"User is not logged in.")}catch(f){console.error(f.message),n(w,"Failed to fetch profile data.")}finally{n(y,!1)}};dt(()=>{N()}),At();var g=ur(),Y=s(g);ve(Y,()=>e(y),f=>{var D=pr();S(f,D)},f=>{var D=$e(),j=Ae(D);ve(j,()=>e(w),O=>{var q=fr(),J=s(q,!0);a(q),z(()=>M(J,e(w))),S(O,q)},O=>{var q=$e(),J=Ae(q);ve(J,()=>{var I,ee,Q;return((I=e(b))==null?void 0:I.role)==="admin"||((ee=e(b))==null?void 0:ee.role)==="vice_president"||((Q=e(b))==null?void 0:Q.role)==="president"},I=>{_r(I,{})},I=>{Xt(I,{})}),S(O,q)},!0),S(f,D)}),a(g),S(C,g),Pe()}export{jr as component};

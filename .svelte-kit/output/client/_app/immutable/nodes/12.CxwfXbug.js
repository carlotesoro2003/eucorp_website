import"../chunks/disclose-version.Bg9kRutz.js";import{f as Ve,p as $e,aF as c,c as a,r as t,s as o,t as N,b as i,g as e,a as Be,G as He,n as Te,O as J}from"../chunks/runtime.CLSstnwU.js";import{s as y}from"../chunks/render.D17u6ZCY.js";import{i as ke}from"../chunks/if.b2Q-jNLG.js";import{e as Ge,i as Oe}from"../chunks/each.sV1uapQk.js";import{c as nt,a as E,d as Qe,e as dt,t as A}from"../chunks/utils.kA-YjkFf.js";import{r as ct}from"../chunks/attributes.DiUoHvyc.js";import{s as ut}from"../chunks/class.9GukHOdr.js";import{b as oe}from"../chunks/input.CQDk-SFX.js";import{b as Ee}from"../chunks/select.BAP3DC-4.js";import{p as g}from"../chunks/proxy.D-58ufVl.js";import{o as vt}from"../chunks/index-client.DT-fMr9Z.js";import{s as j}from"../chunks/supabaseClient.CaMOPPuz.js";import{g as pt}from"../chunks/entry.SSTTWxxn.js";import{r as Se}from"../chunks/misc.C2nsS1Cr.js";import{X as _t}from"../chunks/x.DXpGL3Re.js";import{P as mt}from"../chunks/plus.WugTGZSv.js";import{S as ft}from"../chunks/search.4XRWJUve.js";import{A as Ke}from"../chunks/arrow-up-down.Ch6Rz2vF.js";import{E as gt}from"../chunks/eye.DvOF9_YA.js";import{I as bt,s as xt}from"../chunks/Icon.BPJo08Fo.js";import{l as ht,s as yt}from"../chunks/props.BD0jg91j.js";import{T as wt}from"../chunks/trash-2.DXHXJoNa.js";function kt(p,s){const _=ht(s,["children","$$slots","$$events","$$legacy"]);bt(p,yt({name:"square-pen"},()=>_,{iconNode:[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z"}]],children:(m,S)=>{var x=nt(),w=Ve(x);xt(w,s,"default",{}),E(m,x)},$$slots:{default:!0}}))}var St=A("<option> </option>"),Gt=A('<div class="fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center p-4 z-50"><div class="bg-card p-6 rounded-lg shadow-lg w-full max-w-md relative border border-border"><button class="absolute right-4 top-4 p-1 hover:bg-muted rounded-lg" title="Close"><!></button> <h2 class="text-xl font-semibold mb-4"> </h2> <form class="space-y-4"><div class="space-y-2"><label for="name" class="text-sm font-medium">Name</label> <textarea id="name" placeholder="Enter goal name" class="w-full px-3 py-2 bg-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-ring" required></textarea></div> <div class="space-y-2"><label for="description" class="text-sm font-medium">Description</label> <textarea id="description" placeholder="Enter description" class="w-full px-3 py-2 bg-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-ring" required></textarea></div> <div class="space-y-2"><label for="kpi" class="text-sm font-medium">KPI</label> <textarea id="kpi" placeholder="Enter KPI" class="w-full px-3 py-2 bg-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-ring" required></textarea></div> <div class="space-y-2"><label for="lead_id" class="text-sm font-medium">Lead</label> <select id="lead_id" class="w-full px-3 py-2 bg-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-ring"><option>Select a lead</option><!></select></div> <div class="flex gap-2 pt-4"><button type="submit" class="flex-1 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90"> </button> <button type="button" class="flex-1 px-4 py-2 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/80">Cancel</button></div></form></div></div>');function Et(p,s){var Z,V,U,$;$e(s,!0);let _=c(g(((Z=s.goal)==null?void 0:Z.name)||"")),u=c(g(((V=s.goal)==null?void 0:V.description)||"")),m=c(g(((U=s.goal)==null?void 0:U.kpi)||"")),S=c(g((($=s.goal)==null?void 0:$.lead_id)||null));const x=d=>{d.preventDefault(),s.onSave({name:e(_),description:e(u),kpi:e(m),lead_id:e(S)})};var w=Gt(),L=a(w),h=a(L);h.__click=function(...d){var b;(b=s.onClose)==null||b.apply(this,d)};var F=a(h);_t(F,{size:20}),t(h);var I=o(h,2),R=a(I);t(I);var q=o(I,2),z=a(q),M=o(a(z),2);Se(M),t(z);var H=o(z,2),W=o(a(H),2);Se(W),t(H);var C=o(H,2),Y=o(a(C),2);Se(Y),t(C);var f=o(C,2),O=o(a(f),2),Q=a(O);Q.value=(Q.__value=null)==null?"":null;var se=o(Q);Ge(se,17,()=>s.leads,Oe,(d,b)=>{var G=St(),B={},ee=a(G,!0);t(G),N(()=>{B!==(B=e(b).id)&&(G.value=(G.__value=e(b).id)==null?"":e(b).id),y(ee,e(b).name)}),E(d,G)}),t(O),t(f);var D=o(f,2),T=a(D),K=a(T);t(T);var le=o(T,2);le.__click=function(...d){var b;(b=s.onClose)==null||b.apply(this,d)},t(D),t(q),t(L),t(w),N(()=>{y(R,`${(s.goal?"Edit":"Create")??""} Strategic Goal`),y(K,`${(s.goal?"Update":"Create")??""} Goal`)}),dt("submit",q,x),oe(M,()=>e(_),d=>i(_,d)),oe(W,()=>e(u),d=>i(u,d)),oe(Y,()=>e(m),d=>i(m,d)),Ee(O,()=>e(S),d=>i(S,d)),E(p,w),Be()}Qe(["click"]);var zt=A("<div><span> </span></div>"),Ct=(p,s)=>i(s,!0),Pt=A("<option> </option>"),Nt=A('<div class="flex justify-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),At=(p,s)=>s("goal_no"),Lt=(p,s)=>s("name"),Ft=(p,s)=>pt(`/plans/${e(s).id}`),It=(p,s,_,u)=>{i(s,g(e(_))),i(u,!0)},Mt=(p,s,_)=>s(e(_).id),jt=A('<tr><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3 hidden md:table-cell"> </td><td class="px-4 py-3 hidden lg:table-cell"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><div class="flex justify-center gap-2"><button class="btn btn-ghost btn-sm" title="View objectives"><!></button> <button class="btn btn-ghost btn-sm" title="Edit goal"><!></button> <button class="btn btn-ghost btn-sm text-error" title="Delete goal"><!></button></div></td></tr>'),qt=(p,s)=>He(s,-1),Dt=(p,s)=>He(s),Tt=A('<div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">Goal No <!></button></th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">Name <!></button></th><th class="px-4 py-3 text-left hidden md:table-cell">Description</th><th class="px-4 py-3 text-left hidden lg:table-cell">KPI</th><th class="px-4 py-3 text-left">Lead</th><th class="px-4 py-3 text-center">Actions</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-ring"><option>5 per page</option><option>10 per page</option><option>25 per page</option></select> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Next</button></div></div></div>',1),Kt=A('<div class="container mx-auto p-4"><!> <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6"><h1 class="text-3xl font-bold">Strategic Goals</h1> <button class="btn btn-primary flex items-center gap-2"><!> Add Goal</button></div> <div class="flex flex-col md:flex-row gap-4 mb-6"><div class="relative flex-2"><!> <input type="text" placeholder="Search goals..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring w-full md:w-[200px]"><option>All Leads</option><!></select></div> <!> <!></div>');function ca(p,s){$e(s,!0);let _=c(""),u=c(1),m=c(5),S=c(!1),x=c("goal_no"),w=c("asc"),L=c("all"),h=c(!0),F=c(null),I=c(!1),R=c(""),q=c("success"),z=c(g([])),M=c(g([]));vt(()=>{H()});const H=async()=>{await W(),await C(),i(h,!1)},W=async()=>{const{data:r,error:l}=await j.from("leads").select("id, name");l?f("Error fetching leads","error"):i(M,g(r))},C=async()=>{const{data:r,error:l}=await j.from("strategic_goals").select("*").order("goal_no",{ascending:!0});l?f("Error fetching strategic goals","error"):i(z,g(r))},Y=()=>e(z).length>0?Math.max(...e(z).map(r=>r.goal_no))+1:1,f=(r,l)=>{i(R,g(r)),i(q,g(l)),i(I,!0),setTimeout(()=>{i(I,!1)},3e3)},O=r=>{const l=e(M).find(n=>n.id===r);return l?l.name:"No Lead Assigned"},Q=async r=>{if(e(F)){const{error:l}=await j.from("strategic_goals").update(r).match({id:e(F).id});l?f("Error updating goal","error"):(f("Goal updated successfully","success"),await C(),D())}else{const l={...r,goal_no:Y()},{error:n}=await j.from("strategic_goals").insert([l]);n?f("Error creating goal","error"):(f("Goal created successfully","success"),await C(),D())}},se=async r=>{if(confirm("Are you sure you want to delete this goal?")){i(h,!0);const{error:l}=await j.from("strategic_goals").delete().match({id:r});if(l){f("Error deleting goal","error"),i(h,!1);return}const{data:n,error:v}=await j.from("strategic_goals").select("*").order("goal_no",{ascending:!0});if(v){f("Error reordering goals","error"),i(h,!1);return}for(let k=0;k<n.length;(k+=1)-1)await j.from("strategic_goals").update({goal_no:k+1}).match({id:n[k].id});f("Goal deleted and reordered successfully","success"),await C(),i(h,!1)}},D=()=>{i(S,!1),i(F,null)},T=r=>{e(x)===r?i(w,g(e(w)==="asc"?"desc":"asc")):(i(x,g(r)),i(w,"asc"))},K=J(()=>e(z).filter(r=>{const n=`${r.name} ${r.description} ${r.kpi}`.toLowerCase().includes(e(_).toLowerCase()),v=e(L)==="all"||r.lead_id===e(L);return n&&v}).sort((r,l)=>{const n=String(r[e(x)]),v=String(l[e(x)]);return e(w)==="asc"?n.localeCompare(v):v.localeCompare(n)})),le=J(()=>e(K).slice((e(u)-1)*e(m),e(u)*e(m))),Z=J(()=>Math.ceil(e(K).length/e(m)));var V=Kt(),U=a(V);ke(U,()=>e(I),r=>{var l=zt(),n=a(l),v=a(n,!0);t(n),t(l),N(()=>{ut(l,`alert alert-${e(q)??""} shadow-lg mb-4`),y(v,e(R))}),E(r,l)});var $=o(U,2),d=o(a($),2);d.__click=[Ct,S];var b=a(d);mt(b,{size:20}),Te(),t(d),t($);var G=o($,2),B=a(G),ee=a(B);ft(ee,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var ze=o(ee,2);ct(ze),t(B);var ie=o(B,2),ne=a(ie);ne.value=(ne.__value="all")==null?"":"all";var Ue=o(ne);Ge(Ue,17,()=>e(M),Oe,(r,l)=>{var n=Pt(),v={},k=a(n,!0);t(n),N(()=>{v!==(v=e(l).id)&&(n.value=(n.__value=e(l).id)==null?"":e(l).id),y(k,e(l).name)}),E(r,n)}),t(ie),t(G);var Ce=o(G,2);ke(Ce,()=>e(h),r=>{var l=Nt();E(r,l)},r=>{var l=Tt(),n=Ve(l),v=a(n),k=a(v),Pe=a(k),de=a(Pe),ce=a(de);ce.__click=[At,T];var Je=o(a(ce)),Re=J(()=>e(x)==="goal_no"?"text-primary":"");Ke(Je,{size:16,get class(){return e(Re)}}),t(ce),t(de);var Ne=o(de),ue=a(Ne);ue.__click=[Lt,T];var We=o(a(ue)),Ye=J(()=>e(x)==="name"?"text-primary":"");Ke(We,{size:16,get class(){return e(Ye)}}),t(ue),t(Ne),Te(4),t(Pe),t(k);var Ae=o(k);Ge(Ae,21,()=>e(le),X=>X.id,(X,P)=>{var fe=jt(),ge=a(fe),et=a(ge,!0);t(ge);var be=o(ge),tt=a(be,!0);t(be);var xe=o(be),at=a(xe,!0);t(xe);var he=o(xe),rt=a(he,!0);t(he);var ye=o(he),ot=a(ye,!0);N(()=>y(ot,O(e(P).lead_id))),t(ye);var qe=o(ye),De=a(qe),ae=a(De);ae.__click=[Ft,P];var st=a(ae);gt(st,{size:18}),t(ae);var re=o(ae,2);re.__click=[It,F,P,S];var lt=a(re);kt(lt,{size:18}),t(re);var we=o(re,2);we.__click=[Mt,se,P];var it=a(we);wt(it,{size:18}),t(we),t(De),t(qe),t(fe),N(()=>{y(et,e(P).goal_no),y(tt,e(P).name),y(at,e(P).description),y(rt,e(P).kpi)}),E(X,fe)}),t(Ae),t(v),t(n);var Le=o(n,2),ve=a(Le),Ze=a(ve);N(()=>y(Ze,`Showing ${(e(u)-1)*e(m)+1} to ${Math.min(e(u)*e(m),e(K).length)??""} of ${e(K).length??""} results`)),t(ve);var Fe=o(ve,2),te=a(Fe),pe=a(te);pe.value=(pe.__value=5)==null?"":5;var _e=o(pe);_e.value=(_e.__value=10)==null?"":10;var Ie=o(_e);Ie.value=(Ie.__value=25)==null?"":25,t(te);var Me=o(te,2),me=a(Me);me.__click=[qt,u];var je=o(me,2);je.__click=[Dt,u],t(Me),t(Fe),t(Le),N(()=>{me.disabled=e(u)===1,je.disabled=e(u)===e(Z)}),Ee(te,()=>e(m),X=>i(m,X)),E(r,l)});var Xe=o(Ce,2);ke(Xe,()=>e(S),r=>{Et(r,{get goal(){return e(F)},get leads(){return e(M)},onSave:Q,onClose:D})}),t(V),oe(ze,()=>e(_),r=>i(_,r)),Ee(ie,()=>e(L),r=>i(L,r)),E(p,V),Be()}Qe(["click"]);export{ca as component};

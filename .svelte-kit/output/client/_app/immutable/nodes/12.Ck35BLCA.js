import"../chunks/disclose-version.Bg9kRutz.js";import{f as Ke,p as Ve,d as c,c as a,r as t,s as o,t as N,b as i,g as e,a as $e,an as Be,n as De,e as R}from"../chunks/utils.CRNn4dtP.js";import{s as y}from"../chunks/render.xPn1qZIb.js";import{i as ke}from"../chunks/if.CRsBAEFG.js";import{e as Ge,i as He}from"../chunks/each.v0RK4Yef.js";import{c as nt,a as G,d as Qe,f as dt,t as A}from"../chunks/store.B1kL-7Ni.js";import{c as Se,r as ct}from"../chunks/attributes.BcfEV1VJ.js";import{s as ut}from"../chunks/class.CstC7PuZ.js";import{b as oe}from"../chunks/input.o7SqHMM4.js";import{b as Ee}from"../chunks/select.CgyWjfO5.js";import{l as vt,s as pt,a as b}from"../chunks/preload-helper.Dwm_PvIR.js";import{o as _t}from"../chunks/index-client.BdGz_wQc.js";import{s as M}from"../chunks/supabaseClient.BTuNJN2N.js";import{g as ft}from"../chunks/entry.DOGBvY7d.js";import{X as gt}from"../chunks/x.DaAqSZOK.js";import{S as mt}from"../chunks/search.B4Eo5Hu8.js";import{P as bt}from"../chunks/plus.BBSv_QI7.js";import{A as Te}from"../chunks/arrow-up-down.Ck2frNgV.js";import{E as xt}from"../chunks/eye.C9SOZpvn.js";import{I as ht,s as yt}from"../chunks/Icon.CEA2x5sb.js";import{T as wt}from"../chunks/trash-2.B2J2poVW.js";function kt(_,s){const f=vt(s,["children","$$slots","$$events","$$legacy"]);ht(_,pt({name:"square-pen"},()=>f,{iconNode:[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z"}]],children:(g,S)=>{var x=nt(),w=Ke(x);yt(w,s,"default",{}),G(g,x)},$$slots:{default:!0}}))}var St=A("<option> </option>"),Gt=A('<div class="fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center p-4 z-50"><div class="bg-card p-6 rounded-lg shadow-lg w-full max-w-md relative border border-border"><button class="absolute right-4 top-4 p-1 hover:bg-muted rounded-lg" title="Close"><!></button> <h2 class="text-xl font-semibold mb-4"> </h2> <form class="space-y-4"><div class="space-y-2"><label for="name" class="text-sm font-medium">Name</label> <textarea id="name" placeholder="Enter goal name" class="w-full px-3 py-2 bg-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-ring" required></textarea></div> <div class="space-y-2"><label for="description" class="text-sm font-medium">Description</label> <textarea id="description" placeholder="Enter description" class="w-full px-3 py-2 bg-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-ring" required></textarea></div> <div class="space-y-2"><label for="kpi" class="text-sm font-medium">KPI</label> <textarea id="kpi" placeholder="Enter KPI" class="w-full px-3 py-2 bg-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-ring" required></textarea></div> <div class="space-y-2"><label for="lead_id" class="text-sm font-medium">Lead</label> <select id="lead_id" class="w-full px-3 py-2 bg-secondary rounded-lg focus:outline-none focus:ring-2 focus:ring-ring"><option>Select a lead</option><!></select></div> <div class="flex gap-2 pt-4"><button type="submit" class="flex-1 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90"> </button> <button type="button" class="flex-1 px-4 py-2 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/80">Cancel</button></div></form></div></div>');function Et(_,s){var ee,V,U,$;Ve(s,!0);let f=c(b(((ee=s.goal)==null?void 0:ee.name)||"")),u=c(b(((V=s.goal)==null?void 0:V.description)||"")),g=c(b(((U=s.goal)==null?void 0:U.kpi)||"")),S=c(b((($=s.goal)==null?void 0:$.lead_id)||null));const x=d=>{d.preventDefault(),s.onSave({name:e(f),description:e(u),kpi:e(g),lead_id:e(S)})};var w=Gt(),L=a(w),h=a(L);h.__click=function(...d){var v;(v=s.onClose)==null||v.apply(this,d)};var I=a(h);gt(I,{size:20}),t(h);var j=o(h,2),W=a(j);t(j);var q=o(j,2),E=a(q),F=o(a(E),2);Se(F),t(E);var B=o(E,2),Y=o(a(B),2);Se(Y),t(B);var z=o(B,2),Z=o(a(z),2);Se(Z),t(z);var m=o(z,2),H=o(a(m),2),Q=a(H);Q.value=(Q.__value=null)==null?"":null;var se=o(Q);Ge(se,17,()=>s.leads,He,(d,v)=>{var C=St(),X={},J=a(C,!0);t(C),N(()=>{X!==(X=e(v).id)&&(C.value=(C.__value=e(v).id)==null?"":e(v).id),y(J,e(v).name)}),G(d,C)}),t(H),t(m);var D=o(m,2),T=a(D),K=a(T);t(T);var le=o(T,2);le.__click=function(...d){var v;(v=s.onClose)==null||v.apply(this,d)},t(D),t(q),t(L),t(w),N(()=>{y(W,`${(s.goal?"Edit":"Create")??""} Strategic Goal`),y(K,`${(s.goal?"Update":"Create")??""} Goal`)}),dt("submit",q,x),oe(F,()=>e(f),d=>i(f,d)),oe(Y,()=>e(u),d=>i(u,d)),oe(Z,()=>e(g),d=>i(g,d)),Ee(H,()=>e(S),d=>i(S,d)),G(_,w),$e()}Qe(["click"]);var zt=A("<div><span> </span></div>"),Ct=A("<option> </option>"),Pt=(_,s)=>i(s,!0),Nt=A('<div class="flex justify-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),At=(_,s)=>s("goal_no"),Lt=(_,s)=>s("name"),It=(_,s)=>ft(`/plans/${e(s).id}`),jt=(_,s,f,u)=>{i(s,b(e(f))),i(u,!0)},Ft=(_,s,f)=>s(e(f).id),Mt=A('<tr><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3 hidden md:table-cell"> </td><td class="px-4 py-3 hidden lg:table-cell"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><div class="flex justify-center gap-2"><button class="btn btn-ghost btn-sm" title="View objectives"><!></button> <button class="btn btn-ghost btn-sm" title="Edit goal"><!></button> <button class="btn btn-ghost btn-sm text-error" title="Delete goal"><!></button></div></td></tr>'),qt=(_,s)=>Be(s,-1),Dt=(_,s)=>Be(s),Tt=A('<div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">Goal No <!></button></th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">Name <!></button></th><th class="px-4 py-3 text-left hidden md:table-cell">Description</th><th class="px-4 py-3 text-left hidden lg:table-cell">KPI</th><th class="px-4 py-3 text-left">Lead</th><th class="px-4 py-3 text-center">Actions</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-ring"><option>5 per page</option><option>10 per page</option><option>25 per page</option></select> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Next</button></div></div></div>',1),Kt=A('<div class="flex flex-col gap-4 p-4 container mx-auto"><!> <div class="mb-6"><h1 class="text-3xl font-bold">Strategic Goals</h1></div> <div class="flex flex-col md:flex-row gap-4 mb-6 items-center justify-between"><div class="flex flex-col md:flex-row gap-4 flex-1"><div class="relative flex-1 w-full md:max-w-[300px]"><!> <input type="text" placeholder="Search goals..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring w-full md:w-[200px]"><option>All Leads</option><!></select></div> <button class="flex items-center gap-2 bg-primary text-primary-foreground px-4 py-2 rounded-lg hover:bg-primary/90 justify-center whitespace-nowrap w-full md:w-auto"><!> Add Goal</button></div> <!> <!></div>');function na(_,s){Ve(s,!0);let f=c(""),u=c(1),g=c(5),S=c(!1),x=c("goal_no"),w=c("asc"),L=c("all"),h=c(!0),I=c(null),j=c(!1),W=c(""),q=c("success"),E=c(b([])),F=c(b([]));_t(()=>{B()});const B=async()=>{await Y(),await z(),i(h,!1)},Y=async()=>{const{data:r,error:l}=await M.from("leads").select("id, name");l?m("Error fetching leads","error"):i(F,b(r))},z=async()=>{const{data:r,error:l}=await M.from("strategic_goals").select("*").order("goal_no",{ascending:!0});l?m("Error fetching strategic goals","error"):i(E,b(r))},Z=()=>e(E).length>0?Math.max(...e(E).map(r=>r.goal_no))+1:1,m=(r,l)=>{i(W,b(r)),i(q,b(l)),i(j,!0),setTimeout(()=>{i(j,!1)},3e3)},H=r=>{const l=e(F).find(n=>n.id===r);return l?l.name:"No Lead Assigned"},Q=async r=>{if(e(I)){const{error:l}=await M.from("strategic_goals").update(r).match({id:e(I).id});l?m("Error updating goal","error"):(m("Goal updated successfully","success"),await z(),D())}else{const l={...r,goal_no:Z()},{error:n}=await M.from("strategic_goals").insert([l]);n?m("Error creating goal","error"):(m("Goal created successfully","success"),await z(),D())}},se=async r=>{if(confirm("Are you sure you want to delete this goal?")){i(h,!0);const{error:l}=await M.from("strategic_goals").delete().match({id:r});if(l){m("Error deleting goal","error"),i(h,!1);return}const{data:n,error:p}=await M.from("strategic_goals").select("*").order("goal_no",{ascending:!0});if(p){m("Error reordering goals","error"),i(h,!1);return}for(let k=0;k<n.length;(k+=1)-1)await M.from("strategic_goals").update({goal_no:k+1}).match({id:n[k].id});m("Goal deleted and reordered successfully","success"),await z(),i(h,!1)}},D=()=>{i(S,!1),i(I,null)},T=r=>{e(x)===r?i(w,b(e(w)==="asc"?"desc":"asc")):(i(x,b(r)),i(w,"asc"))},K=R(()=>e(E).filter(r=>{const n=`${r.name} ${r.description} ${r.kpi}`.toLowerCase().includes(e(f).toLowerCase()),p=e(L)==="all"||r.lead_id===e(L);return n&&p}).sort((r,l)=>{const n=String(r[e(x)]),p=String(l[e(x)]);return e(w)==="asc"?n.localeCompare(p):p.localeCompare(n)})),le=R(()=>e(K).slice((e(u)-1)*e(g),e(u)*e(g))),ee=R(()=>Math.ceil(e(K).length/e(g)));var V=Kt(),U=a(V);ke(U,()=>e(j),r=>{var l=zt(),n=a(l),p=a(n,!0);t(n),t(l),N(()=>{ut(l,`alert alert-${e(q)??""} shadow-lg mb-4`),y(p,e(W))}),G(r,l)});var $=o(U,4),d=a($),v=a(d),C=a(v);mt(C,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var X=o(C,2);ct(X),t(v);var J=o(v,2),ie=a(J);ie.value=(ie.__value="all")==null?"":"all";var Ue=o(ie);Ge(Ue,17,()=>e(F),He,(r,l)=>{var n=Ct(),p={},k=a(n,!0);t(n),N(()=>{p!==(p=e(l).id)&&(n.value=(n.__value=e(l).id)==null?"":e(l).id),y(k,e(l).name)}),G(r,n)}),t(J),t(d);var ne=o(d,2);ne.__click=[Pt,S];var Xe=a(ne);bt(Xe,{size:20}),De(),t(ne),t($);var ze=o($,2);ke(ze,()=>e(h),r=>{var l=Nt();G(r,l)},r=>{var l=Tt(),n=Ke(l),p=a(n),k=a(p),Ce=a(k),de=a(Ce),ce=a(de);ce.__click=[At,T];var Oe=o(a(ce)),Re=R(()=>e(x)==="goal_no"?"text-primary":"");Te(Oe,{size:16,get class(){return e(Re)}}),t(ce),t(de);var Pe=o(de),ue=a(Pe);ue.__click=[Lt,T];var We=o(a(ue)),Ye=R(()=>e(x)==="name"?"text-primary":"");Te(We,{size:16,get class(){return e(Ye)}}),t(ue),t(Pe),De(4),t(Ce),t(k);var Ne=o(k);Ge(Ne,21,()=>e(le),O=>O.id,(O,P)=>{var ge=Mt(),me=a(ge),et=a(me,!0);t(me);var be=o(me),tt=a(be,!0);t(be);var xe=o(be),at=a(xe,!0);t(xe);var he=o(xe),rt=a(he,!0);t(he);var ye=o(he),ot=a(ye,!0);N(()=>y(ot,H(e(P).lead_id))),t(ye);var Me=o(ye),qe=a(Me),ae=a(qe);ae.__click=[It,P];var st=a(ae);xt(st,{size:18}),t(ae);var re=o(ae,2);re.__click=[jt,I,P,S];var lt=a(re);kt(lt,{size:18}),t(re);var we=o(re,2);we.__click=[Ft,se,P];var it=a(we);wt(it,{size:18}),t(we),t(qe),t(Me),t(ge),N(()=>{y(et,e(P).goal_no),y(tt,e(P).name),y(at,e(P).description),y(rt,e(P).kpi)}),G(O,ge)}),t(Ne),t(p),t(n);var Ae=o(n,2),ve=a(Ae),Ze=a(ve);N(()=>y(Ze,`Showing ${(e(u)-1)*e(g)+1} to ${Math.min(e(u)*e(g),e(K).length)??""} of ${e(K).length??""} results`)),t(ve);var Le=o(ve,2),te=a(Le),pe=a(te);pe.value=(pe.__value=5)==null?"":5;var _e=o(pe);_e.value=(_e.__value=10)==null?"":10;var Ie=o(_e);Ie.value=(Ie.__value=25)==null?"":25,t(te);var je=o(te,2),fe=a(je);fe.__click=[qt,u];var Fe=o(fe,2);Fe.__click=[Dt,u],t(je),t(Le),t(Ae),N(()=>{fe.disabled=e(u)===1,Fe.disabled=e(u)===e(ee)}),Ee(te,()=>e(g),O=>i(g,O)),G(r,l)});var Je=o(ze,2);ke(Je,()=>e(S),r=>{Et(r,{get goal(){return e(I)},get leads(){return e(F)},onSave:Q,onClose:D})}),t(V),oe(X,()=>e(f),r=>i(f,r)),Ee(J,()=>e(L),r=>i(L,r)),G(_,V),$e()}Qe(["click"]);export{na as component};

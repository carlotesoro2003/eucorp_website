import"../chunks/disclose-version.Bg9kRutz.js";import{f as z,c as r,g as e,s as i,r as t,t as S,e as ce,p as pe,a as _e,d as h,b as l,n as se}from"../chunks/utils.CRNn4dtP.js";import{s as y}from"../chunks/render.xPn1qZIb.js";import{i as L}from"../chunks/if.CRsBAEFG.js";import{e as ve,i as ge}from"../chunks/each.v0RK4Yef.js";import{c as me,a as f,t as k,d as Ae,s as Pe,b as Ie}from"../chunks/store.B1kL-7Ni.js";import{c as Ce,a as Me}from"../chunks/attributes.BcfEV1VJ.js";import{l as Se,s as Te,p as Oe,a as g}from"../chunks/preload-helper.Dwm_PvIR.js";import{s as N}from"../chunks/supabaseClient.BTuNJN2N.js";import{o as Ue}from"../chunks/index-client.BdGz_wQc.js";import{p as De}from"../chunks/stores.DcEtjLim.js";import{c as Fe}from"../chunks/svelte-component.CsbbSknF.js";import{s as qe}from"../chunks/class.CstC7PuZ.js";import{I as Ee,s as Ge}from"../chunks/Icon.CEA2x5sb.js";import{C as Le,a as Ne}from"../chunks/circle-check.BO4zRICV.js";import{s as ze}from"../chunks/snippet.DgQetCpD.js";import{P as Ke}from"../chunks/plus.BBSv_QI7.js";import{S as ue}from"../chunks/save.D1ZZhgaf.js";import{L as Re}from"../chunks/loader-circle.D00fYFri.js";import{X as Xe}from"../chunks/x.DaAqSZOK.js";import{T as Be}from"../chunks/trash-2.B2J2poVW.js";function He(u,o){const c=Se(o,["children","$$slots","$$events","$$legacy"]);Ee(u,Te({name:"info"},()=>c,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 16v-4"}],["path",{d:"M12 8h.01"}]],children:(d,v)=>{var _=me(),b=z(_);Ge(b,o,"default",{}),f(d,_)},$$slots:{default:!0}}))}var Je=k('<div><div class="flex items-center gap-3"><!> <span> </span></div></div>');function Qe(u,o){const c=ce(()=>()=>{switch(o.type){case"success":return"bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-300 border-green-200 dark:border-green-800";case"error":return"bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-300 border-red-200 dark:border-red-800";case"warning":return"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-300 border-yellow-200 dark:border-yellow-800";default:return"bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-300 border-blue-200 dark:border-blue-800"}}),p=ce(()=>()=>{switch(o.type){case"success":return Ne;case"error":case"warning":return Le;default:return He}});var d=Je(),v=r(d),_=r(v);Fe(_,()=>e(p),(T,P)=>{P(T,{class:"w-5 h-5"})});var b=i(_,2),w=r(b,!0);t(b),t(v),t(d),S(()=>{qe(d,`rounded-lg border p-4 ${e(c)??""}`),y(w,o.message)}),f(u,d)}var Ve=k('<div class="fixed inset-0 z-50 overflow-y-auto"><div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0"><div class="fixed inset-0 bg-gray-500 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-75 transition-opacity"></div> <div class="relative transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg"><!></div></div></div>');function We(u,o){pe(o,!0);let c=Oe(o,"show",11,!1);var p=me(),d=z(p);L(d,c,v=>{var _=Ve(),b=r(_),w=i(r(b),2),T=r(w);ze(T,()=>o.children),t(w),t(b),t(_),f(v,_)}),f(u,p),_e()}const Ye=(u,o,c,p,d)=>{e(o)>=0?e(c)[e(o)]={...e(p)}:l(c,g([...e(c),{...e(p)}])),l(d,!1)},Ze=async(u,o,c,p)=>{if(e(o).length===0){c("Please add at least one action plan.","warning");return}try{l(p,!0);const{error:d}=await N.from("action_plans").insert(e(o));d?c("Failed to submit action plans.","error"):(c("Action plans submitted successfully.","success"),l(o,g([])))}catch{c("An error occurred while submitting action plans.","error")}finally{l(p,!1)}};var et=k('<div class="mt-4 space-y-2"><h5 class="text-md text-gray-700 dark:text-gray-300"><span class="font-medium">Strategic Goal:</span> <span class="ml-2"> </span></h5> <h5 class="text-md text-gray-700 dark:text-gray-300"><span class="font-medium">Strategic Objective:</span> <span class="ml-2"> </span></h5></div>'),tt=(u,o)=>o(),rt=k('<div class="border dark:border-gray-700 rounded-lg p-4 relative hover:bg-gray-50 dark:hover:bg-gray-700"><div class="grid md:grid-cols-2 gap-4"><div><h4 class="font-medium text-gray-900 dark:text-white">Actions Taken</h4> <p class="text-gray-600 dark:text-gray-400 mt-1"> </p></div> <div><h4 class="font-medium text-gray-900 dark:text-white">KPI</h4> <p class="text-gray-600 dark:text-gray-400 mt-1"> </p></div> <div><h4 class="font-medium text-gray-900 dark:text-white">Target Output</h4> <p class="text-gray-600 dark:text-gray-400 mt-1"> </p></div> <div><h4 class="font-medium text-gray-900 dark:text-white">Key Person Responsible</h4> <p class="text-gray-600 dark:text-gray-400 mt-1"> </p></div></div> <div class="absolute top-4 right-4 flex gap-2"><button class="p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-full"><!></button> <button class="p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-full"><!></button></div></div>'),at=k('<div class="text-center py-8 text-gray-500 dark:text-gray-400">No action plans added yet. Click "Add Plan" to create one.</div>'),st=k("<!> Submitting...",1),ot=k("<!> Submit All",1),it=(u,o)=>l(o,!1),dt=(u,o,c)=>e(o)[c]=u.target.value,lt=k('<div class="space-y-2"><label class="block text-sm font-medium text-gray-700 dark:text-gray-300"> </label> <textarea class="w-full px-3 py-2 rounded-md border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400"></textarea></div>'),nt=(u,o)=>l(o,!1),ct=k('<div class="p-6 dark:bg-gray-800"><div class="flex justify-between items-center mb-6"><h3 class="text-xl font-semibold text-gray-900 dark:text-white"> </h3> <button class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300"><!></button></div> <div class="space-y-4"></div> <div class="mt-6 flex justify-end gap-4"><button class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">Cancel</button> <button class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"> </button></div></div>'),vt=k('<div class="min-h-screen bg-gray-50 dark:bg-black p-4 md:p-8"><div class="max-w-7xl mx-auto space-y-6"><div class="bg-white dark:bg-black rounded-lg p-6 shadow-sm"><h1 class="text-2xl font-bold text-gray-900 dark:text-white">Action Plans</h1> <!></div> <!> <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6"><div class="flex justify-between items-center mb-6"><h2 class="text-xl font-semibold text-gray-900 dark:text-white">Action Plans List</h2> <button class="inline-flex items-center px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800"><!> Add Plan</button></div> <div class="space-y-4"></div> <!></div> <div class="flex justify-end"><button class="inline-flex items-center px-6 py-2 rounded-md bg-green-600 text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-offset-gray-800 disabled:opacity-50"><!></button></div></div></div> <!>',1);function Ot(u,o){pe(o,!0);const c=Pe(),p=()=>Ie(De,"$page",c);let d=h(g([])),v=h(g({actions_taken:"",kpi:"",target_output:"",key_person_responsible:"",objective_id:0,profile_id:"",department_id:""})),_=h(null),b=h(null),w=h(""),T=h("info"),P=h(null),J=h(!1),Q=h(""),O=h(!1),F=h(-1);Ue(()=>{const{params:a}=p();l(P,g(parseInt(a.id))),e(P)?(e(v).objective_id=e(P),fe(e(P)),be()):I("Objective ID is missing.","error")});const be=async()=>{const{data:{user:a}}=await N.auth.getUser();if(a){const{data:s,error:n}=await N.from("profiles").select("id, department_id").eq("id",a.id).single();if(n||!s){I("Failed to fetch user profile details.","error");return}l(Q,g(s.id)),e(v).profile_id=e(Q),e(v).department_id=s.department_id}else I("User not logged in.","error")},fe=async a=>{try{const{data:s,error:n}=await N.from("strategic_objectives").select("name, strategic_goal_id").eq("id",a).single();if(n||!s){I("Failed to fetch strategic objective.","error");return}l(_,g(s));const{data:m,error:x}=await N.from("strategic_goals").select("name, goal_no").eq("id",s.strategic_goal_id).single();if(x||!m){I("Failed to fetch strategic goal.","error");return}l(b,g(m))}catch{I("An error occurred while fetching strategic data.","error")}},oe=(a=-1)=>{a>=0?(l(v,g({...e(d)[a]})),l(F,g(a))):(l(v,g({actions_taken:"",kpi:"",target_output:"",key_person_responsible:"",objective_id:e(P)||0,profile_id:e(Q),department_id:e(v).department_id})),l(F,-1)),l(O,!0)},xe=a=>{l(d,g(e(d).filter((s,n)=>n!==a)))},I=(a,s)=>{l(w,g(a)),l(T,g(s)),setTimeout(()=>{l(w,"")},5e3)};var ie=vt(),V=z(ie),de=r(V),W=r(de),he=i(r(W),2);L(he,()=>e(b)&&e(_),a=>{var s=et(),n=r(s),m=i(r(n),2),x=r(m);t(m),t(n);var $=i(n,2),j=i(r($),2),q=r(j,!0);t(j),t($),t(s),S(()=>{y(x,`${e(b).goal_no??""} - ${e(b).name??""}`),y(q,e(_).name)}),f(a,s)}),t(W);var le=i(W,2);L(le,()=>e(w),a=>{Qe(a,{get message(){return e(w)},get type(){return e(T)}})});var Y=i(le,2),Z=r(Y),ee=i(r(Z),2);ee.__click=[tt,oe];var ye=r(ee);Ke(ye,{class:"w-5 h-5 mr-2"}),se(),t(ee),t(Z);var te=i(Z,2);ve(te,21,()=>e(d),ge,(a,s,n)=>{var m=rt(),x=r(m),$=r(x),j=i(r($),2),q=r(j,!0);t(j),t($);var C=i($,2),E=i(r(C),2),R=r(E,!0);t(E),t(C);var M=i(C,2),X=i(r(M),2),re=r(X,!0);t(X),t(M);var U=i(M,2),D=i(r(U),2),G=r(D,!0);t(D),t(U),t(x);var B=i(x,2),A=r(B);A.__click=()=>oe(n);var H=r(A);ue(H,{class:"w-5 h-5"}),t(A);var ae=i(A,2);ae.__click=()=>xe(n);var $e=r(ae);Be($e,{class:"w-5 h-5"}),t(ae),t(B),t(m),S(()=>{y(q,e(s).actions_taken),y(R,e(s).kpi),y(re,e(s).target_output),y(G,e(s).key_person_responsible)}),f(a,m)}),t(te);var ke=i(te,2);L(ke,()=>e(d).length===0,a=>{var s=at();f(a,s)}),t(Y);var ne=i(Y,2),K=r(ne);K.__click=[Ze,d,I,J];var we=r(K);L(we,()=>e(J),a=>{var s=st(),n=z(s);Re(n,{class:"w-5 h-5 mr-2 animate-spin"}),se(),f(a,s)},a=>{var s=ot(),n=z(s);ue(n,{class:"w-5 h-5 mr-2"}),se(),f(a,s)}),t(K),t(ne),t(de),t(V);var je=i(V,2);We(je,{get show(){return e(O)},set show(a){l(O,g(a))},children:(a,s)=>{var n=ct(),m=r(n),x=r(m),$=r(x);t(x);var j=i(x,2);j.__click=[it,O];var q=r(j);Xe(q,{class:"w-6 h-6"}),t(j),t(m);var C=i(m,2);ve(C,20,()=>["actions_taken","kpi","target_output","key_person_responsible"],ge,(re,U)=>{var D=lt(),G=r(D),B=r(G,!0);S(()=>y(B,U.split("_").map(H=>H.charAt(0).toUpperCase()+H.slice(1)).join(" "))),t(G);var A=i(G,2);Ce(A),A.__input=[dt,v,U],t(D),S(()=>Me(A,e(v)[U])),f(re,D)}),t(C);var E=i(C,2),R=r(E);R.__click=[nt,O];var M=i(R,2);M.__click=[Ye,F,d,v,O];var X=r(M);t(M),t(E),t(n),S(()=>{y($,`${(e(F)>=0?"Edit":"Add")??""} Action Plan`),y(X,`${(e(F)>=0?"Update":"Add")??""} Plan`)}),f(a,n)},$$slots:{default:!0}}),S(()=>K.disabled=e(J)),f(u,ie),_e()}Ae(["click","input"]);export{Ot as component};

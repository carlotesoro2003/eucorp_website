import"../chunks/disclose-version.Bg9kRutz.js";import{p as ie,c as a,r as t,s as o,t as B,a as ne,e as b,g as e,f as pe,b as d,h as re,n as se,m as Je}from"../chunks/utils.Cx6K9qTo.js";import{d as ce,a as j,t as L,b as K,g as kt,f as At,e as Ze}from"../chunks/store.BALTJZ26.js";import{i as $}from"../chunks/if.Bgpzl8Wa.js";import{i as Pt}from"../chunks/lifecycle.D0tpf3vC.js";import{a as N,p as et}from"../chunks/preload-helper.Tg4Km7Zr.js";import{s as C}from"../chunks/Icon.Nl6wOSVO.js";import{b as Z,r as je,e as Te,i as tt}from"../chunks/attributes.rzeD2olC.js";import{s as Ce}from"../chunks/class.DKwifj_X.js";import{b as Y}from"../chunks/input.BVFrb_g3.js";import{b as $e}from"../chunks/select.BtlRD387.js";import{P as St}from"../chunks/pencil.Brzv4RaD.js";import{T as rt}from"../chunks/trash-2.d9YwO6MY.js";import{E as Et,a as Ot}from"../chunks/jspdf.plugin.autotable.BCh_1lSd.js";import{L as at}from"../chunks/lightbulb.BtKHez7a.js";import{A as de}from"../chunks/arrow-up-down.CZ0J7o1e.js";import{S as Nt}from"../chunks/search.BpYLThKw.js";import{D as zt}from"../chunks/download.K4Jw1XP8.js";import{X as Ft}from"../chunks/x.D9PBK57y.js";import{t as It,f as Rt}from"../chunks/index.3UqCw1jp.js";import{o as Tt}from"../chunks/index-client.lWLCSZVk.js";import{S as Ct}from"../chunks/save.Dylz2glE.js";import{P as jt}from"../chunks/plus.Dop3u5ke.js";import{C as Ut}from"../chunks/circle-plus.C_eqP8H1.js";var Dt=(E,r)=>r.onApprove(r.opportunity.id),qt=(E,r)=>r.onEdit(r.opportunity),Kt=(E,r)=>r.onDelete(r.opportunity.id),Lt=L('<tr class="hover:bg-muted/50"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><div class="flex items-center gap-2"><button class="px-2 py-1 text-sm rounded bg-green-500 text-white hover:bg-green-600 disabled:opacity-50"> </button> <button class="hover:bg-muted rounded-lg text-muted-foreground hover:text-foreground"><!></button> <button class="p-1 rounded hover:bg-muted text-red-500 hover:text-red-600 disabled:opacity-50"><!></button></div></td></tr>');function Vt(E,r){ie(r,!0);var p=Lt(),u=a(p),_=a(u,!0);t(u);var g=o(u),n=a(g,!0);t(g);var x=o(g),P=a(x,!0);t(x);var A=o(x),c=a(A,!0);t(A);var y=o(A),m=a(y,!0);t(y);var w=o(y),F=a(w);B(()=>K(F,`P${r.opportunity.budget.toFixed(2)??""}`)),t(w);var z=o(w),O=a(z,!0);t(z);var D=o(z),q=a(D),I=a(q);I.__click=[Dt,r];var V=a(I,!0);t(I);var h=o(I,2);h.__click=[qt,r];var M=a(h);St(M,{size:16}),t(h);var R=o(h,2);R.__click=[Kt,r];var G=a(R);rt(G,{size:16}),t(R),t(q),t(D),t(p),B(()=>{K(_,r.opportunity.opt_statement),K(n,r.opportunity.planned_actions),K(P,r.opportunity.kpi),K(c,r.opportunity.key_persons),K(m,r.opportunity.target_output),K(O,r.opportunity.department_name),I.disabled=r.approvingId===r.opportunity.id||r.userRole==="admin"&&r.opportunity.is_approved||r.userRole==="vice_president"&&(!r.opportunity.is_approved||r.opportunity.is_approved_vp)||r.userRole==="president"&&(!r.opportunity.is_approved_vp||r.opportunity.is_approved_president),K(V,r.approvingId===r.opportunity.id?"Processing...":r.userRole==="admin"?r.opportunity.is_approved?"Admin Approved":"Approve":r.userRole==="vice_president"?r.opportunity.is_approved_vp?"VP Approved":"Approve":r.userRole==="president"&&r.opportunity.is_approved_president?"President Approved":"Approve"),R.disabled=r.deletingId===r.opportunity.id}),j(E,p),ne()}ce(["click"]);var Mt=L('<form class="h-full max-h-screen flex flex-col gap-4 p-4"><h3 class="text-lg font-semibold">Edit Opportunity</h3> <div class="flex-1 overflow-y-auto pr-2"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="space-y-4"><div class="space-y-2"><label for="opt_statement">Statement</label> <textarea id="opt_statement" class="w-full p-2 border rounded-lg bg-background min-h-[100px] overflow-hidden"></textarea></div> <div class="space-y-2"><label for="planned_actions">Planned Actions</label> <textarea id="planned_actions" class="w-full p-2 border rounded-lg bg-background min-h-[100px] overflow-hidden"></textarea></div></div> <div class="space-y-4"><div class="space-y-2"><label for="kpi">KPI</label> <textarea id="kpi" class="w-full p-2 border rounded-lg bg-background min-h-[42px] overflow-hidden"></textarea></div> <div class="space-y-2"><label for="key_persons">Key Persons</label> <textarea id="key_persons" class="w-full p-2 border rounded-lg bg-background min-h-[42px] overflow-hidden"></textarea></div> <div class="space-y-2"><label for="target_output">Target Output</label> <textarea id="target_output" class="w-full p-2 border rounded-lg bg-background min-h-[42px] overflow-hidden"></textarea></div> <div class="space-y-2"><label for="budget">Budget</label> <input type="number" id="budget" class="w-full p-2 border rounded-lg bg-background" min="0" step="0.01"></div></div></div></div> <div class="sticky bottom-0 flex justify-end gap-2 pt-4 border-t bg-background"><button type="submit" class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"> </button></div></form>');function Ht(E,r){ie(r,!0);let p=r.opportunity?{...r.opportunity}:{opt_statement:"",planned_actions:"",kpi:"",key_persons:"",target_output:"",budget:0};const u=v=>{v.preventDefault(),r.onSave(p)},_=v=>{const k=v.target;k.style.height="auto",k.style.height=k.scrollHeight+"px"};var g=Mt(),n=o(a(g),2),x=a(n),P=a(x),A=a(P),c=o(a(A),2);Z(c),c.__input=_,t(A);var y=o(A,2),m=o(a(y),2);Z(m),m.__input=_,t(y),t(P);var w=o(P,2),F=a(w),z=o(a(F),2);Z(z),z.__input=_,t(F);var O=o(F,2),D=o(a(O),2);Z(D),D.__input=_,t(O);var q=o(O,2),I=o(a(q),2);Z(I),I.__input=_,t(q);var V=o(q,2),h=o(a(V),2);je(h),t(V),t(w),t(x),t(n);var M=o(n,2),R=a(M),G=a(R,!0);t(R),t(M),t(g),B(()=>{R.disabled=r.saving,K(G,r.saving?"Saving...":"Save Changes")}),kt("submit",g,u),Y(c,()=>p.opt_statement,v=>p.opt_statement=v),Y(m,()=>p.planned_actions,v=>p.planned_actions=v),Y(z,()=>p.kpi,v=>p.kpi=v),Y(D,()=>p.key_persons,v=>p.key_persons=v),Y(I,()=>p.target_output,v=>p.target_output=v),Y(h,()=>p.budget,v=>p.budget=v),j(E,g),ne()}ce(["input"]);const Bt=(E,r,p,u,_,g)=>{const n=new Et("landscape");n.setFont("times","normal"),n.setFontSize(12),n.text("MANUEL S. ENVERGA UNIVERSITY FOUNDATION",14,10),n.text("Opportunities Report",14,16),n.setFontSize(10),n.text("SY 2024-2025",14,22);const x=["Opportunity Statement","Planned Actions","KPI","Key Persons","Target Output","Budget","Department"],P=e(r).map(O=>[O.opt_statement,O.planned_actions,O.kpi,O.key_persons,O.target_output,O.budget.toFixed(2),O.department_name||"Unknown"]);Ot(n,{head:[x],body:P,startY:28,theme:"grid",styles:{font:"times",fontSize:10},headStyles:{fillColor:[41,128,185]}});const c=n.internal.pageSize.height-40,y=n.internal.pageSize.width/4,m=[14,y,y*2,y*3];n.setFontSize(10);const w=e(p)[0],F=(w==null?void 0:w.user_name)||"Unknown",z=(w==null?void 0:w.department_name)||"Unknown";n.text(`${F} (sgnd)`,m[0],c-5),n.text("_________________________",m[0],c),n.text(`${z} Department Head`,m[0],c+5),n.text(`${e(u)||"N/A"} (sgnd)`,m[1],c-5),n.text("_________________________",m[1],c),n.text("Corporate Planning Officer",m[1],c+5),n.text(`${e(_)||"N/A"} (sgnd)`,m[2],c-5),n.text("_________________________",m[2],c),n.text("Vice President",m[2],c+5),n.text(`${e(g)||"N/A"} (sgnd)`,m[3],c-5),n.text("_________________________",m[3],c),n.text("President",m[3],c+5),n.save("Opportunities_Report.pdf")};var Yt=L("<div><span> </span></div>"),Gt=(E,r)=>d(r,!e(r)),Qt=L("<option> </option>"),Wt=L('<button class="flex items-center gap-2 bg-secondary px-4 py-2 rounded-lg hover:bg-secondary/80 flex-1 md:flex-initial"><!> Export</button> <button class="flex items-center gap-2 bg-primary text-primary-foreground px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50"></button>',1),Xt=L('<div class="flex justify-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),Jt=(E,r)=>r("opt_statement"),Zt=(E,r)=>r("planned_actions"),$t=(E,r)=>r("budget"),er=(E,r)=>r("department_name"),tr=(E,r)=>d(r,e(r)-1),rr=(E,r)=>d(r,e(r)+1),ar=L('<div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Statement <!></button></th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Actions <!></button></th><th class="px-4 py-3 text-left">KPI</th><th class="px-4 py-3 text-left">Key Persons</th><th class="px-4 py-3 text-left">Target</th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Budget <!></button></th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Department <!></button></th><th class="px-4 py-3 text-left w-[150px]">Actions</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary rounded-lg px-2 py-1 w-full sm:w-auto"><option>5 per page</option><option>10 per page</option><option>25 per page</option><option>50 per page</option></select> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Next</button></div></div></div>',1),or=L('<div class="fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 overflow-y-auto"><div class="bg-card p-3 rounded-lg w-full max-w-md relative border border-border"><button class="absolute right-4 top-4 p-1 hover:bg-muted rounded-lg"><!></button> <!></div></div>'),sr=L('<div class="flex flex-col gap-4 container mx-auto p-6"><!> <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div class="flex items-center gap-2"><!> <h1 class="text-2xl font-bold">Opportunities Management</h1></div></div> <button class="md:hidden w-full px-4 py-2 bg-secondary rounded-lg text-left flex justify-between items-center">Filters <!></button> <div><div class="flex flex-col md:flex-row gap-4 w-full md:w-auto"><div class="relative flex-1 md:w-[300px]"><!> <input type="text" placeholder="Search opportunities..." class="pl-10 pr-4 py-2 bg-secondary border-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <select class="bg-secondary rounded-lg px-3 py-2 w-full md:w-[200px]"><option>All Departments</option><!></select></div> <div class="flex gap-2 w-full md:w-auto"><!></div></div> <!> <!></div>');function ir(E,r){ie(r,!0);let p=b(""),u=b(1),_=b(5),g=b(!1),n=b(null),x=b("opt_statement"),P=b("asc"),A=b("all"),c=b(!1),y=b(!1),m=b(""),w=b("success"),F=b(!1),z=b(!0),O=b(null),D=b(null),q=!1,I=b(N([])),V=b(N([])),h=b(null),M=b(null),R=b(null),G=b(null);const v=async()=>{await k(),await T(),await Q(),await ae(),await W(),d(z,!1)},k=async()=>{const{data:{session:s}}=await C.auth.getSession();if(!s||!s.user)return;const{data:i,error:l}=await C.from("profiles").select("role").eq("id",s.user.id).single();if(l){U("Error fetching user role: "+l.message,"error");return}d(h,N(i.role))},T=async()=>{const{data:s,error:i}=await C.from("profiles").select("first_name, last_name").eq("role","admin");if(i){U("Error fetching admin name: "+i.message,"error"),d(M,"N/A");return}d(M,N(s.map(l=>`${l.first_name} ${l.last_name}`).join(", ")))},W=async()=>{const{data:s,error:i}=await C.from("profiles").select("first_name, last_name, role").in("role",["vice_president","president"]);if(i){U("Error fetching VP and President names: "+i.message,"error"),d(R,"N/A"),d(G,"N/A");return}const l=s.find(S=>S.role==="vice_president"),f=s.find(S=>S.role==="president");d(R,N(l?`${l.first_name} ${l.last_name}`:"N/A")),d(G,N(f?`${f.first_name} ${f.last_name}`:"N/A"))},Q=async()=>{const{data:s,error:i}=await C.from("opportunities").select(`
                *,
                profiles (
                    first_name,
                    last_name,
                    departments (name)
                )
            `);if(i){U("Error fetching opportunities: "+i.message,"error");return}d(I,N(s.map(l=>{var f,S,H,oe;return{...l,department_name:((S=(f=l.profiles)==null?void 0:f.departments)==null?void 0:S.name)||"N/A",user_name:`${((H=l.profiles)==null?void 0:H.first_name)||""} ${((oe=l.profiles)==null?void 0:oe.last_name)||""}`}})))},ae=async()=>{const{data:s,error:i}=await C.from("departments").select("id, name");if(i){U("Error fetching departments: "+i.message,"error");return}d(V,N(s))},U=(s,i)=>{d(m,N(s)),d(w,N(i)),d(y,!0),setTimeout(()=>{d(y,!1)},3e3)},X=re(()=>e(I).filter(s=>{const l=`${s.opt_statement} ${s.planned_actions} ${s.department_name}`.toLowerCase().includes(e(p).toLowerCase()),f=e(A)==="all"||s.department_name===e(A);return l&&f}).sort((s,i)=>{const l=String(s[e(x)]),f=String(i[e(x)]);return e(P)==="asc"?l.localeCompare(f):f.localeCompare(l)})),ee=re(()=>e(X).slice((e(u)-1)*e(_),e(u)*e(_))),fe=re(()=>Math.ceil(e(X).length/e(_))),J=s=>{e(x)===s?d(P,N(e(P)==="asc"?"desc":"asc")):(d(x,N(s)),d(P,"asc"))},te=async s=>{d(D,N(s));const{error:i}=await C.from("opportunities").delete().eq("id",s);i?U("Error deleting opportunity: "+i.message,"error"):(await Q(),U("Opportunity deleted successfully!","success")),d(D,null)},ue=async s=>{d(O,N(s));let i={};e(h)==="admin"?i={is_approved:!0}:e(h)==="vice_president"?i={is_approved_vp:!0}:e(h)==="president"&&(i={is_approved_president:!0});const{data:l,error:f}=await C.from("opportunities").update(i).eq("id",s).select();if(f)U("Error approving opportunity: "+f.message,"error");else{if(e(h)==="president"&&l&&l.length>0){const S=l[0],{error:H}=await C.from("opt_monitoring").insert({opt_id:S.id,profile_id:S.profile_id,department_id:S.department_id});H&&U("Error adding to monitoring: "+H.message,"error")}await Q(),U("Opportunity approved successfully!","success")}d(O,null)},ot=async s=>{if(!e(n))return;d(F,!0);const{error:i}=await C.from("opportunities").update({opt_statement:s.opt_statement,planned_actions:s.planned_actions,kpi:s.kpi,key_persons:s.key_persons,target_output:s.target_output,budget:s.budget}).eq("id",e(n).id);i?U("Error updating opportunity: "+i.message,"error"):(await Q(),U("Opportunity updated successfully!","success"),Ue()),d(F,!1)},Ue=()=>{d(g,!1),d(n,null)},st=async()=>{q=!0;let s={};if(e(h)==="admin")s={is_approved:!0};else if(e(h)==="vice_president")s={is_approved_vp:!0};else if(e(h)==="president")s={is_approved_president:!0};else{q=!1;return}try{const{error:i}=await C.from("opportunities").update(s).in("id",e(ee).map(l=>l.id));if(i)U("Error approving opportunities: "+i.message,"error");else{if(e(h)==="president"){const l=e(ee).map(S=>({opt_id:S.id,profile_id:S.profile_id})),{error:f}=await C.from("opt_monitoring").insert(l);f&&U("Error adding to monitoring: "+f.message,"error")}await Q(),U("All displayed opportunities approved successfully!","success")}}catch(i){console.error("Unexpected error approving all opportunities:",i),U("An unexpected error occurred.","error")}finally{q=!1}};v();var ge=sr(),De=a(ge);$(De,()=>e(y),s=>{var i=Yt(),l=a(i),f=a(l,!0);t(l),t(i),B(()=>{Ce(i,`alert alert-${e(w)??""} shadow-lg mb-4`),K(f,e(m))}),j(s,i)});var be=o(De,2),qe=a(be),it=a(qe);at(it,{class:"w-8 h-8 text-primary"}),se(2),t(qe),t(be);var _e=o(be,2);_e.__click=[Gt,c];var nt=o(a(_e)),lt=re(()=>e(c)?"rotate-180":"");de(nt,{size:16,get class(){return e(lt)}}),t(_e);var ve=o(_e,2),xe=a(ve),ye=a(xe),Ke=a(ye);Nt(Ke,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var Le=o(Ke,2);je(Le),t(ye);var he=o(ye,2),we=a(he);we.value=(we.__value="all")==null?"":"all";var dt=o(we);Te(dt,17,()=>e(V),tt,(s,i)=>{var l=Qt(),f={},S=a(l,!0);t(l),B(()=>{f!==(f=e(i).name)&&(l.value=(l.__value=e(i).name)==null?"":e(i).name),K(S,e(i).name)}),j(s,l)}),t(he),t(xe);var Ve=o(xe,2),pt=a(Ve);$(pt,()=>e(ee).length>0,s=>{var i=Wt(),l=pe(i);l.__click=[Bt,X,I,M,R,G];var f=a(l);zt(f,{size:20}),se(),t(l);var S=o(l,2);S.__click=st,B(()=>S.disabled=q||e(ee).every(H=>e(h)==="admin"&&H.is_approved||e(h)==="vice_president"&&H.is_approved_vp||e(h)==="president"&&H.is_approved_president)),S.textContent=q?"Processing...":"Approve All",j(s,i)}),t(Ve),t(ve);var Me=o(ve,2);$(Me,()=>e(z),s=>{var i=Xt();j(s,i)},s=>{var i=ar(),l=pe(i),f=a(l),S=a(f),H=a(S),oe=a(H),ke=a(oe);ke.__click=[Jt,J];var ut=o(a(ke)),_t=re(()=>e(x)==="opt_statement"?"text-primary":"");de(ut,{size:16,get class(){return e(_t)}}),t(ke),t(oe);var Ae=o(oe),Pe=a(Ae);Pe.__click=[Zt,J];var vt=o(a(Pe)),mt=re(()=>e(x)==="planned_actions"?"text-primary":"");de(vt,{size:16,get class(){return e(mt)}}),t(Pe),t(Ae);var Se=o(Ae,4),Ee=a(Se);Ee.__click=[$t,J];var ft=o(a(Ee)),gt=re(()=>e(x)==="budget"?"text-primary":"");de(ft,{size:16,get class(){return e(gt)}}),t(Ee),t(Se);var He=o(Se),Oe=a(He);Oe.__click=[er,J];var bt=o(a(Oe)),xt=re(()=>e(x)==="department_name"?"text-primary":"");de(bt,{size:16,get class(){return e(xt)}}),t(Oe),t(He),se(),t(H),t(S);var Be=o(S);Te(Be,21,()=>e(ee),le=>le.id,(le,ht)=>{Vt(le,{get opportunity(){return e(ht)},get userRole(){return e(h)},onEdit:wt=>{d(n,N(wt)),d(g,!0)},onDelete:te,onApprove:ue,get approvingId(){return e(O)},get deletingId(){return e(D)}})}),t(Be),t(f),t(l);var Ye=o(l,2),Ne=a(Ye),yt=a(Ne);B(()=>K(yt,`Showing ${(e(u)-1)*e(_)+1} to ${Math.min(e(u)*e(_),e(X).length)??""} of ${e(X).length??""} results`)),t(Ne);var Ge=o(Ne,2),me=a(Ge),ze=a(me);ze.value=(ze.__value=5)==null?"":5;var Fe=o(ze);Fe.value=(Fe.__value=10)==null?"":10;var Ie=o(Fe);Ie.value=(Ie.__value=25)==null?"":25;var Qe=o(Ie);Qe.value=(Qe.__value=50)==null?"":50,t(me);var We=o(me,2),Re=a(We);Re.__click=[tr,u];var Xe=o(Re,2);Xe.__click=[rr,u],t(We),t(Ge),t(Ye),B(()=>{Re.disabled=e(u)===1,Xe.disabled=e(u)===e(fe)}),$e(me,()=>e(_),le=>d(_,le)),j(s,i)});var ct=o(Me,2);$(ct,()=>e(g),s=>{var i=or(),l=a(i),f=a(l);f.__click=Ue;var S=a(f);Ft(S,{size:20}),t(f);var H=o(f,2);Ht(H,{get opportunity(){return e(n)},onSave:ot,get saving(){return e(F)}}),t(l),t(i),j(s,i)}),t(ge),B(()=>Ce(ve,`flex flex-col gap-4 ${e(c)?"block":"hidden"} md:flex md:flex-row md:justify-between`)),Y(Le,()=>e(p),s=>d(p,s)),$e(he,()=>e(A),s=>d(A,s)),j(E,ge),ne()}ce(["click"]);var nr=L('<div class="bg-gray-50 rounded-lg p-6 border border-gray-200"><div class="flex justify-between items-start mb-4"><h3 class="text-lg font-semibold text-gray-700"> </h3> <button class="text-red-500 hover:text-red-700 transition-colors p-2"><!></button></div> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Opportunity Statement</label> <textarea placeholder="Describe the opportunity..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="3"></textarea></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Planned Actions</label> <textarea placeholder="List planned actions..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="3"></textarea></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">KPI</label> <textarea placeholder="Key Performance Indicators..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="2"></textarea></div></div> <div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Key Persons</label> <textarea placeholder="List key persons involved..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="2"></textarea></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Target Output</label> <textarea placeholder="Expected outcomes..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="2"></textarea></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Budget</label> <input type="number" placeholder="Enter budget amount..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></div></div></div></div>');function lr(E,r){ie(r,!0);let p=et(r,"data",7);const u=v=>{const k=v.target;k.style.height="auto",k.style.height=`${k.scrollHeight}px`};var _=nr(),g=a(_),n=a(g),x=a(n);t(n);var P=o(n,2);P.__click=function(...v){var k;(k=r.onDelete)==null||k.apply(this,v)};var A=a(P);rt(A,{class:"w-5 h-5"}),t(P),t(g);var c=o(g,2),y=a(c),m=a(y),w=o(a(m),2);Z(w),w.__input=u,t(m);var F=o(m,2),z=o(a(F),2);Z(z),z.__input=u,t(F);var O=o(F,2),D=o(a(O),2);Z(D),D.__input=u,t(O),t(y);var q=o(y,2),I=a(q),V=o(a(I),2);Z(V),V.__input=u,t(I);var h=o(I,2),M=o(a(h),2);Z(M),M.__input=u,t(h);var R=o(h,2),G=o(a(R),2);je(G),t(R),t(q),t(c),t(_),B(()=>K(x,`Opportunity ${r.index+1}`)),Y(w,()=>p().opt_statement,v=>p().opt_statement=v),Y(z,()=>p().planned_actions,v=>p().planned_actions=v),Y(D,()=>p().kpi,v=>p().kpi=v),Y(V,()=>p().key_persons,v=>p().key_persons=v),Y(M,()=>p().target_output,v=>p().target_output=v),Y(G,()=>p().budget,v=>p().budget=v),j(E,_),ne()}ce(["click","input"]);const dr=async(E,r,p,u,_,g)=>{if(e(r)){d(p,!0);try{const{data:n,error:x}=await C.from("opportunities").insert(e(u).map(P=>({...P,profile_id:e(r),department_id:P.department_id}))).select();if(x){_("Error creating opportunities","error");return}if(n&&n.length>0){const A=(await Promise.all(n.map(async c=>{const{data:y,error:m}=await C.from("departments").select("name").eq("id",c.department_id).single();if(m)return _("Error fetching department name","error"),null;const w=(y==null?void 0:y.name)||"Unknown Department";return{event_id:c.id,event_type:"opportunity",description:`${w} created a new opportunity`}}))).filter(c=>c!==null);A.length>0&&await C.from("recent_events").insert(A)}_("Opportunities created successfully","success"),await g(),d(u,N([{opt_statement:"",planned_actions:"",kpi:"",key_persons:"",target_output:"",budget:0,profile_id:"",department_id:e(u)[0].department_id}]))}catch{_("Unexpected error occurred","error")}finally{d(p,!1)}}},pr=(E,r,p)=>{var u;d(r,N([...e(r),{opt_statement:"",planned_actions:"",kpi:"",key_persons:"",target_output:"",budget:0,profile_id:e(p)||"",department_id:((u=e(r)[0])==null?void 0:u.department_id)||""}]))};var cr=L("<div><span> </span></div>"),ur=()=>console.log("Save Progress"),_r=L('<div class="flex justify-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),vr=L('<div class="animate-spin inline-block w-4 h-4 border-2 border-current border-t-transparent rounded-full"></div>'),mr=L('<div class="grid grid-cols-1 gap-6 mb-6"></div> <div class="flex flex-wrap gap-4"><button class="inline-flex items-center px-4 py-2 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/90 transition-colors"><!> Add New Opportunity</button> <button class="inline-flex items-center px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50"><!> <!></button></div>',1),fr=L('<div class="flex flex-col gap-4 p-4 container mx-auto"><!> <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div class="flex items-center gap-2"><!> <h1 class="text-2xl font-bold">Opportunities Register</h1></div></div> <div class="bg-card rounded-lg shadow border border-border p-6"><div class="flex justify-between items-center mb-6"><h2 class="text-xl font-semibold"> </h2> <button class="inline-flex items-center px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50"><!> Save Progress</button></div> <!></div></div>');function gr(E,r){ie(r,!0);let p=b(N([])),u=b(!1),_=b(!1),g=b(N([{opt_statement:"",planned_actions:"",kpi:"",key_persons:"",target_output:"",budget:0,profile_id:"",department_id:""}])),n=b(null),x=b(!1),P=b(""),A=b("success");const c=(k,T)=>{d(P,N(k)),d(A,N(T)),d(x,!0),setTimeout(()=>{d(x,!1)},3e3)},y=async()=>{const{data:{session:k}}=await C.auth.getSession();if(k){const{data:T,error:W}=await C.from("profiles").select("id, department_id").eq("id",k.user.id).single();W?c("Error fetching profile","error"):(d(n,N(T.id)),e(g).forEach(Q=>{Q.department_id=T.department_id}))}},m=async()=>{d(u,!0);const{data:k,error:T}=await C.from("opportunities").select("*").eq("profile_id",e(n));T?c("Error fetching opportunities","error"):d(p,N(k)),d(u,!1)},w=k=>{e(g).splice(k,1),d(g,N([...e(g)]))};Tt(()=>{y(),e(n)&&m()});var F=fr(),z=a(F);$(z,()=>e(x),k=>{var T=cr(),W=a(T),Q=a(W,!0);t(W),t(T),B(()=>{Ce(T,`flex items-center p-4 rounded-lg ${(e(A)==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800")??""}`),K(Q,e(P))}),It(3,T,()=>Rt),j(k,T)});var O=o(z,2),D=a(O),q=a(D);at(q,{class:"w-8 h-8 text-primary"}),se(2),t(D),t(O);var I=o(O,2),V=a(I),h=a(V),M=a(h,!0);t(h);var R=o(h,2);R.__click=[ur];var G=a(R);Ct(G,{class:"w-4 h-4 mr-2"}),se(),t(R),t(V);var v=o(V,2);$(v,()=>e(u),k=>{var T=_r();j(k,T)},k=>{var T=mr(),W=pe(T);Te(W,21,()=>e(g),tt,(J,te,ue)=>{lr(J,{get data(){return e(te)},index:ue,onDelete:()=>w(ue)})}),t(W);var Q=o(W,2),ae=a(Q);ae.__click=[pr,g,n];var U=a(ae);jt(U,{class:"w-4 h-4 mr-2"}),se(),t(ae);var X=o(ae,2);X.__click=[dr,n,_,g,c,m];var ee=a(X);Ut(ee,{class:"w-4 h-4 mr-2"});var fe=o(ee,2);$(fe,()=>e(_),J=>{var te=vr();j(J,te)},J=>{var te=At();B(()=>K(te,"Submit Opportunities")),j(J,te)}),t(X),t(Q),B(()=>X.disabled=e(u)||e(_)),j(k,T)}),t(I),t(F),B(()=>{K(M,"Create Opportunity"),R.disabled=e(_)}),j(E,F),ne()}ce(["click"]);var br=L("<div><!></div>");function Mr(E,r){ie(r,!1);let p=et(r,"data",8);const{session:u}=p();let _=Je(null),g=Je(!0);(async()=>{if(u){const{user:A}=u,{data:c,error:y}=await C.from("profiles").select("role").eq("id",A.id).single();y?console.error("Error fetching user profile:",y.message):(d(_,c),console.log("Role in Opportunities: ",e(_)))}d(g,!1)})(),Pt();var x=br(),P=a(x);$(P,()=>e(g),A=>{},A=>{var c=Ze(),y=pe(c);$(y,()=>u!==null&&e(_),m=>{var w=Ze(),F=pe(w);$(F,()=>e(_).role==="admin"||e(_).role=="vice_president"||e(_).role=="president",z=>{ir(z,{})},z=>{gr(z,{})}),j(m,w)},null,!0),j(A,c)}),t(x),j(E,x),ne()}export{Mr as component};

import"../chunks/disclose-version.Bg9kRutz.js";import{f as J,p as Ce,aF as b,a as Me,b as _,g as e,t as me,c as r,n as fe,r as a,s as o,O as Te}from"../chunks/runtime.CLSstnwU.js";import{s as P}from"../chunks/render.D17u6ZCY.js";import{i as ne}from"../chunks/if.b2Q-jNLG.js";import{e as Ve,i as Le}from"../chunks/each.sV1uapQk.js";import{c as be,a as x,d as je,t as S}from"../chunks/utils.kA-YjkFf.js";import{r as qe}from"../chunks/attributes.DiUoHvyc.js";import{r as G}from"../chunks/misc.C2nsS1Cr.js";import{b as V}from"../chunks/input.CQDk-SFX.js";import{p as z}from"../chunks/proxy.D-58ufVl.js";import{s as Ge,a as He}from"../chunks/store.D2tkwa9F.js";import{o as Ke}from"../chunks/index-client.DT-fMr9Z.js";import{s as L}from"../chunks/supabaseClient.CaMOPPuz.js";import{p as Ye}from"../chunks/stores.DWte6y18.js";import{g as Be}from"../chunks/entry.SSTTWxxn.js";import{E as Qe,a as Ze}from"../chunks/jspdf.plugin.autotable.4s0l0uhg.js";import{C as Je}from"../chunks/chevron-left.OWvxCM_q.js";import{P as Re}from"../chunks/plus.WugTGZSv.js";import{I as ye,s as $e}from"../chunks/Icon.BPJo08Fo.js";import{l as we,s as Pe}from"../chunks/props.BD0jg91j.js";import{S as Ue}from"../chunks/search.4XRWJUve.js";function We(u,n){const d=we(n,["children","$$slots","$$events","$$legacy"]);ye(u,Pe({name:"file-down"},()=>d,{iconNode:[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}],["path",{d:"M12 18v-6"}],["path",{d:"m9 15 3 3 3-3"}]],children:(v,f)=>{var s=be(),y=J(s);$e(y,n,"default",{}),x(v,s)},$$slots:{default:!0}}))}function Xe(u,n){const d=we(n,["children","$$slots","$$events","$$legacy"]);ye(u,Pe({name:"pen"},()=>d,{iconNode:[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}]],children:(v,f)=>{var s=be(),y=J(s);$e(y,n,"default",{}),x(v,s)},$$slots:{default:!0}}))}const et=async(u,n,d,g)=>{if(e(n)){const{error:v}=await L.from("strategic_objectives").update(e(d)).eq("id",e(n).id);v?console.error("Error updating objective:",v):(g(),_(n,null))}},tt=(u,n,d,g,v,f)=>{const s=new Qe("landscape","mm","a4");s.setFontSize(18),s.text("Strategic Objectives",14,20),e(n)&&(s.setFontSize(12),s.text(`Goal Name: ${e(n).name}`,14,30),s.text(`Lead: ${e(n).lead}`,14,37));const y=e(d).map(k=>[k.name,k.strategic_initiatives,k.kpi,k.persons_involved,k.target,k.eval_measures]);Ze(s,{head:[["Strategic Objectives","Strategic Initiatives","KPI","Persons Involved","Target","Evaluation Measures"]],body:y,startY:58,theme:"grid",styles:{fontSize:10}});const p=s.internal.pageSize.height-30;s.setFontSize(12);const R=e(g)||"Admin Name",j=e(v)||"Vice President Name",i=e(f)||"President Name";s.text(`${R}(sgnd)`,14,p-5),s.text("_________________________",14,p),s.text("Corporate Planning Officer",14,p+5),s.text(`${j}`,100,p-5),s.text("_________________________",100,p),s.text("Vice President",100,p+5),s.text(`${i}`,180,p-5),s.text("_________________________",180,p),s.text("President",180,p+5),s.save("StrategicObjectives.pdf")};var at=S('<div class="flex justify-center items-center min-h-[200px]"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),rt=S('<div class="mt-2 text-muted-foreground"><p><span class="font-medium text-foreground">Goal Name:</span> </p> <p><span class="font-medium text-foreground">Lead:</span> </p></div>'),st=(u,n)=>_(n,null),ot=S('<td class="px-4 py-3"><textarea class="textarea textarea-bordered w-full svelte-1n9y17z" rows="3"></textarea></td> <td class="px-4 py-3"><textarea class="textarea textarea-bordered w-full svelte-1n9y17z" rows="3"></textarea></td> <td class="px-4 py-3"><textarea class="textarea textarea-bordered w-full svelte-1n9y17z" rows="3"></textarea></td> <td class="px-4 py-3"><textarea class="textarea textarea-bordered w-full svelte-1n9y17z" rows="3"></textarea></td> <td class="px-4 py-3"><textarea class="textarea textarea-bordered w-full svelte-1n9y17z" rows="3"></textarea></td> <td class="px-4 py-3"><textarea class="textarea textarea-bordered w-full svelte-1n9y17z" rows="3"></textarea></td> <td class="px-4 py-3"><div class="flex flex-col gap-2"><button class="btn btn-primary btn-sm">Save</button> <button class="btn btn-ghost btn-sm">Cancel</button></div></td>',1),nt=(u,n,d)=>n(e(d).id),it=(u,n,d,g)=>{_(n,z(e(d))),_(g,z({...e(d)}))},lt=S('<td class="px-4 py-3"> </td> <td class="px-4 py-3"> </td> <td class="px-4 py-3"> </td> <td class="px-4 py-3"> </td> <td class="px-4 py-3"> </td> <td class="px-4 py-3"> </td> <td class="px-4 py-3"><div class="flex justify-center gap-2"><button class="btn btn-primary btn-sm">View Plans</button> <button class="btn btn-ghost btn-sm"><!></button></div></td>',1),dt=S("<tr><!></tr>"),ct=S('<div class="relative"><!> <input type="text" placeholder="Search objectives..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left">Strategic Objectives</th><th class="px-4 py-3 text-left">Strategic Initiatives</th><th class="px-4 py-3 text-left">KPI</th><th class="px-4 py-3 text-left">Persons Involved</th><th class="px-4 py-3 text-left">Target</th><th class="px-4 py-3 text-left">Evaluation Measures</th><th class="px-4 py-3 text-center">Actions</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div>',1),_t=S('<div class="text-center py-12 bg-card rounded-lg border border-border"><p class="text-muted-foreground mb-4">No objectives found for this goal.</p> <a href="/plans/strategicPlans" class="btn btn-primary">Add Strategic Objectives</a></div>'),vt=S('<div class="flex flex-col gap-6"><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div><a href="/plans" class="flex items-center gap-2 text-muted-foreground mb-2 hover:text-foreground"><!> Back to Goals</a> <h1 class="text-3xl font-bold"> </h1> <!></div> <div class="flex flex-col sm:flex-row gap-2"><a href="/plans/strategicPlans" class="btn btn-primary flex items-center gap-2"><!> Add Objectives</a> <button class="btn btn-secondary flex items-center gap-2"><!> Export PDF</button></div></div> <!></div>'),pt=S('<div class="container mx-auto p-4"><!></div>');function Ct(u,n){Ce(n,!0);const d=Ge(),g=()=>He(Ye,"$page",d);let v=b(""),f=b(null),s=b(z([])),y=b(!1),O=b(null),ie=b(null),p=b(null),R=b(null),j=b(null),i=b(z({}));const k=async()=>{try{const{data:{session:t}}=await L.auth.getSession();if(!t||!t.user)return;const{data:l,error:m}=await L.from("profiles").select("first_name, last_name").eq("id",t.user.id).single();m?console.error("Error fetching admin name:",m):l&&_(ie,`${l.first_name} ${l.last_name}`)}catch(t){console.error("Error fetching admin details:",t)}},ze=async()=>{try{const{data:t,error:l}=await L.from("profiles").select("first_name, last_name, role").in("role",["vice_president","president"]);if(l){console.error("Error fetching VP and President names:",l);return}const m=t==null?void 0:t.find(h=>h.role==="vice_president"),$=t==null?void 0:t.find(h=>h.role==="president");_(p,z(m?`${m.first_name} ${m.last_name}`:"N/A")),_(R,z($?`${$.first_name} ${$.last_name}`:"N/A"))}catch(t){console.error("Error fetching VP and President details:",t)}},xe=async()=>{if(e(O)!==null){_(y,!0);try{const{data:t,error:l}=await L.from("strategic_goals").select("id, name, goal_no, lead_id").eq("id",e(O)).single();if(l||!t)throw new Error("Failed to fetch goal details");if(_(f,z({id:t.id,name:t.name,goal_no:t.goal_no,lead:""})),t.lead_id){const{data:h,error:U}=await L.from("leads").select("name").eq("id",t.lead_id).single();U?console.error("Error fetching lead name:",U):h&&(e(f).lead=h.name)}const{data:m,error:$}=await L.from("strategic_objectives").select("*").eq("strategic_goal_id",e(O));if($)throw new Error("Failed to fetch objectives");_(s,z(m||[]))}catch(t){console.error(t)}finally{_(y,!1)}}},Se=t=>{e(O)!==null&&Be(`/plans/${e(O)}/${t}`)};Ke(()=>{_(O,z(g().params.id?parseInt(g().params.id):null)),xe(),k(),ze()});const ke=Te(()=>e(s).filter(t=>`${t.name} ${t.strategic_initiatives} ${t.kpi} ${t.persons_involved}`.toLowerCase().includes(e(v).toLowerCase())));var le=pt(),Ne=r(le);ne(Ne,()=>e(y),t=>{var l=at();x(t,l)},t=>{var l=vt(),m=r(l),$=r(m),h=r($),U=r(h);Je(U,{size:20}),fe(),a(h);var de=o(h,2),Ee=r(de);a(de);var Oe=o(de,2);ne(Oe,()=>e(f),N=>{var E=rt(),F=r(E),W=o(r(F));a(F);var H=o(F,2),X=o(r(H));a(H),a(E),me(()=>{P(W,` ${e(f).name??""}`),P(X,` ${e(f).lead??""}`)}),x(N,E)}),a($);var ue=o($,2),ce=r(ue),Fe=r(ce);Re(Fe,{size:20}),fe(),a(ce);var _e=o(ce,2);_e.__click=[tt,f,s,ie,p,R];var De=r(_e);We(De,{size:20}),fe(),a(_e),a(ue),a(m);var Ie=o(m,2);ne(Ie,()=>e(s).length>0,N=>{var E=ct(),F=J(E),W=r(F);Ue(W,{class:`absolute left\r
\r
-3 top-1/2 transform -translate-y-1/2 text-muted-foreground`,size:20});var H=o(W,2);qe(H),a(F);var X=o(F,2),ge=r(X),he=o(r(ge));Ve(he,21,()=>e(ke),Le,(ve,w)=>{var pe=dt(),Ae=r(pe);ne(Ae,()=>{var q;return((q=e(j))==null?void 0:q.id)===e(w).id},q=>{var K=ot(),D=J(K),ee=r(D);G(ee),a(D);var I=o(D,2),te=r(I);G(te),a(I);var A=o(I,2),ae=r(A);G(ae),a(A);var C=o(A,2),re=r(C);G(re),a(C);var M=o(C,2),se=r(M);G(se),a(M);var T=o(M,2),oe=r(T);G(oe),a(T);var Y=o(T,2),B=r(Y),Q=r(B);Q.__click=[et,j,i,xe];var Z=o(Q,2);Z.__click=[st,j],a(B),a(Y),V(ee,()=>e(i).name,c=>e(i).name=c),V(te,()=>e(i).strategic_initiatives,c=>e(i).strategic_initiatives=c),V(ae,()=>e(i).kpi,c=>e(i).kpi=c),V(re,()=>e(i).persons_involved,c=>e(i).persons_involved=c),V(se,()=>e(i).target,c=>e(i).target=c),V(oe,()=>e(i).eval_measures,c=>e(i).eval_measures=c),x(q,K)},q=>{var K=lt(),D=J(K),ee=r(D,!0);a(D);var I=o(D,2),te=r(I,!0);a(I);var A=o(I,2),ae=r(A,!0);a(A);var C=o(A,2),re=r(C,!0);a(C);var M=o(C,2),se=r(M,!0);a(M);var T=o(M,2),oe=r(T,!0);a(T);var Y=o(T,2),B=r(Y),Q=r(B);Q.__click=[nt,Se,w];var Z=o(Q,2);Z.__click=[it,j,w,i];var c=r(Z);Xe(c,{size:18}),a(Z),a(B),a(Y),me(()=>{P(ee,e(w).name),P(te,e(w).strategic_initiatives),P(ae,e(w).kpi),P(re,e(w).persons_involved),P(se,e(w).target),P(oe,e(w).eval_measures)}),x(q,K)}),a(pe),x(ve,pe)}),a(he),a(ge),a(X),V(H,()=>e(v),ve=>_(v,ve)),x(N,E)},N=>{var E=_t();x(N,E)}),a(l),me(()=>{var N;return P(Ee,`Strategic Objectives for Goal ${((N=e(f))==null?void 0:N.goal_no)??""}`)}),x(t,l)}),a(le),x(u,le),Me()}je(["click"]);export{Ct as component};

import"../chunks/disclose-version.Bg9kRutz.js";import{p as G,b as E,a as L,m as A,c as i,r,s as y,n as te,t as z,g as t,f as N,i as re,ad as Y}from"../chunks/utils.Cx6K9qTo.js";import{a as b,t as w,b as F,g as ae,e as W}from"../chunks/store.BALTJZ26.js";import{i as T}from"../chunks/if.Bgpzl8Wa.js";import{i as j}from"../chunks/lifecycle.D0tpf3vC.js";import{p as oe}from"../chunks/preload-helper.Tg4Km7Zr.js";/* empty css                         */import"../chunks/entry.CMKkUr-m.js";import{s as U}from"../chunks/Icon.Nl6wOSVO.js";import{e as q,i as H}from"../chunks/attributes.rzeD2olC.js";import{o as P}from"../chunks/index-client.lWLCSZVk.js";import{b as V}from"../chunks/this.DKiYVa2M.js";import{C as Z,a as se}from"../chunks/auto.w1CHRZhd.js";import{b as ie}from"../chunks/select.BtlRD387.js";import{s as I}from"../chunks/class.DKwifj_X.js";const x={cards:[{title:"Strategic Goals",value:"0",change:12.5,icon:"🎯"},{title:"Unmitigated Risks",value:"0",change:-2.4,icon:"⚠️"},{title:"Opportunities",value:"0",change:8.2,icon:"💡"},{title:"Users",value:"0",change:5.1,icon:"👥"}],barChart:{goals:["Strategic Goal 1","Strategic Goal 2","Strategic Goal 3","Strategic Goal 4","Strategic Goal 5"],achieved:[75,60,85,45,65],notAchieved:[25,40,15,55,35]},riskData:{categories:["Manpower","Financial","Technical","Operational"],datasets:{manpower:[30,50,20],financial:[45,35,20],technical:[25,45,30],operational:[35,40,25]}},recentEvents:[{title:"New project milestone achieved",time:"2 hours ago",type:"success"},{title:"System maintenance scheduled",time:"5 hours ago",type:"warning"},{title:"Server capacity reached 90%",time:"8 hours ago",type:"error"},{title:"New team member onboarded",time:"1 day ago",type:"success"}]},ne=async()=>{try{const{data:n,error:d}=await U.from("strategic_goals").select("id");if(d)throw d;const e=n.length;x.cards[0].value=`${e}`}catch(n){console.error("Error updating strategic goals count:",n),x.cards[0].value="0 Goals"}},le=async()=>{try{const{data:n,error:d}=await U.from("risk_monitoring").select("id",{count:"exact"}).eq("is_achieved",!1);if(d)throw d;const e=n.length;x.cards[1].value=`${e}`}catch(n){console.error("Error updating unmitigated risks count:",n),x.cards[1].value="0 Risks"}},ce=async()=>{try{const{data:n,error:d}=await U.from("opportunities").select("id");if(d)throw d;const e=n.length;x.cards[2].value=`${e}`}catch(n){console.error("Error updating opportunities count:",n),x.cards[2].value="0 Opportunities"}},de=async()=>{try{const{data:n,error:d}=await U.from("profiles").select("id");if(d)throw d;const e=n.length;x.cards[3].value=`${e}`}catch(n){console.error("Error updating users count:",n),x.cards[3].value="0 Users"}};var ve=w('<div class="group relative overflow-hidden rounded-lg border border-border p-4 hover:shadow-lg transition-all duration-300 hover:-translate-y-1"><div class="flex items-center justify-between"><div><p class="text-sm font-medium text-gray-500"> </p> <p class="mt-2 text-3xl font-bold text-gray-900"> </p></div> <div class="rounded-xl bg-blue-50 p-4 text-2xl text-blue-600 transition-transform duration-300 group-hover:rotate-12"> </div></div> <div class="mt-4"></div></div>'),ge=w('<div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4"></div>');function J(n,d){G(d,!1);let e=A(x.cards);P(async()=>{await ne(),await le(),await ce(),await de(),E(e,[...x.cards])}),j();var a=ge();q(a,5,()=>t(e),H,(s,u)=>{var p=ve(),h=i(p),_=i(h),o=i(_),g=i(o,!0);r(o);var v=y(o,2),l=i(v,!0);r(v),r(_);var c=y(_,2),m=i(c,!0);r(c),r(h),te(2),r(p),z(()=>{F(g,t(u).title),F(l,t(u).value),F(m,t(u).icon)}),b(s,p)}),r(a),b(n,a),L()}var ue=w('<div class="relative h-[400px] w-full"><canvas></canvas></div>');function K(n,d){G(d,!1);let e=A(),a,s={goals:[],achieved:[],notAchieved:[]};const u=async()=>{try{console.log("Starting to fetch strategic goals...");const{data:v,error:l}=await U.from("strategic_goals").select(`
					id,
					goal_no,
					name,
					strategic_objectives (
						id,
						name,
						action_plans (
							id,
							plan_monitoring (
								id,
								is_accomplished
							)
						)
					)
				`);if(l){console.error("Error fetching strategic goals:",l);return}console.log("Raw data fetched:",v);const c=v.map(m=>{console.log(`Processing goal: ${m.name}`);const k=m.strategic_objectives.flatMap(C=>C.action_plans.flatMap(S=>S.plan_monitoring.filter(D=>D.is_accomplished))).length,f=m.strategic_objectives.flatMap(C=>C.action_plans.flatMap(S=>S.plan_monitoring.filter(D=>!D.is_accomplished))).length;return console.log(`Goal: ${m.name}, Achieved: ${k}, Not Achieved: ${f}`),{goal_no:m.goal_no,name:m.name,achieved:k,notAchieved:f}});console.log("Processed data for chart:",c),s.goals=c.map(m=>`Strategic Goal No. ${m.goal_no}`),s.achieved=c.map(m=>m.achieved),s.notAchieved=c.map(m=>m.notAchieved),console.log("Final chart data:",s)}catch(v){console.error("Error processing strategic data:",v)}},p=()=>{const v=t(e).getContext("2d");v&&(a&&a.destroy(),a=new Z(v,{type:"bar",data:{labels:s.goals,datasets:[{label:"Achieved",data:s.achieved,backgroundColor:"#e21d48",borderColor:"#e21d48",borderWidth:1,barThickness:100,maxBarThickness:150},{label:"Not Achieved",data:s.notAchieved,backgroundColor:"#e5e7eb",borderColor:"#e5e7eb",borderWidth:1,barThickness:100,maxBarThickness:150}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}},scales:{x:{stacked:!0,ticks:{autoSkip:!1}},y:{stacked:!0,beginAtZero:!0,ticks:{callback:l=>`${l}`}}}}}))};let h;const _=()=>{clearTimeout(h),h=setTimeout(()=>{p()},250)};P(()=>((async()=>{console.log("Initializing chart..."),await u(),p()})(),window.addEventListener("resize",_),()=>{window.removeEventListener("resize",_),a&&a.destroy()})),j();var o=ue(),g=i(o);V(g,v=>E(e,v),()=>t(e)),r(o),b(n,o),L()}var pe=w('<div class="text-center"><span class="loading loading-spinner text-primary"></span> <p>Loading risk data...</p></div>'),me=w("<option> </option>"),he=w('<div class="flex justify-between items-center mb-6"><p class="text-gray-800 font-medium">Classification:</p> <div class="relative w-full sm:w-1/3 lg:w-1/4"><select class="appearance-none w-full rounded-lg border border-gray-200 bg-gray-50 px-4 py-2 pr-10 text-sm font-medium text-gray-600 transition-colors hover:bg-gray-100 focus:border-blue-500 focus:outline-none"></select> <!></div></div> <div class="h-[300px]"><canvas></canvas></div>',1),fe=w('<div class="rounded-lg border border-border p-4 hover:shadow-lg transition-all duration-300"><h2 class="mb-6 text-xl font-semibold text-gray-800">Risk Analysis</h2> <!></div>');function Q(n,d){G(d,!1);let e=A([]),a=A(""),s={},u=A(),p=null,h=A(!0);const _=async()=>{try{const{data:l,error:c}=await U.from("classification").select("name");if(c)throw c;E(e,l.map(f=>f.name)),s=t(e).reduce((f,C)=>(f[C]={low:0,medium:0,high:0,very_high:0},f),{});const{data:m,error:k}=await U.from("risk_monitoring").select(`
					control_rating_id ( name ),
					risks ( classification ( name ) )
				`);if(k)throw k;m.forEach(f=>{var D,$,R;const C=(($=(D=f.risks)==null?void 0:D.classification)==null?void 0:$.name)||"Unknown",S=(R=f.control_rating_id)==null?void 0:R.name.toLowerCase();s[C]&&S&&s[C][S]!==void 0&&(s[C][S]+=1)}),t(e).length>0&&E(a,t(e)[0])}catch(l){console.error("Error fetching risk data:",l)}finally{E(h,!1),o()}},o=()=>{if(!t(u))return;const l=t(u).getContext("2d");if(!l)return;p&&p.destroy();const c=s[t(a)]||{low:0,medium:0,high:0,very_high:0};p=new Z(l,{type:"doughnut",data:{labels:["Low Risk","Medium Risk","High Risk","Very High Risk"],datasets:[{data:[c.low,c.medium,c.high,c.very_high],backgroundColor:["#34C759","#FFCC00","#FF9500","#FF3B30"],borderWidth:2,borderColor:"#ffffff"}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"65%",plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0}}}}})};P(()=>{_()}),j();var g=fe(),v=y(i(g),2);T(v,()=>t(h),l=>{var c=pe();b(l,c)},l=>{var c=he(),m=N(c),k=y(i(m),2),f=i(k);z(()=>{t(a),re(()=>{t(e)})}),q(f,5,()=>t(e),H,($,R)=>{var M=me(),O={},B=i(M,!0);r(M),z(()=>{O!==(O=t(R))&&(M.value=(M.__value=t(R))==null?"":t(R)),F(B,t(R))}),b($,M)}),r(f);var C=y(f,2);se(C,{class:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-500 pointer-events-none"}),r(k),r(m);var S=y(m,2),D=i(S);V(D,$=>E(u,$),()=>t(u)),r(S),ie(f,()=>t(a),$=>E(a,$)),ae("change",f,o),b(l,c)}),r(g),b(n,g),L()}var _e=w('<div class="text-center"><span class="loading loading-spinner text-primary"></span> <p>Loading recent events...</p></div>'),be=w('<div><div></div> <div class="flex-1"><p class="font-medium text-gray-800"> </p> <p class="text-sm text-gray-500"> </p></div></div>'),ye=w('<div class="space-y-4"></div>'),xe=w('<p class="text-gray-400">No recent events to display.</p>'),we=w('<div class="rounded-lg border border-border p-4 hover:shadow-lg transition-all duration-300"><h2 class="mb-6 text-xl font-semibold text-gray-800">Recent Events</h2> <!></div>');function X(n,d){G(d,!1);let e=A([]),a=A(!0);const s=o=>{switch(o){case"warning":return"bg-yellow-50 border-yellow-100";case"error":return"bg-red-50 border-red-100";default:return"bg-green-50 border-green-100"}},u=o=>{switch(o){case"warning":return"bg-yellow-400";case"error":return"bg-red-400";default:return"bg-green-400"}},p=async()=>{E(a,!0);try{const{data:o,error:g}=await U.from("recent_events").select("description, created_at, event_type").order("created_at",{ascending:!1}).limit(5);g?(console.error("Error fetching recent events:",g),E(e,[])):E(e,o||[])}catch(o){console.error("Unexpected error fetching recent events:",o),E(e,[])}finally{E(a,!1)}};P(()=>{p()}),j();var h=we(),_=y(i(h),2);T(_,()=>t(a),o=>{var g=_e();b(o,g)},o=>{var g=W(),v=N(g);T(v,()=>t(e).length>0,l=>{var c=ye();q(c,5,()=>t(e),H,(m,k)=>{var f=be();const C=Y(()=>`flex items-center gap-4 rounded-lg border p-4 transition-all duration-300 hover:-translate-x-1 ${s(t(k).event_type)}`);var S=i(f);const D=Y(()=>`h-3 w-3 rounded-full ${u(t(k).event_type)}`);var $=y(S,2),R=i($),M=i(R,!0);r(R);var O=y(R,2),B=i(O,!0);z(()=>F(B,new Date(t(k).created_at).toLocaleString())),r(O),r($),r(f),z(()=>{I(f,t(C)),I(S,t(D)),F(M,t(k).description)}),b(m,f)}),r(c),b(l,c)},l=>{var c=xe();b(l,c)},!0),b(o,g)}),r(h),b(n,h),L()}var ke=w('<header class="flex flex-col gap-4 rounded-xle p-6 shadow-sm sm:flex-row sm:items-center sm:justify-between"><div><h1 class="text-2xl font-bold">Welcome</h1> <p class="mt-1 text-sm "></p> <p class="mt-1 text-sm"> </p></div></header>');function ee(n,d){G(d,!1);const e=new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});let a=A(null);async function s(){try{const g=new Date().toISOString().split("T")[0],{data:v,error:l}=await U.from("school_years").select("school_year").lte("start_date",g).gte("end_date",g).single();l?(console.error("Error fetching school year:",l),E(a,"Unknown")):E(a,(v==null?void 0:v.school_year)||"Unknown")}catch(g){console.error("Unexpected error fetching school year:",g),E(a,"Unknown")}}s(),j();var u=ke(),p=i(u),h=y(i(p),2);h.textContent=e;var _=y(h,2),o=i(_);r(_),r(p),r(u),z(()=>F(o,`Current School Year: ${(t(a)||"Loading...")??""}`)),b(n,u),L()}var Ce=w('<main class=" min-h-screen  p-4 md:p-6 container mx-auto "><div class="mx-auto max-w-7xl space-y-8"><!> <!> <div class="rounded-lg border border-border p-4 hover:shadow-lg transition-all duration-300 "><h2 class="mb-6 text-xl font-semibold text-gray-800">Strategic Goal Overiew</h2> <!></div> <div class="grid gap-8 lg:grid-cols-2"><!> <!></div></div></main>');function Ee(n,d){G(d,!1),j();var e=Ce(),a=i(e),s=i(a);ee(s,{});var u=y(s,2);J(u,{get data(){return x.cards}});var p=y(u,2),h=y(i(p),2);K(h,{get data(){return x.barChart}}),r(p);var _=y(p,2),o=i(_);Q(o,{get data(){return x.riskData}});var g=y(o,2);X(g,{get events(){return x.recentEvents}}),r(_),r(a),r(e),b(n,e),L()}var Se=w('<main class=" min-h-screen  p-4 md:p-6 container mx-auto "><div class="mx-auto max-w-7xl space-y-8"><!> <!> <div class="rounded-lg border border-border p-4 hover:shadow-lg transition-all duration-300 "><h2 class="mb-6 text-xl font-semibold text-gray-800">Strategic Goal Overiew</h2> <!></div> <div class="grid gap-8 lg:grid-cols-2"><!> <!></div></div></main>');function $e(n,d){G(d,!1),j();var e=Se(),a=i(e),s=i(a);ee(s,{});var u=y(s,2);J(u,{get data(){return x.cards}});var p=y(u,2),h=y(i(p),2);K(h,{get data(){return x.barChart}}),r(p);var _=y(p,2),o=i(_);Q(o,{get data(){return x.riskData}});var g=y(o,2);X(g,{get events(){return x.recentEvents}}),r(_),r(a),r(e),b(n,e),L()}var De=w('<div class="flex flex-col items-center justify-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),Re=w('<div class="w-full"><!></div>'),Ae=w('<div class="min-h-screen "><div class="flex flex-col items-center justify-center w-full h-full"><div class="w-full "><!></div></div></div>');function Ye(n,d){G(d,!1);let e=oe(d,"data",8);const{session:a}=e();let s=A(null),u=A(!0);(async()=>{if(a){const{user:v}=a,{data:l,error:c}=await U.from("profiles").select("first_name, last_name, role, profile_pic").eq("id",v.id).single();c?console.error("Error fetching user profile:",c.message):E(s,l)}E(u,!1)})(),j();var h=Ae(),_=i(h),o=i(_),g=i(o);T(g,()=>t(u),v=>{var l=De();b(v,l)},v=>{var l=W(),c=N(l);T(c,()=>a!==null&&t(s),m=>{var k=Re(),f=i(k);T(f,()=>t(s).role==="admin"||t(s).role==="vice_president"||t(s).role==="president",C=>{Ee(C,{})},C=>{var S=W(),D=N(S);T(D,()=>t(s).role==="user",$=>{$e($,{})},null,!0),b(C,S)}),r(k),b(m,k)},null,!0),b(v,l)}),r(o),r(_),r(h),b(n,h),L()}export{Ye as component};

import"../chunks/disclose-version.Bg9kRutz.js";import{f as Ge,p as se,c as a,r,t as R,s as o,a as oe,g as e,e as _,b as c,n as Ee,h as B}from"../chunks/utils.Cx6K9qTo.js";import{e as vt,a as x,d as He,t as h,b as F,g as mt}from"../chunks/store.BALTJZ26.js";import{i as _t}from"../chunks/lifecycle.D0tpf3vC.js";import{o as pt}from"../chunks/index-client.lWLCSZVk.js";/* empty css                         */import{I as ft,a as bt,s as X,b as gt}from"../chunks/Icon.Nl6wOSVO.js";import{i as G}from"../chunks/if.Bgpzl8Wa.js";import{s as xt,r as De,e as je,i as Je}from"../chunks/attributes.rzeD2olC.js";import{s as Xe}from"../chunks/class.DKwifj_X.js";import{b as Ne}from"../chunks/input.BVFrb_g3.js";import{b as Y}from"../chunks/select.BtlRD387.js";import{l as yt,s as ht,a as N}from"../chunks/preload-helper.Tg4Km7Zr.js";import{P as wt}from"../chunks/pencil.Brzv4RaD.js";import{T as kt}from"../chunks/trash-2.d9YwO6MY.js";import{A as ae}from"../chunks/arrow-up-down.CZ0J7o1e.js";import{S as At}from"../chunks/search.BpYLThKw.js";import{D as Ut}from"../chunks/download.K4Jw1XP8.js";import{X as St}from"../chunks/x.D9PBK57y.js";function Et(p,t){const u=yt(t,["children","$$slots","$$events","$$legacy"]);ft(p,ht({name:"user-round"},()=>u,{iconNode:[["circle",{cx:"12",cy:"8",r:"5"}],["path",{d:"M20 21a8 8 0 0 0-16 0"}]],children:(w,y)=>{var f=vt(),v=Ge(f);bt(v,t,"default",{}),x(w,f)},$$slots:{default:!0}}))}var Dt=h('<img alt="Profile" class="w-10 h-10 rounded-full object-cover">'),jt=h('<div class="w-10 h-10 rounded-full bg-secondary flex items-center justify-center text-muted-foreground"> </div>'),Nt=h('<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">Verified</span>'),Ft=h('<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">Not Verified</span>'),Pt=(p,t)=>t.onEdit(t.user),zt=(p,t)=>t.onApprove(t.user.id),Rt=h('<button class="p-1 rounded-lg bg-green-500 text-white hover:bg-green-600 disabled:opacity-50"> </button>'),Vt=(p,t)=>t.onDelete(t.user.id),qt=h('<tr class="hover:bg-muted/50"><td class="px-4 py-2"><!></td><td class="px-4 py-2"> </td><td class="px-4 py-2 hidden md:table-cell"> </td><td class="px-4 py-2 hidden sm:table-cell"> </td><td class="px-4 py-2"> </td><td class="px-4 py-2"><!></td><td class="px-4 py-2"><div class="flex items-center gap-2"><button class="p-1 hover:bg-muted rounded-lg text-muted-foreground hover:text-foreground" title="Edit user"><!></button> <!> <button class="p-1 hover:bg-red-100 rounded-lg text-red-500 hover:text-red-600 disabled:opacity-50" title="Delete user"><!></button></div></td></tr>');function Ct(p,t){se(t,!0);var u=qt(),g=a(u),w=a(g);G(w,()=>t.user.profile_pic,E=>{var l=Dt();R(()=>xt(l,"src",t.user.profile_pic)),x(E,l)},E=>{var l=jt(),m=a(l);r(l),R(()=>F(m,`${t.user.first_name[0]??""}${t.user.last_name[0]??""}`)),x(E,l)}),r(g);var y=o(g),f=a(y);r(y);var v=o(y),k=a(v,!0);r(v);var b=o(v),U=a(b,!0);r(b);var S=o(b),P=a(S,!0);r(S);var V=o(S),T=a(V);G(T,()=>t.user.is_verified,E=>{var l=Nt();x(E,l)},E=>{var l=Ft();x(E,l)}),r(V);var q=o(V),I=a(q),D=a(I);D.__click=[Pt,t];var L=a(D);wt(L,{size:16}),r(D);var C=o(D,2);G(C,()=>!t.user.is_verified,E=>{var l=Rt();l.__click=[zt,t];var m=a(l,!0);r(l),R(()=>{l.disabled=t.approvingUserId===t.user.id,F(m,t.approvingUserId===t.user.id?"Approving...":"Approve")}),x(E,l)});var j=o(C,2);j.__click=[Vt,t];var O=a(j);kt(O,{size:16}),r(j),r(I),r(q),r(u),R(()=>{F(f,`${t.user.first_name??""} ${t.user.last_name??""}`),F(k,t.user.email),F(U,t.user.role),F(P,t.user.department_name||"N/A"),j.disabled=t.deletingUserId===t.user.id}),x(p,u),oe()}He(["click"]);var It=h("<option> </option>"),Tt=h('<div><label for="department" class="block text-sm font-medium mb-1">Department</label> <select id="department" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required><option>Select Department</option><!></select></div>'),Lt=h('<form class="space-y-4"><h3 class="text-lg font-semibold"> </h3> <div><label for="first_name" class="block text-sm font-medium mb-1">First Name</label> <input id="first_name" type="text" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required></div> <div><label for="last_name" class="block text-sm font-medium mb-1">Last Name</label> <input id="last_name" type="text" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required></div> <div><label for="role" class="block text-sm font-medium mb-1">Role</label> <select id="role" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required><option>Select Role</option><option>Admin</option><option>User</option><option>Vice President</option><option>President</option></select></div> <!> <div class="flex justify-end gap-2 pt-4"><button type="submit" class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"> </button></div></form>');function Mt(p,t){se(t,!0);let u=N(t.user?{first_name:t.user.first_name,last_name:t.user.last_name,role:t.user.role,department_id:t.user.department_id}:{first_name:"",last_name:"",role:"",department_id:""});const g=["admin","vice_president","president"],w=l=>{l.preventDefault(),t.onSave(u)};var y=Lt(),f=a(y),v=a(f);r(f);var k=o(f,2),b=o(a(k),2);De(b),r(k);var U=o(k,2),S=o(a(U),2);De(S),r(U);var P=o(U,2),V=o(a(P),2),T=a(V);T.value=((T.__value="")==null,"");var q=o(T);q.value=(q.__value="admin")==null?"":"admin";var I=o(q);I.value=(I.__value="user")==null?"":"user";var D=o(I);D.value=(D.__value="vice_president")==null?"":"vice_president";var L=o(D);L.value=(L.__value="president")==null?"":"president",r(V),r(P);var C=o(P,2);G(C,()=>u.role&&!g.includes(u.role),l=>{var m=Tt(),H=o(a(m),2),M=a(H);M.value=((M.__value="")==null,"");var ie=o(M);je(ie,17,()=>t.departments,Je,(J,W)=>{var Q=It(),Z={},le=a(Q,!0);r(Q),R(()=>{Z!==(Z=e(W).id)&&(Q.value=(Q.__value=e(W).id)==null?"":e(W).id),F(le,e(W).name)}),x(J,Q)}),r(H),r(m),Y(H,()=>u.department_id,J=>u.department_id=J),x(l,m)});var j=o(C,2),O=a(j),E=a(O,!0);r(O),r(j),r(y),R(()=>{F(v,`${(t.user?"Edit":"Add")??""} User`),O.disabled=t.saving,F(E,t.saving?"Saving...":"Save")}),mt("submit",y,w),Ne(b,()=>u.first_name,l=>u.first_name=l),Ne(S,()=>u.last_name,l=>u.last_name=l),Y(V,()=>u.role,l=>u.role=l),x(p,y),oe()}var Wt=h("<div><div><span> </span></div></div>"),Bt=(p,t)=>c(t,!e(t)),Ot=h("<option> </option>"),Qt=h('<div class="flex justify-center p-8 "><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),Xt=(p,t)=>t("first_name"),Gt=(p,t)=>t("email"),Ht=(p,t)=>t("role"),Jt=(p,t)=>c(t,e(t)-1),Kt=(p,t)=>c(t,e(t)+1),Yt=h('<div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left">Profile</th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Name <!></button></th><th class="px-4 py-3 text-left hidden md:table-cell"><button class="flex items-center gap-1 hover:text-primary">Email <!></button></th><th class="px-4 py-3 text-left hidden sm:table-cell"><button class="flex items-center gap-1 hover:text-primary">Role <!></button></th><th class="px-4 py-3 text-left">Department</th><th class="px-4 py-3 text-left">Status</th><th class="px-4 py-3 text-left w-[100px]">Actions</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4"><div class="text-sm text-muted-foreground text-center sm:text-left"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary border-secondary rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-ring w-full sm:w-auto"><option>5 per page</option><option>10 per page</option><option>25 per page</option><option>50 per page</option></select> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Next</button></div></div></div>',1),Zt=h('<div class="fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 overflow-y-auto"><div class="bg-card p-6 rounded-lg w-full max-w-md relative border border-border"><button class="absolute right-4 top-4 p-1 hover:bg-muted rounded-lg"><!></button> <!></div></div>'),$t=h('<div class="flex flex-col gap-4 container mx-auto"><!> <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div class="flex items-center gap-2"><!> <h1 class="text-2xl font-bold">User Management</h1></div></div> <button class="md:hidden w-full px-4 py-2 bg-secondary rounded-lg text-left flex justify-between items-center">Filters <!></button> <div><div class="flex flex-col md:flex-row gap-4 w-full md:w-auto"><div class="relative flex-1 md:w-[300px]"><!> <input type="text" placeholder="Search users..." class="pl-10 pr-4 py-2 bg-secondary border-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <select class="bg-secondary border-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring w-full md:w-[150px]"><option>All Status</option><option>Verified</option><option>Not Verified</option></select> <select class="bg-secondary border-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring w-full md:w-[150px]"><option>All Roles</option><!></select></div> <div class="flex gap-2 w-full md:w-auto"><button class="flex items-center gap-2 bg-secondary text-foreground px-4 py-2 rounded-lg hover:bg-secondary/80 justify-center flex-1 md:flex-initial whitespace-nowrap"><!> Export</button></div></div> <!> <!></div>');function er(p,t){se(t,!0);let u=_(""),g=_(1),w=_(5),y=_(!1),f=_(null),v=_("first_name"),k=_("asc"),b=_("all"),U=_("all"),S=_(!1),P=_(!1),V=_(""),T=_("success"),q=_(!1),I=_(!0),D=_(null),L=_(null),C=_(N([])),j=_(N([]));const O=async()=>{await E(),await l(),c(I,!1)};async function E(){const{data:s,error:i}=await X.from("departments").select("id, name");i?m("Error fetching departments: "+i.message,"error"):c(j,N(s||[]))}async function l(){const{data:s,error:i}=await X.from("profiles").select("id, first_name, last_name, email, role, department_id, profile_pic, is_verified");i?m("Error fetching users: "+i.message,"error"):c(C,N((s||[]).map(n=>{var d;return{...n,department_name:((d=e(j).find(A=>A.id===n.department_id))==null?void 0:d.name)||"N/A"}})))}const m=(s,i)=>{c(V,N(s)),c(T,N(i)),c(P,!0),setTimeout(()=>{c(P,!1)},3e3)},H=B(()=>[...new Set(e(C).map(s=>s.role))]),M=B(()=>e(C).filter(s=>{const n=`${s.first_name} ${s.last_name} ${s.email} ${s.role}`.toLowerCase().includes(e(u).toLowerCase()),d=e(b)==="all"||(e(b)==="active"?s.is_verified:!s.is_verified),A=e(U)==="all"||s.role===e(U);return n&&d&&A}).sort((s,i)=>{const n=e(v)==="first_name"?s.first_name:s[e(v)],d=e(v)==="first_name"?i.first_name:i[e(v)];return e(k)==="asc"?n.localeCompare(d):d.localeCompare(n)})),ie=B(()=>e(M).slice((e(g)-1)*e(w),e(g)*e(w))),J=B(()=>Math.ceil(e(M).length/e(w))),W=s=>{e(v)===s?c(k,N(e(k)==="asc"?"desc":"asc")):(c(v,N(s)),c(k,"asc"))},Q=()=>{const i=[["First Name","Last Name","Email","Role","Department","Status"].join(","),...e(C).map(z=>[z.first_name,z.last_name,z.email,z.role,z.department_name,z.is_verified?"Verified":"Not Verified"].join(","))].join(`
`),n=new Blob([i],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a"),A=URL.createObjectURL(n);d.setAttribute("href",A),d.setAttribute("download","users.csv"),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)},Z=async s=>{if(e(f)){const i=["admin","vice_president","president"];c(q,!0);const{error:n}=await X.from("profiles").update({first_name:s.first_name,last_name:s.last_name,department_id:i.includes(s.role||"")?void 0:s.department_id,role:s.role}).eq("id",e(f).id);n?m("Error updating profile: "+n.message,"error"):(await l(),m("Profile updated successfully!","success"),Fe()),c(q,!1)}},le=async s=>{c(L,N(s));try{const{error:i}=await gt.auth.admin.deleteUser(s);if(i){m("Error deleting user from authentication: "+i.message,"error");return}const{error:n}=await X.from("profiles").delete().eq("id",s);n?m("Error deleting user profile: "+n.message,"error"):(await l(),m("User deleted successfully!","success"))}catch{m("An unexpected error occurred.","error")}finally{c(L,null)}},Ke=async s=>{c(D,N(s));try{const{error:i}=await X.from("profiles").update({is_verified:!0}).eq("id",s);i?m("Failed to approve user: "+i.message,"error"):(await l(),m("User approved successfully!","success"))}catch{m("An unexpected error occurred.","error")}finally{c(D,null)}},Fe=()=>{c(y,!1),c(f,null)};O();var ne=$t(),Pe=a(ne);G(Pe,()=>e(P),s=>{var i=Wt(),n=a(i),d=a(n),A=a(d,!0);r(d),r(n),r(i),R(()=>{Xe(i,`alert alert-${e(T)??""} shadow-lg mb-4`),F(A,e(V))}),x(s,i)});var de=o(Pe,2),ze=a(de),Ye=a(ze);Et(Ye,{class:"w-8 h-8 text-primary"}),Ee(2),r(ze),r(de);var $=o(de,2);$.__click=[Bt,S];var Ze=o(a($)),$e=B(()=>e(S)?"rotate-180":"");ae(Ze,{size:16,get class(){return e($e)}}),r($);var ee=o($,2),ce=a(ee),ue=a(ce),Re=a(ue);At(Re,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var Ve=o(Re,2);De(Ve),r(ue);var te=o(ue,2),ve=a(te);ve.value=(ve.__value="all")==null?"":"all";var me=o(ve);me.value=(me.__value="active")==null?"":"active";var qe=o(me);qe.value=(qe.__value="inactive")==null?"":"inactive",r(te);var _e=o(te,2),pe=a(_e);pe.value=(pe.__value="all")==null?"":"all";var et=o(pe);je(et,17,()=>e(H),Je,(s,i)=>{var n=Ot(),d={},A=a(n,!0);r(n),R(()=>{d!==(d=e(i))&&(n.value=(n.__value=e(i))==null?"":e(i)),F(A,e(i))}),x(s,n)}),r(_e),r(ce);var Ce=o(ce,2),fe=a(Ce);fe.__click=Q;var tt=a(fe);Ut(tt,{size:20}),Ee(),r(fe),r(Ce),r(ee);var Ie=o(ee,2);G(Ie,()=>e(I),s=>{var i=Qt();x(s,i)},s=>{var i=Yt(),n=Ge(i),d=a(n),A=a(d),z=a(A),be=o(a(z)),ge=a(be);ge.__click=[Xt,W];var at=o(a(ge)),st=B(()=>e(v)==="first_name"?"text-primary":"");ae(at,{size:16,get class(){return e(st)}}),r(ge),r(be);var xe=o(be),ye=a(xe);ye.__click=[Gt,W];var ot=o(a(ye)),it=B(()=>e(v)==="email"?"text-primary":"");ae(ot,{size:16,get class(){return e(it)}}),r(ye),r(xe);var Te=o(xe),he=a(Te);he.__click=[Ht,W];var lt=o(a(he)),nt=B(()=>e(v)==="role"?"text-primary":"");ae(lt,{size:16,get class(){return e(nt)}}),r(he),r(Te),Ee(3),r(z),r(A);var Le=o(A);je(Le,21,()=>e(ie),K=>K.id,(K,ct)=>{Ct(K,{get user(){return e(ct)},get departments(){return e(j)},onEdit:ut=>{c(f,N(ut)),c(y,!0)},onDelete:le,onApprove:Ke,get approvingUserId(){return e(D)},get deletingUserId(){return e(L)}})}),r(Le),r(d),r(n);var Me=o(n,2),we=a(Me),dt=a(we);R(()=>F(dt,`Showing ${(e(g)-1)*e(w)+1} to ${Math.min(e(g)*e(w),e(M).length)??""} of ${e(M).length??""} results`)),r(we);var We=o(we,2),re=a(We),ke=a(re);ke.value=(ke.__value=5)==null?"":5;var Ae=o(ke);Ae.value=(Ae.__value=10)==null?"":10;var Ue=o(Ae);Ue.value=(Ue.__value=25)==null?"":25;var Be=o(Ue);Be.value=(Be.__value=50)==null?"":50,r(re);var Oe=o(re,2),Se=a(Oe);Se.__click=[Jt,g];var Qe=o(Se,2);Qe.__click=[Kt,g],r(Oe),r(We),r(Me),R(()=>{Se.disabled=e(g)===1,Qe.disabled=e(g)===e(J)}),Y(re,()=>e(w),K=>c(w,K)),x(s,i)});var rt=o(Ie,2);G(rt,()=>e(y),s=>{var i=Zt(),n=a(i),d=a(n);d.__click=Fe;var A=a(d);St(A,{size:20}),r(d);var z=o(d,2);Mt(z,{get user(){return e(f)},get departments(){return e(j)},onSave:Z,get saving(){return e(q)}}),r(n),r(i),x(s,i)}),r(ne),R(()=>Xe(ee,`flex flex-col gap-4 ${e(S)?"block":"hidden"} md:flex md:flex-row md:items-center md:justify-between`)),Ne(Ve,()=>e(u),s=>c(u,s)),Y(te,()=>e(b),s=>c(b,s)),Y(_e,()=>e(U),s=>c(U,s)),x(p,ne),oe()}He(["click"]);var tr=h('<main class="container mx-auto min-h-screen p-4"><!></main>');function hr(p,t){se(t,!1);let u=[];pt(async()=>{await g(),await w()});async function g(){const{data:k,error:b}=await X.from("departments").select("id, name");b?y("Error fetching departments: "+b.message):u=k||[]}async function w(){const{data:k,error:b}=await X.from("profiles").select("id, first_name, last_name, email, role, department_id, profile_pic, is_verified");b?y("Error fetching users: "+b.message):(k||[]).map(U=>{var S;return{...U,department_name:((S=u.find(P=>P.id===U.department_id))==null?void 0:S.name)||"N/A"}})}const y=(k,b)=>{setTimeout(()=>{},3e3)};_t();var f=tr(),v=a(f);er(v,{}),r(f),x(p,f),oe()}export{hr as component};

import"../chunks/disclose-version.Bg9kRutz.js";import{p as se,c as a,r,t as R,s as o,a as oe,g as e,d as m,b as c,f as nt,e as B,n as Be}from"../chunks/utils.CRNn4dtP.js";import{d as Qe,a as g,t as x,f as dt}from"../chunks/store.B1kL-7Ni.js";import{i as ct}from"../chunks/lifecycle.DSkr6FdQ.js";import{o as ut}from"../chunks/index-client.BdGz_wQc.js";/* empty css                         */import{s as X,a as vt}from"../chunks/supabaseClient.BTuNJN2N.js";import{s as N}from"../chunks/render.xPn1qZIb.js";import{i as G}from"../chunks/if.CRsBAEFG.js";import{e as Se,i as Xe}from"../chunks/each.v0RK4Yef.js";import{s as mt,r as Ee}from"../chunks/attributes.BcfEV1VJ.js";import{s as Oe}from"../chunks/class.CstC7PuZ.js";import{b as De}from"../chunks/input.o7SqHMM4.js";import{b as Y}from"../chunks/select.CgyWjfO5.js";import{a as F}from"../chunks/preload-helper.Dwm_PvIR.js";import{P as _t}from"../chunks/pencil.DHUYAf-P.js";import{T as pt}from"../chunks/trash-2.B2J2poVW.js";import{A as ae}from"../chunks/arrow-up-down.Ck2frNgV.js";import{S as ft}from"../chunks/search.B4Eo5Hu8.js";import{D as bt}from"../chunks/download.CIM__xX3.js";import{X as gt}from"../chunks/x.DaAqSZOK.js";var xt=x('<img alt="Profile" class="w-10 h-10 rounded-full object-cover">'),yt=x('<div class="w-10 h-10 rounded-full bg-secondary flex items-center justify-center text-muted-foreground"> </div>'),ht=x('<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">Verified</span>'),wt=x('<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">Not Verified</span>'),kt=(f,t)=>t.onEdit(t.user),At=(f,t)=>t.onApprove(t.user.id),Ut=x('<button class="p-1 rounded-lg bg-green-500 text-white hover:bg-green-600 disabled:opacity-50"> </button>'),St=(f,t)=>t.onDelete(t.user.id),Et=x('<tr class="hover:bg-muted/50"><td class="px-4 py-2"><!></td><td class="px-4 py-2"> </td><td class="px-4 py-2 hidden md:table-cell"> </td><td class="px-4 py-2 hidden sm:table-cell"> </td><td class="px-4 py-2"> </td><td class="px-4 py-2"><!></td><td class="px-4 py-2"><div class="flex items-center gap-2"><button class="p-1 hover:bg-muted rounded-lg text-muted-foreground hover:text-foreground" title="Edit user"><!></button> <!> <button class="p-1 hover:bg-red-100 rounded-lg text-red-500 hover:text-red-600 disabled:opacity-50" title="Delete user"><!></button></div></td></tr>');function Dt(f,t){se(t,!0);var u=Et(),b=a(u),A=a(b);G(A,()=>t.user.profile_pic,E=>{var l=xt();R(()=>mt(l,"src",t.user.profile_pic)),g(E,l)},E=>{var l=yt(),v=a(l);r(l),R(()=>N(v,`${t.user.first_name[0]??""}${t.user.last_name[0]??""}`)),g(E,l)}),r(b);var y=o(b),h=a(y);r(y);var p=o(y),w=a(p,!0);r(p);var _=o(p),U=a(_,!0);r(_);var S=o(_),P=a(S,!0);r(S);var V=o(S),I=a(V);G(I,()=>t.user.is_verified,E=>{var l=ht();g(E,l)},E=>{var l=wt();g(E,l)}),r(V);var q=o(V),T=a(q),D=a(T);D.__click=[kt,t];var L=a(D);_t(L,{size:16}),r(D);var C=o(D,2);G(C,()=>!t.user.is_verified,E=>{var l=Ut();l.__click=[At,t];var v=a(l,!0);r(l),R(()=>{l.disabled=t.approvingUserId===t.user.id,N(v,t.approvingUserId===t.user.id?"Approving...":"Approve")}),g(E,l)});var j=o(C,2);j.__click=[St,t];var O=a(j);pt(O,{size:16}),r(j),r(T),r(q),r(u),R(()=>{N(h,`${t.user.first_name??""} ${t.user.last_name??""}`),N(w,t.user.email),N(U,t.user.role),N(P,t.user.department_name||"N/A"),j.disabled=t.deletingUserId===t.user.id}),g(f,u),oe()}Qe(["click"]);var jt=x("<option> </option>"),Ft=x('<div><label for="department" class="block text-sm font-medium mb-1">Department</label> <select id="department" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required><option>Select Department</option><!></select></div>'),Nt=x('<form class="space-y-4"><h3 class="text-lg font-semibold"> </h3> <div><label for="first_name" class="block text-sm font-medium mb-1">First Name</label> <input id="first_name" type="text" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required></div> <div><label for="last_name" class="block text-sm font-medium mb-1">Last Name</label> <input id="last_name" type="text" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required></div> <div><label for="role" class="block text-sm font-medium mb-1">Role</label> <select id="role" class="w-full p-2 rounded-md bg-secondary border-secondary focus:ring-2 focus:ring-ring" required><option>Select Role</option><option>Admin</option><option>User</option><option>Vice President</option><option>President</option></select></div> <!> <div class="flex justify-end gap-2 pt-4"><button type="submit" class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"> </button></div></form>');function Pt(f,t){se(t,!0);let u=F(t.user?{first_name:t.user.first_name,last_name:t.user.last_name,role:t.user.role,department_id:t.user.department_id}:{first_name:"",last_name:"",role:"",department_id:""});const b=["admin","vice_president","president"],A=l=>{l.preventDefault(),t.onSave(u)};var y=Nt(),h=a(y),p=a(h);r(h);var w=o(h,2),_=o(a(w),2);Ee(_),r(w);var U=o(w,2),S=o(a(U),2);Ee(S),r(U);var P=o(U,2),V=o(a(P),2),I=a(V);I.value=((I.__value="")==null,"");var q=o(I);q.value=(q.__value="admin")==null?"":"admin";var T=o(q);T.value=(T.__value="user")==null?"":"user";var D=o(T);D.value=(D.__value="vice_president")==null?"":"vice_president";var L=o(D);L.value=(L.__value="president")==null?"":"president",r(V),r(P);var C=o(P,2);G(C,()=>u.role&&!b.includes(u.role),l=>{var v=Ft(),H=o(a(v),2),M=a(H);M.value=((M.__value="")==null,"");var ie=o(M);Se(ie,17,()=>t.departments,Xe,(J,W)=>{var Q=jt(),Z={},le=a(Q,!0);r(Q),R(()=>{Z!==(Z=e(W).id)&&(Q.value=(Q.__value=e(W).id)==null?"":e(W).id),N(le,e(W).name)}),g(J,Q)}),r(H),r(v),Y(H,()=>u.department_id,J=>u.department_id=J),g(l,v)});var j=o(C,2),O=a(j),E=a(O,!0);r(O),r(j),r(y),R(()=>{N(p,`${(t.user?"Edit":"Add")??""} User`),O.disabled=t.saving,N(E,t.saving?"Saving...":"Save")}),dt("submit",y,A),De(_,()=>u.first_name,l=>u.first_name=l),De(S,()=>u.last_name,l=>u.last_name=l),Y(V,()=>u.role,l=>u.role=l),g(f,y),oe()}var zt=x("<div><div><span> </span></div></div>"),Rt=(f,t)=>c(t,!e(t)),Vt=x("<option> </option>"),qt=x('<div class="flex justify-center p-8 "><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),Ct=(f,t)=>t("first_name"),Tt=(f,t)=>t("email"),It=(f,t)=>t("role"),Lt=(f,t)=>c(t,e(t)-1),Mt=(f,t)=>c(t,e(t)+1),Wt=x('<div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left">Profile</th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Name <!></button></th><th class="px-4 py-3 text-left hidden md:table-cell"><button class="flex items-center gap-1 hover:text-primary">Email <!></button></th><th class="px-4 py-3 text-left hidden sm:table-cell"><button class="flex items-center gap-1 hover:text-primary">Role <!></button></th><th class="px-4 py-3 text-left">Department</th><th class="px-4 py-3 text-left">Status</th><th class="px-4 py-3 text-left w-[100px]">Actions</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4"><div class="text-sm text-muted-foreground text-center sm:text-left"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary border-secondary rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-ring w-full sm:w-auto"><option>5 per page</option><option>10 per page</option><option>25 per page</option><option>50 per page</option></select> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Next</button></div></div></div>',1),Bt=x('<div class="fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 overflow-y-auto"><div class="bg-card p-6 rounded-lg w-full max-w-md relative border border-border"><button class="absolute right-4 top-4 p-1 hover:bg-muted rounded-lg"><!></button> <!></div></div>'),Ot=x('<div class="flex flex-col gap-4 container mx-auto"><!> <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><h2 class="text-2xl font-bold">Users Management</h2></div> <button class="md:hidden w-full px-4 py-2 bg-secondary rounded-lg text-left flex justify-between items-center">Filters <!></button> <div><div class="flex flex-col md:flex-row gap-4 w-full md:w-auto"><div class="relative flex-1 md:w-[300px]"><!> <input type="text" placeholder="Search users..." class="pl-10 pr-4 py-2 bg-secondary border-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <select class="bg-secondary border-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring w-full md:w-[150px]"><option>All Status</option><option>Verified</option><option>Not Verified</option></select> <select class="bg-secondary border-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring w-full md:w-[150px]"><option>All Roles</option><!></select></div> <div class="flex gap-2 w-full md:w-auto"><button class="flex items-center gap-2 bg-secondary text-foreground px-4 py-2 rounded-lg hover:bg-secondary/80 justify-center flex-1 md:flex-initial whitespace-nowrap"><!> Export</button></div></div> <!> <!></div>');function Qt(f,t){se(t,!0);let u=m(""),b=m(1),A=m(5),y=m(!1),h=m(null),p=m("first_name"),w=m("asc"),_=m("all"),U=m("all"),S=m(!1),P=m(!1),V=m(""),I=m("success"),q=m(!1),T=m(!0),D=m(null),L=m(null),C=m(F([])),j=m(F([]));const O=async()=>{await E(),await l(),c(T,!1)};async function E(){const{data:s,error:i}=await X.from("departments").select("id, name");i?v("Error fetching departments: "+i.message,"error"):c(j,F(s||[]))}async function l(){const{data:s,error:i}=await X.from("profiles").select("id, first_name, last_name, email, role, department_id, profile_pic, is_verified");i?v("Error fetching users: "+i.message,"error"):c(C,F((s||[]).map(n=>{var d;return{...n,department_name:((d=e(j).find(k=>k.id===n.department_id))==null?void 0:d.name)||"N/A"}})))}const v=(s,i)=>{c(V,F(s)),c(I,F(i)),c(P,!0),setTimeout(()=>{c(P,!1)},3e3)},H=B(()=>[...new Set(e(C).map(s=>s.role))]),M=B(()=>e(C).filter(s=>{const n=`${s.first_name} ${s.last_name} ${s.email} ${s.role}`.toLowerCase().includes(e(u).toLowerCase()),d=e(_)==="all"||(e(_)==="active"?s.is_verified:!s.is_verified),k=e(U)==="all"||s.role===e(U);return n&&d&&k}).sort((s,i)=>{const n=e(p)==="first_name"?s.first_name:s[e(p)],d=e(p)==="first_name"?i.first_name:i[e(p)];return e(w)==="asc"?n.localeCompare(d):d.localeCompare(n)})),ie=B(()=>e(M).slice((e(b)-1)*e(A),e(b)*e(A))),J=B(()=>Math.ceil(e(M).length/e(A))),W=s=>{e(p)===s?c(w,F(e(w)==="asc"?"desc":"asc")):(c(p,F(s)),c(w,"asc"))},Q=()=>{const i=[["First Name","Last Name","Email","Role","Department","Status"].join(","),...e(C).map(z=>[z.first_name,z.last_name,z.email,z.role,z.department_name,z.is_verified?"Verified":"Not Verified"].join(","))].join(`
`),n=new Blob([i],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a"),k=URL.createObjectURL(n);d.setAttribute("href",k),d.setAttribute("download","users.csv"),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)},Z=async s=>{if(e(h)){const i=["admin","vice_president","president"];c(q,!0);const{error:n}=await X.from("profiles").update({first_name:s.first_name,last_name:s.last_name,department_id:i.includes(s.role||"")?void 0:s.department_id,role:s.role}).eq("id",e(h).id);n?v("Error updating profile: "+n.message,"error"):(await l(),v("Profile updated successfully!","success"),je()),c(q,!1)}},le=async s=>{c(L,F(s));try{const{error:i}=await vt.auth.admin.deleteUser(s);if(i){v("Error deleting user from authentication: "+i.message,"error");return}const{error:n}=await X.from("profiles").delete().eq("id",s);n?v("Error deleting user profile: "+n.message,"error"):(await l(),v("User deleted successfully!","success"))}catch{v("An unexpected error occurred.","error")}finally{c(L,null)}},Ge=async s=>{c(D,F(s));try{const{error:i}=await X.from("profiles").update({is_verified:!0}).eq("id",s);i?v("Failed to approve user: "+i.message,"error"):(await l(),v("User approved successfully!","success"))}catch{v("An unexpected error occurred.","error")}finally{c(D,null)}},je=()=>{c(y,!1),c(h,null)};O();var ne=Ot(),Fe=a(ne);G(Fe,()=>e(P),s=>{var i=zt(),n=a(i),d=a(n),k=a(d,!0);r(d),r(n),r(i),R(()=>{Oe(i,`alert alert-${e(I)??""} shadow-lg mb-4`),N(k,e(V))}),g(s,i)});var $=o(Fe,4);$.__click=[Rt,S];var He=o(a($)),Je=B(()=>e(S)?"rotate-180":"");ae(He,{size:16,get class(){return e(Je)}}),r($);var ee=o($,2),de=a(ee),ce=a(de),Ne=a(ce);ft(Ne,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var Pe=o(Ne,2);Ee(Pe),r(ce);var te=o(ce,2),ue=a(te);ue.value=(ue.__value="all")==null?"":"all";var ve=o(ue);ve.value=(ve.__value="active")==null?"":"active";var ze=o(ve);ze.value=(ze.__value="inactive")==null?"":"inactive",r(te);var me=o(te,2),_e=a(me);_e.value=(_e.__value="all")==null?"":"all";var Ke=o(_e);Se(Ke,17,()=>e(H),Xe,(s,i)=>{var n=Vt(),d={},k=a(n,!0);r(n),R(()=>{d!==(d=e(i))&&(n.value=(n.__value=e(i))==null?"":e(i)),N(k,e(i))}),g(s,n)}),r(me),r(de);var Re=o(de,2),pe=a(Re);pe.__click=Q;var Ye=a(pe);bt(Ye,{size:20}),Be(),r(pe),r(Re),r(ee);var Ve=o(ee,2);G(Ve,()=>e(T),s=>{var i=qt();g(s,i)},s=>{var i=Wt(),n=nt(i),d=a(n),k=a(d),z=a(k),fe=o(a(z)),be=a(fe);be.__click=[Ct,W];var $e=o(a(be)),et=B(()=>e(p)==="first_name"?"text-primary":"");ae($e,{size:16,get class(){return e(et)}}),r(be),r(fe);var ge=o(fe),xe=a(ge);xe.__click=[Tt,W];var tt=o(a(xe)),rt=B(()=>e(p)==="email"?"text-primary":"");ae(tt,{size:16,get class(){return e(rt)}}),r(xe),r(ge);var qe=o(ge),ye=a(qe);ye.__click=[It,W];var at=o(a(ye)),st=B(()=>e(p)==="role"?"text-primary":"");ae(at,{size:16,get class(){return e(st)}}),r(ye),r(qe),Be(3),r(z),r(k);var Ce=o(k);Se(Ce,21,()=>e(ie),K=>K.id,(K,it)=>{Dt(K,{get user(){return e(it)},get departments(){return e(j)},onEdit:lt=>{c(h,F(lt)),c(y,!0)},onDelete:le,onApprove:Ge,get approvingUserId(){return e(D)},get deletingUserId(){return e(L)}})}),r(Ce),r(d),r(n);var Te=o(n,2),he=a(Te),ot=a(he);R(()=>N(ot,`Showing ${(e(b)-1)*e(A)+1} to ${Math.min(e(b)*e(A),e(M).length)??""} of ${e(M).length??""} results`)),r(he);var Ie=o(he,2),re=a(Ie),we=a(re);we.value=(we.__value=5)==null?"":5;var ke=o(we);ke.value=(ke.__value=10)==null?"":10;var Ae=o(ke);Ae.value=(Ae.__value=25)==null?"":25;var Le=o(Ae);Le.value=(Le.__value=50)==null?"":50,r(re);var Me=o(re,2),Ue=a(Me);Ue.__click=[Lt,b];var We=o(Ue,2);We.__click=[Mt,b],r(Me),r(Ie),r(Te),R(()=>{Ue.disabled=e(b)===1,We.disabled=e(b)===e(J)}),Y(re,()=>e(A),K=>c(A,K)),g(s,i)});var Ze=o(Ve,2);G(Ze,()=>e(y),s=>{var i=Bt(),n=a(i),d=a(n);d.__click=je;var k=a(d);gt(k,{size:20}),r(d);var z=o(d,2);Pt(z,{get user(){return e(h)},get departments(){return e(j)},onSave:Z,get saving(){return e(q)}}),r(n),r(i),g(s,i)}),r(ne),R(()=>Oe(ee,`flex flex-col gap-4 ${e(S)?"block":"hidden"} md:flex md:flex-row md:items-center md:justify-between`)),De(Pe,()=>e(u),s=>c(u,s)),Y(te,()=>e(_),s=>c(_,s)),Y(me,()=>e(U),s=>c(U,s)),g(f,ne),oe()}Qe(["click"]);var Xt=x('<main class="container mx-auto min-h-screen p-4"><!></main>');function _r(f,t){se(t,!1);let u=[];ut(async()=>{await b(),await A()});async function b(){const{data:w,error:_}=await X.from("departments").select("id, name");_?y("Error fetching departments: "+_.message):u=w||[]}async function A(){const{data:w,error:_}=await X.from("profiles").select("id, first_name, last_name, email, role, department_id, profile_pic, is_verified");_?y("Error fetching users: "+_.message):(w||[]).map(U=>{var S;return{...U,department_name:((S=u.find(P=>P.id===U.department_id))==null?void 0:S.name)||"N/A"}})}const y=(w,_)=>{setTimeout(()=>{},3e3)};ct();var h=Xt(),p=a(h);Qt(p,{}),r(h),g(f,h),oe()}export{_r as component};

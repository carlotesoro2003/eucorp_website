import"../chunks/disclose-version.Bg9kRutz.js";import{p as mt,c as a,r,s,t as J,a as ft,aF as k,g as t,f as Ct,b as i,O as $,n as Xt,i as at,m as vt}from"../chunks/runtime.CLSstnwU.js";import{d as te,a as K,t as L,e as G,c as Jt}from"../chunks/utils.kA-YjkFf.js";import{i as ot}from"../chunks/if.b2Q-jNLG.js";import{i as ee}from"../chunks/lifecycle.V0dJQ05z.js";import{p as xe}from"../chunks/props.BD0jg91j.js";import{s as N}from"../chunks/supabaseClient.CaMOPPuz.js";import{s as B}from"../chunks/render.D17u6ZCY.js";import{e as jt,i as re}from"../chunks/each.sV1uapQk.js";import{r as st}from"../chunks/attributes.DiUoHvyc.js";import{s as Zt}from"../chunks/class.9GukHOdr.js";import{b as q}from"../chunks/input.CQDk-SFX.js";import{b as $t}from"../chunks/select.BAP3DC-4.js";import{p as z}from"../chunks/proxy.D-58ufVl.js";import{P as ye}from"../chunks/pencil.5iKfE7p4.js";import{T as he}from"../chunks/trash-2.DXHXJoNa.js";import{r as et}from"../chunks/misc.C2nsS1Cr.js";import{E as we,a as ke}from"../chunks/jspdf.plugin.autotable.4s0l0uhg.js";import{A as ut}from"../chunks/arrow-up-down.Ch6Rz2vF.js";import{S as Pe}from"../chunks/search.4XRWJUve.js";import{D as Ae}from"../chunks/download.DXjW2liV.js";import{X as Se}from"../chunks/x.DXpGL3Re.js";import{o as Ee}from"../chunks/index-client.DT-fMr9Z.js";var Oe=(P,e)=>e.onApprove(e.opportunity.id),Ne=(P,e)=>e.onEdit(e.opportunity),Fe=(P,e)=>e.onDelete(e.opportunity.id),Ie=L('<tr class="hover:bg-muted/50"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><div class="flex items-center gap-2"><button class="px-2 py-1 text-sm rounded bg-green-500 text-white hover:bg-green-600 disabled:opacity-50"> </button> <button class="p-1 rounded hover:bg-muted"><!></button> <button class="p-1 rounded hover:bg-muted text-red-500 hover:text-red-600 disabled:opacity-50"><!></button></div></td></tr>');function Re(P,e){mt(e,!0);var _=Ie(),b=a(_),l=a(b,!0);r(b);var h=s(b),p=a(h,!0);r(h);var x=s(h),F=a(x,!0);r(x);var A=s(x),u=a(A,!0);r(A);var m=s(A),f=a(m,!0);r(m);var w=s(m),I=a(w);J(()=>B(I,`P${e.opportunity.budget.toFixed(2)??""}`)),r(w);var S=s(w),E=a(S,!0);r(S);var U=s(S),C=a(U),j=a(C);j.__click=[Oe,e];var g=a(j,!0);r(j);var V=s(j,2);V.__click=[Ne,e];var y=a(V);ye(y,{size:16}),r(V);var c=s(V,2);c.__click=[Fe,e];var M=a(c);he(M,{size:16}),r(c),r(C),r(U),r(_),J(()=>{B(l,e.opportunity.opt_statement),B(p,e.opportunity.planned_actions),B(F,e.opportunity.kpi),B(u,e.opportunity.key_persons),B(f,e.opportunity.target_output),B(E,e.opportunity.department_name),j.disabled=e.approvingId===e.opportunity.id||e.userRole==="admin"&&e.opportunity.is_approved||e.userRole==="vice_president"&&(!e.opportunity.is_approved||e.opportunity.is_approved_vp)||e.userRole==="president"&&(!e.opportunity.is_approved_vp||e.opportunity.is_approved_president),B(g,e.approvingId===e.opportunity.id?"Processing...":e.userRole==="admin"?e.opportunity.is_approved?"Admin Approved":"Approve":e.userRole==="vice_president"?e.opportunity.is_approved_vp?"VP Approved":"Approve":e.userRole==="president"&&e.opportunity.is_approved_president?"President Approved":"Approve"),c.disabled=e.deletingId===e.opportunity.id}),K(P,_),ft()}te(["click"]);var ze=L('<form class="space-y-4"><h3 class="text-lg font-semibold mb-4">Edit Opportunity</h3> <div class="space-y-2"><label for="opt_statement">Statement</label> <textarea id="opt_statement" class="w-full p-2 border rounded-lg bg-background" rows="3"></textarea></div> <div class="space-y-2"><label for="planned_actions">Planned Actions</label> <textarea id="planned_actions" class="w-full p-2 border rounded-lg bg-background" rows="3"></textarea></div> <div class="space-y-2"><label for="kpi">KPI</label> <input type="text" id="kpi" class="w-full p-2 border rounded-lg bg-background"></div> <div class="space-y-2"><label for="key_persons">Key Persons</label> <input type="text" id="key_persons" class="w-full p-2 border rounded-lg bg-background"></div> <div class="space-y-2"><label for="target_output">Target Output</label> <input type="text" id="target_output" class="w-full p-2 border rounded-lg bg-background"></div> <div class="space-y-2"><label for="budget">Budget</label> <input type="number" id="budget" class="w-full p-2 border rounded-lg bg-background" min="0" step="0.01"></div> <div class="flex justify-end gap-2 mt-6"><button type="submit" class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50"> </button></div></form>');function De(P,e){mt(e,!0);let _=e.opportunity?{...e.opportunity}:{opt_statement:"",planned_actions:"",kpi:"",key_persons:"",target_output:"",budget:0};const b=g=>{g.preventDefault(),e.onSave(_)};var l=ze(),h=s(a(l),2),p=s(a(h),2);et(p),r(h);var x=s(h,2),F=s(a(x),2);et(F),r(x);var A=s(x,2),u=s(a(A),2);st(u),r(A);var m=s(A,2),f=s(a(m),2);st(f),r(m);var w=s(m,2),I=s(a(w),2);st(I),r(w);var S=s(w,2),E=s(a(S),2);st(E),r(S);var U=s(S,2),C=a(U),j=a(C,!0);r(C),r(U),r(l),J(()=>{C.disabled=e.saving,B(j,e.saving?"Saving...":"Save Changes")}),G("submit",l,b),q(p,()=>_.opt_statement,g=>_.opt_statement=g),q(F,()=>_.planned_actions,g=>_.planned_actions=g),q(u,()=>_.kpi,g=>_.kpi=g),q(f,()=>_.key_persons,g=>_.key_persons=g),q(I,()=>_.target_output,g=>_.target_output=g),q(E,()=>_.budget,g=>_.budget=g),K(P,l),ft()}const Te=(P,e,_,b,l,h)=>{const p=new we("landscape");p.setFont("times","normal"),p.setFontSize(12),p.text("MANUEL S. ENVERGA UNIVERSITY FOUNDATION",14,10),p.text("Opportunities Report",14,16),p.setFontSize(10),p.text("SY 2024-2025",14,22);const x=["Opportunity Statement","Planned Actions","KPI","Key Persons","Target Output","Budget","Department"],F=t(e).map(E=>[E.opt_statement,E.planned_actions,E.kpi,E.key_persons,E.target_output,E.budget.toFixed(2),E.department_name||"Unknown"]);ke(p,{head:[x],body:F,startY:28,theme:"grid",styles:{font:"times",fontSize:10},headStyles:{fillColor:[41,128,185]}});const u=p.internal.pageSize.height-40,m=p.internal.pageSize.width/4,f=[14,m,m*2,m*3];p.setFontSize(10);const w=t(_)[0],I=(w==null?void 0:w.user_name)||"Unknown",S=(w==null?void 0:w.department_name)||"Unknown";p.text(`${I} (sgnd)`,f[0],u-5),p.text("_________________________",f[0],u),p.text(`${S} Department Head`,f[0],u+5),p.text(`${t(b)||"N/A"} (sgnd)`,f[1],u-5),p.text("_________________________",f[1],u),p.text("Corporate Planning Officer",f[1],u+5),p.text(`${t(l)||"N/A"} (sgnd)`,f[2],u-5),p.text("_________________________",f[2],u),p.text("Vice President",f[2],u+5),p.text(`${t(h)||"N/A"} (sgnd)`,f[3],u-5),p.text("_________________________",f[3],u),p.text("President",f[3],u+5),p.save("Opportunities_Report.pdf")};var Ue=L("<div><span> </span></div>"),Ce=(P,e)=>i(e,!t(e)),je=L("<option> </option>"),Ke=L('<div class="flex justify-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),qe=(P,e)=>e("opt_statement"),Ve=(P,e)=>e("planned_actions"),Me=(P,e)=>e("budget"),Be=(P,e)=>e("department_name"),He=(P,e)=>i(e,t(e)-1),Le=(P,e)=>i(e,t(e)+1),Ye=L('<div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Statement <!></button></th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Actions <!></button></th><th class="px-4 py-3 text-left">KPI</th><th class="px-4 py-3 text-left">Key Persons</th><th class="px-4 py-3 text-left">Target</th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Budget <!></button></th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Department <!></button></th><th class="px-4 py-3 text-left w-[150px]">Actions</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary rounded-lg px-2 py-1 w-full sm:w-auto"><option>5 per page</option><option>10 per page</option><option>25 per page</option><option>50 per page</option></select> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Next</button></div></div></div>',1),We=L('<div class="fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 overflow-y-auto"><div class="bg-card p-3 rounded-lg w-full max-w-md relative border border-border"><button class="absolute right-4 top-4 p-1 hover:bg-muted rounded-lg"><!></button> <!></div></div>'),Ge=L('<div class="flex flex-col gap-4 container mx-auto p-6"><!> <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><h2 class="text-2xl font-bold">Opportunities Management</h2></div> <button class="md:hidden w-full px-4 py-2 bg-secondary rounded-lg text-left flex justify-between items-center">Filters <!></button> <div><div class="flex flex-col md:flex-row gap-4 w-full md:w-auto"><div class="relative flex-1 md:w-[300px]"><!> <input type="text" placeholder="Search opportunities..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full"></div> <select class="bg-secondary rounded-lg px-3 py-2 w-full md:w-[200px]"><option>All Departments</option><!></select></div> <div class="flex gap-2 w-full md:w-auto"><button class="flex items-center gap-2 bg-secondary px-4 py-2 rounded-lg hover:bg-secondary/80 flex-1 md:flex-initial"><!> Export PDF</button></div></div> <!> <!></div>');function Qe(P,e){mt(e,!0);let _=k(""),b=k(1),l=k(5),h=k(!1),p=k(null),x=k("opt_statement"),F=k("asc"),A=k("all"),u=k(!1),m=k(!1),f=k(""),w=k("success"),I=k(!1),S=k(!0),E=k(null),U=k(null),C=k(z([])),j=k(z([])),g=k(null),V=k(null),y=k(null),c=k(null);const M=async()=>{await Y(),await D(),await H(),await tt(),await Q(),i(S,!1)},Y=async()=>{const{data:{session:o}}=await N.auth.getSession();if(!o||!o.user)return;const{data:n,error:d}=await N.from("profiles").select("role").eq("id",o.user.id).single();if(d){R("Error fetching user role: "+d.message,"error");return}i(g,z(n.role))},D=async()=>{const{data:o,error:n}=await N.from("profiles").select("first_name, last_name").eq("role","admin");if(n){R("Error fetching admin name: "+n.message,"error"),i(V,"N/A");return}i(V,z(o.map(d=>`${d.first_name} ${d.last_name}`).join(", ")))},Q=async()=>{const{data:o,error:n}=await N.from("profiles").select("first_name, last_name, role").in("role",["vice_president","president"]);if(n){R("Error fetching VP and President names: "+n.message,"error"),i(y,"N/A"),i(c,"N/A");return}const d=o.find(O=>O.role==="vice_president"),v=o.find(O=>O.role==="president");i(y,z(d?`${d.first_name} ${d.last_name}`:"N/A")),i(c,z(v?`${v.first_name} ${v.last_name}`:"N/A"))},H=async()=>{const{data:o,error:n}=await N.from("opportunities").select(`
                *,
                profiles (
                    first_name,
                    last_name,
                    departments (name)
                )
            `);if(n){R("Error fetching opportunities: "+n.message,"error");return}i(C,z(o.map(d=>{var v,O,W,rt;return{...d,department_name:((O=(v=d.profiles)==null?void 0:v.departments)==null?void 0:O.name)||"N/A",user_name:`${((W=d.profiles)==null?void 0:W.first_name)||""} ${((rt=d.profiles)==null?void 0:rt.last_name)||""}`}})))},tt=async()=>{const{data:o,error:n}=await N.from("departments").select("id, name");if(n){R("Error fetching departments: "+n.message,"error");return}i(j,z(o))},R=(o,n)=>{i(f,z(o)),i(w,z(n)),i(m,!0),setTimeout(()=>{i(m,!1)},3e3)},X=$(()=>t(C).filter(o=>{const d=`${o.opt_statement} ${o.planned_actions} ${o.department_name}`.toLowerCase().includes(t(_).toLowerCase()),v=t(A)==="all"||o.department_name===t(A);return d&&v}).sort((o,n)=>{const d=String(o[t(x)]),v=String(n[t(x)]);return t(F)==="asc"?d.localeCompare(v):v.localeCompare(d)})),nt=$(()=>t(X).slice((t(b)-1)*t(l),t(b)*t(l))),it=$(()=>Math.ceil(t(X).length/t(l))),Z=o=>{t(x)===o?i(F,z(t(F)==="asc"?"desc":"asc")):(i(x,z(o)),i(F,"asc"))},lt=async o=>{i(U,z(o));const{error:n}=await N.from("opportunities").delete().eq("id",o);n?R("Error deleting opportunity: "+n.message,"error"):(await H(),R("Opportunity deleted successfully!","success")),i(U,null)},dt=async o=>{i(E,z(o));let n={};t(g)==="admin"?n={is_approved:!0}:t(g)==="vice_president"?n={is_approved_vp:!0}:t(g)==="president"&&(n={is_approved_president:!0});const{data:d,error:v}=await N.from("opportunities").update(n).eq("id",o).select();if(v)R("Error approving opportunity: "+v.message,"error");else{if(t(g)==="president"&&d&&d.length>0){const O=d[0],{error:W}=await N.from("opt_monitoring").insert({opt_id:O.id,profile_id:O.profile_id,department_id:O.department_id});W&&R("Error adding to monitoring: "+W.message,"error")}await H(),R("Opportunity approved successfully!","success")}i(E,null)},gt=async o=>{if(!t(p))return;i(I,!0);const{error:n}=await N.from("opportunities").update({opt_statement:o.opt_statement,planned_actions:o.planned_actions,kpi:o.kpi,key_persons:o.key_persons,target_output:o.target_output,budget:o.budget}).eq("id",t(p).id);n?R("Error updating opportunity: "+n.message,"error"):(await H(),R("Opportunity updated successfully!","success"),pt()),i(I,!1)},pt=()=>{i(h,!1),i(p,null)};M();var ct=Ge(),T=a(ct);ot(T,()=>t(m),o=>{var n=Ue(),d=a(n),v=a(d,!0);r(d),r(n),J(()=>{Zt(n,`alert alert-${t(w)??""} shadow-lg mb-4`),B(v,t(f))}),K(o,n)});var bt=s(T,4);bt.__click=[Ce,u];var ae=s(a(bt)),se=$(()=>t(u)?"rotate-180":"");ut(ae,{size:16,get class(){return t(se)}}),r(bt);var xt=s(bt,2),ht=a(xt),wt=a(ht),Kt=a(wt);Pe(Kt,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var qt=s(Kt,2);st(qt),r(wt);var kt=s(wt,2),Pt=a(kt);Pt.value=(Pt.__value="all")==null?"":"all";var oe=s(Pt);jt(oe,17,()=>t(j),re,(o,n)=>{var d=je(),v={},O=a(d,!0);r(d),J(()=>{v!==(v=t(n).name)&&(d.value=(d.__value=t(n).name)==null?"":t(n).name),B(O,t(n).name)}),K(o,d)}),r(kt),r(ht);var Vt=s(ht,2),At=a(Vt);At.__click=[Te,X,C,V,y,c];var ne=a(At);Ae(ne,{size:20}),Xt(),r(At),r(Vt),r(xt);var Mt=s(xt,2);ot(Mt,()=>t(S),o=>{var n=Ke();K(o,n)},o=>{var n=Ye(),d=Ct(n),v=a(d),O=a(v),W=a(O),rt=a(W),St=a(rt);St.__click=[qe,Z];var le=s(a(St)),de=$(()=>t(x)==="opt_statement"?"text-primary":"");ut(le,{size:16,get class(){return t(de)}}),r(St),r(rt);var Et=s(rt),Ot=a(Et);Ot.__click=[Ve,Z];var pe=s(a(Ot)),ce=$(()=>t(x)==="planned_actions"?"text-primary":"");ut(pe,{size:16,get class(){return t(ce)}}),r(Ot),r(Et);var Nt=s(Et,4),Ft=a(Nt);Ft.__click=[Me,Z];var _e=s(a(Ft)),ue=$(()=>t(x)==="budget"?"text-primary":"");ut(_e,{size:16,get class(){return t(ue)}}),r(Ft),r(Nt);var Bt=s(Nt),It=a(Bt);It.__click=[Be,Z];var ve=s(a(It)),me=$(()=>t(x)==="department_name"?"text-primary":"");ut(ve,{size:16,get class(){return t(me)}}),r(It),r(Bt),Xt(),r(W),r(O);var Ht=s(O);jt(Ht,21,()=>t(nt),_t=>_t.id,(_t,ge)=>{Re(_t,{get opportunity(){return t(ge)},get userRole(){return t(g)},onEdit:be=>{i(p,z(be)),i(h,!0)},onDelete:lt,onApprove:dt,get approvingId(){return t(E)},get deletingId(){return t(U)}})}),r(Ht),r(v),r(d);var Lt=s(d,2),Rt=a(Lt),fe=a(Rt);J(()=>B(fe,`Showing ${(t(b)-1)*t(l)+1} to ${Math.min(t(b)*t(l),t(X).length)??""} of ${t(X).length??""} results`)),r(Rt);var Yt=s(Rt,2),yt=a(Yt),zt=a(yt);zt.value=(zt.__value=5)==null?"":5;var Dt=s(zt);Dt.value=(Dt.__value=10)==null?"":10;var Tt=s(Dt);Tt.value=(Tt.__value=25)==null?"":25;var Wt=s(Tt);Wt.value=(Wt.__value=50)==null?"":50,r(yt);var Gt=s(yt,2),Ut=a(Gt);Ut.__click=[He,b];var Qt=s(Ut,2);Qt.__click=[Le,b],r(Gt),r(Yt),r(Lt),J(()=>{Ut.disabled=t(b)===1,Qt.disabled=t(b)===t(it)}),$t(yt,()=>t(l),_t=>i(l,_t)),K(o,n)});var ie=s(Mt,2);ot(ie,()=>t(h),o=>{var n=We(),d=a(n),v=a(d);v.__click=pt;var O=a(v);Se(O,{size:20}),r(v);var W=s(v,2);De(W,{get opportunity(){return t(p)},onSave:gt,get saving(){return t(I)}}),r(d),r(n),K(o,n)}),r(ct),J(()=>Zt(xt,`flex flex-col gap-4 ${t(u)?"block":"hidden"} md:flex md:flex-row md:justify-between`)),q(qt,()=>t(_),o=>i(_,o)),$t(kt,()=>t(A),o=>i(A,o)),K(P,ct),ft()}te(["click"]);var Xe=L('<tr><td class="px-4 py-2"><textarea placeholder="Opportunity Statement" class="textarea textarea-bordered w-full" style="overflow: hidden"></textarea></td><td class="px-4 py-2"><textarea placeholder="Planned Actions" class="textarea textarea-bordered w-full" style="overflow: hidden"></textarea></td><td class="px-4 py-2"><textarea placeholder="KPI" class="textarea textarea-bordered w-full" style="overflow: hidden"></textarea></td><td class="px-4 py-2"><textarea placeholder="Key Persons" class="textarea textarea-bordered w-full" style="overflow: hidden"></textarea></td><td class="px-4 py-2"><textarea placeholder="Target Output" class="textarea textarea-bordered w-full" style="overflow: hidden"></textarea></td><td class="px-4 py-2"><input type="number" placeholder="Budget" class="input input-bordered w-full"></td><td class="px-4 py-2"><button class="btn btn-sm btn-error">Delete</button></td></tr>'),Je=L('<div class="container mx-auto p-6"><div class="p-6 rounded-lg shadow-lg mb-6"><div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-semibold"></h2> <button class="btn btn-success">Save Progress</button></div> <div class="overflow-x-auto"><table class="table-auto table table-zebra w-full"><thead><tr class="text-sm"><th class="px-4 py-2 text-left">Opportunity Statement</th><th class="px-4 py-2 text-left">Planned Actions</th><th class="px-4 py-2 text-left">KPI</th><th class="px-4 py-2 text-left">Key Persons</th><th class="px-4 py-2 text-left">Target Output</th><th class="px-4 py-2 text-left">Budget</th><th class="px-4 py-2 text-left">Actions</th></tr></thead><tbody></tbody></table></div> <button class="btn btn-secondary mt-4">Add Row</button> <button class="btn btn-primary mt-4"></button></div></div>');function Ze(P,e){mt(e,!1);let _=vt(!1),b=vt(!1),l=vt([{opt_statement:"",planned_actions:"",kpi:"",key_persons:"",target_output:"",budget:0,profile_id:"",department_id:""}]),h=null;const p=async()=>{const{data:{session:y}}=await N.auth.getSession();if(y){const{data:c,error:M}=await N.from("profiles").select("id, department_id").eq("id",y.user.id).single();M?console.error("Error fetching profile:",M):(h=c.id,t(l).forEach(Y=>{Y.department_id=c.department_id}))}else console.log("User is not logged in")},x=async()=>{if(h){i(b,!0);try{const{data:y,error:c}=await N.from("opportunities").insert(t(l).map(M=>({...M,profile_id:h,department_id:M.department_id}))).select();if(c){console.error("Error creating opportunities:",c);return}if(y&&y.length>0){const Y=(await Promise.all(y.map(async D=>{const{data:Q,error:H}=await N.from("departments").select("name").eq("id",D.department_id).single();if(H)return console.error(`Error fetching department name for ID ${D.department_id}:`,H),null;const tt=(Q==null?void 0:Q.name)||"Unknown Department";return{event_id:D.id,event_type:"opportunity",description:`${tt} created a new opportunity`}}))).filter(D=>D!==null);if(Y.length>0){const{error:D}=await N.from("recent_events").insert(Y);D?console.error("Error adding to recent events:",D):console.log("Recent events updated successfully.")}}F(),i(l,[{opt_statement:"",planned_actions:"",kpi:"",key_persons:"",target_output:"",budget:0,profile_id:"",department_id:""}])}catch(y){console.error("Unexpected error:",y)}finally{i(b,!1)}}},F=async()=>{i(_,!0);const{data:y,error:c}=await N.from("opportunities").select("*").eq("profile_id",h);c&&console.error("Error fetching opportunities:",c),i(_,!1)},A=y=>{t(l).splice(y,1),i(l,[...t(l)])},u=()=>{var y;i(l,[...t(l),{opt_statement:"",planned_actions:"",kpi:"",key_persons:"",target_output:"",budget:0,profile_id:h||"",department_id:((y=t(l)[0])==null?void 0:y.department_id)||""}])},m=y=>{const c=y.target;c.style.height="auto",c.style.width="auto",c.style.height=`${c.scrollHeight}px`,c.style.width=`${Math.max(c.scrollWidth,200)}px`};Ee(()=>{p(),h&&F()}),ee();var f=Je(),w=a(f),I=a(w),S=a(I);S.textContent="Create Opportunity";var E=s(S,2);r(I);var U=s(I,2),C=a(U),j=s(a(C));jt(j,5,()=>t(l),re,(y,c,M)=>{var Y=Xe(),D=a(Y),Q=a(D);et(Q),r(D);var H=s(D),tt=a(H);et(tt),r(H);var R=s(H),X=a(R);et(X),r(R);var nt=s(R),it=a(nt);et(it),r(nt);var Z=s(nt),lt=a(Z);et(lt),r(Z);var dt=s(Z),gt=a(dt);st(gt),r(dt);var pt=s(dt),ct=a(pt);r(pt),r(Y),q(Q,()=>t(c).opt_statement,T=>(t(c).opt_statement=T,at(()=>t(l)))),G("input",Q,m),q(tt,()=>t(c).planned_actions,T=>(t(c).planned_actions=T,at(()=>t(l)))),G("input",tt,m),q(X,()=>t(c).kpi,T=>(t(c).kpi=T,at(()=>t(l)))),G("input",X,m),q(it,()=>t(c).key_persons,T=>(t(c).key_persons=T,at(()=>t(l)))),G("input",it,m),q(lt,()=>t(c).target_output,T=>(t(c).target_output=T,at(()=>t(l)))),G("input",lt,m),q(gt,()=>t(c).budget,T=>(t(c).budget=T,at(()=>t(l)))),G("click",ct,()=>A(M)),K(y,Y)}),r(j),r(C),r(U);var g=s(U,2),V=s(g,2);V.textContent="Submit Opportunities",r(w),r(f),J(()=>{E.disabled=t(b),V.disabled=t(_)}),G("click",E,()=>console.log("Save Progress")),G("click",g,u),G("click",V,x),K(P,f),ft()}var $e=L("<div><!></div>");function kr(P,e){mt(e,!1);let _=xe(e,"data",8);const{session:b}=_();let l=vt(null),h=vt(!0);(async()=>{if(b){const{user:A}=b,{data:u,error:m}=await N.from("profiles").select("role").eq("id",A.id).single();m?console.error("Error fetching user profile:",m.message):(i(l,u),console.log("Role in Opportunities: ",t(l)))}i(h,!1)})(),ee();var x=$e(),F=a(x);ot(F,()=>t(h),A=>{},A=>{var u=Jt(),m=Ct(u);ot(m,()=>b!==null&&t(l),f=>{var w=Jt(),I=Ct(w);ot(I,()=>t(l).role==="admin"||t(l).role=="vice_president"||t(l).role=="president",S=>{Qe(S,{})},S=>{Ze(S,{})}),K(f,w)},null,!0),K(A,u)}),r(x),K(P,x),ft()}export{kr as component};

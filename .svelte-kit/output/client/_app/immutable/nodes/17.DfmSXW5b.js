import"../chunks/disclose-version.Bg9kRutz.js";import{p as lt,d as g,a as _t,b as f,g as r,c as s,s as i,f as Ve,t as H,e as z,r as a,n as dt}from"../chunks/utils.CRNn4dtP.js";import{s as x}from"../chunks/render.xPn1qZIb.js";import{i as be}from"../chunks/if.CRsBAEFG.js";import{e as Ce,i as Oe}from"../chunks/each.v0RK4Yef.js";import{d as ct,s as pt,a as y,t as P,c as vt,b as mt}from"../chunks/store.B1kL-7Ni.js";import{r as ft}from"../chunks/attributes.BcfEV1VJ.js";import{b as ut}from"../chunks/input.o7SqHMM4.js";import{b as he}from"../chunks/select.CgyWjfO5.js";import{a as D}from"../chunks/preload-helper.Dwm_PvIR.js";import{o as gt}from"../chunks/index-client.BdGz_wQc.js";import{s as m}from"../chunks/supabaseClient.BTuNJN2N.js";import{E as bt,a as ht}from"../chunks/jspdf.plugin.autotable.hR4uI5lc.js";import{p as xt}from"../chunks/stores.DcEtjLim.js";import{S as yt}from"../chunks/search.B4Eo5Hu8.js";import{A as Te}from"../chunks/arrow-up-down.Ck2frNgV.js";var wt=P("<option> </option>"),At=P('<button class="btn btn-secondary whitespace-nowrap">Export to PDF</button>'),kt=P('<div class="flex justify-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),Pt=(w,d)=>d("department_name"),Nt=(w,d)=>d("actions_taken"),$t=(w,d,j)=>d(r(j).id),Et=(w,d,j)=>d(r(j).id),St=P('<tr><td> </td><td> </td><td> </td><td> </td><td> </td><td class="flex space-x-2"><button class="btn btn-sm btn-success text-white"> </button> <button class="btn btn-sm btn-error text-white">Delete</button></td></tr>'),Dt=(w,d)=>f(d,r(d)-1),jt=(w,d)=>f(d,r(d)+1),Ft=P('<div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Department <!></button></th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1 hover:text-primary">Actions Taken <!></button></th><th>KPI</th><th>Target Output</th><th>Key Person Responsible</th><th class="px-4 py-3 text-left">Actions</th></tr></thead><tbody></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex gap-2"><button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50">Next</button></div></div>',1),Vt=P("<div>No action plans found for this objective.</div>"),Ct=P('<div class="min-h-screen p-8"><h1 class="text-2xl font-bold mb-4">Action Plans</h1> <div class="flex flex-col md:flex-row gap-4 mb-4"><div class="flex flex-col md:flex-row gap-4 w-full"><div class="relative flex-1"><!> <input type="text" placeholder="Search action plans..." class="pl-10 pr-4 py-2 bg-secondary border-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <select class="select select-bordered w-full md:w-48"><option>All Departments</option><!></select> <select class="select select-bordered w-full md:w-48"><option>All Status</option><option>Approved</option><option>Not Approved</option></select> <select class="select select-bordered w-full md:w-48"><option>5 per page</option><option>10 per page</option><option>25 per page</option><option>50 per page</option></select></div> <!></div> <!></div>');function Wt(w,d){lt(d,!0);const j=pt(),Ue=()=>mt(xt,"$page",j);let Q=g(""),b=g(1),A=g(5),N=g("department_name"),I=g("asc"),q=[],$=g(D([])),xe=g(D([])),L=g("all"),R=g("all"),G=null,B=null,F=null,h=!1,K=null,V=null,C=null,p=null;gt(async()=>{const{params:e}=Ue();if(F=parseInt(e.id),F)try{await ze(),await J(),await Ie(),await qe(),await Le(),await Re()}catch(o){console.error("Error:",o)}finally{h=!1}else console.error("Objective ID is missing."),h=!1});const ze=async()=>{try{const{data:{session:e}}=await m.auth.getSession();if(!e||!e.user)return;const{data:o,error:t}=await m.from("profiles").select("role").eq("id",e.user.id).single();t?console.error("Error fetching user role:",t):p=o.role}catch(e){console.error("Error fetching current user role:",e)}},J=async()=>{if(!F){console.error("Objective ID is missing.");return}const{data:e,error:o}=await m.from("action_plans").select(`
      *,
      profiles (
        first_name,
        last_name,
        departments (name)
      )
    `).eq("objective_id",F);o?console.error("Error fetching action plans:",o):(q=e.map(t=>{var n,l,v,k;return{id:t.id,actions_taken:t.actions_taken,kpi:t.kpi,target_output:t.target_output,key_person_responsible:t.key_person_responsible,created_at:t.created_at,objective_id:t.objective_id,is_approved:t.is_approved,is_approved_vp:t.is_approved_vp,is_approved_president:t.is_approved_president,profile_id:t.profile_id,department_name:((l=(n=t.profiles)==null?void 0:n.departments)==null?void 0:l.name)||"Unknown",user_name:`${((v=t.profiles)==null?void 0:v.first_name)||""} ${((k=t.profiles)==null?void 0:k.last_name)||""}`}}),W())},Ie=async()=>{const{data:e,error:o}=await m.from("departments").select("id, name");o?console.error("Error fetching departments:",o):f(xe,D(e))},qe=async()=>{const{data:e,error:o}=await m.from("strategic_objectives").select("id, name, strategic_goal_id").eq("id",F).single();if(o)console.error("Error fetching objective:",o);else{G=e;const{data:t,error:n}=await m.from("strategic_goals").select("id, name").eq("id",e.strategic_goal_id).single();n?console.error("Error fetching strategic goal:",n):B=t}},Le=async()=>{try{const{data:e,error:o}=await m.from("profiles").select("first_name, last_name").eq("role","admin");o||!e?(console.error("Error fetching admin names:",o||"No data found"),K="N/A"):K=e.map(t=>`${t.first_name} ${t.last_name}`).join(", ")}catch(e){console.error("Error fetching admin details:",e),K="N/A"}},Re=async()=>{try{const{data:e,error:o}=await m.from("profiles").select("first_name, last_name, role").in("role",["vice_president","president"]);if(o||!e){console.error("Error fetching VP and President names:",o||"No data found"),V="N/A",C="N/A";return}const t=e.find(l=>l.role==="vice_president"),n=e.find(l=>l.role==="president");V=t?`${t.first_name} ${t.last_name}`:"N/A",C=n?`${n.first_name} ${n.last_name}`:"N/A"}catch(e){console.error("Error fetching VP and President details:",e),V="N/A",C="N/A"}},W=()=>{let e=[...q];p==="vice_president"&&(e=e.filter(o=>o.is_approved)),p==="president"&&(e=e.filter(o=>o.is_approved&&o.is_approved_vp)),r(L)!=="all"&&(e=e.filter(o=>o.department_name===r(L))),r(R)==="approved"?e=e.filter(o=>o.is_approved):r(R)==="notApproved"&&(e=e.filter(o=>!o.is_approved)),f($,D(e))},Ge=async e=>{const{error:o}=await m.from("action_plans").delete().eq("id",e);o?console.error("Error deleting action plan:",o):await J()},Ke=async e=>{let o={};if(h=!0,p==="admin")o={is_approved:!0};else if(p==="vice_president")o={is_approved_vp:!0};else if(p==="president")o={is_approved_president:!0};else{h=!1;return}try{const{data:t,error:n}=await m.from("action_plans").update(o).eq("id",e).select();if(n){console.error("Error approving action plan:",n);return}if(p==="president"&&t&&t.length>0){const l=t[0],{error:v}=await m.from("plan_monitoring").insert({action_plan_id:l.id,profile_id:l.profile_id,department_id:l.department_id});v&&console.error("Error inserting into plan_monitoring:",v)}await J()}catch(t){console.error("Unexpected error while approving action plan:",t)}finally{console.log("Action plan approved successfully."),h=!1}},Me=()=>{var E,S;const e=((E=q[0])==null?void 0:E.user_name)||"Unknown",o=((S=q[0])==null?void 0:S.department_name)||"Unknown",t=new bt("landscape");t.setFont("times","normal"),t.setFontSize(12);const n=`${o} Action Plans for Objective: ${(G==null?void 0:G.name)||"N/A"}`,l=B?`Strategic Goal: ${B.name}`:"No Strategic Goal Assigned";t.text("MANUEL S. ENVERGA UNIVERSITY FOUNDATION",14,10),t.text(n,14,15),t.text(l,14,20),t.setFontSize(12),t.text("SY 2024-2025",14,25),t.setFontSize(12);const v=["Actions Taken","KPI","Target Output","Key Person Responsible"],k=r($).map(u=>[u.actions_taken,u.kpi,u.target_output,u.key_person_responsible]);ht(t,{head:[v],body:k,startY:35,theme:"grid",styles:{fontSize:10},headStyles:{fillColor:[41,128,185]}});const _=t.internal.pageSize.height-30;t.text(`${e} (sgnd)`,14,_-5),t.text("_________________________",14,_),t.text(`${o} Department Head`,14,_+5),t.text(`${K||"N/A"} (sgnd)`,100,_-5),t.text("_________________________",100,_),t.text("Corporate Planning Officer",100,_+5),r($).some(u=>u.is_approved_vp)?t.text(`${V||"N/A"} (sgnd)`,180,_-5):t.text(`${V||"N/A"}`,180,_-5),t.text("_________________________",180,_),t.text("Vice President",180,_+5),r($).some(u=>u.is_approved_president)?t.text(`${C||"N/A"} (sgnd)`,260,_-5):t.text(`${C||"N/A"}`,260,_-5),t.text("_________________________",260,_),t.text("President",260,_+5),t.save("ActionPlans.pdf")},M=z(()=>r($).filter(e=>`${e.department_name} ${e.actions_taken} ${e.kpi} ${e.target_output} ${e.key_person_responsible}`.toLowerCase().includes(r(Q).toLowerCase())).sort((e,o)=>{const t=e[r(N)].toString().toLowerCase(),n=o[r(N)].toString().toLowerCase();return r(I)==="asc"?t.localeCompare(n):n.localeCompare(t)})),ye=z(()=>r(M).slice((r(b)-1)*r(A),r(b)*r(A))),Ye=z(()=>Math.ceil(r(M).length/r(A))),we=e=>{r(N)===e?f(I,D(r(I)==="asc"?"desc":"asc")):(f(N,D(e)),f(I,"asc"))};var X=Ct(),Z=i(s(X),2),ee=s(Z),te=s(ee),Ae=s(te);yt(Ae,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var ke=i(Ae,2);ft(ke),a(te);var O=i(te,2);O.__change=W;var re=s(O);re.value=(re.__value="all")==null?"":"all";var He=i(re);Ce(He,17,()=>r(xe),Oe,(e,o)=>{var t=wt(),n={},l=s(t,!0);a(t),H(()=>{n!==(n=r(o).name)&&(t.value=(t.__value=r(o).name)==null?"":r(o).name),x(l,r(o).name)}),y(e,t)}),a(O);var T=i(O,2);T.__change=W;var oe=s(T);oe.value=(oe.__value="all")==null?"":"all";var ae=i(oe);ae.value=(ae.__value="approved")==null?"":"approved";var Pe=i(ae);Pe.value=(Pe.__value="notApproved")==null?"":"notApproved",a(T);var se=i(T,2),ie=s(se);ie.value=(ie.__value=5)==null?"":5;var ne=i(ie);ne.value=(ne.__value=10)==null?"":10;var le=i(ne);le.value=(le.__value=25)==null?"":25;var Ne=i(le);Ne.value=(Ne.__value=50)==null?"":50,a(se),a(ee);var Qe=i(ee,2);be(Qe,()=>r($).length>0,e=>{var o=At();o.__click=Me,y(e,o)}),a(Z);var Be=i(Z,2);be(Be,()=>h,e=>{var o=kt();y(e,o)},e=>{var o=vt(),t=Ve(o);be(t,()=>r(ye).length>0,n=>{var l=Ft(),v=Ve(l),k=s(v),Y=s(k),_=s(Y),E=s(_),S=s(E);S.__click=[Pt,we];var u=i(s(S)),Je=z(()=>r(N)==="department_name"?"text-primary":"");Te(u,{size:16,get class(){return r(Je)}}),a(S),a(E);var $e=i(E),_e=s($e);_e.__click=[Nt,we];var We=i(s(_e)),Xe=z(()=>r(N)==="actions_taken"?"text-primary":"");Te(We,{size:16,get class(){return r(Xe)}}),a(_e),a($e),dt(4),a(_),a(Y);var Ee=i(Y);Ce(Ee,21,()=>r(ye),Oe,(et,c)=>{var pe=St(),ve=s(pe),tt=s(ve,!0);a(ve);var me=i(ve),rt=s(me,!0);a(me);var fe=i(me),ot=s(fe,!0);a(fe);var ue=i(fe),at=s(ue,!0);a(ue);var ge=i(ue),st=s(ge,!0);a(ge);var Fe=i(ge),U=s(Fe);U.__click=[$t,Ke,c];var it=s(U,!0);a(U);var nt=i(U,2);nt.__click=[Et,Ge,c],a(Fe),a(pe),H(()=>{x(tt,r(c).department_name),x(rt,r(c).actions_taken),x(ot,r(c).kpi),x(at,r(c).target_output),x(st,r(c).key_person_responsible),U.disabled=h||p==="admin"&&r(c).is_approved||p==="vice_president"&&(!r(c).is_approved||r(c).is_approved_vp)||p==="president"&&(!r(c).is_approved_vp||r(c).is_approved_president),x(it,h?"Processing...":p==="admin"?r(c).is_approved?"Admin Approved":"Approve as Admin":p==="vice_president"?r(c).is_approved_vp?"VP Approved":"Approve as VP":p==="president"?r(c).is_approved_president?"President Approved":"Approve as President":"Approve")}),y(et,pe)}),a(Ee),a(k),a(v);var Se=i(v,2),de=s(Se),Ze=s(de);H(()=>x(Ze,`Showing ${(r(b)-1)*r(A)+1} to ${Math.min(r(b)*r(A),r(M).length)??""} of ${r(M).length??""} results`)),a(de);var De=i(de,2),ce=s(De);ce.__click=[Dt,b];var je=i(ce,2);je.__click=[jt,b],a(De),a(Se),H(()=>{ce.disabled=r(b)===1,je.disabled=r(b)===r(Ye)}),y(n,l)},n=>{var l=Vt();y(n,l)},!0),y(e,o)}),a(X),ut(ke,()=>r(Q),e=>f(Q,e)),he(O,()=>r(L),e=>f(L,e)),he(T,()=>r(R),e=>f(R,e)),he(se,()=>r(A),e=>f(A,e)),y(w,X),_t()}ct(["change","click"]);export{Wt as component};

import"../chunks/disclose-version.Bg9kRutz.js";import{p as ct,e as b,a as vt,b as m,g as r,c as i,s as n,f as he,t as I,h as O,r as s,n as ft}from"../chunks/utils.Cx6K9qTo.js";import{d as ut,s as mt,a as A,t as N,e as gt,c as xt,b as P}from"../chunks/store.BALTJZ26.js";import{i as ye}from"../chunks/if.Bgpzl8Wa.js";import{e as Ie,r as bt,i as Oe}from"../chunks/attributes.rzeD2olC.js";import{b as ht}from"../chunks/input.BVFrb_g3.js";import{b as we}from"../chunks/select.BtlRD387.js";import{a as D}from"../chunks/preload-helper.Tg4Km7Zr.js";import{o as yt}from"../chunks/index-client.lWLCSZVk.js";import{s as u}from"../chunks/Icon.Nl6wOSVO.js";import{E as wt,a as At}from"../chunks/jspdf.plugin.autotable.BCh_1lSd.js";import{p as Pt}from"../chunks/stores.iWLj25CT.js";import{S as kt}from"../chunks/search.BpYLThKw.js";import{A as qe}from"../chunks/arrow-up-down.CZ0J7o1e.js";import{T as Et}from"../chunks/trash-2.d9YwO6MY.js";var Nt=N("<option> </option>"),$t=N('<button class="flex items-center gap-2 bg-secondary text-secondary-foreground px-4 py-2 rounded-lg hover:bg-secondary/90 transition-colors">Export to PDF</button> <button class="flex items-center gap-2 bg-primary text-primary-foreground px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50"></button>',1),St=N('<div class="flex justify-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),jt=(k,_)=>_("department_name"),Dt=(k,_)=>_("actions_taken"),Ft=(k,_,F)=>_(r(F).id),Tt=(k,_,F)=>_(r(F).id),Ct=N('<tr class="hover:bg-muted/50"><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"> </td><td class="px-4 py-3"><div class="flex justify-center gap-2"><button class="px-2 py-1 rounded bg-green-500 text-white hover:bg-green-600 disabled:opacity-50 text-sm"> </button> <button class="p-1.5 hover:bg-muted rounded-lg text-red-400"><!></button></div></td></tr>'),Ut=(k,_)=>m(_,r(_)-1),Vt=(k,_)=>m(_,r(_)+1),zt=N('<div class="overflow-x-auto bg-card rounded-lg shadow border border-border"><table class="min-w-full table-auto"><thead class="bg-muted/50"><tr><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">Department <!></button></th><th class="px-4 py-3 text-left"><button class="flex items-center gap-1">Actions Taken <!></button></th><th class="px-4 py-3 text-left">KPI</th><th class="px-4 py-3 text-left">Target Output</th><th class="px-4 py-3 text-left">Key Person Responsible</th><th class="px-4 py-3 text-center">Actions</th></tr></thead><tbody class="divide-y divide-border"></tbody></table></div> <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-4"><div class="text-sm text-muted-foreground"> </div> <div class="flex flex-col sm:flex-row items-center gap-4"><select class="bg-secondary border-secondary rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-ring w-full sm:w-auto"><option>5 per page</option><option>10 per page</option><option>25 per page</option><option>50 per page</option></select> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50 transition-colors">Previous</button> <button class="px-3 py-1 rounded-lg border border-border hover:bg-muted disabled:opacity-50 transition-colors">Next</button></div></div>',1),It=N('<div class="flex justify-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>'),Ot=N('<div class="flex flex-col gap-4 p-4 container mx-auto"><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"><div class="flex items-center gap-2"><h1 class="text-2xl font-bold">Action Plans</h1></div></div> <div class="flex flex-col md:flex-row gap-4 mb-6"><div class="flex flex-col md:flex-row gap-4 flex-1"><div class="relative flex-1 w-full md:max-w-[300px]"><!> <input type="text" placeholder="Search action plans..." class="pl-10 pr-4 py-2 bg-secondary rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-ring"></div> <select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring w-full md:w-[200px]"><option>All Departments</option><!></select> <select class="bg-secondary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring w-full md:w-[200px]"><option>All Status</option><option>Approved</option><option>Not Approved</option></select></div> <div class="flex gap-2"><!></div></div> <!></div>');function tr(k,_){ct(_,!0);const F=mt(),Le=()=>xt(Pt,"$page",F);let J=b(""),h=b(1),E=b(5),$=b("department_name"),q=b("asc"),L=[],y=b(D([])),Ae=b(D([])),R=b("all"),G=b("all"),K=null,W=null,T=null,c=!1,M=null,C=null,U=null,d=null;yt(async()=>{const{params:e}=Le();if(T=parseInt(e.id),T)try{await Re(),await Y(),await Ge(),await Ke(),await Me(),await Ye()}catch(o){console.error("Error:",o)}finally{c=!1}else console.error("Objective ID is missing."),c=!1});const Re=async()=>{try{const{data:{session:e}}=await u.auth.getSession();if(!e||!e.user)return;const{data:o,error:t}=await u.from("profiles").select("role").eq("id",e.user.id).single();t?console.error("Error fetching user role:",t):d=o.role}catch(e){console.error("Error fetching current user role:",e)}},Y=async()=>{if(!T){console.error("Objective ID is missing.");return}const{data:e,error:o}=await u.from("action_plans").select(`
      *,
      profiles (
        first_name,
        last_name,
        departments (name)
      )
    `).eq("objective_id",T);o?console.error("Error fetching action plans:",o):(L=e.map(t=>{var a,l,v,g;return{id:t.id,actions_taken:t.actions_taken,kpi:t.kpi,target_output:t.target_output,key_person_responsible:t.key_person_responsible,created_at:t.created_at,objective_id:t.objective_id,is_approved:t.is_approved,is_approved_vp:t.is_approved_vp,is_approved_president:t.is_approved_president,profile_id:t.profile_id,department_name:((l=(a=t.profiles)==null?void 0:a.departments)==null?void 0:l.name)||"Unknown",user_name:`${((v=t.profiles)==null?void 0:v.first_name)||""} ${((g=t.profiles)==null?void 0:g.last_name)||""}`}}),X())},Ge=async()=>{const{data:e,error:o}=await u.from("departments").select("id, name");o?console.error("Error fetching departments:",o):m(Ae,D(e))},Ke=async()=>{const{data:e,error:o}=await u.from("strategic_objectives").select("id, name, strategic_goal_id").eq("id",T).single();if(o)console.error("Error fetching objective:",o);else{K=e;const{data:t,error:a}=await u.from("strategic_goals").select("id, name").eq("id",e.strategic_goal_id).single();a?console.error("Error fetching strategic goal:",a):W=t}},Me=async()=>{try{const{data:e,error:o}=await u.from("profiles").select("first_name, last_name").eq("role","admin");o||!e?(console.error("Error fetching admin names:",o||"No data found"),M="N/A"):M=e.map(t=>`${t.first_name} ${t.last_name}`).join(", ")}catch(e){console.error("Error fetching admin details:",e),M="N/A"}},Ye=async()=>{try{const{data:e,error:o}=await u.from("profiles").select("first_name, last_name, role").in("role",["vice_president","president"]);if(o||!e){console.error("Error fetching VP and President names:",o||"No data found"),C="N/A",U="N/A";return}const t=e.find(l=>l.role==="vice_president"),a=e.find(l=>l.role==="president");C=t?`${t.first_name} ${t.last_name}`:"N/A",U=a?`${a.first_name} ${a.last_name}`:"N/A"}catch(e){console.error("Error fetching VP and President details:",e),C="N/A",U="N/A"}},X=()=>{let e=[...L];d==="vice_president"&&(e=e.filter(o=>o.is_approved)),d==="president"&&(e=e.filter(o=>o.is_approved&&o.is_approved_vp)),r(R)!=="all"&&(e=e.filter(o=>o.department_name===r(R))),r(G)==="approved"?e=e.filter(o=>o.is_approved):r(G)==="notApproved"&&(e=e.filter(o=>!o.is_approved)),m(y,D(e))},He=async e=>{const{error:o}=await u.from("action_plans").delete().eq("id",e);o?console.error("Error deleting action plan:",o):await Y()},Qe=async e=>{let o={};if(c=!0,d==="admin")o={is_approved:!0};else if(d==="vice_president")o={is_approved_vp:!0};else if(d==="president")o={is_approved_president:!0};else{c=!1;return}try{const{data:t,error:a}=await u.from("action_plans").update(o).eq("id",e).select();if(a){console.error("Error approving action plan:",a);return}if(d==="president"&&t&&t.length>0){const l=t[0],{error:v}=await u.from("plan_monitoring").insert({action_plan_id:l.id,profile_id:l.profile_id,department_id:l.department_id});v&&console.error("Error inserting into plan_monitoring:",v)}await Y()}catch(t){console.error("Unexpected error while approving action plan:",t)}finally{console.log("Action plan approved successfully."),c=!1}},Be=()=>{var S,j;const e=((S=L[0])==null?void 0:S.user_name)||"Unknown",o=((j=L[0])==null?void 0:j.department_name)||"Unknown",t=new wt("landscape");t.setFont("times","normal"),t.setFontSize(12);const a=`${o} Action Plans for Objective: ${(K==null?void 0:K.name)||"N/A"}`,l=W?`Strategic Goal: ${W.name}`:"No Strategic Goal Assigned";t.text("MANUEL S. ENVERGA UNIVERSITY FOUNDATION",14,10),t.text(a,14,15),t.text(l,14,20),t.setFontSize(12),t.text("SY 2024-2025",14,25),t.setFontSize(12);const v=["Actions Taken","KPI","Target Output","Key Person Responsible"],g=r(y).map(x=>[x.actions_taken,x.kpi,x.target_output,x.key_person_responsible]);At(t,{head:[v],body:g,startY:35,theme:"grid",styles:{fontSize:10},headStyles:{fillColor:[41,128,185]}});const p=t.internal.pageSize.height-30;t.text(`${e} (sgnd)`,14,p-5),t.text("_________________________",14,p),t.text(`${o} Department Head`,14,p+5),t.text(`${M||"N/A"} (sgnd)`,100,p-5),t.text("_________________________",100,p),t.text("Corporate Planning Officer",100,p+5),r(y).some(x=>x.is_approved_vp)?t.text(`${C||"N/A"} (sgnd)`,180,p-5):t.text(`${C||"N/A"}`,180,p-5),t.text("_________________________",180,p),t.text("Vice President",180,p+5),r(y).some(x=>x.is_approved_president)?t.text(`${U||"N/A"} (sgnd)`,260,p-5):t.text(`${U||"N/A"}`,260,p-5),t.text("_________________________",260,p),t.text("President",260,p+5),t.save("ActionPlans.pdf")},H=O(()=>r(y).filter(e=>`${e.department_name} ${e.actions_taken} ${e.kpi} ${e.target_output} ${e.key_person_responsible}`.toLowerCase().includes(r(J).toLowerCase())).sort((e,o)=>{const t=e[r($)].toString().toLowerCase(),a=o[r($)].toString().toLowerCase();return r(q)==="asc"?t.localeCompare(a):a.localeCompare(t)})),Pe=O(()=>r(H).slice((r(h)-1)*r(E),r(h)*r(E))),Je=O(()=>Math.ceil(r(H).length/r(E))),ke=e=>{r($)===e?m(q,D(r(q)==="asc"?"desc":"asc")):(m($,D(e)),m(q,"asc"))},We=async()=>{c=!0;try{let e={};if(d==="admin")e={is_approved:!0};else if(d==="vice_president")e={is_approved_vp:!0};else if(d==="president")e={is_approved_president:!0};else{c=!1;return}const o=r(y).map(v=>v.id),{data:t,error:a}=await u.from("action_plans").select("id, profile_id, department_id").in("id",o);if(a){console.error("Error fetching action plans with department_id:",a),c=!1;return}const{error:l}=await u.from("action_plans").update(e).in("id",o);if(l){console.error("Error approving all action plans:",l),c=!1;return}if(d==="president"&&t){const v=t.map(w=>({action_plan_id:w.id,profile_id:w.profile_id,department_id:w.department_id})),{error:g}=await u.from("plan_monitoring").insert(v);g&&console.error("Error inserting into plan_monitoring:",g)}await Y(),console.log("All action plans approved successfully.")}catch(e){console.error("Unexpected error while approving all action plans:",e)}finally{c=!1}};var Z=Ot(),ee=n(i(Z),2),te=i(ee),re=i(te),Ee=i(re);kt(Ee,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20});var Ne=n(Ee,2);bt(Ne),s(re);var V=n(re,2);V.__change=X;var oe=i(V);oe.value=(oe.__value="all")==null?"":"all";var Xe=n(oe);Ie(Xe,17,()=>r(Ae),Oe,(e,o)=>{var t=Nt(),a={},l=i(t,!0);s(t),I(()=>{a!==(a=r(o).name)&&(t.value=(t.__value=r(o).name)==null?"":r(o).name),P(l,r(o).name)}),A(e,t)}),s(V);var Q=n(V,2);Q.__change=X;var ae=i(Q);ae.value=(ae.__value="all")==null?"":"all";var se=n(ae);se.value=(se.__value="approved")==null?"":"approved";var $e=n(se);$e.value=($e.__value="notApproved")==null?"":"notApproved",s(Q),s(te);var Se=n(te,2),Ze=i(Se);ye(Ze,()=>r(y).length>0,e=>{var o=$t(),t=he(o);t.__click=Be;var a=n(t,2);a.__click=We,I(()=>a.disabled=c||r(y).every(l=>d==="admin"&&l.is_approved||d==="vice_president"&&l.is_approved_vp||d==="president"&&l.is_approved_president)),a.textContent=c?"Processing...":"Approve All",A(e,o)}),s(Se),s(ee);var et=n(ee,2);ye(et,()=>c,e=>{var o=St();A(e,o)},e=>{var o=gt(),t=he(o);ye(t,()=>r(Pe).length>0,a=>{var l=zt(),v=he(l),g=i(v),w=i(g),p=i(w),S=i(p),j=i(S);j.__click=[jt,ke];var x=n(i(j)),tt=O(()=>r($)==="department_name"?"text-primary":"");qe(x,{size:16,get class(){return r(tt)}}),s(j),s(S);var je=n(S),ie=i(je);ie.__click=[Dt,ke];var rt=n(i(ie)),ot=O(()=>r($)==="actions_taken"?"text-primary":"");qe(rt,{size:16,get class(){return r(ot)}}),s(ie),s(je),ft(4),s(p),s(w);var De=n(w);Ie(De,21,()=>r(Pe),Oe,(ce,f)=>{var ve=Ct(),fe=i(ve),st=i(fe,!0);s(fe);var ue=n(fe),it=i(ue,!0);s(ue);var me=n(ue),nt=i(me,!0);s(me);var ge=n(me),lt=i(ge,!0);s(ge);var xe=n(ge),dt=i(xe,!0);s(xe);var Ve=n(xe),ze=i(Ve),z=i(ze);z.__click=[Ft,Qe,f];var pt=i(z,!0);s(z);var be=n(z,2);be.__click=[Tt,He,f];var _t=i(be);Et(_t,{size:16}),s(be),s(ze),s(Ve),s(ve),I(()=>{P(st,r(f).department_name),P(it,r(f).actions_taken),P(nt,r(f).kpi),P(lt,r(f).target_output),P(dt,r(f).key_person_responsible),z.disabled=c||d==="admin"&&r(f).is_approved||d==="vice_president"&&(!r(f).is_approved||r(f).is_approved_vp)||d==="president"&&(!r(f).is_approved_vp||r(f).is_approved_president),P(pt,c?"Processing...":d==="admin"?r(f).is_approved?"Admin Approved":"Approve as Admin":d==="vice_president"?r(f).is_approved_vp?"VP Approved":"Approve as VP":d==="president"?r(f).is_approved_president?"President Approved":"Approve as President":"Approve")}),A(ce,ve)}),s(De),s(g),s(v);var Fe=n(v,2),ne=i(Fe),at=i(ne);I(()=>P(at,`Showing ${(r(h)-1)*r(E)+1} to ${Math.min(r(h)*r(E),r(H).length)??""} of ${r(H).length??""} results`)),s(ne);var Te=n(ne,2),B=i(Te),le=i(B);le.value=(le.__value=5)==null?"":5;var de=n(le);de.value=(de.__value=10)==null?"":10;var pe=n(de);pe.value=(pe.__value=25)==null?"":25;var Ce=n(pe);Ce.value=(Ce.__value=50)==null?"":50,s(B);var _e=n(B,2);_e.__click=[Ut,h];var Ue=n(_e,2);Ue.__click=[Vt,h],s(Te),s(Fe),I(()=>{_e.disabled=r(h)===1,Ue.disabled=r(h)===r(Je)}),we(B,()=>r(E),ce=>m(E,ce)),A(a,l)},a=>{var l=It();A(a,l)},!0),A(e,o)}),s(Z),ht(Ne,()=>r(J),e=>m(J,e)),we(V,()=>r(R),e=>m(R,e)),we(Q,()=>r(G),e=>m(G,e)),A(k,Z),vt()}ut(["change","click"]);export{tr as component};

import"../chunks/disclose-version.Bg9kRutz.js";import{p as ue,f as J,a as me,c as r,s,r as t,e as _,t as S,g as e,b as n,n as H}from"../chunks/utils.Cx6K9qTo.js";import{e as Pe,a as f,t as h,d as $e,s as ze,c as Se,b as x}from"../chunks/store.BALTJZ26.js";import{i as G}from"../chunks/if.Bgpzl8Wa.js";import{e as ve,i as pe,b as Oe,c as Te}from"../chunks/attributes.rzeD2olC.js";import{s as Ce}from"../chunks/class.DKwifj_X.js";import{t as Me,f as Ue}from"../chunks/index.3UqCw1jp.js";import{p as De,a as c}from"../chunks/preload-helper.Tg4Km7Zr.js";import{s as L}from"../chunks/Icon.Nl6wOSVO.js";import{o as Fe}from"../chunks/index-client.lWLCSZVk.js";import{p as Ie}from"../chunks/stores.iWLj25CT.js";import{s as qe}from"../chunks/snippet.nc6DXt7K.js";import{C as Ee}from"../chunks/chevron-left.BQoiznrZ.js";import{P as Ge}from"../chunks/plus.Dop3u5ke.js";import{S as _e}from"../chunks/save.Dylz2glE.js";import{L as Le}from"../chunks/loader-circle.DGJ4eXRr.js";import{X as Ke}from"../chunks/x.D9PBK57y.js";import{T as Be}from"../chunks/trash-2.d9YwO6MY.js";var Ne=h('<div class="fixed inset-0 z-50 overflow-y-auto"><div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0"><div class="fixed inset-0 bg-gray-500 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-75 transition-opacity"></div> <div class="relative transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg"><!></div></div></div>');function Re(g,d){ue(d,!0);let v=De(d,"show",11,!1);var b=Pe(),p=J(b);G(p,v,u=>{var j=Ne(),A=r(j),M=s(r(A),2),U=r(M);qe(U,()=>d.children),t(M),t(A),t(j),f(u,j)}),f(g,b),me()}const Xe=(g,d,v,b,p)=>{e(d)>=0?e(v)[e(d)]={...e(b)}:n(v,c([...e(v),{...e(b)}])),n(p,!1)},He=async(g,d,v,b)=>{if(e(d).length===0){v("Please add at least one action plan.","warning");return}try{n(b,!0);const{error:p}=await L.from("action_plans").insert(e(d));p?v("Failed to submit action plans.","error"):(v("Action plans submitted successfully.","success"),n(d,c([])))}catch{v("An error occurred while submitting action plans.","error")}finally{n(b,!1)}};var Je=h("<div><span> </span></div>"),Qe=h('<div class="mt-4 space-y-2"><h5 class="text-md font-medium">Strategic Goal: <span class="ml-2 text-muted-foreground"> </span></h5> <h5 class="text-md font-medium">Strategic Objective: <span class="ml-2 text-muted-foreground"> </span></h5></div>'),Ve=(g,d)=>d(),We=h('<div class="border border-border rounded-lg p-4 relative hover:bg-muted/50 transition-colors"><div class="grid md:grid-cols-2 gap-4"><div><h4 class="font-medium">Actions Taken</h4> <p class="text-muted-foreground mt-1"> </p></div> <div><h4 class="font-medium">KPI</h4> <p class="text-muted-foreground mt-1"> </p></div> <div><h4 class="font-medium">Target Output</h4> <p class="text-muted-foreground mt-1"> </p></div> <div><h4 class="font-medium">Key Person Responsible</h4> <p class="text-muted-foreground mt-1"> </p></div></div> <div class="absolute top-4 right-4 flex gap-2"><button class="p-2 text-blue-600 hover:bg-blue-50 rounded-full transition-colors"><!></button> <button class="p-2 text-red-600 hover:bg-red-50 rounded-full transition-colors"><!></button></div></div>'),Ye=h('<div class="text-center py-8 text-muted-foreground">No action plans added yet. Click "Add Plan" to create one.</div>'),Ze=h("<!> Submitting...",1),et=h("<!> Submit All",1),tt=(g,d)=>n(d,!1),rt=(g,d,v)=>e(d)[v]=g.target.value,at=h('<div class="space-y-2"><label class="block text-sm font-medium"> </label> <textarea class="w-full px-3 py-2 rounded-lg bg-secondary border border-border focus:ring-2 focus:ring-ring"></textarea></div>'),ot=(g,d)=>n(d,!1),st=h('<div class="p-6"><div class="flex justify-between items-center mb-6"><h3 class="text-xl font-semibold"> </h3> <button class="text-muted-foreground hover:text-foreground transition-colors"><!></button></div> <div class="space-y-4"></div> <div class="mt-6 flex justify-end gap-4"><button class="px-4 py-2 border border-border rounded-lg text-muted-foreground hover:bg-muted transition-colors">Cancel</button> <button class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors"> </button></div></div>'),it=h('<div class="flex flex-col gap-4 p-4 container mx-auto"><!> <a href="/plans/operationalPlans" class="flex items-center gap-2 text-muted-foreground mb-2 hover:text-foreground"><!> Back to Operational Plans</a> <div class="bg-card border border-border rounded-lg shadow p-6"><h1 class="text-2xl font-bold">Action Plans</h1> <!></div> <div class="bg-card rounded-lg shadow border border-border p-6"><div class="flex justify-between items-center mb-6"><h2 class="text-xl font-semibold">Action Plans List</h2> <button class="inline-flex items-center gap-2 bg-primary text-primary-foreground px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors"><!> Add Plan</button></div> <div class="space-y-4"></div> <!></div> <div class="flex justify-end"><button class="inline-flex items-center gap-2 bg-primary text-primary-foreground px-6 py-2 rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50"><!></button></div></div> <!>',1);function At(g,d){ue(d,!0);const v=ze(),b=()=>Se(Ie,"$page",v);let p=_(c([])),u=_(c({actions_taken:"",kpi:"",target_output:"",key_person_responsible:"",objective_id:0,profile_id:"",department_id:""})),j=_(null),A=_(null),M=_(""),U=_("info"),D=_(null),Q=_(!1),V=_(""),O=_(!1),F=_(-1),W=_(!1);Fe(()=>{const{params:o}=b();n(D,c(parseInt(o.id))),e(D)?(e(u).objective_id=e(D),ge(e(D)),fe()):P("Objective ID is missing.","error")});const fe=async()=>{const{data:{user:o}}=await L.auth.getUser();if(o){const{data:a,error:i}=await L.from("profiles").select("id, department_id").eq("id",o.id).single();if(i||!a){P("Failed to fetch user profile details.","error");return}n(V,c(a.id)),e(u).profile_id=e(V),e(u).department_id=a.department_id}else P("User not logged in.","error")},ge=async o=>{try{const{data:a,error:i}=await L.from("strategic_objectives").select("name, strategic_goal_id").eq("id",o).single();if(i||!a){P("Failed to fetch strategic objective.","error");return}n(j,c(a));const{data:l,error:m}=await L.from("strategic_goals").select("name, goal_no").eq("id",a.strategic_goal_id).single();if(m||!l){P("Failed to fetch strategic goal.","error");return}n(A,c(l))}catch{P("An error occurred while fetching strategic data.","error")}},ne=(o=-1)=>{o>=0?(n(u,c({...e(p)[o]})),n(F,c(o))):(n(u,c({actions_taken:"",kpi:"",target_output:"",key_person_responsible:"",objective_id:e(D)||0,profile_id:e(V),department_id:e(u).department_id})),n(F,-1)),n(O,!0)},be=o=>{confirm("Are you sure you want to delete this plan?")&&n(p,c(e(p).filter((a,i)=>i!==o)))},P=(o,a)=>{n(M,c(o)),n(U,c(a)),n(W,!0),setTimeout(()=>{n(W,!1)},3e3)};var de=it(),Y=J(de),le=r(Y);G(le,()=>e(W),o=>{var a=Je(),i=r(a),l=r(i,!0);t(i),t(a),S(()=>{Ce(a,`flex items-center p-4 rounded-lg ${(e(U)==="success"?"bg-green-100 text-green-800":e(U)==="error"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800")??""}`),x(l,e(M))}),Me(3,a,()=>Ue),f(o,a)});var Z=s(le,2),xe=r(Z);Ee(xe,{size:20}),H(),t(Z);var ee=s(Z,2),he=s(r(ee),2);G(he,()=>e(A)&&e(j),o=>{var a=Qe(),i=r(a),l=s(r(i)),m=r(l);t(l),t(i);var k=s(i,2),y=s(r(k)),I=r(y,!0);t(y),t(k),t(a),S(()=>{x(m,`${e(A).goal_no??""} - ${e(A).name??""}`),x(I,e(j).name)}),f(o,a)}),t(ee);var te=s(ee,2),re=r(te),ae=s(r(re),2);ae.__click=[Ve,ne];var ye=r(ae);Ge(ye,{size:20}),H(),t(ae),t(re);var oe=s(re,2);ve(oe,21,()=>e(p),pe,(o,a,i)=>{var l=We(),m=r(l),k=r(m),y=s(r(k),2),I=r(y,!0);t(y),t(k);var $=s(k,2),q=s(r($),2),B=r(q,!0);t(q),t($);var z=s($,2),N=s(r(z),2),se=r(N,!0);t(N),t(z);var T=s(z,2),C=s(r(T),2),E=r(C,!0);t(C),t(T),t(m);var R=s(m,2),w=r(R);w.__click=()=>ne(i);var X=r(w);_e(X,{size:18}),t(w);var ie=s(w,2);ie.__click=()=>be(i);var Ae=r(ie);Be(Ae,{size:18}),t(ie),t(R),t(l),S(()=>{x(I,e(a).actions_taken),x(B,e(a).kpi),x(se,e(a).target_output),x(E,e(a).key_person_responsible)}),f(o,l)}),t(oe);var ke=s(oe,2);G(ke,()=>e(p).length===0,o=>{var a=Ye();f(o,a)}),t(te);var ce=s(te,2),K=r(ce);K.__click=[He,p,P,Q];var we=r(K);G(we,()=>e(Q),o=>{var a=Ze(),i=J(a);Le(i,{class:"animate-spin",size:20}),H(),f(o,a)},o=>{var a=et(),i=J(a);_e(i,{size:20}),H(),f(o,a)}),t(K),t(ce),t(Y);var je=s(Y,2);Re(je,{get show(){return e(O)},set show(o){n(O,c(o))},children:(o,a)=>{var i=st(),l=r(i),m=r(l),k=r(m);t(m);var y=s(m,2);y.__click=[tt,O];var I=r(y);Ke(I,{size:24}),t(y),t(l);var $=s(l,2);ve($,20,()=>["actions_taken","kpi","target_output","key_person_responsible"],pe,(se,T)=>{var C=at(),E=r(C),R=r(E,!0);S(()=>x(R,T.split("_").map(X=>X.charAt(0).toUpperCase()+X.slice(1)).join(" "))),t(E);var w=s(E,2);Oe(w),w.__input=[rt,u,T],t(C),S(()=>Te(w,e(u)[T])),f(se,C)}),t($);var q=s($,2),B=r(q);B.__click=[ot,O];var z=s(B,2);z.__click=[Xe,F,p,u,O];var N=r(z);t(z),t(q),t(i),S(()=>{x(k,`${(e(F)>=0?"Edit":"Add")??""} Action Plan`),x(N,`${(e(F)>=0?"Update":"Add")??""} Plan`)}),f(o,i)},$$slots:{default:!0}}),S(()=>K.disabled=e(Q)),f(g,de),me()}$e(["click","input"]);export{At as component};

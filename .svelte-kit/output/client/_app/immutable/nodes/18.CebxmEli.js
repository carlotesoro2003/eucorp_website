import"../chunks/disclose-version.Bg9kRutz.js";import{p as ae,a as re,b as u,g as e,f as J,s as l,t as K,d as M,m as h,c as o,r as i,n as te}from"../chunks/runtime.CLSstnwU.js";import{a as p,t as P,c as le,b as y,e as O}from"../chunks/utils.kA-YjkFf.js";import{i as g}from"../chunks/if.b2Q-jNLG.js";import{r as q,s as oe,a as ie}from"../chunks/attributes.DiUoHvyc.js";import{b as Q}from"../chunks/input.CQDk-SFX.js";import{p as se}from"../chunks/event-modifiers.CWmzcjye.js";import{i as ne}from"../chunks/lifecycle.V0dJQ05z.js";import{p as pe}from"../chunks/props.BD0jg91j.js";/* empty css                         */import{s as x}from"../chunks/supabaseClient.CaMOPPuz.js";var fe=P('<span class="loading loading-spinner loading-sm"></span> <p>Loading...</p>',1),ce=P('<img alt="Profile Picture" class="rounded-full w-32 h-32 mx-auto mb-4">'),ue=P('<h1 class=" font-bold text-4xl">Edit Profile</h1> <!> <form class="mt-4"><div class="mb-4"><label for="profile-pic" class=" mb-2 cursor-pointer">Profile Picture</label> <div class="relative"><input id="profile-pic" type="file" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"> <button type="button" class="w-full py-2 px-4 border border-gray-300 rounded-lg bg-gray-100 hover:bg-gray-200 focus:outline-none text-gray-700"><!></button></div></div> <div class="mb-4"><label for="first-name">First Name</label> <input id="first-name" type="text" placeholder="Enter first name" class="input input-bordered w-full"></div> <div class="mb-4"><label for="last-name">Last Name</label> <input id="last-name" type="text" placeholder="Enter last name" class="input input-bordered w-full"></div> <div class="mb-4"><label for="role">Role</label> <input id="role" type="text" disabled class="input input-bordered w-full bg-gray-100"></div> <button type="submit" class="btn btn-primary w-full"><!></button></form>',1),de=P('<div class="hero min-h-screen overflow-y-auto"><div class="hero-content flex flex-col items-center justify-center"><div class="max-w-md text-center"><!></div></div></div>');function Ee(T,D){ae(D,!1);let V=pe(D,"data",8);const{session:d}=V();let a=h(null),F=h(!0),_=h(!1),c=null,m=h(null);const W=async()=>{if(d){const{user:s}=d,{data:r,error:f}=await x.from("profiles").select("first_name, last_name, email, role, profile_pic").eq("id",s.id).single();f?console.error("Error fetching user profile:",f.message):(u(a,r),u(m,e(a).profile_pic||null))}u(F,!1)},N=async()=>{if(e(a)&&d){u(_,!0);const{user:s}=d;let r=e(a).profile_pic;if(c){console.log("Uploading new profile picture...");const{data:v,error:b}=await x.storage.from("profile-pictures").upload(`public/${s.id}/${c.name}`,c,{cacheControl:"3600",upsert:!0});b?console.error("Error uploading profile picture:",b.message):v&&(console.log("Upload successful:",v),r=x.storage.from("profile-pictures").getPublicUrl(v.path).data.publicUrl,console.log("Public URL of profile picture:",r),u(m,r))}const{error:f}=await x.from("profiles").update({first_name:e(a).first_name,last_name:e(a).last_name,email:e(a).email,profile_pic:r}).eq("id",s.id);f?console.error("Error updating profile:",f.message):(console.log("Profile updated successfully!"),alert("Profile updated successfully!")),u(_,!1)}},X=async s=>{const r=s.target;c=r.files?r.files[0]:null,c&&(console.log("Selected file for upload:",c.name),N())};W(),ne();var w=de(),R=o(w),j=o(R),Y=o(j);g(Y,()=>e(F),s=>{var r=fe();te(2),p(s,r)},s=>{var r=le(),f=J(r);g(f,()=>d!==null&&e(a),v=>{var b=ue(),k=l(J(b),2);g(k,()=>e(m),t=>{var n=ce();K(()=>oe(n,"src",e(m))),p(t,n)});var U=l(k,2),E=o(U),$=l(o(E),2),z=o($),A=l(z,2),Z=o(A);g(Z,()=>e(m),t=>{var n=y("Change Image");p(t,n)},t=>{var n=y("Upload Image");p(t,n)}),i(A),i($),i(E);var C=l(E,2),B=l(o(C),2);q(B),i(C);var I=l(C,2),G=l(o(I),2);q(G),i(I);var L=l(I,2),H=l(o(L),2);q(H),i(L);var S=l(L,2),ee=o(S);g(ee,()=>e(_),t=>{var n=y("Saving...");p(t,n)},t=>{var n=y("Save Profile");p(t,n)}),i(S),i(U),K(()=>{ie(H,e(a).role),S.disabled=e(_)}),O("change",z,X),Q(B,()=>e(a).first_name,t=>M(a,e(a).first_name=t)),Q(G,()=>e(a).last_name,t=>M(a,e(a).last_name=t)),O("submit",U,se(N)),p(v,b)},null,!0),p(s,r)}),i(j),i(R),i(w),p(T,w),re()}export{Ee as component};
